
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>Intel® Security Libraries - Datacenter Foundational Security - Intel® SecL-DC</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.75751829.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intel-security-libraries-datacenter-foundational-security" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Intel® SecL-DC" class="md-header-nav__button md-logo" aria-label="Intel® SecL-DC">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Intel® SecL-DC
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Intel® Security Libraries - Datacenter Foundational Security
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://raghav19.github.io/docs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    intel-secl/intel-secl
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Intel® SecL-DC" class="md-nav__button md-logo" aria-label="Intel® SecL-DC">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Intel® SecL-DC
  </label>
  
    <div class="md-nav__source">
      
<a href="https://raghav19.github.io/docs" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    intel-secl/intel-secl
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome to Intel® SecL-DC
      </a>
    </li>
  

    
      
      
      


  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Quick Start Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Quick Start Guide" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Quick Start Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
      
      <label class="md-nav__link" for="nav-2-1">
        Foundational & Workload
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Foundational & Workload" data-md-level="2">
        <label class="md-nav__title" for="nav-2-1">
          <span class="md-nav__icon md-icon"></span>
          Foundational & Workload
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/foundational_workload/pre-reqs/" class="md-nav__link">
        Pre-requisites
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/foundational_workload/build/" class="md-nav__link">
        Build
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/foundational_workload/deploy/" class="md-nav__link">
        Deploy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/foundational_workload/workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/foundational_workload/appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" >
      
      <label class="md-nav__link" for="nav-2-2">
        Secure Key Caching
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Secure Key Caching" data-md-level="2">
        <label class="md-nav__title" for="nav-2-2">
          <span class="md-nav__icon md-icon"></span>
          Secure Key Caching
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/secure_key_caching/pre-reqs/" class="md-nav__link">
        Pre-requisites
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/secure_key_caching/build/" class="md-nav__link">
        Build
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/secure_key_caching/deploy/" class="md-nav__link">
        Deploy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/secure_key_caching/workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start-guide/secure_key_caching/appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      


  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
      
      <label class="md-nav__link" for="nav-3">
        Product Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Product Guide" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Product Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Intel® Security Libraries - Datacenter Foundational Security
      </a>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Product%20Guide%20-%20Intel%C2%AE%20Security%20Libraries%20-%20Secure%20Key%20Caching/" class="md-nav__link">
        Intel® Security Libraries - Datacenter SGX Attestation Infrastructure and Secure Key Caching
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="intel-security-libraries-datacenter-foundational-security">Intel® Security Libraries - Datacenter Foundational Security</h1>
<p><strong>Product Guide</strong></p>
<p><strong>January 2020</strong></p>
<p><strong>Revision 3.3.1</strong></p>
<p>Notice: This document contains information on products in the design phase of development. The information here is subject to change without notice. Do not finalize a design with this information.</p>
<p>Intel technologies’ features and benefits depend on system configuration and may require enabled hardware, software, or service activation. Learn more at intel.com, or from the OEM or retailer.</p>
<p>No computer system can be absolutely secure. Intel does not assume any liability for lost or stolen data or systems or any damages resulting from such losses.</p>
<p>You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.</p>
<p>No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document.</p>
<p>The products described may contain design defects or errors known as errata which may cause the product to deviate from published
specifications. Current characterized errata are available on request.</p>
<p>This document contains information on products, services and/or processes in development. All information provided here is subject to
change without notice. Contact your Intel representative to obtain the latest Intel product specifications and roadmaps.</p>
<p>Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.</p>
<p>Warning: Altering PC clock or memory frequency and/or voltage may (i) reduce system stability and use life of the system, memory and
processor; (ii) cause the processor and other system components to fail; (iii) cause reductions in system performance; (iv) cause additional heat or other damage; and (v) affect system data integrity. Intel assumes no responsibility that the memory, included if used with altered clock frequencies and/or voltages, will be fit for any particular purpose.
Check with memory manufacturer for warranty and additional details.</p>
<p>Tests document performance of components on a particular test, in specific systems. Differences in hardware, software, or configuration
will affect actual performance. Consult other sources of information to evaluate performance as you consider your purchase. For more complete information about performance and benchmark results, visit <a href="http://www.intel.com/performance">http://www.intel.com/performance</a>.</p>
<p>Cost reduction scenarios described are intended as examples of how a given Intel- based product, in the specified circumstances and
configurations, may affect future costs and provide cost savings. Circumstances will vary. Intel does not guarantee any costs or cost
reduction.</p>
<p>Results have been estimated or simulated using internal Intel analysis or architecture simulation or modeling, and provided to you for
informational purposes. Any differences in your system hardware, software or configuration may affect your actual performance.</p>
<p>Intel does not control or audit third-party benchmark data or the web sites referenced in this document. You should visit the referenced web site and confirm whether referenced data are accurate.</p>
<p>Intel is a sponsor and member of the Benchmark XPRT Development Community, and was the major developer of the XPRT family of benchmarks. Principled Technologies is the publisher of the XPRT family of benchmarks. You should consult other information and performance tests to assist you in fully evaluating your contemplated purchases.</p>
<p>Copies of documents which have an order number and are referenced in this document may be obtained by calling 1-800-548-4725 or by visiting w<a href="http://www.intel.com/design/literature.htm">ww.intel.com/design/literature.htm.</a></p>
<p>Intel, the Intel logo, Intel TXT, and Xeon are trademarks of Intel Corporation in the U.S. and/or other countries.</p>
<p>*Other names and brands may be claimed as the property of others.</p>
<p>Copyright © 2020, Intel Corporation. All Rights Reserved.</p>
<h1 id="revision-history">Revision History</h1>
<table>
<thead>
<tr>
<th>Revision  Number</th>
<th>Description</th>
<th>Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Updated for all GA Failures</td>
<td>May 2019</td>
</tr>
<tr>
<td>1.5</td>
<td>Updated for version 1.5 release</td>
<td>July 2019</td>
</tr>
<tr>
<td>1.6 BETA</td>
<td>Updated for 1.6 BETA release</td>
<td>November 2019</td>
</tr>
<tr>
<td>1.6</td>
<td>Updated for version 1.6 release</td>
<td>December 2019</td>
</tr>
<tr>
<td>2.0</td>
<td>Updated for version 2.0 release</td>
<td>February 2020</td>
</tr>
<tr>
<td>2.1</td>
<td>Updated for version 2.1 release</td>
<td>April 2020</td>
</tr>
<tr>
<td>2.2</td>
<td>Updated for version 2.2 release</td>
<td>June 2020</td>
</tr>
<tr>
<td>3.0</td>
<td>Updated for version 3.0 release</td>
<td>August 2020</td>
</tr>
<tr>
<td>3.1</td>
<td>Updated for version 3.1 release</td>
<td>October 2020</td>
</tr>
<tr>
<td>3.2</td>
<td>Updated for version 3.2 release</td>
<td>November 2020</td>
</tr>
<tr>
<td>3.3</td>
<td>Updated for version 3.3 release</td>
<td>December 2020</td>
</tr>
<tr>
<td>3.3.1</td>
<td>Updated for version 3.3.1 release</td>
<td>January 2020</td>
</tr>
</tbody>
</table>
<h1 id="table-of-contents">Table of Contents</h1>
<div class="toc">
<ul>
<li><a href="#intel-security-libraries-datacenter-foundational-security">Intel® Security Libraries - Datacenter Foundational Security</a></li>
<li><a href="#revision-history">Revision History</a></li>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#1-introduction">1  Introduction</a><ul>
<li><a href="#11-overview">1.1  Overview</a><ul>
<li><a href="#111-trusted-computing">1.1.1  Trusted Computing</a><ul>
<li><a href="#1111-the-chain-of-trust">1.1.1.1  The Chain of Trust</a></li>
<li><a href="#1112-hardware-root-of-trust">1.1.1.2  Hardware Root of Trust</a><ul>
<li><a href="#11121-intel-trusted-execution-technology-intel-txt">1.1.1.2.1  Intel® Trusted Execution Technology (Intel® TXT)</a></li>
<li><a href="#11122-intel-bootguard-intel-btg">1.1.1.2.2  Intel® BootGuard (Intel® BtG)</a></li>
</ul>
</li>
<li><a href="#1113-supported-trusted-boot-options">1.1.1.3  Supported Trusted Boot Options</a></li>
<li><a href="#1114-remote-attestation">1.1.1.4  Remote Attestation</a></li>
</ul>
</li>
<li><a href="#112-intel-security-libraries-for-datacenter-features">1.1.2  Intel® Security Libraries for Datacenter Features</a><ul>
<li><a href="#1121-platform-integrity">1.1.2.1  Platform Integrity</a></li>
<li><a href="#1122-data-sovereignty">1.1.2.2  Data Sovereignty</a></li>
<li><a href="#1123-application-integrity">1.1.2.3  Application Integrity</a></li>
<li><a href="#1124-workload-confidentiality-for-virtual-machines-and-containers">1.1.2.4  Workload Confidentiality for Virtual Machines and Containers</a></li>
<li><a href="#1125-signed-flavors">1.1.2.5  Signed Flavors</a></li>
<li><a href="#1126-trusted-virtual-kubernetes-worker-nodes">1.1.2.6  Trusted Virtual Kubernetes Worker Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-intel-security-libraries-components">2  Intel® Security Libraries Components</a><ul>
<li><a href="#21-certificate-management-service">2.1  Certificate Management Service</a></li>
<li><a href="#22-authentication-and-authorization-service">2.2  Authentication and Authorization Service</a></li>
<li><a href="#23-verification-service">2.3  Verification Service</a></li>
<li><a href="#24-workload-service">2.4  Workload Service</a></li>
<li><a href="#25-trust-agent">2.5  Trust Agent</a></li>
<li><a href="#26-workload-agent">2.6  Workload Agent</a></li>
<li><a href="#27-integration-hub">2.7  Integration Hub</a></li>
<li><a href="#28-workload-policy-manager">2.8  Workload Policy Manager</a></li>
<li><a href="#29-key-broker-service">2.9  Key Broker Service</a></li>
</ul>
</li>
<li><a href="#3-intel-security-libraries-installation">3  Intel® Security Libraries Installation</a><ul>
<li><a href="#31-building-from-source">3.1  Building from Source</a></li>
<li><a href="#32-hardware-considerations">3.2  Hardware Considerations</a></li>
<li><a href="#33-recommended-service-layout">3.3  Recommended Service Layout</a><ul>
<li><a href="#331-platform-integrity">3.3.1  Platform Integrity</a></li>
<li><a href="#332-workload-confidentiality">3.3.2  Workload Confidentiality</a></li>
</ul>
</li>
<li><a href="#34-installingconfiguring-the-database">3.4  Installing/Configuring the Database</a><ul>
<li><a href="#341-using-the-provided-database-installation-script">3.4.1  Using the Provided Database Installation Script</a></li>
<li><a href="#342-provisioning-the-database">3.4.2  Provisioning the Database</a></li>
<li><a href="#343-database-server-tls-certificate">3.4.3  Database Server TLS Certificate</a></li>
</ul>
</li>
<li><a href="#35-installing-the-certificate-management-service">3.5  Installing the Certificate Management Service</a><ul>
<li><a href="#351-required-for">3.5.1  Required For</a></li>
<li><a href="#352-supported-operating-systems">3.5.2  Supported Operating Systems</a></li>
<li><a href="#353-recommended-hardware">3.5.3  Recommended Hardware</a></li>
<li><a href="#354-installation">3.5.4  Installation</a></li>
</ul>
</li>
<li><a href="#36-installing-the-authentication-and-authorization-service">3.6  Installing the Authentication and Authorization Service</a><ul>
<li><a href="#361-required-for">3.6.1  Required For</a></li>
<li><a href="#362-prerequisites">3.6.2  Prerequisites</a></li>
<li><a href="#363-package-dependencies">3.6.3  Package Dependencies</a></li>
<li><a href="#364-supported-operating-systems">3.6.4  Supported Operating Systems</a></li>
<li><a href="#365-recommended-hardware">3.6.5  Recommended Hardware</a></li>
<li><a href="#366-installation">3.6.6  Installation</a></li>
<li><a href="#367-creating-users">3.6.7  Creating Users</a></li>
</ul>
</li>
<li><a href="#37-installing-the-host-verification-service">3.7  Installing the Host Verification Service</a><ul>
<li><a href="#371-required-for">3.7.1  Required For</a></li>
<li><a href="#372-prerequisites">3.7.2  Prerequisites</a></li>
<li><a href="#373-package-dependencies">3.7.3  Package Dependencies</a></li>
<li><a href="#374-supported-operating-systems">3.7.4  Supported Operating Systems</a></li>
<li><a href="#375-recommended-hardware">3.7.5  Recommended Hardware</a></li>
<li><a href="#376-installation">3.7.6  Installation</a></li>
</ul>
</li>
<li><a href="#38-installing-the-workload-service">3.8  Installing the Workload Service</a><ul>
<li><a href="#381-required-for">3.8.1  Required For</a></li>
<li><a href="#382-prerequisites">3.8.2  Prerequisites</a></li>
<li><a href="#383-supported-operating-systems">3.8.3  Supported Operating Systems</a></li>
<li><a href="#384-recommended-hardware">3.8.4  Recommended Hardware</a></li>
<li><a href="#385-installation">3.8.5  Installation</a></li>
</ul>
</li>
<li><a href="#39-installing-the-trust-agent-for-linux">3.9  Installing the Trust Agent for Linux</a><ul>
<li><a href="#391-required-for">3.9.1  Required For</a></li>
<li><a href="#392-package-dependencies">3.9.2  Package Dependencies</a></li>
<li><a href="#393-supported-operating-systems">3.9.3  Supported Operating Systems</a></li>
<li><a href="#394-prerequisites">3.9.4  Prerequisites</a><ul>
<li><a href="#3941-tboot-installation">3.9.4.1  Tboot Installation</a></li>
</ul>
</li>
<li><a href="#395-installation">3.9.5  Installation</a></li>
</ul>
</li>
<li><a href="#310-installing-the-workload-agent">3.10  Installing the Workload Agent</a><ul>
<li><a href="#3101-required-for">3.10.1  Required For</a></li>
<li><a href="#3102-supported-operating-systems">3.10.2  Supported Operating Systems</a></li>
<li><a href="#3103-prerequisites">3.10.3  Prerequisites</a></li>
<li><a href="#3104-installation">3.10.4  Installation</a></li>
</ul>
</li>
<li><a href="#312-trust-agent-provisioning">3.12  Trust Agent Provisioning</a></li>
<li><a href="#313-trust-agent-registration">3.13  Trust Agent Registration</a></li>
<li><a href="#314-importing-the-host_unique-flavor">3.14  Importing the HOST_UNIQUE Flavor</a></li>
<li><a href="#315-installing-the-integration-hub">3.15  Installing the Integration Hub</a><ul>
<li><a href="#3151-required-for">3.15.1  Required For</a></li>
<li><a href="#3152-deployment-architecture-considerations-for-the-hub">3.15.2  Deployment Architecture Considerations for the Hub</a></li>
<li><a href="#3153-prerequisites">3.15.3  Prerequisites</a></li>
<li><a href="#3154-package-dependencies">3.15.4  Package Dependencies</a></li>
<li><a href="#3155-supported-operating-systems">3.15.5  Supported Operating Systems</a></li>
<li><a href="#3156-recommended-hardware">3.15.6  Recommended Hardware</a></li>
<li><a href="#3157-installing-the-integration-hub">3.15.7  Installing the Integration Hub</a></li>
</ul>
</li>
<li><a href="#316-installing-the-key-broker-service">3.16  Installing the Key Broker Service</a><ul>
<li><a href="#3161-required-for">3.16.1  Required For</a></li>
<li><a href="#3162-prerequisites">3.16.2  Prerequisites</a></li>
<li><a href="#3163-package-dependencies">3.16.3  Package Dependencies</a></li>
<li><a href="#3164-supported-operating-systems">3.16.4  Supported Operating Systems</a></li>
<li><a href="#3165-recommended-hardware">3.16.5  Recommended Hardware</a></li>
<li><a href="#3166-installation">3.16.6  Installation</a><ul>
<li><a href="#31661-configure-the-key-broker-to-use-a-kmip-compliant-key-management-server">3.16.6.1  Configure the Key Broker to use a KMIP-compliant Key Management Server</a></li>
</ul>
</li>
<li><a href="#3167-importing-verification-service-certificates">3.16.7  Importing Verification Service Certificates</a><ul>
<li><a href="#31671-importing-a-saml-certificate">3.16.7.1  Importing a SAML certificate</a></li>
<li><a href="#31672-importing-a-privacyca-certificate">3.16.7.2  Importing a PrivacyCA Certificate</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#317-installing-the-workload-policy-manager">3.17  Installing the Workload Policy Manager</a><ul>
<li><a href="#3171-required-for">3.17.1  Required For</a></li>
<li><a href="#3172-package-dependencies">3.17.2  Package Dependencies</a></li>
<li><a href="#3173-supported-operating-systems">3.17.3  Supported Operating Systems</a></li>
<li><a href="#3174-recommended-hardware">3.17.4  Recommended Hardware</a></li>
<li><a href="#3175-installation">3.17.5  Installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-authentication">4  Authentication</a><ul>
<li><a href="#41-create-token">4.1  Create Token</a></li>
<li><a href="#42-user-management">4.2  User Management</a><ul>
<li><a href="#421-username-and-password-requirements">4.2.1  Username and Password requirements</a></li>
<li><a href="#422-create-user">4.2.2  Create User</a></li>
<li><a href="#423-search-user">4.2.3  Search User</a></li>
<li><a href="#424-change-user-password">4.2.4  Change User Password</a></li>
<li><a href="#425-delete-user">4.2.5  Delete User</a></li>
</ul>
</li>
<li><a href="#43-roles-and-permissions">4.3  Roles and Permissions</a><ul>
<li><a href="#431-create-role">4.3.1  Create Role</a></li>
<li><a href="#432-search-roles">4.3.2  Search Roles</a></li>
<li><a href="#433-delete-role">4.3.3  Delete Role</a></li>
<li><a href="#434-assign-role-to-user">4.3.4  Assign Role to User</a></li>
<li><a href="#435-list-roles-assigned-to-user">4.3.5  List Roles Assigned to User</a></li>
<li><a href="#436-remove-role-from-user">4.3.6  Remove Role from User</a></li>
<li><a href="#437-role-definitions">4.3.7  Role Definitions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-connection-strings">5  Connection Strings</a><ul>
<li><a href="#51-trust-agent">5.1  Trust Agent</a></li>
<li><a href="#52-vmware-esxi">5.2  VMware ESXi</a><ul>
<li><a href="#521-importing-vmware-tls-certificates">5.2.1 Importing VMware TLS Certificates</a></li>
<li><a href="#522-registering-a-vmware-esxi-host">5.2.2  Registering a VMware ESXi Host</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-platform-integrity-attestation">6  Platform Integrity Attestation</a><ul>
<li><a href="#61-host-registration">6.1  Host Registration</a><ul>
<li><a href="#611-trust-agent">6.1.1  Trust Agent</a><ul>
<li><a href="#6111-registration-via-trust-agent-command-line">6.1.1.1  Registration via Trust Agent Command Line</a></li>
</ul>
</li>
<li><a href="#612-registration-via-verification-service-api">6.1.2  Registration via Verification Service API</a><ul>
<li><a href="#6121-special-note-for-vmware-esxi-hosts-and-the-vcenter-tls-certificate">6.1.2.1  Special Note for VMware ESXi Hosts and the vCenter TLS Certificate</a></li>
<li><a href="#6122-sample-call">6.1.2.2  Sample Call</a></li>
<li><a href="#6123-sample-call-for-esxi-cluster-registration">6.1.2.3  Sample Call for ESXi Cluster Registration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#62-flavor-creation-for-automatic-flavor-matching">6.2  Flavor Creation for Automatic Flavor Matching</a><ul>
<li><a href="#621-importing-a-flavor-from-a-sample-host">6.2.1  Importing a Flavor from a Sample Host</a></li>
<li><a href="#622-creating-a-flavor-manually">6.2.2  Creating a Flavor Manually</a></li>
</ul>
</li>
<li><a href="#63-creating-the-default-software-flavor-linux-only">6.3  Creating the Default SOFTWARE Flavor (Linux Only)</a></li>
<li><a href="#64-creating-and-provisioning-asset-tags">6.4  Creating and Provisioning Asset Tags</a><ul>
<li><a href="#641-creating-asset-tag-certificates">6.4.1  Creating Asset Tag Certificates</a></li>
<li><a href="#642-deploying-asset-tags">6.4.2  Deploying Asset Tags</a><ul>
<li><a href="#6421-red-hat-enterprise-linux">6.4.2.1  Red Hat Enterprise Linux</a></li>
<li><a href="#6422-vmware">6.4.2.2  VMWare</a><ul>
<li><a href="#64221-calculate-the-certificate-hash-value">6.4.2.2.1  Calculate the Certificate Hash Value</a></li>
<li><a href="#64222-provision-the-certificate-hash-to-the-host-tpm">6.4.2.2.2  Provision the Certificate Hash to the Host TPM</a><ul>
<li><a href="#vsphere-65-update-2-or-later">vSphere 6.5 Update 2 or Later</a></li>
<li><a href="#vsphere-65-update-1-or-older">vSphere 6.5 Update 1 or Older</a></li>
</ul>
</li>
<li><a href="#64223-creating-the-asset-tag-flavor-vmware-esxi-only">6.4.2.2.3  Creating the Asset Tag Flavor (VMWare ESXi Only)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#65-retrieving-current-attestation-reports">6.5  Retrieving Current Attestation Reports</a></li>
<li><a href="#66-retrieving-current-host-state-information">6.6  Retrieving Current Host State Information</a></li>
<li><a href="#67-upgrading-hosts-in-the-datacenter-to-a-new-bios-or-os-version">6.7  Upgrading Hosts in the Datacenter to a New BIOS or OS Version</a></li>
<li><a href="#68-removing-hosts-from-the-verification-service">6.8  Removing Hosts From the Verification Service</a></li>
<li><a href="#69-removing-flavors">6.9  Removing Flavors</a></li>
<li><a href="#610-invalidating-asset-tags">6.10 Invalidating Asset Tags</a></li>
<li><a href="#611-remediating-an-untrusted-attestation">6.11  Remediating an Untrusted attestation</a></li>
<li><a href="#612-attestation-reporting">6.12  Attestation Reporting</a><ul>
<li><a href="#6121-sample-call-generating-a-new-attestation-report">6.12.1  Sample Call – Generating a New Attestation Report</a></li>
<li><a href="#6122-sample-call-retrieving-an-existing-attestation-report">6.12.2  Sample Call – Retrieving an Existing Attestation Report</a></li>
</ul>
</li>
<li><a href="#613-integration">6.13  Integration</a><ul>
<li><a href="#6131-the-integration-hub">6.13.1  The Integration Hub</a></li>
<li><a href="#6132-integration-with-openstack">6.13.2  Integration with OpenStack</a><ul>
<li><a href="#61321-prerequisites">6.13.2.1  Prerequisites</a></li>
<li><a href="#61322-setting-image-traits">6.13.2.2  Setting Image Traits</a></li>
<li><a href="#61323-configuring-the-integration-hub-for-use-with-openstack">6.13.2.3  Configuring the Integration Hub for Use with OpenStack</a></li>
<li><a href="#61327-scheduling-instances">6.13.2.7  Scheduling Instances</a></li>
</ul>
</li>
<li><a href="#6133-integration-with-kubernetes">6.13.3  Integration with Kubernetes</a><ul>
<li><a href="#61331-prerequisites">6.13.3.1  Prerequisites</a></li>
<li><a href="#61332-installing-the-intel-secl-custom-resource-definitions">6.13.3.2  Installing the Intel® SecL Custom Resource Definitions</a></li>
<li><a href="#61333-configuring-the-integration-hub-for-use-with-kubernetes">6.13.3.3   Configuring the Integration Hub for Use with Kubernetes</a></li>
<li><a href="#61336-configuring-pods-to-require-intel-secl-attributes">6.13.3.6  Configuring Pods to Require Intel® SecL Attributes</a></li>
<li><a href="#61337-tainting-untrusted-worker-nodes">6.13.3.7  Tainting Untrusted Worker Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#7-workload-confidentiality">7  Workload Confidentiality</a><ul>
<li><a href="#71-virtual-machine-confidentiality">7.1  Virtual Machine Confidentiality</a><ul>
<li><a href="#711-prerequisites">7.1.1  Prerequisites</a></li>
<li><a href="#712-workflow">7.1.2  Workflow</a><ul>
<li><a href="#7121-encrypting-images">7.1.2.1  Encrypting Images</a></li>
<li><a href="#7122-uploading-the-image-flavor">7.1.2.2  Uploading the Image Flavor</a></li>
<li><a href="#7123-creating-the-image-flavor-to-image-id-association">7.1.2.3  Creating the Image Flavor to Image ID Association</a></li>
<li><a href="#7124-launching-encrypted-vms">7.1.2.4  Launching Encrypted VMs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#72-container-confidentiality">7.2  Container Confidentiality</a><ul>
<li><a href="#721-container-integrity-and-confidentiality-with-docker">7.2.1  Container Integrity and Confidentiality with Docker</a><ul>
<li><a href="#7211-docker-container-integrity">7.2.1.1  Docker Container Integrity</a></li>
<li><a href="#7212-prerequisites">7.2.1.2  Prerequisites</a></li>
<li><a href="#7213-workflow">7.2.1.3  Workflow</a><ul>
<li><a href="#72131-encrypting-docker-container-images">7.2.1.3.1  Encrypting Docker Container Images</a></li>
<li><a href="#72132-uploading-the-image-flavor">7.2.1.3.2  Uploading the Image Flavor</a></li>
<li><a href="#72133-creating-the-image-flavor-to-image-id-association">7.2.1.3.3  Creating the Image Flavor to Image ID Association</a></li>
<li><a href="#72134-launching-encrypted-docker-containers">7.2.1.3.4  Launching Encrypted Docker Containers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#722-container-confidentiality-with-cri-o-and-skopeo">7.2.2  Container Confidentiality with Cri-o and Skopeo</a><ul>
<li><a href="#7221-prerequisites">7.2.2.1  Prerequisites</a></li>
<li><a href="#7222-workflow">7.2.2.2  Workflow</a><ul>
<li><a href="#skopeo-commands">Skopeo Commands</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#prepare-an-image">Prepare an Image</a></li>
<li><a href="#72221-pulling-and-encrypting-a-container-image">7.2.2.2.1 Pulling and Encrypting a Container Image</a></li>
<li><a href="#72222-launching-an-encrypted-container-image">7.2.2.2.2 Launching an Encrypted Container Image</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-trusted-virtual-kubernetes-worker-nodes">8  Trusted Virtual Kubernetes Worker Nodes</a><ul>
<li><a href="#81-prerequisites">8.1  Prerequisites</a></li>
<li><a href="#82-workflow">8.2  Workflow</a></li>
<li><a href="#83-sample-vm-trust-report">8.3  Sample VM Trust Report</a></li>
</ul>
</li>
<li><a href="#9-flavor-management">9  Flavor Management</a><ul>
<li><a href="#91-flavor-format-definitions">9.1  Flavor Format Definitions</a><ul>
<li><a href="#911-meta">9.1.1  Meta</a></li>
<li><a href="#912-hardware">9.1.2  Hardware</a></li>
<li><a href="#pcrs">PCRs</a></li>
<li><a href="#914-sample-platform-flavor">9.1.4  Sample PLATFORM Flavor</a></li>
<li><a href="#915-sample-os-flavor">9.1.5  Sample OS Flavor</a></li>
<li><a href="#916-sample-host_unique-flavor">9.1.6  Sample HOST_UNIQUE Flavor</a></li>
<li><a href="#917-sample-asset_tag-flavor">9.1.7  Sample ASSET_TAG Flavor</a></li>
</ul>
</li>
<li><a href="#92-flavor-matching">9.2  Flavor Matching</a><ul>
<li><a href="#921-when-does-flavor-matching-happen">9.2.1  When Does Flavor Matching Happen?</a></li>
<li><a href="#922-flavor-matching-performance">9.2.2  Flavor Matching Performance</a></li>
<li><a href="#923-flavor-groups">9.2.3  Flavor Groups</a></li>
<li><a href="#924-default-flavor-group">9.2.4  Default Flavor Group</a><ul>
<li><a href="#9241-automatic">9.2.4.1  automatic</a></li>
<li><a href="#9242-unique">9.2.4.2  unique</a></li>
</ul>
</li>
<li><a href="#925-flavor-match-policies">9.2.5  Flavor Match Policies</a><ul>
<li><a href="#9251-default-flavor-match-policy">9.2.5.1  Default Flavor Match Policy</a></li>
<li><a href="#9252-any_of">9.2.5.2  ANY_OF</a></li>
<li><a href="#9253-all_of">9.2.5.3  ALL_OF</a></li>
<li><a href="#9254-latest">9.2.5.4  LATEST</a></li>
<li><a href="#9255-required">9.2.5.5  REQUIRED</a></li>
<li><a href="#9256-required_if_defined">9.2.5.6  REQUIRED_IF_DEFINED</a></li>
</ul>
</li>
<li><a href="#926-flavor-match-event-triggers">9.2.6  Flavor Match Event Triggers</a></li>
<li><a href="#927-sample-flavorgroup-api-calls">9.2.7  Sample Flavorgroup API Calls</a><ul>
<li><a href="#9271-create-a-new-flavorgroup">9.2.7.1  Create a New Flavorgroup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#93-software-flavor-management">9.3  SOFTWARE Flavor Management</a><ul>
<li><a href="#931-what-is-a-software-flavor">9.3.1  What is a SOFTWARE Flavor?</a></li>
<li><a href="#932-creating-a-software-flavor-part">9.3.2  Creating a SOFTWARE Flavor part</a><ul>
<li><a href="#9321-directories">9.3.2.1  Directories</a></li>
<li><a href="#9322-symlinks">9.3.2.2  Symlinks</a></li>
<li><a href="#9323-files">9.3.2.3  Files</a></li>
</ul>
</li>
<li><a href="#933-sample-software-flavor-creation-call">9.3.3  Sample SOFTWARE Flavor Creation Call</a></li>
<li><a href="#934-deploying-a-software-flavor-manifest-to-a-host">9.3.4  Deploying a SOFTWARE Flavor Manifest to a Host</a></li>
<li><a href="#935-software-flavor-matching">9.3.5  SOFTWARE Flavor Matching</a></li>
<li><a href="#936-kernel-upgrades">9.3.6  Kernel Upgrades</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#10-scalability-and-sizing">10  Scalability and Sizing</a><ul>
<li><a href="#101-configuration-maximums">10.1  Configuration Maximums</a><ul>
<li><a href="#1011-registered-hosts">10.1.1  Registered Hosts</a></li>
<li><a href="#1012-hdd-space">10.1.2  HDD Space</a></li>
</ul>
</li>
<li><a href="#102-database-rotation-settings">10.2  Database Rotation Settings</a></li>
<li><a href="#103-log-rotation">10.3  Log Rotation</a></li>
</ul>
</li>
<li><a href="#11-intel-security-libraries-configuration-settings">11  Intel Security Libraries Configuration Settings</a><ul>
<li><a href="#111-verification-service">11.1  Verification Service</a><ul>
<li><a href="#1111-installation-answer-file-options">11.1.1  Installation Answer File Options</a></li>
<li><a href="#1112-configuration-options">11.1.2  Configuration Options</a></li>
<li><a href="#1113-command-line-options">11.1.3  Command-Line Options</a><ul>
<li><a href="#11131-help">11.1.3.1  Help</a></li>
<li><a href="#11132-start">11.1.3.2  Start</a></li>
<li><a href="#11133-stop">11.1.3.3  Stop</a></li>
<li><a href="#11135-status">11.1.3.5  Status</a></li>
<li><a href="#11136-uninstall">11.1.3.6  Uninstall</a></li>
<li><a href="#11137-version">11.1.3.7  Version</a></li>
<li><a href="#111310-erase-data">11.1.3.10  Erase-data</a></li>
<li><a href="#111316-setup">11.1.3.16  Setup</a></li>
</ul>
</li>
<li><a href="#1114-directory-layout">11.1.4  Directory Layout</a></li>
</ul>
</li>
<li><a href="#112-trust-agent">11.2  Trust Agent</a><ul>
<li><a href="#1121-installation-answer-file-options">11.2.1  Installation Answer File Options</a></li>
<li><a href="#1122-configuration-options">11.2.2  Configuration Options</a></li>
<li><a href="#1123-command-line-options">11.2.3  Command-Line Options</a><ul>
<li><a href="#11231-available-commands">11.2.3.1  Available Commands</a><ul>
<li><a href="#112311-help">11.2.3.1.1  help</a></li>
<li><a href="#112312-setup-task">11.2.3.1.2  setup [task]</a><ul>
<li><a href="#tagent-setup-all">tagent setup (all)</a></li>
<li><a href="#tagent-setup-trustagentenv">tagent setup trustagent.env</a></li>
<li><a href="#tagent-setup-download-ca-cert">tagent setup download-ca-cert</a></li>
<li><a href="#tagent-setup-download-cert">tagent setup download-cert</a></li>
<li><a href="#tagent-setup-update-certificates">tagent setup update-certificates</a></li>
<li><a href="#tagent-setup-provision-attestation">tagent setup provision-attestation</a></li>
<li><a href="#tagent-setup-create-host">tagent setup create-host</a></li>
<li><a href="#tagent-setup-create-host-unique-flavor">tagent setup create-host-unique-flavor</a></li>
<li><a href="#tagent-setup-get-configured-manifest">tagent setup get-configured-manifest</a></li>
<li><a href="#environment-variables-used-by-tagent-setup">Environment variables used by tagent setup:</a></li>
</ul>
</li>
<li><a href="#112313-uninstall">11.2.3.1.3  uninstall</a></li>
<li><a href="#112314-version">11.2.3.1.4  version</a></li>
<li><a href="#112315-start">11.2.3.1.5  start</a></li>
<li><a href="#112316-stop">11.2.3.1.6  stop</a></li>
<li><a href="#112327-status">11.2.3.2.7  status</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#1124-directory-layout">11.2.4  Directory Layout</a><ul>
<li><a href="#11241-windows">11.2.4.1  Windows</a></li>
<li><a href="#11242-linux">11.2.4.2 Linux</a><ul>
<li><a href="#112421-bin">11.2.4.2.1  Bin</a></li>
<li><a href="#112422-configuration">11.2.4.2.2  Configuration</a></li>
<li><a href="#112423-var">11.2.4.2.3  Var</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#113-integration-hub">11.3  Integration Hub</a><ul>
<li><a href="#1131-installation-answer-file">11.3.1  Installation Answer File</a></li>
<li><a href="#1132-configuration-options">11.3.2  Configuration Options</a></li>
<li><a href="#1133-command-line-options">11.3.3  Command-Line Options</a><ul>
<li><a href="#11331-available-commands">11.3.3.1  Available Commands</a><ul>
<li><a href="#113311-help">11.3.3.1.1  Help</a></li>
<li><a href="#113312-start">11.3.3.1.2  Start</a></li>
<li><a href="#113313-stop">11.3.3.1.3  Stop</a></li>
<li><a href="#113315-status">11.3.3.1.5  Status</a></li>
<li><a href="#113315-uninstall">11.3.3.1.5  Uninstall</a></li>
<li><a href="#113316-version">11.3.3.1.6  Version</a></li>
<li><a href="#1133110-setup">11.3.3.1.10  Setup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#1134-directory-layout">11.3.4  Directory Layout</a><ul>
<li><a href="#1341-logs">1.3.4.1  Logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#114-certificate-management-service">11.4  Certificate Management Service</a><ul>
<li><a href="#1141-installation-answer-file-options">11.4.1  Installation Answer File Options</a></li>
<li><a href="#1142-configuration-options">11.4.2  Configuration Options</a></li>
<li><a href="#1143-command-line-options">11.4.3  Command-Line Options</a><ul>
<li><a href="#11431-help">11.4.3.1  Help</a></li>
<li><a href="#11432-start">11.4.3.2  Start</a></li>
<li><a href="#11433-stop">11.4.3.3  Stop</a></li>
<li><a href="#11435-status">11.4.3.5  Status</a></li>
<li><a href="#11436-uninstall">11.4.3.6  Uninstall</a></li>
<li><a href="#11437-version">11.4.3.7  Version</a></li>
<li><a href="#11438-tlscertsha384">11.4.3.8  Tlscertsha384</a></li>
<li><a href="#11439-setup-task">11.4.3.9  setup [task]</a><ul>
<li><a href="#cms-setup-server-portport">cms setup server [--port=&lt;port&gt;]</a></li>
<li><a href="#cms-setup-root_ca-force">cms setup root_ca [--force]</a></li>
<li><a href="#cms-setup-tls-force-host_nameshost_names">cms setup tls [--force] [--host_names=&lt;host_names&gt;]</a></li>
<li><a href="#cms-setup-cms_auth_token-force">cms setup cms_auth_token [--force]</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#1144-directory-layout">11.4.4  Directory Layout</a><ul>
<li><a href="#11441-bin">11.4.4.1  Bin</a></li>
<li><a href="#11442-cacerts">11.44.2 Cacerts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#115-authentication-and-authorization-service">11.5  Authentication and Authorization Service</a><ul>
<li><a href="#1151-installation-answer-file-options">11.5.1  Installation Answer File Options</a></li>
<li><a href="#1152-configuration-options">11.5.2  Configuration Options</a></li>
<li><a href="#1153-command-line-options">11.5.3  Command-Line Options</a><ul>
<li><a href="#11531-help">11.5.3.1  Help</a></li>
<li><a href="#11532-setup-task">11.5.3.2  setup \&lt;task&gt;</a><ul>
<li><a href="#115321-authservice-setup-all">11.5.3.2.1  authservice setup all</a></li>
<li><a href="#115322-authservice-setup-database-force-argumentsargument_value">11.5.3.2.2  authservice setup database [-force] [--arguments=\&lt;argument_value&gt;]</a></li>
<li><a href="#115323-authservice-setup-server-portport">11.5.3.2.3  authservice setup server [--port=&lt;port&gt;]</a></li>
<li><a href="#115324-authservice-setup-admin-userusername-passpassword">11.5.3.2.4  authservice setup admin [--user=&lt;username&gt;] [--pass=&lt;password&gt;]</a></li>
<li><a href="#115325-authservice-setup-download_ca_cert-force">11.5.3.2.5  authservice setup download_ca_cert [--force]</a></li>
<li><a href="#115326-authservice-setup-download_cert-tls-force">11.5.3.2.6  authservice setup download_cert TLS [--force]</a></li>
<li><a href="#115327-authservice-setup-jwt">11.5.3.2.7  authservice setup jwt</a></li>
</ul>
</li>
<li><a href="#115328-start">11.5.3.2.8  Start</a></li>
<li><a href="#115329-status">11.5.3.2.9  Status</a></li>
<li><a href="#1153210-stop">11.5.3.2.10  Stop</a></li>
<li><a href="#1153211-tlscertsha384">11.5.3.2.11  tlscertsha384</a></li>
<li><a href="#1153212-uninstall">11.5.3.2.12  Uninstall</a></li>
<li><a href="#1153213-version">11.5.3.2.13  Version</a></li>
</ul>
</li>
<li><a href="#1154-directory-layout">11.5.4  Directory Layout</a><ul>
<li><a href="#11541-bin">11.5.4.1 Bin</a></li>
<li><a href="#11542-dbscripts">11.5.4.2  dbscripts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#116-workload-service">11.6  Workload Service</a><ul>
<li><a href="#1161-installation-answer-file-options">11.6.1  Installation Answer File Options</a></li>
<li><a href="#1162-configuration-options">11.6.2  Configuration Options</a></li>
<li><a href="#1163-command-line-options">11.6.3  Command-Line Options</a><ul>
<li><a href="#11631-help">11.6.3.1  Help</a></li>
<li><a href="#11632-start">11.6.3.2  start</a></li>
<li><a href="#11633-stop">11.6.3.3  stop</a></li>
<li><a href="#11634-status">11.6.3.4  status</a></li>
<li><a href="#11635-uninstall">11.6.3.5  uninstall</a></li>
<li><a href="#11636-setup">11.6.3.6  setup</a><ul>
<li><a href="#116361-download_ca_cert">11.6.3.6.1  download_ca_cert</a></li>
<li><a href="#116362-download_cert-tls">11.6.3.6.2  download_cert TLS</a></li>
<li><a href="#116363-server">11.6.3.6.3  server</a></li>
<li><a href="#116364-database-setup-workload-service-database">11.6.3.6.4  database     Setup workload-service database</a></li>
<li><a href="#116365-hvsconnection">11.6.3.6.5  hvsconnection</a></li>
<li><a href="#116366-aasconnection">11.6.3.6.6  aasconnection</a></li>
<li><a href="#116367-logs">11.6.3.6.7  logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#1164-directory-layout">11.6.4 Directory Layout</a></li>
</ul>
</li>
<li><a href="#117-key-broker-service">11.7  Key Broker Service</a><ul>
<li><a href="#1171-installation-answer-file-options">11.7.1  Installation Answer File Options</a></li>
<li><a href="#1172-configuration-options">11.7.2  Configuration Options</a></li>
<li><a href="#1173-command-line-options">11.7.3 Command-Line Options</a><ul>
<li><a href="#_1"></a></li>
</ul>
</li>
<li><a href="#1174-directory-layout">11.7.4  Directory Layout</a><ul>
<li><a href="#optkbsbin">/opt/kbs/bin</a></li>
<li><a href="#etckbs">/etc/kbs/</a></li>
<li><a href="#varlogkbs">/var/log/kbs/</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#118-workload-agent">11.8  Workload Agent</a><ul>
<li><a href="#1181-installation-answer-file-options">11.8.1  Installation Answer File Options</a></li>
<li><a href="#1182-configuration-options">11.8.2  Configuration Options</a></li>
<li><a href="#1183-command-line-options">11.8.3  Command-Line Options</a><ul>
<li><a href="#11831-help">11.8.3.1  Help</a></li>
<li><a href="#11832-setup">11.8.3.2  setup</a><ul>
<li><a href="#118321-available-tasks-for-setup">11.8.3.2.1  Available Tasks for setup</a><ul>
<li><a href="#signingkey">SigningKey</a></li>
<li><a href="#bindingkey">BindingKey</a></li>
<li><a href="#registersigningkey">RegisterSigningKey</a></li>
<li><a href="#registerbindingkey">RegisterBindingKey</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#11833-start">11.8.3.3  start</a></li>
<li><a href="#11834-stop">11.8.3.4  stop</a></li>
<li><a href="#11835-status">11.8.3.5  status</a></li>
<li><a href="#11836-uninstall">11.8.3.6  uninstall</a></li>
<li><a href="#11837-uninstall-purge">11.8.3.7  uninstall --purge</a></li>
<li><a href="#11838-version">11.8.3.8  version</a></li>
</ul>
</li>
<li><a href="#1184-directory-layout">11.8.4  Directory Layout</a><ul>
<li><a href="#11841-bin">11.8.4.1  Bin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#119-workload-policy-manager">11.9  Workload Policy Manager</a><ul>
<li><a href="#1191-installation-answer-file-options">11.9.1  Installation Answer File Options</a></li>
<li><a href="#1192-configuration-options">11.9.2  Configuration Options</a></li>
<li><a href="#1193-command-line-options">11.9.3  Command-Line Options</a><ul>
<li><a href="#11931-create-image-flavor">11.9.3.1  create-image-flavor</a></li>
<li><a href="#11932-create-container-image-flavor">11.9.3.2  create-container-image-flavor</a></li>
<li><a href="#11933-get-container-image-id">11.9.3.3  get-container-image-id</a></li>
<li><a href="#11934-create-software-flavor">11.9.3.4  create-software-flavor</a></li>
<li><a href="#11935-uninstall">11.9.3.5  Uninstall</a></li>
<li><a href="#11936-help">11.9.3.6  --help</a></li>
<li><a href="#11937-version">11.9.3.7  --version</a></li>
<li><a href="#11938-setup">11.9.3.8  Setup</a><ul>
<li><a href="#119381-wpm-setup">11.9.3.8.1  wpm setup</a></li>
<li><a href="#119382-wpm-setup-createenvelopekey">11.9.3.8.2  wpm setup CreateEnvelopeKey</a></li>
<li><a href="#119383-wpm-setup-registerenvelopekey">11.9.3.8.3  wpm setup RegisterEnvelopeKey</a></li>
<li><a href="#119384-wpm-setup-download_ca_cert-force">11.9.3.8.4  wpm setup download_ca_cert [--force]</a></li>
<li><a href="#119385-wpm-setup-download_cert-flavor-signing-force">11.9.3.8.5 wpm setup download_cert Flavor-Signing [--force]</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#12-certificate-and-key-management">12  Certificate and Key Management</a><ul>
<li><a href="#121-host-verification-service-certificates-and-keys">12.1  Host Verification Service Certificates and Keys</a><ul>
<li><a href="#1211-saml">12.1.1  SAML</a></li>
<li><a href="#1212-asset-tag">12.1.2  Asset Tag</a></li>
<li><a href="#1213-privacy-ca">12.1.3  Privacy CA</a></li>
<li><a href="#1214-endorsement-ca">12.1.4  Endorsement CA</a></li>
</ul>
</li>
<li><a href="#122-tls-certificates">12.2  TLS Certificates</a></li>
</ul>
</li>
<li><a href="#13-uninstallation">13  Uninstallation</a><ul>
<li><a href="#131-host-verification-service">13.1 Host Verification Service</a></li>
<li><a href="#132-trust-agent">13.2  Trust Agent</a></li>
<li><a href="#133-integration-hub">13.3  Integration Hub</a></li>
</ul>
</li>
<li><a href="#14appendix">14Appendix</a><ul>
<li><a href="#141-pcr-definitions">14.1  PCR Definitions</a><ul>
<li><a href="#1411-red-had-enterprise-linux">14.1.1  Red Had Enterprise Linux</a><ul>
<li><a href="#14111-tpm-20">14.1.1.1  TPM 2.0</a></li>
</ul>
</li>
<li><a href="#1412-vmware-esxi">14.1.2  VMWare ESXi</a><ul>
<li><a href="#14121-tpm-12">14.1.2.1  TPM 1.2</a></li>
<li><a href="#14122-tpm-20">14.1.2.2  TPM 2.0</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a1-attestation-rules">A.1  Attestation Rules</a></li>
<li><a href="#a2-intel-txt-and-the-trusted-boot-process">A.2  Intel TXT and the Trusted Boot Process</a></li>
</ul>
</li>
<li><a href="#_2"></a></li>
<li><a href="#table-of-contents_1">Table of Contents</a><ul>
<li><a href="#1-introduction_1">1  Introduction</a></li>
<li><a href="#11-overview_1">1.1  Overview</a><ul>
<li><a href="#111-trusted-computing_1">1.1.1  Trusted Computing</a><ul>
<li><a href="#1111-the-chain-of-trust_1">1.1.1.1  The Chain of Trust</a></li>
<li><a href="#1112-hardware-root-of-trust_1">1.1.1.2  Hardware Root of Trust</a><ul>
<li><a href="#intel-trusted-execution-technology-intel-txt">Intel® Trusted Execution Technology (Intel® TXT)</a></li>
<li><a href="#intel-bootguard-intel-btg">Intel® BootGuard (Intel® BtG)</a></li>
</ul>
</li>
<li><a href="#1113-supported-trusted-boot-options_1">1.1.1.3  Supported Trusted Boot Options</a></li>
<li><a href="#1114-remote-attestation_1">1.1.1.4  Remote Attestation</a></li>
</ul>
</li>
<li><a href="#112-intel-security-libraries-for-datacenter-features_1">1.1.2  Intel® Security Libraries for Datacenter Features</a><ul>
<li><a href="#1121-platform-integrity_1">1.1.2.1  Platform Integrity</a></li>
<li><a href="#1122-data-sovereignty_1">1.1.2.2  Data Sovereignty</a></li>
<li><a href="#1123-application-integrity_1">1.1.2.3  Application Integrity</a></li>
<li><a href="#1124-workload-confidentiality-for-virtual-machines-and-containers_1">1.1.2.4  Workload Confidentiality for Virtual Machines and Containers</a></li>
<li><a href="#1125-signed-flavors_1">1.1.2.5  Signed Flavors</a></li>
<li><a href="#1126-trusted-virtual-kubernetes-worker-nodes_1">1.1.2.6  Trusted Virtual Kubernetes Worker Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-intel-security-libraries-components_1">2  Intel® Security Libraries Components</a><ul>
<li><a href="#21-certificate-management-service_1">2.1  Certificate Management Service</a></li>
<li><a href="#22-authentication-and-authorization-service_1">2.2  Authentication and Authorization Service</a></li>
<li><a href="#23-verification-service_1">2.3  Verification Service</a></li>
<li><a href="#24-workload-service_1">2.4  Workload Service</a></li>
<li><a href="#25-trust-agent_1">2.5  Trust Agent</a></li>
<li><a href="#26-workload-agent_1">2.6  Workload Agent</a></li>
<li><a href="#27-integration-hub_1">2.7  Integration Hub</a></li>
<li><a href="#28-workload-policy-manager_1">2.8  Workload Policy Manager</a></li>
<li><a href="#29-key-broker-service_1">2.9  Key Broker Service</a></li>
</ul>
</li>
<li><a href="#3-intel-security-libraries-installation_1">3  Intel® Security Libraries Installation</a><ul>
<li><a href="#31-building-from-source_1">3.1  Building from Source</a></li>
<li><a href="#32-hardware-considerations_1">3.2  Hardware Considerations</a></li>
<li><a href="#33-recommended-service-layout_1">3.3  Recommended Service Layout</a><ul>
<li><a href="#331-platform-integrity_1">3.3.1  Platform Integrity</a></li>
<li><a href="#332-workload-confidentiality_1">3.3.2  Workload Confidentiality</a></li>
</ul>
</li>
<li><a href="#34-installingconfiguring-the-database_1">3.4  Installing/Configuring the Database</a><ul>
<li><a href="#341-using-the-provided-database-installation-script_1">3.4.1  Using the Provided Database Installation Script</a></li>
<li><a href="#342-provisioning-the-database_1">3.4.2  Provisioning the Database</a></li>
<li><a href="#343-database-server-tls-certificate_1">3.4.3  Database Server TLS Certificate</a></li>
</ul>
</li>
<li><a href="#35-installing-the-certificate-management-service_1">3.5  Installing the Certificate Management Service</a><ul>
<li><a href="#351-required-for_1">3.5.1  Required For</a></li>
<li><a href="#352-supported-operating-systems_1">3.5.2  Supported Operating Systems</a></li>
<li><a href="#353-recommended-hardware_1">3.5.3  Recommended Hardware</a></li>
<li><a href="#354-installation_1">3.5.4  Installation</a></li>
</ul>
</li>
<li><a href="#36-installing-the-authentication-and-authorization-service_1">3.6  Installing the Authentication and Authorization Service</a><ul>
<li><a href="#361-required-for_1">3.6.1  Required For</a></li>
<li><a href="#362-prerequisites_1">3.6.2  Prerequisites</a></li>
<li><a href="#363-package-dependencies_1">3.6.3  Package Dependencies</a></li>
<li><a href="#364-supported-operating-systems_1">3.6.4  Supported Operating Systems</a></li>
<li><a href="#365-recommended-hardware_1">3.6.5  Recommended Hardware</a></li>
<li><a href="#366-installation_1">3.6.6  Installation</a></li>
<li><a href="#367-creating-users_1">3.6.7  Creating Users</a></li>
</ul>
</li>
<li><a href="#37-installing-the-host-verification-service_1">3.7  Installing the Host Verification Service</a><ul>
<li><a href="#371-required-for_1">3.7.1  Required For</a></li>
<li><a href="#372-prerequisites_1">3.7.2  Prerequisites</a></li>
<li><a href="#373-package-dependencies_1">3.7.3  Package Dependencies</a></li>
<li><a href="#374-supported-operating-systems_1">3.7.4  Supported Operating Systems</a></li>
<li><a href="#375-recommended-hardware_1">3.7.5  Recommended Hardware</a></li>
<li><a href="#376-installation_1">3.7.6  Installation</a></li>
<li><a href="#395-installation_1">3.9.5  Installation</a></li>
</ul>
</li>
<li><a href="#310-installing-the-workload-agent_1">3.10  Installing the Workload Agent</a><ul>
<li><a href="#3101-required-for_1">3.10.1  Required For</a></li>
<li><a href="#3102-supported-operating-systems_1">3.10.2  Supported Operating Systems</a></li>
<li><a href="#3103-prerequisites_1">3.10.3  Prerequisites</a></li>
<li><a href="#3104-installation_1">3.10.4  Installation</a></li>
</ul>
</li>
<li><a href="#311-trust-agent-provisioning">3.11  Trust Agent Provisioning</a></li>
<li><a href="#312-trust-agent-registration">3.12  Trust Agent Registration</a></li>
<li><a href="#313-importing-the-host_unique-flavor">3.13  Importing the HOST_UNIQUE Flavor</a></li>
<li><a href="#314-installing-the-integration-hub">3.14  Installing the Integration Hub</a><ul>
<li><a href="#3141-required-for">3.14.1  Required For</a></li>
<li><a href="#3142-deployment-architecture-considerations-for-the-hub">3.14.2  Deployment Architecture Considerations for the Hub</a></li>
<li><a href="#3143-prerequisites">3.14.3  Prerequisites</a></li>
<li><a href="#3144-package-dependencies">3.14.4  Package Dependencies</a></li>
<li><a href="#3145-supported-operating-systems">3.14.5  Supported Operating Systems</a></li>
<li><a href="#3146-recommended-hardware">3.14.6  Recommended Hardware</a></li>
<li><a href="#3147-installing-the-integration-hub">3.14.7  Installing the Integration Hub</a></li>
</ul>
</li>
<li><a href="#315-installing-the-key-broker-service">3.15  Installing the Key Broker Service</a><ul>
<li><a href="#3151-required-for_1">3.15.1  Required For</a></li>
<li><a href="#3152-prerequisites">3.15.2  Prerequisites</a></li>
<li><a href="#3153-package-dependencies">3.15.3  Package Dependencies</a></li>
<li><a href="#3154-supported-operating-systems">3.15.4  Supported Operating Systems</a></li>
<li><a href="#3155-recommended-hardware">3.15.5  Recommended Hardware</a></li>
<li><a href="#3156-installation">3.15.6  Installation</a><ul>
<li><a href="#31561-configure-the-key-broker-to-use-a-kmip-compliant-key-management-server">3.15.6.1  Configure the Key Broker to use a KMIP-compliant Key Management Server</a></li>
</ul>
</li>
<li><a href="#3157-importing-verification-service-certificates">3.15.7  Importing Verification Service Certificates</a><ul>
<li><a href="#31571-importing-a-saml-certificate">3.15.7.1  Importing a SAML certificate</a></li>
<li><a href="#31572-importing-a-privacyca-certificate">3.15.7.2  Importing a PrivacyCA Certificate</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#316-installing-the-workload-policy-manager">3.16  Installing the Workload Policy Manager</a><ul>
<li><a href="#3161-required-for_1">3.16.1  Required For</a></li>
<li><a href="#3162-package-dependencies">3.16.2  Package Dependencies</a></li>
<li><a href="#3163-supported-operating-systems">3.16.3  Supported Operating Systems</a></li>
<li><a href="#3164-recommended-hardware">3.16.4  Recommended Hardware</a></li>
<li><a href="#3165-installation">3.16.5  Installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-authentication_1">4  Authentication</a><ul>
<li><a href="#41-create-token_1">4.1  Create Token</a></li>
<li><a href="#42-user-management_1">4.2  User Management</a><ul>
<li><a href="#421-username-and-password-requirements_1">4.2.1  Username and Password requirements</a></li>
<li><a href="#422-create-user_1">4.2.2  Create User</a></li>
<li><a href="#423-search-user_1">4.2.3  Search User</a></li>
<li><a href="#424-change-user-password_1">4.2.4  Change User Password</a></li>
<li><a href="#425-delete-user_1">4.2.5  Delete User</a></li>
</ul>
</li>
<li><a href="#43-roles-and-permissions_1">4.3  Roles and Permissions</a><ul>
<li><a href="#431-create-role_1">4.3.1  Create Role</a></li>
<li><a href="#432-search-roles_1">4.3.2  Search Roles</a></li>
<li><a href="#433-delete-role_1">4.3.3  Delete Role</a></li>
<li><a href="#434-assign-role-to-user_1">4.3.4  Assign Role to User</a></li>
<li><a href="#435-list-roles-assigned-to-user_1">4.3.5  List Roles Assigned to User</a></li>
<li><a href="#436-remove-role-from-user_1">4.3.6  Remove Role from User</a></li>
<li><a href="#437-role-definitions_1">4.3.7  Role Definitions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-connection-strings_1">5  Connection Strings</a><ul>
<li><a href="#51-trust-agent-windows-and-linux">5.1  Trust Agent (Windows and Linux)</a></li>
<li><a href="#52-vmware-esxi_1">5.2  VMware ESXi</a><ul>
<li><a href="#521-importing-vmware-tls-certificates_1">5.2.1 Importing VMware TLS Certificates</a></li>
<li><a href="#522-registering-a-vmware-esxi-host_1">5.2.2  Registering a VMware ESXi Host</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-platform-integrity-attestation_1">6  Platform Integrity Attestation</a><ul>
<li><a href="#61-host-registration_1">6.1  Host Registration</a><ul>
<li><a href="#611-trust-agent_1">6.1.1  Trust Agent</a><ul>
<li><a href="#6111-registration-via-trust-agent-command-line_1">6.1.1.1  Registration via Trust Agent Command Line</a></li>
</ul>
</li>
<li><a href="#612-registration-via-verification-service-api_1">6.1.2  Registration via Verification Service API</a><ul>
<li><a href="#6121-special-note-for-vmware-esxi-hosts-and-teh-vcenter-tls-certificate">6.1.2.1  Special Note for VMware ESXi Hosts and teh vCenter TLS Certificate</a></li>
<li><a href="#6122-sample-call_1">6.1.2.2  Sample Call</a></li>
<li><a href="#6123-sample-call-for-esxi-cluster-registration_1">6.1.2.3  Sample Call for ESXi Cluster Registration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#62-flavor-creation-for-automatic-flavor-matching_1">6.2  Flavor Creation for Automatic Flavor Matching</a><ul>
<li><a href="#621-importing-a-flavor-from-a-sample-host_1">6.2.1  Importing a Flavor from a Sample Host</a></li>
<li><a href="#622-creating-a-flavor-manually_1">6.2.2  Creating a Flavor Manually</a></li>
</ul>
</li>
<li><a href="#63-creating-the-default-software-flavor-linux-only_1">6.3  Creating the Default SOFTWARE Flavor (Linux Only)</a></li>
<li><a href="#64-creating-and-provisioning-asset-tags_1">6.4  Creating and Provisioning Asset Tags</a><ul>
<li><a href="#641-creating-asset-tag-certificates_1">6.4.1  Creating Asset Tag Certificates</a></li>
<li><a href="#642-deploying-asset-tags_1">6.4.2  Deploying Asset Tags</a><ul>
<li><a href="#6421-windows-and-red-hat-enterprise-linux">6.4.2.1  Windows and Red Hat Enterprise Linux</a></li>
<li><a href="#6422-vmware_1">6.4.2.2  VMWare</a><ul>
<li><a href="#calculate-the-certificate-hash-value">Calculate the Certificate Hash Value</a></li>
<li><a href="#provision-the-certificate-hash-to-the-host-tpm">Provision the Certificate Hash to the Host TPM</a><ul>
<li><a href="#vsphere-65-update-2-or-later_1">vSphere 6.5 Update 2 or Later</a></li>
<li><a href="#vsphere-65-update-1-or-older_1">vSphere 6.5 Update 1 or Older</a></li>
</ul>
</li>
<li><a href="#creating-the-asset-tag-flavor-vmware-esxi-only">Creating the Asset Tag Flavor (VMWare ESXi Only)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#65-retrieving-current-attestation-reports_1">6.5  Retrieving Current Attestation Reports</a></li>
<li><a href="#66-retrieving-current-host-state-information_1">6.6  Retrieving Current Host State Information</a></li>
<li><a href="#67-upgrading-hosts-in-the-datacenter-to-a-new-bios-or-os-version_1">6.7  Upgrading Hosts in the Datacenter to a New BIOS or OS Version</a></li>
<li><a href="#68-removing-hosts-from-the-verification-service_1">6.8  Removing Hosts From the Verification Service</a></li>
<li><a href="#69-removing-flavors_1">6.9  Removing Flavors</a></li>
<li><a href="#610-invalidating-asset-tags_1">6.10 Invalidating Asset Tags</a></li>
<li><a href="#611-remediating-an-untrusted-attestation_1">6.11  Remediating an Untrusted attestation</a></li>
<li><a href="#612-attestation-reporting_1">6.12  Attestation Reporting</a><ul>
<li><a href="#6121-sample-call-generating-a-new-attestation-report_1">6.12.1  Sample Call – Generating a New Attestation Report</a></li>
<li><a href="#6122-sample-call-retrieving-an-existing-attestation-report_1">6.12.2  Sample Call – Retrieving an Existing Attestation Report</a></li>
</ul>
</li>
<li><a href="#613-integration_1">6.13  Integration</a><ul>
<li><a href="#6131-the-integration-hub_1">6.13.1  The Integration Hub</a></li>
<li><a href="#6132-integration-with-openstack_1">6.13.2  Integration with OpenStack</a><ul>
<li><a href="#61321-prerequisites_1">6.13.2.1  Prerequisites</a></li>
<li><a href="#61322-setting-image-traits_1">6.13.2.2  Setting Image Traits</a></li>
<li><a href="#61323-configuring-the-integration-hub-for-use-with-openstack_1">6.13.2.3  Configuring the Integration Hub for Use with OpenStack</a></li>
<li><a href="#61327-scheduling-instances_1">6.13.2.7  Scheduling Instances</a></li>
</ul>
</li>
<li><a href="#6133-integration-with-kubernetes_1">6.13.3  Integration with Kubernetes</a><ul>
<li><a href="#61331-prerequisites_1">6.13.3.1  Prerequisites</a></li>
<li><a href="#61332-installing-the-intel-secl-custom-resource-definitions_1">6.13.3.2  Installing the Intel® SecL Custom Resource Definitions</a></li>
<li><a href="#61336-configuring-pods-to-require-intel-secl-attributes_1">6.13.3.6  Configuring Pods to Require Intel® SecL Attributes</a></li>
<li><a href="#61337-tainting-untrusted-worker-nodes_1">6.13.3.7  Tainting Untrusted Worker Nodes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#7-workload-confidentiality_1">7  Workload Confidentiality</a><ul>
<li><a href="#71-virtual-machine-confidentiality_1">7.1  Virtual Machine Confidentiality</a><ul>
<li><a href="#711-prerequisites_1">7.1.1  Prerequisites</a></li>
<li><a href="#712-workflow_1">7.1.2  Workflow</a><ul>
<li><a href="#7121-encrypting-images_1">7.1.2.1  Encrypting Images</a></li>
<li><a href="#7122-uploading-the-image-flavor_1">7.1.2.2  Uploading the Image Flavor</a></li>
<li><a href="#7123-creating-the-image-flavor-to-image-id-association_1">7.1.2.3  Creating the Image Flavor to Image ID Association</a></li>
<li><a href="#7124-launching-encrypted-vms_1">7.1.2.4  Launching Encrypted VMs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#72-docker-container-confidentiality">7.2  Docker Container Confidentiality</a><ul>
<li><a href="#721-docker-container-integrity">7.2.1  Docker Container Integrity</a></li>
<li><a href="#722-prerequisites">7.2.2  Prerequisites</a></li>
<li><a href="#723-workflow">7.2.3  Workflow</a><ul>
<li><a href="#7231-encrypting-docker-container-images">7.2.3.1  Encrypting Docker Container Images</a></li>
<li><a href="#7232-uploading-the-image-flavor">7.2.3.2  Uploading the Image Flavor</a></li>
<li><a href="#7233-creating-the-image-flavor-to-image-id-association">7.2.3.3  Creating the Image Flavor to Image ID Association</a></li>
<li><a href="#7234-launching-encrypted-docker-containers">7.2.3.4  Launching Encrypted Docker Containers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-trusted-virtual-kubernetes-worker-nodes_1">8  Trusted Virtual Kubernetes Worker Nodes</a><ul>
<li><a href="#81-prerequisites_1">8.1  Prerequisites</a></li>
<li><a href="#82-workflow_1">8.2  Workflow</a></li>
<li><a href="#83-sample-vm-trust-report_1">8.3  Sample VM Trust Report</a></li>
</ul>
</li>
<li><a href="#9-flavor-management_1">9  Flavor Management</a><ul>
<li><a href="#91-flavor-format-definitions_1">9.1  Flavor Format Definitions</a><ul>
<li><a href="#911-meta_1">9.1.1  Meta</a></li>
<li><a href="#912-hardware_1">9.1.2  Hardware</a></li>
<li><a href="#913-pcrs">9.1.3 PCRs</a></li>
<li><a href="#914-sample-platform-flavor_1">9.1.4  Sample PLATFORM Flavor</a></li>
<li><a href="#915-sample-os-flavor_1">9.1.5  Sample OS Flavor</a></li>
<li><a href="#916-sample-host_unique-flavor_1">9.1.6  Sample HOST_UNIQUE Flavor</a></li>
<li><a href="#917-sample-asset_tag-flavor_1">9.1.7  Sample ASSET_TAG Flavor</a></li>
</ul>
</li>
<li><a href="#92-flavor-matching_1">9.2  Flavor Matching</a><ul>
<li><a href="#921-when-does-flavor-matching-happen_1">9.2.1  When Does Flavor Matching Happen?</a></li>
<li><a href="#922-flavor-matching-performance_1">9.2.2  Flavor Matching Performance</a></li>
<li><a href="#923-flavor-groups_1">9.2.3  Flavor Groups</a></li>
<li><a href="#924-default-flavor-group_1">9.2.4  Default Flavor Group</a><ul>
<li><a href="#9241-automatic_1">9.2.4.1  automatic</a></li>
<li><a href="#9242-unique_1">9.2.4.2  unique</a></li>
</ul>
</li>
<li><a href="#925-flavor-match-policies_1">9.2.5  Flavor Match Policies</a><ul>
<li><a href="#9251-default-flavor-match-policy_1">9.2.5.1  Default Flavor Match Policy</a></li>
<li><a href="#9252-any_of_1">9.2.5.2  ANY_OF</a></li>
<li><a href="#9253-all_of_1">9.2.5.3  ALL_OF</a></li>
<li><a href="#9254-latest_1">9.2.5.4  LATEST</a></li>
<li><a href="#9255-required_1">9.2.5.5  REQUIRED</a></li>
<li><a href="#9256-required_if_defined_1">9.2.5.6  REQUIRED_IF_DEFINED</a></li>
</ul>
</li>
<li><a href="#926-flavor-match-event-triggers_1">9.2.6  Flavor Match Event Triggers</a></li>
<li><a href="#927-sample-flavorgroup-api-calls_1">9.2.7  Sample Flavorgroup API Calls</a><ul>
<li><a href="#9271-create-a-new-flavorgroup_1">9.2.7.1  Create a New Flavorgroup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#93-software-flavor-management_1">9.3  SOFTWARE Flavor Management</a><ul>
<li><a href="#931-what-is-a-software-flavor_1">9.3.1  What is a SOFTWARE Flavor?</a></li>
<li><a href="#932-creating-a-software-flavor-part_1">9.3.2  Creating a SOFTWARE Flavor part</a><ul>
<li><a href="#9321-directories_1">9.3.2.1  Directories</a></li>
<li><a href="#9322-symlinks_1">9.3.2.2  Symlinks</a></li>
<li><a href="#9323-files_1">9.3.2.3  Files</a></li>
</ul>
</li>
<li><a href="#933-sample-software-flavor-creation-call_1">9.3.3  Sample SOFTWARE Flavor Creation Call</a></li>
<li><a href="#934-deploying-a-software-flavor-manifest-to-a-host_1">9.3.4  Deploying a SOFTWARE Flavor Manifest to a Host</a></li>
<li><a href="#935-software-flavor-matching_1">9.3.5  SOFTWARE Flavor Matching</a></li>
<li><a href="#936-kernel-upgrades_1">9.3.6  Kernel Upgrades</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#10-scalability-and-sizing_1">10  Scalability and Sizing</a><ul>
<li><a href="#101-configuration-maximums_1">10.1  Configuration Maximums</a><ul>
<li><a href="#1011-registered-hosts_1">10.1.1  Registered Hosts</a></li>
<li><a href="#1012-hdd-space_1">10.1.2  HDD Space</a></li>
</ul>
</li>
<li><a href="#102-database-rotation-settings_1">10.2  Database Rotation Settings</a></li>
<li><a href="#103-log-rotation_1">10.3  Log Rotation</a></li>
</ul>
</li>
<li><a href="#11-intel-security-libraries-configuration-settings_1">11  Intel Security Libraries Configuration Settings</a><ul>
<li><a href="#111-verification-service_1">11.1  Verification Service</a><ul>
<li><a href="#1111-installation-answer-file-options_1">11.1.1  Installation Answer File Options</a></li>
<li><a href="#1112-configuration-options_1">11.1.2  Configuration Options</a></li>
<li><a href="#1113-command-line-options_1">11.1.3  Command-Line Options</a></li>
<li><a href="#1114-directory-layout_1">11.1.4  Directory Layout</a></li>
</ul>
</li>
<li><a href="#112-trust-agent_1">11.2  Trust Agent</a><ul>
<li><a href="#1121-installation-answer-file-options_1">11.2.1  Installation Answer File Options</a></li>
<li><a href="#1122-configuration-options_1">11.2.2  Configuration Options</a></li>
<li><a href="#1123-command-line-options_1">11.2.3  Command-Line Options</a></li>
<li><a href="#1124-directory-layout_1">11.2.4  Directory Layout</a><ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a><ul>
<li><a href="#bin">Bin</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#var">Var</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#113-integration-hub_1">11.3  Integration Hub</a><ul>
<li><a href="#1131-installation-answer-file_1">11.3.1  Installation Answer File</a></li>
<li><a href="#1132-configuration-options_1">11.3.2  Configuration Options</a></li>
<li><a href="#1133-command-line-options_1">11.3.3  Command-Line Options</a></li>
<li><a href="#1134-directory-layout_1">11.3.4  Directory Layout</a><ul>
<li><a href="#11341-logs">11.3.4.1  Logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#114-certificate-management-service_1">11.4  Certificate Management Service</a><ul>
<li><a href="#1141-installation-answer-file-options_1">11.4.1  Installation Answer File Options</a></li>
<li><a href="#1142-configuration-options_1">11.4.2  Configuration Options</a></li>
<li><a href="#1143-command-line-options_1">11.4.3  Command-Line Options</a></li>
<li><a href="#1144-directory-layout_1">11.4.4  Directory Layout</a><ul>
<li><a href="#11441-bin_1">11.4.4.1  Bin</a></li>
<li><a href="#11442-cacerts_1">11.4.4.2 Cacerts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#115-authentication-and-authorization-service_1">11.5  Authentication and Authorization Service</a><ul>
<li><a href="#1151-installation-answer-file-options_1">11.5.1  Installation Answer File Options</a></li>
<li><a href="#1152-configuration-options_1">11.5.2  Configuration Options</a></li>
<li><a href="#1153-command-line-options_1">11.5.3  Command-Line Options</a></li>
<li><a href="#1154-directory-layout_1">11.5.4  Directory Layout</a><ul>
<li><a href="#11541-bin_1">11.5.4.1 Bin</a></li>
<li><a href="#11542-dbscripts_1">11.5.4.2  dbscripts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#116-workload-service_1">11.6  Workload Service</a><ul>
<li><a href="#1161-installation-answer-file-options_1">11.6.1  Installation Answer File Options</a></li>
<li><a href="#1162-configuration-options_1">11.6.2  Configuration Options</a></li>
<li><a href="#1163-command-line-options_1">11.6.3  Command-Line Options</a></li>
<li><a href="#1164-directory-layout_1">11.6.4 Directory Layout</a></li>
</ul>
</li>
<li><a href="#117-key-broker-service_1">11.7  Key Broker Service</a><ul>
<li><a href="#1171-installation-answer-file-options_1">11.7.1  Installation Answer File Options</a></li>
<li><a href="#1172-configuration-options_1">11.7.2  Configuration Options</a></li>
<li><a href="#1173-command-line-options_1">11.7.3 Command-Line Options</a></li>
<li><a href="#1174-directory-layout_1">11.7.4  Directory Layout</a><ul>
<li><a href="#11741-bin">11.7.4.1  Bin</a></li>
<li><a href="#11742-configuration">11.7.4.2  Configuration</a></li>
<li><a href="#11743-env">11.7.4.3  Env</a></li>
<li><a href="#11744-features">11.7.4.4  Features</a></li>
<li><a href="#11745-java">11.7.4.5  Java</a></li>
<li><a href="#11746-logs">11.7.4.6  Logs</a></li>
<li><a href="#11747-repository">11.7.4.7  Repository</a></li>
<li><a href="#11748-script">11.7.4.8  Script</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#118-workload-agent_1">11.8  Workload Agent</a><ul>
<li><a href="#1181-installation-answer-file-options_1">11.8.1  Installation Answer File Options</a></li>
<li><a href="#1182-configuration-options_1">11.8.2  Configuration Options</a></li>
<li><a href="#1183-command-line-options_1">11.8.3  Command-Line Options</a></li>
<li><a href="#1184-directory-layout_1">11.8.4  Directory Layout</a><ul>
<li><a href="#11841-bin_1">11.8.4.1  Bin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#119-workload-policy-manager_1">11.9  Workload Policy Manager</a><ul>
<li><a href="#1191-installation-answer-file-options_1">11.9.1  Installation Answer File Options</a></li>
<li><a href="#1192-configuration-options_1">11.9.2  Configuration Options</a></li>
<li><a href="#1193-command-line-options_1">11.9.3  Command-Line Options</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#12-certificate-and-key-management_1">12  Certificate and Key Management</a><ul>
<li><a href="#121-authentication-and-authorization-service">12.1  Authentication and Authorization Service</a></li>
<li><a href="#122-host-verification-service">12.2  Host Verification Service</a><ul>
<li><a href="#1221-saml">12.2.1  SAML</a></li>
<li><a href="#1222-asset-tag">12.2.2  Asset Tag</a></li>
<li><a href="#1223-privacy-ca">12.2.3  Privacy CA</a></li>
<li><a href="#1224-endorsement-ca">12.2.4  Endorsement CA</a></li>
</ul>
</li>
<li><a href="#123-regenerating-tls-certificates">12.3  Regenerating TLS Certificates</a></li>
<li><a href="#124-replacing-self-signed-certificates">12.4 Replacing Self-Signed Certificates</a><ul>
<li><a href="#tls-certificates">TLS Certificates</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#13-uninstallation_1">13  Uninstallation</a><ul>
<li><a href="#131-host-verification-service_1">13.1 Host Verification Service</a></li>
<li><a href="#132-trust-agent_1">13.2  Trust Agent</a></li>
<li><a href="#133-integration-hub_1">13.3  Integration Hub</a></li>
<li><a href="#134-kubernetes-crds">13.4 Kubernetes CRDs</a></li>
</ul>
</li>
<li><a href="#14-appendix">14  Appendix</a><ul>
<li><a href="#141-pcr-definitions_1">14.1  PCR Definitions</a><ul>
<li><a href="#1411-microsoft-windows-server-2016-datacenter">14.1.1  Microsoft Windows Server 2016 Datacenter</a><ul>
<li><a href="#14111-tpm-20_1">14.1.1.1  TPM 2.0</a></li>
</ul>
</li>
<li><a href="#1412-red-had-enterprise-linux">14.1.2  Red Had Enterprise Linux</a><ul>
<li><a href="#14121-tpm-20">14.1.2.1  TPM 2.0</a></li>
</ul>
</li>
<li><a href="#1413-vmware-esxi">14.1.3  VMWare ESXi</a><ul>
<li><a href="#14131-tpm-12">14.1.3.1  TPM 1.2</a></li>
<li><a href="#14132-tpm-20">14.1.3.2  TPM 2.0</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#a1-attestation-rules_1">A.1  Attestation Rules</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="1-introduction">1  Introduction</h1>
<h2 id="11-overview">1.1  Overview</h2>
<p>Intel Security Libraries for Datacenter is a collection of software applications and development libraries intended to help turn Intel platform security  features into real-world security use cases.</p>
<h3 id="111-trusted-computing">1.1.1  Trusted Computing</h3>
<p>Trusted Computing consists of a set of industry standards defined by the Trusted Computing Group to harden systems and data against attack. These
standards include verifying platform integrity, establishing identity, protection of keys and secrets, and more. One of the functions of Intel Security Libraries is to provide a “Trusted Platform,” using Intel security technologies to add visibility, auditability, and control to server platforms.</p>
<h4 id="1111-the-chain-of-trust">1.1.1.1  The Chain of Trust</h4>
<p>In a Trusted Computing environment, a key concept is verification of the integrity of the underlying platform. Verifying platform integrity typically means cryptographic measurement and/or verification of firmware and software components. The process by which this measurement and verification takes place affects the overall strength of the assertion that the measured and verified components have not been altered. Intel refers to this process as the “<em>Chain of Trust</em>,” whereby at boot time, a sequence of cryptographic measurements and signature verification events happen in a defined order, such that
measurement/verification happens before execution, and each entity responsible for performing a measurement or verification is measured by
another step earlier in the process. Any break in this chain leads to an opportunity for an attacker to modify code and evade detection.</p>
<h4 id="1112-hardware-root-of-trust">1.1.1.2  Hardware Root of Trust</h4>
<p>The <em>Root of Trust,</em> the first link in the chain, can be one of several different options. Anything that happens in the boot process before the Root of Trust must be considered to be within the “trust boundary,” signifying components whose trustworthiness cannot be assessed. For this reason, it’s best to use a Root of Trust that starts as early in the system boot process as possible, so that the Chain of Trust during the boot process can cover as much as possible. </p>
<p>Multiple Root of Trust options exist, ranging from firmware to hardware. In general, a hardware Root of Trust will have a smaller “trust
boundary” than a firmware Root of Trust. A hardware Root of Trust will also have the benefit of immutability – where firmware can easily be
flashed and modified, hardware is much more difficult to tamper with.</p>
<h5 id="11121-intel-trusted-execution-technology-intel-txt">1.1.1.2.1  Intel® Trusted Execution Technology (Intel® TXT)</h5>
<p>Intel® Trusted Execution Technology is a hardware Root of Trust feature available on Intel® server platforms starting with the Grantley generation. Intel® TXT is enabled in the system BIOS (typically under the Processor > Advanced tab), and requires Intel® VT-d and Intel VT-x features to be enabled as prerequisites (otherwise the option will be grayed out). Intel® TXT will ship “disabled” by default.</p>
<h5 id="11122-intel-bootguard-intel-btg">1.1.1.2.2  Intel® BootGuard (Intel® BtG)</h5>
<p>Intel® BootGuard is a hardware Root of Trust feature available on Intel® server platforms starting with the Purley-Refresh generation. Unlike
Intel® TXT, Intel® BtG is configured in platform fuses, not in the system BIOS. Intel® BtG is fused into several “profiles” that determine the behavior of the feature. Intel® BtG supports both “verify” and “measure” profiles; in “verify” profiles, Intel® BtG will verify the signature of the platform Initial Boot Block (IBB). In “measure”profiles, Intel® BtG will hash the IBB and extend that measurement to a TPM PCR. It is recommended that Intel® BtG be fused into the “measure and verify” profile for maximum protection and auditability.</p>
<p>Because the Intel® BtG profile is configured using fuses, the server OEM/ODM will determine the profile used at manufacturing time. Please contact your server vendor to determine what Intel® BtG profiles are available in their product line.</p>
<p>Because Intel® BtG only measures/verifies the integrity of the IBB, it’s important to have an additional technology handle measurements later in the boot process. Intel® TXT can provide this function using tboot to invoke SINIT, and UEFI SecureBoot can alternatively provide similar functionality (note that Linux users should properly configure Shim and use a signed kernel for UEFI SecureBoot).</p>
<h4 id="1113-supported-trusted-boot-options">1.1.1.3  Supported Trusted Boot Options</h4>
<p>Intel® SecL-DC supports several options for Trusted Computing, depending
on the features available on the platform.</p>
<p><img src="Images\tboot options.png" style="zoom:150%;" /></p>
<blockquote>
<p><strong>Note</strong>: A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on
RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.</p>
</blockquote>
<h4 id="1114-remote-attestation">1.1.1.4  Remote Attestation</h4>
<p>Trusted computing consists primarily of two activities – measurement, and attestation. Measurement is the act of obtaining cryptographic representations for the system state. Attestation is the act of comparing those cryptographic measurements against expected values to determine whether the system booted into an acceptable state. </p>
<p>Attestation can be performed either locally, on the same host that is to be attested, or remotely, by an external authority. The trusted boot process can optionally include a local attestation involving the evaluation of a TPM-stored Launch Control Policy (LCP). In this case, the host’s TPM will compare the measurements that have been taken so far to a set of expected PCR values stored in the LCP; if there is a mismatch, the boot process is halted entirely. </p>
<p>Intel® SecL utilizes remote attestation, providing a remote Verification Service that maintains a database of expected measurements (or “flavors”), and compares the actual boot-time measurements from any number of hosts against its database to provide an assertion that the host booted into a “trusted” or “untrusted” state. Remote attestation is typically easier to centrally manage (as opposed to creating an LCP for each host and entering the policy into the host’s TPM), does not halt the boot process allowing for easier remediation, and separates the attack surface into separate components that must both be compromised to bypass security controls.</p>
<p>Both local and remote attestation can be used concurrently. However, Intel® SecL, and this document, will focus only on remote attestation. For more information on TPM Launch Control Policies, consult the <em>Intel Trusted Execution Technology (Intel TXT) Software Development Guide</em> (<a href="https://www.intel.com/content/dam/www/public/us/en/documents/guides/intel-txt-software-development-guide.pdf">https://www.intel.com/content/dam/www/public/us/en/documents/guides/intel-txt-software-development-guide.pdf</a>).</p>
<h3 id="112-intel-security-libraries-for-datacenter-features">1.1.2  Intel® Security Libraries for Datacenter Features</h3>
<h4 id="1121-platform-integrity">1.1.2.1  Platform Integrity</h4>
<p>Platform Integrity is the use case enabled by the specific implementation of the Chain of Trust and Remote Attestation concepts. This involves the use of a Root of Trust to begin an unbroken chain of platform measurements at server boot time, with measurements extended to the Trusted Platform Module and compared against expected values to verify the integrity of measured components. This use case is foundational for other Intel® SecL use cases.</p>
<h4 id="1122-data-sovereignty">1.1.2.2  Data Sovereignty</h4>
<p>Data Sovereignty builds on the Platform Integrity use case to allow physical TPMs to be written with Asset Tags containing any number of key/value pairs. This use case is typically used to identify the geographic location of the physical server, but can also be used to identify other attributes. For example, the Asset Tags provided by the Data Sovereignty use case could be used to identify hosts that meet specific compliance requirements and can run controlled workloads.</p>
<h4 id="1123-application-integrity">1.1.2.3  Application Integrity</h4>
<p>Added in the Intel® SecL-DC 1.5 release, Application Integrity allows any files and folders on a Linux host system to be included in the Chain of Trust integrity measurements. These measurements are attested by the Verification Service along with the other platform measurements, and are included in determining the host’s overall Trust status. The measurements are performed by a measurement agent called tbootXM, which is built into initrd during Trust Agent installation. Because initrd is included in other Trusted Computing measurements, this allows Intel® SecL-DC to carry the Chain of Trust all the way to the Linux filesystem.</p>
<h4 id="1124-workload-confidentiality-for-virtual-machines-and-containers">1.1.2.4  Workload Confidentiality for Virtual Machines and Containers</h4>
<p>Added in the Intel® SecL-DC 1.6 release, Workload Confidentiality allows virtual machine and Docker container images to be encrypted at rest, with key access tied to platform integrity attestation. Because security attributes contained in the platform integrity attestation report are used to control access to the decryption keys, this feature provides both protection for at-rest data, IP, code, etc in Docker container or virtual machine images, and also enforcement of image-owner-controlled placement policies. When decryption keys are released, they are sealed to the physical TPM of the host that was attested, meaning that only a server that has successfully met the policy requirements for the image can actually gain access.</p>
<p>Workload Confidentiality begins with the Workload Policy Manager (WPM) and a qcow2 or Docker image that needs to be protected. The WPM is a lightweight application that will request a new key from the Key Broker, use that key to encrypt the image, and generate an Image Flavor. The image owner will then upload the encrypted image to their desired image storage service (for example, OpenStack Glance or a local Docker Registry), and the image ID from the image storage will be uploaded along with the Image Flavor to the Intel® SecL Workload Service. When that image is used to launch a new VM or container, the Workload Agent will intercept the VM or container start and request the decryption key for that image from the Workload Service. The Workload Service will use the image ID and the Image Flavor to find the key transfer URL for the appropriate Key Broker, and will query the Verification Service for the latest Platform Integrity trust attestation report for the host. The Key Broker will use the attestation report to determine whether the host meets the policy requirements for the key transfer, and to verify that the report is signed by a Verification Service known to the Broker. If the report is genuine and meets the policy requirements, the image decryption key is sealed using an asymmetric key from that host’s TPM, and sent back to the Workload Service. The Workload Service then caches the key for 5 minutes (to avoid performance issues for multiple rapid launch requests; note that these keys are still wrapped using a sealing key unique to the hosts TPM, so multiple hosts would require multiple keys even for an identical image) and return the wrapped key to the Workload Agent on the host, which then uses the host TPM to unseal the image decryption key. The key is then used to create a new LUKS volume, and the image is decrypted into this volume. </p>
<p>This functionality means that a physical host must pass policy requirements in order to gain access to the image key, and the image will be encrypted at rest both in image storage and on the compute host.</p>
<p>Beginning with the Intel® SecL-DC version 2.1 release, the Key Broker now supports 3<sup>rd</sup>-party key managers that are KMIP-compliant. The Key Broker has been updated to use the “libkmip” client.</p>
<h4 id="1125-signed-flavors">1.1.2.5  Signed Flavors</h4>
<p>Added in the Intel® SecL-DC 1.6 release, Flavor signing is an improvement to the existing handling of expected attestation measurements, called “Flavors.” This feature adds the ability to digitally sign Flavors so that the integrity of the expected measurements themselves can be verified when attestations occur. This also means that Flavors can be more securely transferred between different Verification Service instances.</p>
<p>Flavor signing is seamlessly added to the existing Flavor creation process (both importing from a sample host and “manually” creating a Flavor using the POST method to the /v2/flavors resource). When a Flavor is created, the Verification Service will sign it using a signing certificate signed by the Certificate Management Service (this is created during Verification Service setup). Each time that the Verification Service evaluates a Flavor, it will first verify the signature on that Flavor to ensure the integrity of the Flavor contents before it is used to attest the integrity of any host.</p>
<h4 id="1126-trusted-virtual-kubernetes-worker-nodes">1.1.2.6  Trusted Virtual Kubernetes Worker Nodes</h4>
<p>Added in the Intel® SecL-DC version 2.1 release, this feature provides a Chain of Trust solution extending to Kubernetes Worker Nodes deployed as Virtual Machines. This feature addresses Kubernetes deployments that use Virtual Machines as Worker Nodes, rather than using bare-metal servers. </p>
<p>When libvirt initiates a VM Start, the Intel® SecL-DC Workload Agent will create a report for the VM that associates the VM’s trust status with the trust status of the host launching the VM. This VM report will be retrievable via the Workload Service, and contains the hardware UUID of the physical server hosting the VM. This UUID can be correlated to the Trust Report of that server at the time of VM launch, creating an audit trail validating that the VM launched on a trusted platform. A new report is created for every VM Start, which includes actions like VM migrations, so that each time a VM is launched or moved a new report is generated ensuring an accurate trust status.</p>
<p>By using Platform Integrity and Data Sovereignty-based orchestration (or Workload Confidentiality with encrypted worker VMs) for the Virtual Machines to ensure that the virtual Kubernetes Worker nodes only launch on trusted hardware, these VM trust reports provide an auditing capability to extend the Chain of Trust to the virtual Worker Nodes.</p>
<h1 id="2-intel-security-libraries-components">2  Intel® Security Libraries Components</h1>
<h2 id="21-certificate-management-service">2.1  Certificate Management Service</h2>
<p>Starting with Intel® SecL-DC 1.6, most non-TPM-related certificates used by Intel® SecL-DC applications will be issued by the new Certificate Management Service. This includes acting as a root CA and issuing TLS certificates for all of the various web services. </p>
<h2 id="22-authentication-and-authorization-service">2.2  Authentication and Authorization Service</h2>
<p>Starting with Intel® SecL-DC 1.6, authentication and authorization for all Intel® SecL applications will be centrally managed by the new Authentication and Authorization Service (AAS). Previously, each application would manage its own users and permissions independently; this change allows authentication and authorization management to be centralized.</p>
<h2 id="23-verification-service">2.3  Verification Service</h2>
<p>The Verification Service component of Intel® Security Libraries performs the core Platform Integrity and Data Sovereignty functionality by acting as a remote attestation authority.</p>
<p>Platform security technologies like Intel® TXT, Intel® BootGuard, and UEFI SecureBoot extend measurements of platform components (such as the system BIOS/UEFI, OS kernel, etc) to a Trusted Platform module as the server boots. Known-good measurements for each of these components can be directly imported from a sample server. These expected measurements can then be compared against actual measurements from registered servers, allowing the Verification Service to attest to the "trustiness" of the platform, meaning whether the platform booted into a "known-good" state.</p>
<h2 id="24-workload-service">2.4  Workload Service</h2>
<p>The Workload Service acts as a management service for handling Workload Flavors (Flavors used for Virtual Machines and Containers). In the Intel® SecL-DC 1.6 release, the Workload Service uses Flavors to map decryption key IDs to image IDs. When a launch request for an encrypted workload image is intercepted by the Workload Agent, the Workload Service will handle mapping the image ID to the appropriate key ID and key request URL, and will initiate the key transfer request to the Key Broker. </p>
<h2 id="25-trust-agent">2.5  Trust Agent</h2>
<p>The Trust Agent resides on physical servers and enables both remote attestation and the extended chain of trust capabilities. The Agent maintains ownership of the server's Trusted Platform Module, allowing secure attestation quotes to be sent to the Verification Service. Incorporating the Intel® SecL HostInfo and TpmProvider libraries, the Trust Agent serves to report on platform security capabilities and platform integrity measurements. </p>
<p>The Trust Agent is supported for Windows<em> Server 2016 Datacenter and Red Hat Enterprise Linux</em> (RHEL) 8.1 and later. </p>
<h2 id="26-workload-agent">2.6  Workload Agent</h2>
<p>The Workload Agent is the component responsible for handling all of the functions needed for Workload Confidentiality for virtual machines and Docker containers on a physical server. The Workload Agent uses libvirt hooks to identify VM lifecycle events (VM start, stop, hibernate, etc), and intercepts those events to perform needed functions like requesting decryption keys, creation and deletion of encrypted LUKS volumes, using the TPM to unseal decryption keys, etc. The WLA also includes the Docker SecureOverlay Driver that performs analogous functionality for Docker containers.</p>
<h2 id="27-integration-hub">2.7  Integration Hub</h2>
<p>The Integration Hub acts as a middle-man between the Verification Service and one or more scheduler services (such as OpenStack* Nova), and "pushes" attestation information retrieved from the Verification Service to one or more scheduler services according to an assignment of hosts to specific tenants. In this way, Tenant A can receive attestation information for hosts that belong to Tenant A, but receive no information about hosts belonging to Tenant B. </p>
<p>The Integration Hub serves to disassociate the process of retrieving attestations from actual scheduler queries, so that scheduler services can adhere to best practices and retain better performance at scale. The Integration Hub will regularly query the Intel® SecL Verification Service for SAML attestations for each host. The Integration Hub maintains only the most recent currently valid attestation for each host, and will refresh attestations when they would expire. The Integration Hub will verify the signature of the SAML attestation for each host assigned to a tenant, then parse the attestation status and asset tag information, and then will securely push the parsed key/value pairs to the plugin endpoints enabled.</p>
<p>The Integration Hub features a plugin design for adding new scheduler endpoint types. Currently the Integration Hub supports OpenStack Nova and Kubernetes endpoint plugins. Other integration plugins may be added.</p>
<h2 id="28-workload-policy-manager">2.8  Workload Policy Manager</h2>
<p>The Workload Policy Manager is a Linux command line utility used by an image owner to encrypt VM (qcow2) or container (Docker) images, and to create an Image Flavor used to provide the encryption key transfer URL during launch requests. The WPM utility will use an existing or request a new key from the Key Broker Service, use that key to encrypt the image, and output the Image Flavor in JSON format. The encrypted image can then be uploaded to the image store of choice (like OpenStack Glance), and the Image Flavor can be uploaded to the Workload Service. The ID of the image on the image storage system is then mapped to the Image Flavor in the WLS; when the image is used to launch a new instance, the WLS will find the Image Flavor associated with that image ID, and use the Image Flavor to determine the key transfer URL.</p>
<h2 id="29-key-broker-service">2.9  Key Broker Service</h2>
<p>The Key Broker Service is effectively a policy compliance engine. Its job is to manage key transfer requests, releasing keys only to servers that meet policy requirements. The Key Broker registers one or more SAML signing certificates from any Verification Services that it will trust. When a key transfer request is received, the request includes a trust attestation report signed by the Verification Service. If the signature matches a registered SAML key, the Broker will then look at the actual report to ensure the server requesting the key matches the image policy (currently only overall system trust is supported as a policy requirement). If the report indicates the policy requirements are met, the image decryption key is wrapped using a public key unique to the TPM of the host that was attested in the report, such that only the host that was attested can unseal the decryption key and gain access to the image.</p>
<h1 id="3-intel-security-libraries-installation">3  Intel® Security Libraries Installation</h1>
<h2 id="31-building-from-source">3.1  Building from Source</h2>
<p>Intel® Security Libraries is distributed as open source code, and must be compiled into installation binaries before installation.</p>
<p>Instructions and sample scripts for building the Intel® SecL-DC components can be found here:</p>
<p><a href="https://github.com/intel-secl/build-manifest">https://github.com/intel-secl/build-manifest</a></p>
<p>After the components have been built, the installation binaries can be found in the directories created by the build scripts. </p>
<div class="highlight"><pre><span></span><code>&lt;servicename&gt;/out/&lt;servicename&gt;.bin
</code></pre></div>
<p>In addition, the build script will produce some sample database creation scripts that can be used during installation to configure database requirements (instructions are given in the installation sections):</p>
<p>create_db: <code>authservice/out/create_db.sh</code></p>
<p>install_pgdb: <code>authservice/out/install_pgdb.sh</code></p>
<p>In addition, sample Ansible roles to automatically build and deploy a testbed environment are provided:</p>
<p><a href="https://github.com/intel-secl/utils/tree/v3.3.1/develop/tools/ansible-role">https://github.com/intel-secl/utils/tree/v3.3.1/develop/tools/ansible-role</a></p>
<p>Also provided are sample API calls organized by workflows for Postman:</p>
<p><a href="https://github.com/intel-secl/utils/tree/v3.3.1/develop/tools/api-collections">https://github.com/intel-secl/utils/tree/v3.3.1/develop/tools/api-collections</a></p>
<h2 id="32-hardware-considerations">3.2  Hardware Considerations</h2>
<p>Intel® SecL-DC supports and uses a variety of Intel security features, but there are some key requirements to consider before beginning an installation. Most important among these is the Root of Trust configuration. This involves deciding what combination of TXT, Boot Guard, tboot, and UEFI Secure Boot to enable on platforms that will be attested using Intel® SecL. </p>
<p>Key points: </p>
<p>-   At least one "Static Root of Trust" mechanism must be used (TXT and/or BtG)</p>
<p>-   For Legacy BIOS systems, tboot must be used</p>
<p>-   For UEFI mode systems, UEFI SecureBoot must be used*</p>
<p>Use the chart below for a guide to acceptable configuration options. .</p>
<p><img src="Images\hardware_considerations.png" alt="image-20200620161440899" style="zoom:150%;" /></p>
<blockquote>
<p><strong>*Note</strong>: A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode. </p>
</blockquote>
<h2 id="33-recommended-service-layout">3.3  Recommended Service Layout</h2>
<p>The Intel® SecL-DC services can be installed in a variety of layouts, partially depending on the use cases desired and the OS of the server(s) to be protected. In general, the Intel® SecL-DC applications can be divided into management services that are deployed on the network on the management plane, and host or node components that must be installed on each protected server. </p>
<p>Management services can typically be deployed anywhere with network access to all of the protected servers. This could be a set of individual VMs per service; containers; or all installed on a single physical or virtual machine.</p>
<p>Node components must be installed on each protected physical server. Typically this is needed for Windows and Linux deployments.</p>
<h3 id="331-platform-integrity">3.3.1  Platform Integrity</h3>
<p>The most basic use case enabled by Intel® SecL-DC, Platform Integrity requires only the Verification Service and, to protect Windows or Linux hosts, the Trust Agent. This also enables the Application Integrity use case by default for Linux systems.</p>
<p>The Integration Hub may be added to provide integration support for OpenStack or Kubernetes. The Hub is often installed on the same machine as the Verification Service, but optionally can be installed separately.</p>
<h3 id="332-workload-confidentiality">3.3.2  Workload Confidentiality</h3>
<p>Workload Confidentiality introduces a number of additional services and agents. For a POC environment, all of the management services can be installed on a single machine or VM. This includes:</p>
<p>Certificate Management Service (CMS)</p>
<p>Authorization and Authentication Service (AAS)</p>
<p>Host Verification Service (HVS)</p>
<p>Workload Service (WLS)</p>
<p>Integration Hub (HUB)</p>
<p>Key Broker Service (KBS) with backend key management </p>
<p>Workload Policy Manager (WPM)</p>
<p>In a production environment, it is strongly suggested that the WPM and KBS be deployed (with their own CMS and AAS) separately for each image owner. For a Cloud Service Provider, this would mean that each customer/tenant who will use the Workload Confidentiality feature would have their own dedicated AAS/CMS/KBS/WPM operated on their own networks, not controlled by the CSP. This is because the Key Broker and WPM are the tools used to define the policies that will allow images to launch, and these policies and their enforcement should remain entirely under the control of the image owner.</p>
<p>The node components must be installed on each protected physical server:</p>
<p>Trust Agent (TA)</p>
<p>Workload Agent (WLA)</p>
<p><img src="Images\service_layout" alt="image-20200620161752980" style="zoom:150%;" /></p>
<h2 id="34-installingconfiguring-the-database">3.4  Installing/Configuring the Database</h2>
<p>The Intel® SecL-DC Authentication and Authorization Service (AAS) requires a Postgresql 11 database. Scripts (install_pgdb.sh, create_db.sh) are provided with the AAS that will automatically add the Postgresql repositories and install/configure a sample database. If this script will not be used, a Postgresql 11 database must be installed by the user before executing the AAS installation.</p>
<h3 id="341-using-the-provided-database-installation-script">3.4.1  Using the Provided Database Installation Script</h3>
<p>Install a sample Postgresql 11 database using the install_pgdb.sh script. This script will automatically install the Postgresql database and client packages required.</p>
<p>Add the Postgresql 11 repository:</p>
<p><a href="https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm">https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm</a></p>
<p>Create the <code>iseclpgdb.env</code> answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ISECL_PGDB_IP_INTERFACES</span><span class="o">=</span>localhost
<span class="nv">ISECL_PGDB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">ISECL_PGDB_SAVE_DB_INSTALL_LOG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">ISECL_PGDB_CERT_DNS</span><span class="o">=</span>localhost
<span class="nv">ISECL_PGDB_CERT_IP</span><span class="o">=</span><span class="m">127</span>.0.0.1
</code></pre></div>
<p>Note that the values above assume that the database will be accessed locally. If the database server will be external to the Intel® SecL services, change these values to the hostname or FQDN and IP address where the client will access the database server.</p>
<p>Run the following command:</p>
<div class="highlight"><pre><span></span><code>dnf module disable postgresql -y
</code></pre></div>
<p>Execute the installation script:</p>
<div class="highlight"><pre><span></span><code>./install_pgdb.sh
</code></pre></div>
<blockquote>
<p><strong>Note</strong>: the database installation only needs to be performed once if the same database server will be used for all services that require a database. Only the "create_db" step needs to be repeated if the database server will be shared.</p>
</blockquote>
<h3 id="342-provisioning-the-database">3.4.2  Provisioning the Database</h3>
<p>Each Intel® SecL service that uses a database (the Authentication and Authorization Service, the Verification Service, the Integration Hub, the Workload Service) requires its own schema and access. After installation, the database must be created initialized and tables created. Execute the create_db.sh script to configure the database. </p>
<p>If a single shared database server will be used for each Intel® SecL service (for example, if all management plane services will be installed on a single VM), run the script multiple times, once for each service that requires a database.</p>
<p>If separate database servers will be used (for example, if the management plane services will reside on separate systems and will use their own local database servers), execute the script on each server hosting a database.</p>
<div class="highlight"><pre><span></span><code>./create_db.sh &lt;database name&gt; &lt;database_username&gt; &lt;database_password&gt;
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>./create_db.sh isecl_hvs_db hvs_db_username hvs_db_password
./create_db.sh isecl_aas_db aas_db_username aas_db_password
./create_db.sh isecl_wls_db wls_db_username wls_db_password
</code></pre></div>
<p>Note that the database name, username, and password details for each service must be used in the corresponding installation answer file for that service. </p>
<h3 id="343-database-server-tls-certificate">3.4.3  Database Server TLS Certificate</h3>
<p>The database client for Intel® SecL services requires the database TLS certificate to authenticate communication with the database server. </p>
<p>If the database server for a service is located on the same server that the service will run on, only the path to this certificate is needed. If the provided Postgres scripts are used, the certificate will be located in <code>/usr/local/pgsql/data/server.crt</code></p>
<p>If the database server will be run separately from the Intel® SecL service(s), the certificate will need to be copied from the database server to the service machine before installing the Intel® SecL services. </p>
<p>The database client for Intel® SecL services will validate that the Subject Alternative Names in the database server’s TLS certificate contain the hostname(s)/IP address(es) that the clients will use to access the database server. If configuring a database without using the provided scripts, ensure that these attributes are present in the database TLS certificate.</p>
<h2 id="35-installing-the-certificate-management-service">3.5  Installing the Certificate Management Service</h2>
<h3 id="351-required-for">3.5.1  Required For</h3>
<p>The CMS is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="352-supported-operating-systems">3.5.2  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Certificate Management Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="353-recommended-hardware">3.5.3  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>10 GB</p>
</li>
<li>
<p>One network interface with network access to all Intel® SecL-DC services</p>
</li>
</ul>
<h3 id="354-installation">3.5.4  Installation</h3>
<p>To install the Intel® SecL-DC Certificate Management Service:</p>
<ol>
<li>
<p>Copy the Certificate Management Service installation binary to the /root/ directory.</p>
</li>
<li>
<p>Create the <code>cms.env</code> installation answer file for an unattended installation:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nv">AAS_TLS_SAN</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the AAS&gt;
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;Authentication and Authorization Service IP or Hostname&gt;:8444/aas
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;Comma-separated list of IP addresses and hostnames <span class="k">for</span> the CMS&gt;,127.0.0.1,localhost 
</code></pre></div>
<p>The SAN list will be used to authenticate the Certificate Signing Request from the AAS to the CMS. Only a CSR originating from a host matching the SAN list will be honored. Later, in the AAS <code>authservice.env</code> installation answer file, this same SAN list will be provided for the AAS installation. These lists must match, and must be valid for IPs and/or hostnames used by the AAS system. If both the AAS and CMS will be installed on the same system, "127.0.0.1,localhost" may be used. The SAN list variables also accept the wildcards “?” (for single-character wildcards) and "*" (for multiple-character wildcards) to allow address ranges or multiple FQDNs.</p>
<p>The <code>AAS_API_URL</code> represents the URL for the AAS that will exist after the AAS is installed.</p>
<p>For all configuration options and their descriptions, refer to the Intel® SecL Configuration section on the Certificate Management Service.</p>
<ol>
<li>Execute the installer binary.</li>
</ol>
<div class="highlight"><pre><span></span><code>./cms-v3.3.1.bin
</code></pre></div>
<p>When the installation completes, the Certificate Management Service is available. The services can be verified by running cms status from the command line.</p>
<p><code>shell
cms status</code></p>
<p>After installation is complete, the CMS will output a bearer token to the console. This token will be used with the AAS during installation to authenticate certificate requests to the CMS. If this token expires or otherwise needs to be recreated, use the following command:</p>
<p>```shell
cms setup cms_auth_token --force
   <div class="highlight"><pre><span></span><code>In addition, the SHA384 digest of the CMS TLS certificate will be needed for installation of the remaining Intel® SecL services. The digest can be obtained using the following command:

```shell
cms tlscertsha384
</code></pre></div></p>
<h2 id="36-installing-the-authentication-and-authorization-service">3.6  Installing the Authentication and Authorization Service</h2>
<h3 id="361-required-for">3.6.1  Required For</h3>
<p>The AAS is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="362-prerequisites">3.6.2  Prerequisites</h3>
<p>The following must be completed before installing the Authentication and Authorization Service:</p>
<ul>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service database must be available</p>
</li>
</ul>
<h3 id="363-package-dependencies">3.6.3  Package Dependencies</h3>
<p>The Intel® SecL-DC Authentication and Authorization Service (AAS) requires a Postgresql 11 database. A script (install_pgdb.sh) is provided with the AAS that will automatically add the Postgresql repositories and install/configure a sample database. If this script will not be used, a Postgresql 11 database must be installed by the user before executing the AAS installation.</p>
<h3 id="364-supported-operating-systems">3.6.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Authentication and Authorization Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="365-recommended-hardware">3.6.5  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>10 GB</p>
</li>
<li>
<p>One network interface with network access to all Intel® SecL-DC services</p>
</li>
</ul>
<h3 id="366-installation">3.6.6  Installation</h3>
<p>To install the AAS, a bearer token from the CMS is required. This bearer token is output at the end of the CMS installation. However, if a new token is needed, simply use the following command from the CMS command line:</p>
<div class="highlight"><pre><span></span><code>cms setup cms_auth_token --force
</code></pre></div>
<p>Create the <code>authservice.env</code> installation answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;CMS IP or hostname&gt;:8445/cms/v1/
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;CMS TLS certificate sha384&gt;
<span class="nv">AAS_DB_HOSTNAME</span><span class="o">=</span>&lt;IP or hostname of database server&gt;
<span class="nv">AAS_DB_PORT</span><span class="o">=</span>&lt;database port number<span class="p">;</span> default is <span class="m">5432</span>&gt;
<span class="nv">AAS_DB_NAME</span><span class="o">=</span>&lt;database name&gt;
<span class="nv">AAS_DB_USERNAME</span><span class="o">=</span>&lt;database username&gt;
<span class="nv">AAS_DB_PASSWORD</span><span class="o">=</span>&lt;database password&gt;
<span class="nv">AAS_DB_SSLCERTSRC</span><span class="o">=</span>&lt;path to database TLS certificate<span class="p">;</span> the default location is typically /usr/local/pgsql/data/server.crt&gt;
<span class="nv">AAS_ADMIN_USERNAME</span><span class="o">=</span>&lt;username <span class="k">for</span> AAS administrative user&gt;
<span class="nv">AAS_ADMIN_PASSWORD</span><span class="o">=</span>&lt;password <span class="k">for</span> AAS administrative user&gt;
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the AAS<span class="p">;</span> this should match the value <span class="k">for</span> the AAS_TLS_SAN <span class="k">in</span> the cms.env file from the CMS installation&gt;
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;bearer token from CMS installation&gt;
</code></pre></div>
<p>Execute the AAS installer:</p>
<div class="highlight"><pre><span></span><code>./authservice-v3.3.1.bin
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> the <code>AAS_ADMIN</code> credentials specified in this answer file will have administrator rights for the AAS and can be used to create other users, create new roles, and assign roles to users. </p>
</blockquote>
<h3 id="367-creating-users">3.6.7  Creating Users</h3>
<p>After installation is complete, a number of roles and user accounts must be generated. Most of these accounts will be service users, used by the various Intel® SecL services to work together. Another set of users will be used for installation permissions, and a final administrative user will be created to provide the initial authentication interface for the actual human user. The administrative user can be used to create additional users with appropriately restricted roles based on organizational needs.</p>
<p>Creating these required users and roles is facilitated by a script that will accept credentials and some configuration settings from an answer file and automate the process.</p>
<p>Create the <code>populate-users.env</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ISECL_INSTALL_COMPONENTS</span><span class="o">=</span>KBS,TA,WLS,WPM,IHUB,HVS,WLA,AAS

<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;AAS IP address or hostname&gt;:8444/aas
<span class="nv">AAS_ADMIN_USERNAME</span><span class="o">=</span>&lt;AAS username&gt;
<span class="nv">AAS_ADMIN_PASSWORD</span><span class="o">=</span>&lt;AAS password&gt;

<span class="nv">HVS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Host Verification Service&gt;
<span class="nv">IH_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Integration Hub&gt;
<span class="nv">WLS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Workload Service&gt;
<span class="nv">KBS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Key Broker Service&gt;
<span class="nv">TA_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Trust Agent&gt;

<span class="nv">HVS_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the HVS service user&gt;
<span class="nv">HVS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the HVS service user&gt;

<span class="nv">IHUB_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the Hub service user&gt;
<span class="nv">IHUB_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the Hub service user&gt;

<span class="nv">WPM_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WPM service user&gt;
<span class="nv">WPM_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WPM service user&gt;

<span class="nv">WLS_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WLS service user&gt;
<span class="nv">WLS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WLS service user&gt;

<span class="nv">WLA_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WLA service user&gt;
<span class="nv">WLA_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WLA service user&gt;

<span class="nv">GLOBAL_ADMIN_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the global Administrator user
<span class="nv">GLOBAL_ADMIN_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the global Administrator user

<span class="nv">INSTALL_ADMIN_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the installation user
<span class="nv">INSTALL_ADMIN_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the global installation user
</code></pre></div>
<blockquote>
<p><strong>Note</strong>: The <code>ISECL_INSTALL_COMPONENTS</code> variable is a comma-separated list of the components that will be used in your environment. Not all services are required for every use case. If a given service will not be used in your deployment, simply delete the unnecessary service abbreviation from the <code>ISECL_INSTALL_COMPONENTS</code> list, and leave the SAN and credential variables for that service blank.</p>
<p><strong>Note</strong>: The SAN list variables each support wildcards( "*" and "?"). In particular, without wildcards the Trust Agent SAN list would need to explicitly list each hostname or IP address for all Trust Agents that will be installed, which is not generally feasible. Using wildcards, domain names and entire IP ranges can be included in the SAN list, which will allow any host matching those ranges to install the relevant service. The SAN list specified here must exactly match the SAN list for the applicable service in that service’s env installation file.</p>
</blockquote>
<p>Execute the populate-users script:</p>
<div class="highlight"><pre><span></span><code>./populate-users
</code></pre></div>
<blockquote>
<p><strong>Note:</strong> The script can be executed with the <code>–output_json</code> argument to create the <code>populate-user.json</code>.This json output file will contain all of the users created by the script, along with usernames, passwords, and role assignments. This file can be used both as a record of the service and administrator accounts, and can be used as alternative inputs to recreate the same users with the same credentials in the future if needed. Be sure to protect this file if the <code>–output_json</code> argument is used. </p>
</blockquote>
<p>The script will automatically generate the following users:</p>
<p>Verification Service User</p>
<p>Attestation Hub Service User</p>
<p>Workload Policy Manager Service User</p>
<p>Workload Service User Name</p>
<p>Workload Service User</p>
<p>Global Admin User</p>
<p>Installation User</p>
<p>These user accounts will be used during installation of several of the Intel® SecL-DC applications. In general, whenever credentials are required by an installation answer file, the variable name should match the name of the corresponding variable used in the <code>populate-users.env</code> file.</p>
<p>The Global Admin user account has all roles for all services. This is a default administrator account that can be used to perform any task, including creating any other users. In general this account is useful for POC installations, but in production it should be used only to create user accounts with more restrictive roles. The administrator credentials should be protected and not shared.</p>
<p>The populate-users script will also output an installation token. This token has all privileges needed for installation of the Intel® SecL services, and uses the credentials provided with the <code>INSTALLATION_ADMIN_USERNAME</code> and password. The remaining Intel ® SecL-DC services require this token (set as the <code>BEARER_TOKEN</code> variable in the installation env files) to grant the appropriate privileges for installation. By default this token will be valid for two hours; the populate-users script can be rerun with the same <code>populate-users.env</code> file to regenerate the token if more time is required, or the <code>INSTALLATION_ADMIN_USERNAME</code> and password can be used to generate an authentication token. </p>
<h2 id="37-installing-the-host-verification-service">3.7  Installing the Host Verification Service</h2>
<p>This section details how to install the Intel® SecL-DC services. For instructions on running these services as containers, see the following section.</p>
<h3 id="371-required-for">3.7.1  Required For</h3>
<p>The Host Verification Service is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="372-prerequisites">3.7.2  Prerequisites</h3>
<p>The following must be completed before installing the Verification Service:</p>
<ul>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service must be installed and available</p>
</li>
<li>The Verification Service database must be available</li>
</ul>
<h3 id="373-package-dependencies">3.7.3  Package Dependencies</h3>
<p>The Intel® Security Libraries Verification Service requires the following packages and their dependencies:</p>
<ul>
<li>logback</li>
<li>Postgres* client and server 11.6 (server component optional if an external Postgres database is used)</li>
<li>unzip</li>
<li>zip</li>
<li>openssl</li>
<li>wget</li>
<li>net-tools</li>
<li>python3-policycoreutils</li>
</ul>
<p>If they are not already installed, the Verification Service installer attempts to install these automatically using the package manager. Automatic installation requires access to package repositories (the RHEL subscription repositories, the EPEL repository, or a suitable mirror), which may require an Internet connection. If the packages are to be installed from the package repository, be sure to update the repository package lists before installation.</p>
<h3 id="374-supported-operating-systems">3.7.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Verification Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="375-recommended-hardware">3.7.5  Recommended Hardware</h3>
<ul>
<li>
<p>4 vCPUs</p>
</li>
<li>
<p>RAM: 8 GB</p>
</li>
<li>
<p>100 GB</p>
</li>
<li>
<p>One network interface with network access to all managed servers</p>
</li>
<li>
<p>(Optional) One network interface for Asset Tag provisioning (only required for “pull” tag provisioning; required to provision Asset Tags to VMware ESXi servers).</p>
</li>
</ul>
<h3 id="376-installation">3.7.6  Installation</h3>
<p>To install the Verification Service, follow these steps:</p>
<ol>
<li>
<p>Copy the Verification Service installation binary to the <code>/root</code> directory.</p>
</li>
<li>
<p>Create the <code>hvs.env</code> installation answer file.</p>
</li>
</ol>
<p>A sample minimal hvs.env file is provided below. For all configuration options and their descriptions, refer to the Intel® SecL Configuration section  on the Verification Service.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials </span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">HVS_SERVICE_USERNAME</span><span class="o">=</span>&lt;username&gt;
<span class="nv">HVS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;password&gt;

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification </span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;digest&gt;

<span class="c1"># TLS Configuration</span>
<span class="nv">SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,192.168.1.1,hvs.server.com <span class="c1">#comma-separated list of IP addresses and hostnames for the HVS to be used in the Subject Alternative Names list in the TLS Certificate</span>

<span class="c1"># Installation admin bearer token for CSR approval request to CMS </span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

<span class="c1"># Database </span>
<span class="nv">HVS_DB_NAME</span><span class="o">=</span>&lt;database name&gt;
<span class="nv">HVS_DB_USERNAME</span><span class="o">=</span>&lt;database username&gt;
<span class="nv">HVS_DB_PASSWORD</span><span class="o">=</span>&lt;database password&gt;
<span class="nv">HVS_DB_SSLCERTSRC</span><span class="o">=</span>/tmp/dbcert.pem  <span class="c1"># Not required if VS_DB_SSLCERT is given</span>
</code></pre></div>
<ol>
<li>Execute the installer binary.</li>
</ol>
<p>```shell
./hvs-v3.3.1.bin
   <div class="highlight"><pre><span></span><code>When the installation completes, the Verification Service is available. The services can be verified by running **hvs status** from the Verification Service command line.

```shell
hvs status
</code></pre></div></p>
<h2 id="38-installing-the-workload-service">3.8  Installing the Workload Service</h2>
<h3 id="381-required-for">3.8.1  Required For</h3>
<p>The WLS is REQUIRED for the following use cases.</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="382-prerequisites">3.8.2  Prerequisites</h3>
<p>The following must be completed before installing the Workload Service:</p>
<ul>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service must be installed and available</p>
</li>
<li>
<p>The Verification Service must be installed and available</p>
</li>
<li>
<p>The Workload Service database must be available</p>
</li>
</ul>
<h3 id="383-supported-operating-systems">3.8.3  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Workload Service supports Red Hat Enterprise Linux 8.2</p>
<h3 id="384-recommended-hardware">3.8.4  Recommended Hardware</h3>
<h3 id="385-installation">3.8.5  Installation</h3>
<ul>
<li>
<p>Copy the Workload Service installation binary to the <code>/root</code> directory.</p>
</li>
<li>
<p>Create the <code>workload-service.env</code> installation answer file</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nv">WLS_DB_USERNAME</span><span class="o">=</span>&lt;database username&gt;
<span class="nv">WLS_DB_PASSWORD</span><span class="o">=</span>&lt;database password&gt;
<span class="nv">WLS_DB_HOSTNAME</span><span class="o">=</span>&lt;IP or hostname of database server&gt;
<span class="nv">WLS_DB_PORT</span><span class="o">=</span>&lt;Database port<span class="p">;</span> <span class="m">5432</span> by default&gt;
<span class="nv">WLS_DB</span><span class="o">=</span>&lt;name of the WLS database&gt;
<span class="nv">WLS_DB_SSLCERTSRC</span><span class="o">=</span>&lt;path to database TLS certificate<span class="p">;</span> the default location is typically /usr/local/pgsql/data/server.crt &gt;
<span class="nv">HVS_URL</span><span class="o">=</span>https://&lt;Ip address or hostname of the Host verification Service&gt;:8443/hvs/v2/
<span class="nv">WLS_SERVICE_USERNAME</span><span class="o">=</span>&lt;username <span class="k">for</span> WLS service account&gt;
<span class="nv">WLS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;password <span class="k">for</span> WLS service account&gt;
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;IP or hostname to CMS&gt;:8445/cms/v1/
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;sha384 of CMS TLS certificate&gt;
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;IP or hostname to AAS&gt;:8444/aas/
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the WLS&gt;
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;Installation token from populate-users script&gt;
</code></pre></div>
<ul>
<li>Execute the WLS installer binary:</li>
</ul>
<div class="highlight"><pre><span></span><code>./wls-v3.3.1.bin
</code></pre></div>
<h2 id="39-installing-the-trust-agent-for-linux">3.9  Installing the Trust Agent for Linux</h2>
<h3 id="391-required-for">3.9.1  Required For</h3>
<p>The Trust Agent for Linux is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="392-package-dependencies">3.9.2  Package Dependencies</h3>
<p>The Trust Agent requires the following packages and their dependencies:</p>
<ul>
<li>
<p>Tboot (Optional, for TXT-based deployments <strong>without</strong> UEFI SecureBoot only) </p>
</li>
<li>
<p>openssl</p>
</li>
<li>
<p>tar</p>
</li>
<li>
<p>redhat-lsb</p>
</li>
</ul>
<p>If they are not already installed, the Trust Agent installer attempts to install these automatically using the package manager. Automatic installation requires access to package repositories (the RHEL subscription repositories, the EPEL repository, or a suitable mirror), which may require an Internet connection. If the packages are to be installed from the package repository, be sure to update the repository package lists before installation.</p>
<p>Tboot will not be installed automatically. Instructions for installing and configuring tboot are documented later in this section.</p>
<h3 id="393-supported-operating-systems">3.9.3  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Trust Agent for Linux supports Red Hat Enterprise Linux 8.2. Windows support is described in the section "Installing the Trust Agent for Windows"</p>
<h3 id="394-prerequisites">3.9.4  Prerequisites</h3>
<p>The following must be completed before installing the Trust Agent:</p>
<ul>
<li>
<p>Supported server hardware including an Intel® Xeon® processor with Intel Trusted Execution Technology activated in the system BIOS.</p>
</li>
<li>
<p>Trusted Platform Module (version 2.0) installed and activated in the system BIOS, with cleared ownership status. </p>
</li>
</ul>
<blockquote>
<p><strong>Note:</strong> For Linux systems, TPM 1.2 and TPM resource sharing to applications other than the Trust Agent are not supported at this time. Do not install trousers or another TSS stack application after installing the Trust Agent on Linux systems. </p>
</blockquote>
<ul>
<li>System must be booted to a tboot boot option OR use UEFI SecureBoot.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode. </p>
</blockquote>
<ul>
<li>
<p>(Provisioning step only) Intel® SecL Verification Service server installed and active.</p>
</li>
<li>
<p>(REQUIRED for servers configured with TXT and tboot only) If the server is installed using an LVM, the LVM name must be identical for all Trust Agent systems. The Grub bootloader line that calls the Linux kernel will contain the LVM name of the root volume, and this line with all arguments is part of what is measured in the TXT/Tboot boot process. This will cause the OS Flavor measurements to differ between two otherwise identical hosts if their LVM names are different. Simply using a uniform name for the LVM during OS installation will resolve this possible discrepancy. </p>
</li>
<li>
<p>(Optional, REQUIRED for Virtual Machine Confidentiality only):</p>
</li>
<li>
<p>QEMU/KVM must be installed</p>
</li>
<li>
<p>Libvirt must be installed</p>
</li>
<li>
<p>(Optional, REQUIRED for Docker Container Confidentiality only): Docker CE 19.03.13 must be installed</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: The specific Docker-CE version 19.03.13 is required for Docker Container Confidentiality. Only this version is supported for this use case.</p>
</blockquote>
<h4 id="3941-tboot-installation">3.9.4.1  Tboot Installation</h4>
<blockquote>
<p><strong>Note</strong>: A solution to a security bug has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.</p>
</blockquote>
<p>Tboot is required to build a complete Chain of Trust for Intel® TXT systems that are not using UEFI Secure Boot. Tboot acts to initiate the Intel® TXT SINIT ACM (Authenticated Code Module), which populates several TPM measurements including measurement of the kernel, grub command line, and initrd. Without either tboot or UEFI Secure Boot, the Chain of Trust will be broken because the OS-related components will be neither measured nor signature-verified prior to execution. Because tboot acts to initiate the Intel® TXT SINIT ACM, tboot is only required for platforms using Intel® TXT, and is not required for platforms using another hardware Root of Trust technology like Intel® Boot Guard.</p>
<p>Intel® SecL-DC requires tboot 1.9.7 or greater. For most platforms, the version of tboot available from the RedHat software repository will meet all requirements. Some newer platforms and platform firmware versions may require a later version of tboot, including later versions than are available on the RedHat software repositories. This is due to updates that can be made to the Intel® TXT SINIT ACM behavior, and the SINIT ACM is contained in the BIOS firmware. </p>
<p>If a newer version of tboot is required than is available from the repository, the most current version can be found here:</p>
<p><a href="https://sourceforge.net/projects/tboot/files/tboot/">https://sourceforge.net/projects/tboot/files/tboot/</a></p>
<p>Tboot requires configuration of the grub boot loader after installation. To install and configure tboot:</p>
<ol>
<li>Install tboot</li>
</ol>
<div class="highlight"><pre><span></span><code>yum install tboot
</code></pre></div>
<ol>
<li>Make a backup of your current <code>grub.cfg</code> file</li>
</ol>
<p>The below examples assume RedHat has been installed on a platform using Legacy boot mode.The grub path will be slightly different for platforms using Legacy BIOS.</p>
<div class="highlight"><pre><span></span><code>cp /boot/grub2/grub.cfg /boot/grub2/grub.bak
</code></pre></div>
<ol>
<li>
<p>Generate a new <code>grub.cfg</code> with the tboot boot option</p>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
</li>
<li>
<p>Update the default boot option</p>
</li>
</ol>
<p>Ensure that the <code>GRUB_DEFAULT</code> value is set to the tboot option. </p>
<p>a. Update /etc/default/grub and set the GRUB_DEFAULT value to "saved"</p>
<div class="highlight"><pre><span></span><code>GRUB_DEFAULT=saved
</code></pre></div>
<p>b. Set the grub default option to tboot using the following</p>
<div class="highlight"><pre><span></span><code>grub2-set-default 2
</code></pre></div>
<p>Note that option 2 will be the correct Grub option assuming an otherwise-default installation of  RHEL.  A different option may be needed depending on the system configuration.</p>
<p>c. Regenerate grub.cfg:</p>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
<ol>
<li>Reboot the system</li>
</ol>
<p>Because measurement happens at system boot, a reboot is needed to boot to the tboot boot option and populate measurements in the TPM.</p>
<ol>
<li>Verify a successful trusted boot with tboot</li>
</ol>
<p>Tboot provides the <code>txt-stat</code> command to show the tboot log. The first part of the output of this command can be used to verify a successful trusted launch. In the output below, note the “TXT measured launch” and “secrets flag set” at the bottom. Both of these should show "<strong>TRUE</strong>" if the tboot measured launch was successful. If either of these show "<strong>FALSE</strong>" the measured launch has failed. This usually simply indicates that the tboot boot option was not selected during boot.</p>
<p>If the measured launch was successful, proceed to install the Trust Agent.</p>
<p>```
Intel&reg; TXT Configuration Registers:
           STS: 0x0001c091
               senter_done: TRUE
               sexit_done: FALSE
               mem_config_lock: FALSE
               private_open: TRUE
               locality_1_open: TRUE
               locality_2_open: TRUE
           ESTS: 0x00
               txt_reset: FALSE
           E2STS: 0x0000000000000006
               secrets: TRUE
           ERRORCODE: 0x00000000
           DIDVID: 0x00000001b0078086
               vendor_id: 0x8086
               device_id: 0xb007
               revision_id: 0x1
           FSBIF: 0xffffffffffffffff
           QPIIF: 0x000000009d003000
           SINIT.BASE: 0x6fec0000
           SINIT.SIZE: 262144B (0x40000)
           HEAP.BASE: 0x6ff00000
           HEAP.SIZE: 1048576B (0x100000)
           DPR: 0x0000000070000051
               lock: TRUE
               top: 0x70000000
               size: 5MB (5242880B)
           PUBLIC.KEY:
               9c 78 f0 d8 53 de 85 4a 2f 47 76 1c 72 b8 6a 11
               16 4a 66 a9 84 c1 aa d7 92 e3 14 4f b7 1c 2d 11</p>
<hr />
<pre><code>        TXT measured launch: TRUE
        secrets flag set: TRUE
</code></pre>
<hr />
<p>```</p>
<h3 id="395-installation">3.9.5  Installation</h3>
<p>Installation of the Trust Agent is split into two major steps: Installation, which covers the creation of system files and folders, and Provisioning, which involves the creation of keys and secrets and links the Trust Agent to a specific Verification Service. Both operations can be performed at the same time using an installation answer file. Without the answer file, the Trust Agent can be installed and left in an un-provisioned state regardless of whether a Verification Service is up and running, until such time as the datacenter administrator is ready to run the provisioning step and link the Trust Agent to a Verification Service.</p>
<p>To install the Trust Agent for Linux:</p>
<ul>
<li>
<p>Copy the Trust Agent installation binary to the /root/ directory.</p>
</li>
<li>
<p>(Optional; required to perform Provisioning and Installation at the same time.) Create the<code>trustagent.env</code> answer file in the <code>/root</code> directory (for full configuration options, see section 9.2). The minimum configuration options for installation are provided below.</p>
</li>
</ul>
<p>For Platform Attestation only, provide the following in <code>trustagent.env</code> </p>
<p><code>shell
  HVS_URL=https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2
  PROVISION_ATTESTATION=y
  GRUB_FILE=&lt;path to grub.cfg&gt;
  CURRENT_IP=&lt;Trust Agent IP address&gt;
  CMS_TLS_CERT_SHA384=&lt;CMS TLS digest&gt;
  BEARER_TOKEN=&lt;Installation token from populate-users script&gt;
  AAS_API_URL=https://&lt;AAS IP or Hostname&gt;:8444/aas
  CMS_BASE_URL=https://&lt;CMS IP or Hostname&gt;:8445/cms/v1
  SAN_LIST=&lt;Comma-separated list of IP addresses and hostnames for the TAgent matching the SAN list specified in the populate-users script; may include wildcards&gt;</code></p>
<p>For Workload Confidentiality with VM Encryption, add the following (<strong>in addition to</strong> the basic Platform Attestation sample):</p>
<p><code>shell
  WLA_SERVICE_USERNAME=&lt;Username for the WLA service user&gt;
  WLA_SERVICE_PASSWORD=&lt;Username for the WLA service user&gt;
  WLS_API_URL=https://&lt;WLS IP address or hostname&gt;:5000/wls/</code></p>
<p>For Workload Confidentiality with Docker Container Encryption, add the following (<strong>in addition to</strong> the basic Platform Attestation sample):</p>
<p><code>shell
  WLA_SERVICE_USERNAME=&lt;Username for the WLA service user&gt;
  WLA_SERVICE_PASSWORD=&lt;Username for the WLA service user&gt;
  WLS_API_URL=https://&lt;WLS IP address or hostname&gt;:5000/wls/
  WA_WITH_CONTAINER_SECURITY=yes
  NO_PROXY=&lt;Registry_ip&gt;
  HTTPS_PROXY=&lt;proxy_url&gt;
  REGISTRY_SCHEME_TYPE=https</code></p>
<ul>
<li>Execute the Trust Agent installer and wait for the installation to complete.</li>
</ul>
<div class="highlight"><pre><span></span><code>./trustagent-v3.3.1.bin
</code></pre></div>
<p>If the <code>trustagent.env</code> answer file was provided with the minimum required options, the Trust Agent will be installed and also Provisioned to the Verification Service specified in the answer file.</p>
<p>If no answer file was provided, the Trust Agent will be installed, but will not be Provisioned. TPM-related functionality will not be available from the Trust Agent until the Provisioning step is completed.</p>
<p>The Trust Agent will add a new grub menu entry for application measurement. This new entry will include tboot if the existing grub contains tboot as the default boot option.</p>
<blockquote>
<p><strong>Note:</strong>  If the Linux Trust Agent is installed without being Provisioned, the Trust Agent process will not actually run until the Provisioning step has been completed.</p>
</blockquote>
<ul>
<li>Legacy BIOS systems using tboot ONLY) Update the grub boot loader:</li>
</ul>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
<ul>
<li>After Provisioning is completed, the Linux Trust Agent must be rebooted so that the default SOFTWARE Flavor manifest can be measured and extended to the TPM. If the Workload Agent will also be installed on the system (see the next section), wait to reboot the server until after the Workload Agent has been installed, as this modifies the default SOFTWARE Flavor manifest.</li>
</ul>
<h2 id="310-installing-the-workload-agent">3.10  Installing the Workload Agent</h2>
<h3 id="3101-required-for">3.10.1  Required For</h3>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3102-supported-operating-systems">3.10.2  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Workload Agent supports Red Hat Enterprise
Linux 8.2</p>
<h3 id="3103-prerequisites">3.10.3  Prerequisites</h3>
<p>The following must be completed before installing the Workload Agent:</p>
<ul>
<li>
<p>Intel® SecL Trust Agent installed and active.</p>
</li>
<li>
<p>cryptsetup</p>
</li>
<li>
<p>(REQUIRED for Virtual Machine Confidentiality only):</p>
</li>
<li>
<p>QEMU/KVM must be installed</p>
</li>
<li>
<p>libvirt must be installed</p>
</li>
<li>
<p>(REQUIRED for Docker Container Confidentiality only): Docker CE
    19.03.13 must be installed</p>
<blockquote>
<p><strong>Note</strong>: The specific Docker-CE version 19.03.13 is required for
Docker Container Confidentiality. Only this version is supported for
this use case.</p>
</blockquote>
</li>
</ul>
<h3 id="3104-installation">3.10.4  Installation</h3>
<ul>
<li>
<p>Copy the Workload Agent installation binary to the /root/ directory</p>
</li>
<li>
<p>Verify that the <code>trustagent.env</code> answer file is present. This file was
  necessary for installing/provisioning the Trust Agent. Note that the
  additional content required for Workload Confidentiality with either
  VM Encryption or Docker Container Encryption must be included in the
  <code>trustagent.env</code> file (samples provided in the previous section) for
  use by the Workload Agent.</p>
</li>
<li>
<p>Execute the Workload Agent installer binary.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>./workload-agent-v3.3.1.bin
</code></pre></div>
<ul>
<li>(Legacy BIOS systems using tboot ONLY) Update the grub boot loader:</li>
</ul>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
<ul>
<li>Reboot the server. The Workload Agent populates files that are
  needed for the default <code>SOFTWARE</code> Flavor, and a reboot is required for
  those measurements to happen.</li>
</ul>
<h2 id="312-trust-agent-provisioning">3.12  Trust Agent Provisioning</h2>
<p>"Provisioning" the Trust Agent involves connecting to a Verification
Service to download the Verification Service PrivacyCA certificate,
create a new Attestation Identity Keypair in the TPM, and verify or
create the TPM Endorsement Certificate and Endorsement Key. The
Verification Service PrivacyCA root certificate is used to sign the EC,
and the EC is used to generate the Attestation Identity Keypair. The AIK
is used by the Verification Service to verify the integrity of quotes
from the host’s TPM.</p>
<p>Provisioning can be performed separately from installation (meaning you
can install the Trust Agent without Provisioning, and then Provision
later). If the <code>trustagent.env</code> answer file is present and has the
required Verification Service information during installation, the Agent
will automatically run the Provisioning steps.</p>
<blockquote>
<p><strong>Note:</strong>The <code>trustagent.env</code> answer file must contain user credentials for a
user with sufficient privileges. The minimum role required for
performing provisioning is the "trustagent_provisioner" role.</p>
<p><strong>Note:</strong>If the Linux Trust Agent is installed without being Provisioned, the
Trust Agent process will not actually run until the Provisioning
step has been completed.</p>
</blockquote>
<p>If the answer file is not present during installation, the Agent can be
Provisioned later by adding the <code>trustagent.env</code> file and running the
following command:</p>
<p><code>tagent provision-attestation &lt;trustagent.env or trustagent.ini file
path&gt;</code></p>
<h2 id="313-trust-agent-registration">3.13  Trust Agent Registration</h2>
<p>Registration creates a host record with connectivity details and other
host information in the Verification Service database. This host record
will be used by the Verification Service to retrieve TPM attestation
quotes from the Trust Agent to generate an attestation report.</p>
<p>The Trust Agent can register the host with a Verification Service by
running the following command (the trustagent.env or trustagent.ini
answer file must be present in the current working directory):</p>
<p><code>tagent create-host</code></p>
<p>Hosts can also be registered using a REST API request to the
Verification Service:</p>
<div class="highlight"><pre><span></span><code><span class="err">POST &lt;https://verification.service.com:8443/hvs/v2/hosts&gt;</span>

<span class="err">{</span>
<span class="err">    &quot;host_name&quot;: &quot;&lt;hostname of host to be registered&gt;&quot;</span>
<span class="err">    &quot;connection_string&quot;: &quot;intel:https://&lt;hostname or IP address&gt;:1443&quot;,</span>
<span class="err">    &quot;flavorgroup_names&quot;: [],</span>
<span class="err">    &quot;description&quot;: &quot;&lt;description&gt;&quot;</span>
<span class="err">}</span>
</code></pre></div>
<blockquote>
<p><strong>Note:</strong>When a new host is registered, the Verification Service will
automatically attempt to match the host to appropriate Flavors. If
appropriate Flavors are not found, the host will still be
registered, but will be in an Untrusted state until/unless
appropriate Flavors are added to the Verification Service.</p>
</blockquote>
<p><img src="Images\ta_registration.png" alt="image-20200621070159371" style="zoom:150%;" /></p>
<h2 id="314-importing-the-host_unique-flavor">3.14  Importing the HOST_UNIQUE Flavor</h2>
<p>RHEL and VMWare ESXi hosts have measured components that are unique to
each host. This means that a special HOST_UNIQUE flavor part needs to
be imported for each RHEL and ESXi host, in addition to any other OS or
Platform Flavors.</p>
<blockquote>
<p><strong>Note:</strong>Importing a Flavor requires user credentials for a user with
sufficient privileges. The minimum role required for creating the
HOST_UNIQUE Flavor part is the “host_unique_flavor_creator”
role. This role can only create HOST_UNIQUE Flavor parts, and
cannot create any other Flavors.</p>
</blockquote>
<p>On Red Hat Enterprise Linux hosts with the Trust Agent, this can be
performed from the Trust Agent command line (this requires the
trustagent.env answer file to be present in the current working
directory):</p>
<div class="highlight"><pre><span></span><code>tagent create-host-unique-flavor
</code></pre></div>
<p>This can also be performed using a REST API (required for VMWare ESXi
hosts):</p>
<div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>

<span class="err">{ </span>
<span class="err">    &quot;connection_string&quot;: &quot;&lt;Connection string&gt;&quot;,</span>
<span class="err">    &quot;partial_flavor_types&quot;: [&quot;HOST_UNIQUE&quot;]</span>
<span class="err">}</span>
</code></pre></div>
<h2 id="315-installing-the-integration-hub">3.15  Installing the Integration Hub</h2>
<blockquote>
<p><strong>Note:</strong>The Integration Hub is only required to integrate Intel® SecL with
third-party scheduler services, such as OpenStack Nova or
Kubernetes. The Hub is not required for usage models that do not
require Intel® SecL security attributes to be pushed to an
integration endpoint.</p>
</blockquote>
<h3 id="3151-required-for">3.15.1  Required For</h3>
<p>The Hub is REQUIRED for the following use cases.</p>
<ul>
<li>Workload Confidentiality (both VMs and Containers)</li>
</ul>
<p>The Hub is OPTIONAL for the following use cases (used only if
orchestration or other integration support is needed):</p>
<ul>
<li>Platform Integrity with Data Sovereignty and Signed Flavors</li>
<li>Application Integrity</li>
</ul>
<h3 id="3152-deployment-architecture-considerations-for-the-hub">3.15.2  Deployment Architecture Considerations for the Hub</h3>
<p>A separate Hub instance is REQUIRED for each Cloud environment (also referred to as a Hub "tenant").  For example, if a single datacenter will have an OpenStack cluster and also two separate Kubernetes clusters, a total of three Hub instances must be installed, though additional instances of other Intel SecL services are not required (in the same example, only a single Verification Service is required).  Each Hub will manage a single orchestrator environment.  Each Hub instance should be installed on a separate VM or physical server</p>
<h3 id="3153-prerequisites">3.15.3  Prerequisites</h3>
<p>The Intel® Security Libraries Integration Hub can be run as a VM or as a
bare-metal server. The Hub may be installed on the same server (physical
or VM) as the Verification Service.</p>
<ul>
<li>The Verification Service must be installed and available</li>
<li>The Authentication and Authorization Service must be installed and
    available</li>
<li>The Certificate Management Service must be installed and available</li>
<li>(REQUIRED for Kubernetes integration only) The Intel SecL Custom Resource Definitions must be installed and available (see the Integration section for details)</li>
</ul>
<h3 id="3154-package-dependencies">3.15.4  Package Dependencies</h3>
<p>The Intel® SecL Integration Hub requires a number of packages and their
dependencies:</p>
<p>If these are not already installed, the Integration Hub installer
attempts to install these packages automatically using the package
manager. Automatic installation requires access to package repositories
(the RHEL subscription repositories, the EPEL repository, or a suitable
mirror), which may require an Internet connection. If the packages are
to be installed from the package repository, be sure to update your
repository package lists before installation.</p>
<h3 id="3155-supported-operating-systems">3.15.5  Supported Operating Systems</h3>
<p>The Intel Security Libraries Integration Hub supports Red Hat Enterprise
Linux 8.2</p>
<h3 id="3156-recommended-hardware">3.15.6  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>1 GB free space to install the Verification Service services.
    Additional free space is needed for the Attestation Hub database and
    logs (database and log space requirements are dependent on the
    number of managed servers).</p>
</li>
<li>
<p>One network interface with network access to the Verification
    Service.</p>
</li>
<li>
<p>One network interface with network access to any integration
    endpoints (for example, OpenStack Nova).</p>
</li>
</ul>
<h3 id="3157-installing-the-integration-hub">3.15.7  Installing the Integration Hub</h3>
<p>To install the Integration Hub, follow these steps:</p>
<ol>
<li>
<p>Copy the Integration Hub installation binary to the<code>/root</code>
    directory.</p>
</li>
<li>
<p>Create the <code>ihub.env</code> installation answer file. See the
    sample file below.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials</span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">IHUB_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the Hub service user&gt;
<span class="nv">IHUB_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the Hub service user&gt;

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification</span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;TLS hash&gt;

<span class="c1"># TLS Configuration</span>
<span class="nv">TLS_SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,192.168.1.1,hub.server.com <span class="c1">#comma-separated list of IP addresses and hostnames for the Hub to be used in the Subject Alternative Names list in the TLS Certificate</span>

<span class="c1"># Verification Service URL</span>
<span class="nv">ATTESTATION_SERVICE_URL</span><span class="o">=</span>https://isecl-hvs:8443/hvs/v2
<span class="nv">ATTESTATION_TYPE</span><span class="o">=</span>HVS

<span class="c1">#Integration tenant type.  Currently supported values are &quot;KUBENETES&quot; or &quot;OPENSTACK&quot;</span>
<span class="nv">TENANT</span><span class="o">=</span>&lt;KUBERNETES or OPENSTACK&gt;

<span class="c1"># OpenStack Integration Credentials - required for OpenStack integration only</span>
<span class="nv">OPENSTACK_AUTH_URL</span><span class="o">=</span>&lt;OpenStack Keystone URL<span class="p">;</span> typically http://openstack-ip:5000/&gt;
<span class="nv">OPENSTACK_PLACEMENT_URL</span><span class="o">=</span>&lt;OpenStack Nova API URL<span class="p">;</span> typically http://openstack-ip:8778/&gt;
<span class="nv">OPENSTACK_USERNAME</span><span class="o">=</span>&lt;OpenStack username&gt;
<span class="nv">OPENSTACK_PASSWORD</span><span class="o">=</span>&lt;OpenStack password&gt;

<span class="c1"># Kubernetes Integration Credentials - required for Kubernetes integration only</span>
<span class="nv">KUBERNETES_URL</span><span class="o">=</span>https://kubernetes:6443/
<span class="nv">KUBERNETES_CRD</span><span class="o">=</span>custom-isecl
<span class="nv">KUBERNETES_CERT_FILE</span><span class="o">=</span>/etc/ihub/apiserver.crt
<span class="nv">KUBERNETES_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzI1NiIsImtpZCI6Ik......

<span class="c1"># Installation admin bearer token for CSR approval request to CMS - mandatory</span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…
</code></pre></div>
3. Execute the installer binary.</p>
<div class="highlight"><pre><span></span><code>./ihub-v3.3.1.bin
</code></pre></div>
<p>After installation, the Hub must be configured to integrate with a Cloud orchestration platform (for example, OpenStack or Kubernetes).  See the Integration section for details.</p>
<h2 id="316-installing-the-key-broker-service">3.16  Installing the Key Broker Service</h2>
<h3 id="3161-required-for">3.16.1  Required For</h3>
<p>The KBS is REQUIRED for the following use cases:</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3162-prerequisites">3.16.2  Prerequisites</h3>
<p>The following must be completed before installing the Key Broker:</p>
<ul>
<li>
<p>The Verification Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service must be installed and
    available</p>
</li>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>(Recommended; Required if a 3<sup>rd</sup>-party Key Management Server will
    be used) A KMIP 2.0-compliant 3<sup>rd</sup>-party Key management Server must
    be available.</p>
</li>
<li>
<p>The Key Broker will require the KMIP server’s client
        certificate, client key and root ca certificate.</p>
</li>
<li>
<p>The Key Broker uses the libkmip client to connect to a KMIP
        server</p>
</li>
<li>
<p>The Key Broker has been validated using the pykmip 0.9.1 KMIP
        server as a 3<sup>rd</sup>-party Key Management Server. While any general
        KMIP 2.0-compliant Key Management Server should work,
        implementation differences among KMIP providers may prevent
        functionality with specific providers.</p>
</li>
</ul>
<h3 id="3163-package-dependencies">3.16.3  Package Dependencies</h3>
<h3 id="3164-supported-operating-systems">3.16.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Key Broker Service supports Red Hat
Enterprise Linux 8.2</p>
<h3 id="3165-recommended-hardware">3.16.5  Recommended Hardware</h3>
<h3 id="3166-installation">3.16.6  Installation</h3>
<ol>
<li>
<p>Copy the Key Broker installation binary to the /root/ directory.</p>
</li>
<li>
<p>Create the installation answer file kbs.env:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;AAS IP or hostname&gt;:8444/aas
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;CMS IP or hostname&gt;:8445/cms/v1/
<span class="nv">ENDPOINT_URL</span><span class="o">=</span>https://&lt;KBS IP or hostname&gt;:9443/kbs/v1/
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of hostnames and IP addresses <span class="k">for</span> the Key Broker&gt;
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;SHA384 <span class="nb">hash</span> of CMS TLS certificate&gt;
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;Installation token from populate-users script&gt;

<span class="c1">### OPTIONAL - KMIP configuration only</span>
<span class="nv">KEY_MANAGER</span><span class="o">=</span>KMIP
<span class="nv">KMIP_SERVER_IP</span><span class="o">=</span>&lt;IP address of KMIP server&gt;
<span class="nv">KMIP_SERVER_PORT</span><span class="o">=</span>&lt;Port number of KMIP server&gt;
<span class="c1">### Retrieve the following certificates and keys from the KMIP server</span>
<span class="nv">KMIP_CLIENT_KEY_PATH</span><span class="o">=</span>&lt;path&gt;/client_key.pem
<span class="nv">KMIP_ROOT_CERT_PATH</span><span class="o">=</span>&lt;path&gt;/root_certificate.pem
<span class="nv">KMIP_CLIENT_CERT_PATH</span><span class="o">=</span>&lt;path&gt;/client_certificate.pem
</code></pre></div>
<ol>
<li>
<p>Execute the KBS installer.</p>
<div class="highlight"><pre><span></span><code>./kbs-3.3.0.bin
</code></pre></div>
</li>
</ol>
<h4 id="31661-configure-the-key-broker-to-use-a-kmip-compliant-key-management-server">3.16.6.1  Configure the Key Broker to use a KMIP-compliant Key Management Server</h4>
<p>The Key Broker can be configured to use a 3<sup>rd</sup>-party KMIP key manager as part of installation using optional kbs.env installation variables.  Without using these variables, the Key Broker will be configured to use a filesystem key management solution. This should be used only for testing and POC purposes; using a secure 3<sup>rd</sup>-party Key management Server should be used for production deployments. </p>
<p>To configure the Key Broker to point to a 3<sup>rd</sup>-party KMIP-compliant Key Management Server:</p>
<ol>
<li>
<p>Copy the KMIP server’s client certificate, client key and root ca
    certificate to the Key Broker system</p>
</li>
<li>
<p>Change the ownership of these files to <code>kms:kms</code></p>
<div class="highlight"><pre><span></span><code>chown kms:kms &lt;path&gt;/*
</code></pre></div>
</li>
<li>
<p>Configure the variables for kmip support as below</p>
<div class="highlight"><pre><span></span><code>kbs config key.manager.provider com.intel.kbs.keystore.kmip.KMIPKeyManager
kbs config kmip.server.address &lt;IP&gt;
kbs config kmip.server.port &lt;PORT&gt;
kbs config kmip.ca.certificates.path &lt;path to kmip ca certificate&gt;
kbs config kmip.client.certificate.path &lt;path to kmip client certificate&gt;
kbs config kmip.client.key.path &lt;path to kmip client key&gt;
</code></pre></div>
</li>
<li>
<p>Restart the Key Broker for the settings to take effect</p>
<div class="highlight"><pre><span></span><code>kbs stop
kbs start
</code></pre></div>
</li>
</ol>
<h3 id="3167-importing-verification-service-certificates">3.16.7  Importing Verification Service Certificates</h3>
<p>After installation, the Key Broker must import the SAML and PrivacyCA
certificates from any Verification Services it will trust. This provides
the Key Broker a way to ensure that only attestations that come from a
“known” Verification Service. The SAML and PrivacyCA certificates needed
can be found on the Verification Service.</p>
<h4 id="31671-importing-a-saml-certificate">3.16.7.1  Importing a SAML certificate</h4>
<p>Display the SAML certificate:</p>
<div class="highlight"><pre><span></span><code>cat /etc/hvs/certs/trustedca/saml-crt.pem
</code></pre></div>
<p>Use the SAML certificate output in the following POST call to the Key
Broker:</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;Key Broker IP address or hostname&gt;:9443/kbs/v1/saml-certificates
Content-Type: application/x-pem-file 
-----BEGIN CERTIFICATE-----
MIID9TCCAl2gAwIBAgIBCTANBgkqhkiG9w0BAQwFADBQMQswCQYDVQQGEwJVUzEL
MAkGA1UECBMCU0YxCzAJBgNVBAcTAlNDMQ4wDAYDVQQKEwVJTlRFTDEXMBUGA1UE
AxMOQ01TIFNpZ25pbmcgQ0EwHhcNMTkxMjExMTkzOTU1WhcNMjAxMjExMTkzOTU1
WjAYMRYwFAYDVQQDEw1tdHdpbHNvbi1zYW1sMIIBojANBgkqhkiG9w0BAQEFAAOC
AY8AMIIBigKCAYEArbrDpzR4Ry0MVhSJULHZoiVL020YqtyRH+R2NlVXTpJzqmEA
Ep2utfcP8+mSCT7DLpGBO6KACPCz3pmqj3wZyqZNTrG7IF2Z4Fuf641fPcxA3WVH
3lXz0L5Ep4jOUdfT8kj4hHxHJVJhDsW4J2fds2RGnn8bZG/QbmmGNRfqdxht0zMh
63ik8jBWNWHxYSRbck27FyTj9hDU+z+rFfIdNv1SiQ9FyndgOytK/m7ijoAetkSF
bCsauzUL7DFdRzTmB2GCF/Zd957V51GNpvan6uwqDTL6T4NFX2sqoVduu/WIyTpO
/6D2aA741CR3Bmk9945TSeDKZNz2HkihuE+d8ES68W1t4rvox/Noi74e0k35AqcQ
Q3P0DZpD+XaRapz5CHcOPwOpZ3A/8wN2f+CS2HqDx8FwABkh7l8OdiIWs8+TDQZe
1x4e/50jE/8zMR/tsAy1EXkm3OTOVxih0u18J84x4OT+rHAIcoQ+TOJ40aHrWGHg
kVCfiCUzYYT/W/RBAgMBAAGjEjAQMA4GA1UdDwEB/wQEAwIGwDANBgkqhkiG9w0B
AQwFAAOCAYEAP/ABHdPquBNrMOCU+v7SfMLmIfJymA15mCorMEiKZ1d7oNnoPP0G
pfyRA4TUiyFLCOLi4jIXWuu4Lt6RUz6bnzn8JRWD5ocIJGGxWjOA66xyS3o9iG7G
otOh1pzp5wlwPG7r8ZJ7Q26J+NuHpN1GW5U5Vjww1J9rEKnsKp45QHkG2nXEujdx
YXmKXtEG2gOMVjaLiqromf6VxbdNoKHZGEfqU3H5ymMgqIrnXl3MivA30CymCDLl
rJGRQSwOfzywPCnUOAVptBwLs2kwOtdvnq+BTK3q/dKKoNiFURj/mQ70egquW9ly
TOkYivmKqMZxZlq0//cre4K35aCW3ZArzGgNM8Pk0V/hZp8ZHrWLNAdo4w/Pj1oC
Yq7R0RQ8jQerkewYBfrv3O3e9c22h48fsHnun6F3sbcDjws/sWJIOcrPyqJE26HY
DmIKpvjqc0jI31ndBBwkb+RIBFkz1Ycob9rsW16uVqbjBFDjJ5QKOdXxhqulyboa
JAF53vmU+1jE
-----END CERTIFICATE-----
</code></pre></div>
<h4 id="31672-importing-a-privacyca-certificate">3.16.7.2  Importing a PrivacyCA Certificate</h4>
<p>Use OpenSSL to display the PrivacyCA certificate content:</p>
<div class="highlight"><pre><span></span><code>openssl x509 -in /etc/hvs/certs/trustedca/privacy-ca/privacy-ca-cert.pem
</code></pre></div>
<p>Use the PrivacyCA certificate output in the following POST call to the
Key Broker:</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;Key Broker IP address or hostname&gt;:9443/kbs/v1/tpm-identity-certificates
Content-Type: application/x-pem-file 
-----BEGIN CERTIFICATE-----
MIIHaDCCBdCgAwIBAgIGAW72eWZ9MA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNVBAMT
EG10d2lsc29uLXBjYS1haWswHhcNMTkxMjExMTkzOTQxWhcNMjkxMjEwMTkzOTQx
WjAbMRkwFwYDVQQDExBtdHdpbHNvbi1wY2EtYWlrMIIBojANBgkqhkiG9w0BAQEF
AAOCAY8AMIIBigKCAYEAmWqBr2YiycZbF/QgFbxTr4YiHtueWBdW0sibtH1QRSbI
KtkbFsmr6J6QiLBaXcF7KVN6DaD0j5sU4cZSttqKwlSUnn07xjWJRP1EcvSaufO1
MarewgBpFQcI2T6aTs1ziV77BoKz0kWteURz1jT1KSwuattxTelpmgucDp98MqW/
uWsliHUVxh51JTE1yn7Vf1QCWz3a+NDH98Lgr5ks337yx3VBK59Dwtsmfsrd5tMn
IuV9Jw0Y2UEdDi004FXI4q64MsMpWA7t5ONRAU+VNU0Y3saXeNBDg9J363imOHIH
haP8ixDhqZ+Xb/TGafgFeEHBkJTv6bWpDqodbWVDbgZloxJzcNgtimQw3RbyrB3C
KijlEo5BQY6bOcdMG7gCq77u/fbOvLb5IXzS8ZDpwuwCQNnBP4UJXwAflO7COG7P
mpj9bTV1OtFiPtYFc4JdGdaf1Pl2zWGeR0c3PIzYQxqvtTVtFX+oRWRsgaEdxKf7
LJx4aIjXwP2s6PIiOSalAgMBAAGjggOwMIIDrDCCAbMGA1UdDgSCAaoEggGmMIIB
ojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAmWqBr2YiycZbF/QgFbxTr4Yi
HtueWBdW0sibtH1QRSbIKtkbFsmr6J6QiLBaXcF7KVN6DaD0j5sU4cZSttqKwlSU
nn07xjWJRP1EcvSaufO1MarewgBpFQcI2T6aTs1ziV77BoKz0kWteURz1jT1KSwu
attxTelpmgucDp98MqW/uWsliHUVxh51JTE1yn7Vf1QCWz3a+NDH98Lgr5ks337y
x3VBK59Dwtsmfsrd5tMnIuV9Jw0Y2UEdDi004FXI4q64MsMpWA7t5ONRAU+VNU0Y
3saXeNBDg9J363imOHIHhaP8ixDhqZ+Xb/TGafgFeEHBkJTv6bWpDqodbWVDbgZl
oxJzcNgtimQw3RbyrB3CKijlEo5BQY6bOcdMG7gCq77u/fbOvLb5IXzS8ZDpwuwC
QNnBP4UJXwAflO7COG7Pmpj9bTV1OtFiPtYFc4JdGdaf1Pl2zWGeR0c3PIzYQxqv
tTVtFX+oRWRsgaEdxKf7LJx4aIjXwP2s6PIiOSalAgMBAAEwDwYDVR0TAQH/BAUw
AwEB/zCCAeAGA1UdIwSCAdcwggHTgIIBpjCCAaIwDQYJKoZIhvcNAQEBBQADggGP
ADCCAYoCggGBAJlqga9mIsnGWxf0IBW8U6+GIh7bnlgXVtLIm7R9UEUmyCrZGxbJ
q+iekIiwWl3BeylTeg2g9I+bFOHGUrbaisJUlJ59O8Y1iUT9RHL0mrnztTGq3sIA
aRUHCNk+mk7Nc4le+waCs9JFrXlEc9Y09SksLmrbcU3paZoLnA6ffDKlv7lrJYh1
FcYedSUxNcp+1X9UAls92vjQx/fC4K+ZLN9+8sd1QSufQ8LbJn7K3ebTJyLlfScN
GNlBHQ4tNOBVyOKuuDLDKVgO7eTjUQFPlTVNGN7Gl3jQQ4PSd+t4pjhyB4Wj/IsQ
4amfl2/0xmn4BXhBwZCU7+m1qQ6qHW1lQ24GZaMSc3DYLYpkMN0W8qwdwioo5RKO
QUGOmznHTBu4Aqu+7v32zry2+SF80vGQ6cLsAkDZwT+FCV8AH5Tuwjhuz5qY/W01
dTrRYj7WBXOCXRnWn9T5ds1hnkdHNzyM2EMar7U1bRV/qEVkbIGhHcSn+yyceGiI
18D9rOjyIjkmpQIDAQABoR+kHTAbMRkwFwYDVQQDExBtdHdpbHNvbi1wY2EtYWlr
ggYBbvZ5Zn0wDQYJKoZIhvcNAQELBQADggGBAC3PEB8Av0PBJgrJMxzMbuf1FCdD
AUrfYmP81Hs0/v70efviMEF2s3GAyLHD9v+1nNFCQrjcNCar18k45BlcodBEmxKA
DZoioFykRtlha6ByVvuN6wD93KQbKsXPKhUp8X67fLuOcQgfc3BoDRlw/Ha1Ib6X
fliE+rQzLCOgClK7ZdTwl9Ok0VbR7Mbal/xShIqr2WopjBtal9p4RsnIxilTHI+m
qzbV8zvZXYfYtEb3MMMT5EnjIV8O498KKOjxohD2vqaxqItd58pOi6z/q5f4pLHc
DvdsJecJEoWb2bxWQdBgthMjX6AUV/B5G/LTfaPwVbTLdEc+S6Nrobf/TFYV0pvG
OzF3ltYag0fupuYJ991s/JhVwgJhCGq7YourDGkNIWAjt0Z2FWuQKnxWvmResgkS
WTeXt+1HCFSo5WcAZWV8R9FYv7tzFxPY8aoLj82sgrOE4IwRqaA8KMbq3anF4RCk
+D8k6etqMcNHFS8Fj6GlCd80mb4Q3sxuCiBvZw==
-----END CERTIFICATE-----
</code></pre></div>
<h2 id="317-installing-the-workload-policy-manager">3.17  Installing the Workload Policy Manager</h2>
<h3 id="3171-required-for">3.17.1  Required For</h3>
<p>The WPM is REQUIRED for the following use cases.</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3172-package-dependencies">3.17.2  Package Dependencies</h3>
<ul>
<li>(Required only if Docker Container encryption is needed) <code>Docker-ce
    19.03.13</code> must be installed. This is needed only if the option
    <code>WPM_WITH_CONTAINER_SECURITY=yes</code> is set in the <code>wpm.env</code> answer
    file.</li>
</ul>
<h3 id="3173-supported-operating-systems">3.17.3  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Workload Policy Manager supports Red Hat
Enterprise Linux 8.2.</p>
<h3 id="3174-recommended-hardware">3.17.4  Recommended Hardware</h3>
<ul>
<li>
<p>2 vCPUs</p>
</li>
<li>
<p>RAM: 8 GB</p>
</li>
<li>
<p>100 GB</p>
</li>
<li>
<p>One network interface with network access to the Key Broker and
    Workload Service</p>
</li>
<li>
<p>Additional memory and disk space may be required depending on the
    size of images to be encrypted</p>
</li>
</ul>
<h3 id="3175-installation">3.17.5  Installation</h3>
<ol>
<li>
<p>Copy the WPM installer to the <code>/root</code> directory</p>
</li>
<li>
<p>Create the <code>wpm.env</code> answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">KMS_API_URL</span><span class="o">=</span>https://&lt;IP address or hostname of the KBS&gt;:9443/v1/
<span class="nv">WPM_SERVICE_USERNAME</span><span class="o">=</span>&lt;WPM_Service username from populate-users script&gt;
<span class="nv">WPM_SERVICE_PASSWORD</span><span class="o">=</span>&lt;WPM Service password from populate-users script&gt;
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;Sha384 <span class="nb">hash</span> of the CMS TLS certificate&gt;
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;IP address or hostname <span class="k">for</span> CMS&gt;:8445/cms/v1/
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;Hostname or IP address of the AAS&gt;:8444/aas
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;Installation token from populate-users script&gt;
</code></pre></div>
<p>For Docker Container Encryption only, add the following line to the
wpm.env installation answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">WPM_WITH_CONTAINER_SECURITY</span><span class="o">=</span>yes
</code></pre></div>
</li>
<li>
<p>Execute the WPM installer:</p>
<div class="highlight"><pre><span></span><code>./wpm-v3.3.1.bin
</code></pre></div>
</li>
</ol>
<h1 id="4-authentication">4  Authentication</h1>
<p>Beginning in the Intel® SecL-DC 1.6 release, authentication is centrally
managed by the Authentication and Authorization Service (AAS). This
service uses a Bearer Token authentication method, which replaces the
previous HTTP BASIC authentication. This service also centralizes the
creation of roles and users, allowing much easier management of users,
passwords, and permissions across all Intel® SecL-DC services.</p>
<p>To make an API request to an Intel® SecL-DC service, an authentication
token is now required. API requests must now include an Authorization
header with an appropriate token:</p>
<p><code>Authorization: Bearer $TOKEN</code></p>
<p>The token is issued by the AAS and will expire after a set amount of
time. This token may be used with any Intel® SecL-DC service, and will
carry the appropriate permissions for the role(s) assigned to the
account the token was generated for.</p>
<h2 id="41-create-token">4.1  Create Token</h2>
<p>To request a new token from the AAS:</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;AAS IP or hostname&gt;:8444/aas/token

{
    &quot;username&quot; : &quot;&lt;username&gt;&quot;,
    &quot;password&quot; : &quot;&lt;password&gt;&quot;
}
</code></pre></div>
<p>The response will be a token that can be used in the Authorization
header for other requests. The length of time for which the token will
be valid is configured on the AAS using the key
<code>AAS\_JWT\_TOKEN\_DURATION\_MINS</code> (in the installation answer file during
installation) or <code>aas.jwt.token.duration.mins</code> (configured on the AAS
after installation). In both cases the value is the length of time in
minutes that issued tokens will remain valid before expiring.</p>
<h2 id="42-user-management">4.2  User Management</h2>
<p>Users in Intel® SecL-DC are no longer restrained to a specific service,
as they are now centrally managed by the Authentication and
Authorization Service. Any user may now be assigned roles for any
service, allowing user accounts to be fully defined by the tasks needed.</p>
<h3 id="421-username-and-password-requirements">4.2.1  Username and Password requirements</h3>
<p>Passwords have the following constraints:</p>
<ul>
<li>
<p>cannot be empty - i.e must at least have one character</p>
</li>
<li>
<p>maximum length of 255 characters</p>
</li>
</ul>
<p>Usernames have the following requirements:</p>
<ul>
<li>
<p>Format: username[@host_name[domain]]</p>
</li>
<li>
<p>[@host_name[domain]] is optional</p>
</li>
<li>
<p>username shall be minimum of 2 and maximum of 255 characters</p>
</li>
<li>
<p>username allowed characters are alphanumeric, ., -, _ - but cannot
    start with -.</p>
</li>
<li>
<p>Domain name must meet requirements of a host name or fully qualified
    internet host name</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>admin, admin_wls, admin@wls, <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#119;&#108;&#115;&#46;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;">&#97;&#100;&#109;&#105;&#110;&#64;&#119;&#108;&#115;&#46;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;</a>,
    <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#108;&#115;&#45;&#97;&#100;&#109;&#105;&#110;&#64;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;">&#119;&#108;&#115;&#45;&#97;&#100;&#109;&#105;&#110;&#64;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;</a></li>
</ul>
</li>
</ul>
<h3 id="422-create-user">4.2.2  Create User</h3>
<div class="highlight"><pre><span></span><code>POST https://&lt;IP or hostname of AAS&gt;:8444/aas/users
Authorization: Bearer &lt;token&gt;

{
    &quot;username&quot; : &quot;&lt;username&gt;&quot;,
    &quot;password&quot; : &quot;&lt;password&gt;&quot;
}
</code></pre></div>
<h3 id="423-search-user">4.2.3  Search User</h3>
<div class="highlight"><pre><span></span><code>GET https://&lt;IP or hostname of AAS&gt;:8444/aas/users?&lt;parameter&gt;=&lt;value&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h3 id="424-change-user-password">4.2.4  Change User Password</h3>
<div class="highlight"><pre><span></span><code>PATCH https://&lt;IP or hostname of AAS&gt;:8444/aas/users/changepassword
Authorization: Bearer &lt;token&gt;
{
    &quot;username&quot;: &quot;&lt;username&gt;&quot;,
    &quot;old_password&quot;: &quot;&lt;old_password&gt;&quot;,
    &quot;new_password&quot;: &quot;&lt;new_password&gt;&quot;,
    &quot;password_confirm&quot;: &quot;&lt;new_password&gt;&quot;
}
</code></pre></div>
<h3 id="425-delete-user">4.2.5  Delete User</h3>
<div class="highlight"><pre><span></span><code>DELETE https://&lt;IP or hostname of AAS&gt;:8444/aas/users/&lt;User ID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h2 id="43-roles-and-permissions">4.3  Roles and Permissions</h2>
<p>Permissions in Intel® SecL-DC are managed by Roles. Roles are a set of
predefined permissions applicable to a specific service. Any number of
Roles may be applied to a User. While new Roles can be created, each
Intel® SecL service defines permissions that are applicable to specific
predetermined Roles. This means that only pre-defined Roles will
actually have any permissions. Role creation is intended to allow Intel®
SecL-DC services to define their permissions while allowing role and
user management to be centrally managed on the AAS. When a new service
is installed, it will use the Role creation functions to define roles
applicable for that service in the AAS.</p>
<h3 id="431-create-role">4.3.1  Create Role</h3>
<div class="highlight"><pre><span></span><code>POST https://&lt;AAS IP or Hostname&gt;:8444/aas/roles
Authorization: Bearer &lt;token&gt;

{
    &quot;service&quot;: &quot;&lt;Service name&gt;&quot;,
    &quot;name&quot;: &quot;&lt;Role Name&gt;&quot;,
    &quot;permissions&quot;: [&lt;array of permissions&gt;]
}
</code></pre></div>
<ul>
<li>
<p><code>service</code> field contains a minimum of 1 and maximum of 20 characters.
    Allowed characters are alphanumeric plus the special charecters -,
    _, @, ., ,</p>
</li>
<li>
<p><code>name</code> field contains a minimum of 1 and maximum of 40 characters.
    Allowed characters are alphanumeric plus the special characters -,
    _, @, ., ,</p>
</li>
<li>
<p><code>service</code> and <code>name</code> fields are mandatory</p>
</li>
<li>
<p><code>context</code> field is optional and can contain up to 512 characters.
    Allowed characters are alphanumeric plus -, _, @, ., ,,=,;,:,*</p>
</li>
<li>
<p><code>permissions</code> field is optional and allow up to a maximum of 512
    characters.</p>
</li>
</ul>
<p>The Permissions array must a comma-separated list of permissions
formatted as <code>resource:action:</code></p>
<p>Permissions required to execute specific API requests are listed with
the API resource and method definitions in the API documentation.</p>
<h3 id="432-search-roles">4.3.2  Search Roles</h3>
<div class="highlight"><pre><span></span><code>GET https://&lt;AAS IP or Hostname&gt;:8444/aas/roles?&lt;parameter&gt;=&lt;value&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>Search parameters supported:</p>
<div class="highlight"><pre><span></span><code>Service=&lt;name of service&gt;
Name=&lt;role name&gt;
Context=&lt;context&gt;
contextContains=&lt;partial &quot;context&quot; string&gt;
allContexts=&lt;true or false&gt;
filter=false
</code></pre></div>
<h3 id="433-delete-role">4.3.3  Delete Role</h3>
<div class="highlight"><pre><span></span><code>DELETE https://&lt;AAS IP or Hostname&gt;:8444/aas/roles/&lt;role ID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h3 id="434-assign-role-to-user">4.3.4  Assign Role to User</h3>
<div class="highlight"><pre><span></span><code>POST https://&lt;AAS IP or Hostname&gt;:8444/aas/users/&lt;user ID&gt;/roles
Authorization: Bearer &lt;token&gt;

{
    &quot;role_ids&quot;: [&quot;&lt;comma-separated list of role IDs&gt;&quot;]
}
</code></pre></div>
<h3 id="435-list-roles-assigned-to-user">4.3.5  List Roles Assigned to User</h3>
<div class="highlight"><pre><span></span><code>GET https://&lt;AAS IP or Hostname\&gt;:8444/aas/users/&lt;user ID&gt;/roles
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h3 id="436-remove-role-from-user">4.3.6  Remove Role from User</h3>
<div class="highlight"><pre><span></span><code>DELETE https://&lt;AAS IP or Hostname&gt;:8444/aas/users/&lt;userID&gt;/roles/&lt;role ID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h3 id="437-role-definitions">4.3.7  Role Definitions</h3>
<p>The following roles are created during installation (or by the
CreateUsers script) and exist by default.</p>
<table>
<thead>
<tr>
<th><strong>Role Name</strong></th>
<th align="left"><strong>Permissions</strong></th>
<th><strong>Utility</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>TA:Administrator</td>
<td align="left">TA:*:*</td>
<td>Used by the Verification Service to access Trust Agent APIs, including retrieval of TPM quotes, provisioning Asset Tags and SOFTWARE Flavors, etc.</td>
</tr>
<tr>
<td>HVS:ReportSearcher</td>
<td align="left">HVS: [reports:search:*"]</td>
<td>Used by the Integration Hub to retrieve attestation reports from the Verification Service</td>
</tr>
<tr>
<td>KMS:Keymanager</td>
<td align="left">KBS: ["keys:create:*", "keys:transfer:*"]</td>
<td>Used by the WPM to create and retrieve symmetric encryption keys to encrypt workload images</td>
</tr>
<tr>
<td>WLS:FlavorsImageRetrieval</td>
<td align="left">WLS: image_flavors:retrieve:*</td>
<td>Used by the Workload Agent during Workload Confidentiality flows to retrieve the image Flavor</td>
</tr>
<tr>
<td>HVS: ReportCreator</td>
<td align="left">HVS: ["reports:create:*"]</td>
<td>Used by the Workload Service to create new attestation reports on the Verification Service as part of Workload Confidentiality key retrievals.</td>
</tr>
<tr>
<td>Administrator</td>
<td align="left">*:*:*</td>
<td>Global administrator role used for the initial administrator account. This role has all permissions across all services, including permissions to create new roles and users.</td>
</tr>
<tr>
<td>AAS: Administrator</td>
<td align="left">*:*:*</td>
<td>Administrator role for the AAS only. Has all permissions for AAS resources, including the ability to create or delete users and roles.</td>
</tr>
<tr>
<td>AAS: RoleManager</td>
<td align="left">AAS: [roles:create:*, roles:retrieve:*, roles:search:*, roles:delete:*]</td>
<td>AAS role that allows all actions for Roles, but cannot create or delete Users or assign Roles to Users.</td>
</tr>
<tr>
<td>AAS: UserManager</td>
<td align="left">AAS: [users:create:*, users:retrieve:*, users:store:*, users:search:*, users:delete:*]</td>
<td>AAS role with all permissions for Users, but has no ability to create Roles or assign Roles to Users.</td>
</tr>
<tr>
<td>AAS: UserRoleManager</td>
<td align="left">AAS: [user_roles:create:*, user_roles:retrieve:*, user_roles:search:*, user_roles:delete:*,</td>
<td>AAS role with permissions to assign Roles to Users, but cannot create delete or modify Users or Roles.</td>
</tr>
<tr>
<td>HVS: AttestationRegister</td>
<td align="left">HVS: [host_tls_policies:create:*, hosts:create:*, hosts:store:*, hosts:search:*, host_unique_flavors:create:*, flavors:search:*, tpm_passwords:retrieve:*, tpm_passwords:create:*, host_aiks:certify:*</td>
<td>Role used for Trust Agent provisioning. Used to create the installation token provided during installation.</td>
</tr>
<tr>
<td>HVS: Certifier</td>
<td align="left">HVS: host_signing_key_certificates:create:*</td>
<td>Used for installation of the Workload Agent</td>
</tr>
</tbody>
</table>
<h1 id="5-connection-strings">5  Connection Strings</h1>
<p>Connection Strings define a remote API resource endpoint that will be
used to communicate with the registered host for retrieving TPM quotes
and other host information. Connection Strings differ based on the type
of host.</p>
<h2 id="51-trust-agent">5.1  Trust Agent</h2>
<p>The Trust Agent connection string connects directly to the Trust Agent
on a given host. The Verification Service will use a service account
with the needed Trust Agent permissions to connect to the Trust Agent.
In previous Intel® SecL versions, each Trust Agent had its own unique
user access controls. Starting in the 1.6 release, all authentication
has been centralized with the new Authentication and Authorization
Service, eliminating the need for credentials to be provided for
connection strings connecting to Trust Agent resources.</p>
<p><code>intel:https://&lt;HostNameOrIp&gt;:1443</code></p>
<h2 id="52-vmware-esxi">5.2  VMware ESXi</h2>
<h3 id="521-importing-vmware-tls-certificates">5.2.1 Importing VMware TLS Certificates</h3>
<p>Before connecting to vCenter to register hosts or clusters, the vCenter TLS certificate needs to be imported to the Verification Service.  This must be done for each vCenter server that the Verification Service will connect to, for importing Flavors or registering hosts.</p>
<ol>
<li>Download the root CA certs from vCenter:</li>
</ol>
<p>```shell
wget --no-proxy "*" https://<vCenter IP or hostname>/certs/download.zip --no-check-certificate
   <div class="highlight"><pre><span></span><code>This downloads all the root CA certificates for you into `download.zip` file. 

```shell
unzip download.zip
</code></pre></div></p>
<p>All of the certificates will be stored under <code>&lt;pwd&gt;/certs/</code>. Certs will be in <code>PEM</code> format.</p>
<ol>
<li>Upload the certificates to the HVS</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="err">POST https://%3CIP%3E:8443/hvs/v2/ca-certificates</span>

<span class="err">{</span>
<span class="err">    &quot;name&quot;: &quot;&lt;cert name&gt;&quot;,</span>
<span class="err">    &quot;type&quot;: &quot;root&quot;,</span>
<span class="err">    &quot;certificate&quot;: &quot;MIIELTCCAxW...&quot;</span>
<span class="err">}</span>
</code></pre></div>
<blockquote>
<p><strong>Note</strong> Please make sure that the certificate does not contain any other characters other than the base64 characters like that of <code>\n</code> or <code>-----BEGIN CERTIFICATE-----</code> etc.</p>
</blockquote>
<ol>
<li>After upload is successful, restart the HVS</li>
</ol>
<div class="highlight"><pre><span></span><code>hvs restart
</code></pre></div>
<h3 id="522-registering-a-vmware-esxi-host">5.2.2  Registering a VMware ESXi Host</h3>
<p>The VMware ESXi connection string is actually directed to vCenter, not
the actual ESXi host. Many ESXi hosts managed by the same vCenter server
will use the same connection string. The username and password specified
are vCenter credentials, and the vCenter "Validate Session" privilege is
required for access.</p>
<div class="highlight"><pre><span></span><code>vmware:https://&lt;vCenterHostNameOrIp&gt;:443/sdk<span class="p">;</span><span class="nv">h</span><span class="o">=</span>&lt;hostname of ESXi host&gt;<span class="p">;</span><span class="nv">u</span><span class="o">=</span>&lt;username&gt;<span class="p">;</span><span class="nv">p</span><span class="o">=</span>&lt;password&gt;
</code></pre></div>
<h1 id="6-platform-integrity-attestation">6  Platform Integrity Attestation</h1>
<p>Platform attestation is the cornerstone use case for ISecL. Platform
attestation involves taking measurements of system components during
system boot, and then cryptographically verifying that the actual
measurements taken matched a set of expected or approved values,
ensuring that the measured components were in an acceptable or "<strong>trusted</strong>"
state at the time of the last system boot.</p>
<p>ISecL leverages the Trusted Compute Group specification for a trusted
boot process, extending measurements of platform components to registers
in a Trusted Platform Module, and securely generating quotes of those
measurements from the TPM for remote comparison to expected values
(attestation).</p>
<p>This section includes basic REST API examples for these workflows. See
the Javadoc for more detailed documentation on REST APIs supported by
ISecL.</p>
<p>Typical workflows in the datacenter might include:</p>
<ul>
<li>
<p>Creating a set of acceptable flavors for attestation with automatic
    flavor matching that represent the known-good measurements for
    acceptable BIOS and OS versions in the datacenter</p>
</li>
<li>
<p>Registering hosts for attestation with automatic flavor matching</p>
</li>
<li>
<p>Upgrading hosts in the datacenter to a new BIOS or OS version</p>
</li>
<li>
<p>Removing hosts from the Verification Service</p>
</li>
<li>
<p>Removing flavors</p>
</li>
<li>
<p>Provisioning asset tags to hosts</p>
</li>
<li>
<p>Invalidating asset tags</p>
</li>
<li>
<p>Retrieving current attestation reports</p>
</li>
<li>
<p>Retrieving current host state information</p>
</li>
<li>
<p>Remediating an untrusted attestation</p>
</li>
</ul>
<h2 id="61-host-registration">6.1  Host Registration</h2>
<p>Registration creates a host record with connectivity details and other
host information in the Verification Service database. This host record
will be used by the Verification Service to retrieve TPM attestation
quotes from the Trust Agent to generate an attestation report.</p>
<h3 id="611-trust-agent">6.1.1  Trust Agent</h3>
<h4 id="6111-registration-via-trust-agent-command-line">6.1.1.1  Registration via Trust Agent Command Line</h4>
<p>The Trust Agent can register the host with a Verification Service by
running the following command:</p>
<div class="highlight"><pre><span></span><code>tagent create-host &lt;Verification Service base URL&gt; &lt;username&gt; &lt;password&gt;
</code></pre></div>
<blockquote>
<p><strong>Note</strong>: Because VMWare ESXi hosts do not use a Trust Agent, this method is
not applicable for registration of ESXi hosts.</p>
</blockquote>
<h3 id="612-registration-via-verification-service-api">6.1.2  Registration via Verification Service API</h3>
<p>Any Trust Agent or VMware ESXi host/cluster can be registered using a
Verification Service API request. Registration can be performed with or
without a set of existing Flavors. Rules for Flavor matching can be set
by using the Flavor Group in the request; if no Flavor Group is
specified, the <code>mtwilson_automatic</code> Flavor Group will be used. See the
Flavor Management section for additional details on Flavors, Flavor
Groups, and Flavor matching.</p>
<h4 id="6121-special-note-for-vmware-esxi-hosts-and-the-vcenter-tls-certificate">6.1.2.1  Special Note for VMware ESXi Hosts and the vCenter TLS Certificate</h4>
<h4 id="6122-sample-call">6.1.2.2  Sample Call</h4>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/hosts
Authorization: Bearer &lt;token&gt;

{
    &quot;host_name&quot;: &quot;&lt;hostname of host to be registered&gt;&quot;,
    &quot;connection_string&quot;: &quot;&lt;connection string&gt;&quot;,
    &quot;flavorgroup_name&quot; : &quot;&quot;,
    &quot;description&quot; : &quot;&lt;description&gt;&quot;
}
</code></pre></div>
<p>Requires the permission <code>hosts:create</code></p>
<h4 id="6123-sample-call-for-esxi-cluster-registration">6.1.2.3  Sample Call for ESXi Cluster Registration</h4>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/hosts
Authorization: Bearer &lt;token&gt;

{
    &quot; esxi_clusters&quot;: [
       {
          &quot;connection_string&quot;: &quot;&lt;password&gt;&quot;,
          &quot;cluster_name&quot;: &quot;&lt;cluster name&gt;&quot;
       }
    ]
 }
</code></pre></div>
<p>Requires the permission <code>esxi_clusters:create</code></p>
<h2 id="62-flavor-creation-for-automatic-flavor-matching">6.2  Flavor Creation for Automatic Flavor Matching</h2>
<p>Flavor creation is the process of adding one or more sets of acceptable
measurements to the Verification Service database. These measurements
correspond to specific system components, and are used as the basis of
comparison to generate trust attestations.</p>
<p>Flavors can be created manually, or can be imported from an example
host.</p>
<p>Flavors are automatically matched to hosts based on the Flavorgroup used
by the host and the Flavors, and the Flavor Match Policies of the
Flavorgroup. The ISecL Verification Service creates a default
Flavorgroups during installation called "<strong>automatic</strong>" This Flavorgroup is
configured to be used as a pool of all acceptable Flavors in a given
environment, and will automatically match the appropriate Flavor parts
to the correct host. This Flavorgroup is used by default and is expected
to be useful for the majority of deployments. If no Flavorgroup is
specified when creating a Flavor, it will be placed in the "<strong>automatic</strong>"
Flavorgroup.</p>
<p>Flavors are also divided into Flavor parts, which correspond to the
<code>PLATFORM</code>, <code>OS</code>, <code>HOST_UNIQUE</code>, <code>SOFTWARE</code>, and <code>ASSET_TAG</code> measurements. These
can be created and maintained separately (so that users can manage
acceptable OS and BIOS versions, rather than entire host
configurations). By default, if not specified, the Verification Service
will import Flavors as separate Flavor parts, as appropriate for the
host type.</p>
<p>By using individual Flavor parts, individual versions of OS or PLATFORM
measurements can be managed and automatically mapped. Whenever a host
changes states (Untrusted, Connected, etc.) the Verification Service
will attempt to match appropriate Flavors to that host. If a Flavor is
removed or added, all appropriate hosts will be updated to use the new
Flavor, or to no longer use the deleted Flavor. Hosts that are currently
using a BIOS where that BIOS versions’ PLATFORM Flavor was deleted will
now appear Untrusted, for example. This can be used to easily flag as
Untrusted hosts that are using software that has been End-Of-Lifed, or
perhaps an OS kernel with a known security vulnerability.</p>
<blockquote>
<p><strong>Note</strong>: See the Flavor Management section for additional details on how
flavors can be managed, and how the Flavor matching engine works.
The sample workflow provided here is intended to be an introduction
only.</p>
</blockquote>
<h3 id="621-importing-a-flavor-from-a-sample-host">6.2.1  Importing a Flavor from a Sample Host</h3>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{ 
    &quot;connection_string&quot;: &quot;&lt;connection string&gt;&quot;,
    &quot;partial_flavor_types&quot;: [&quot;PLATFORM&quot;, &quot;OS&quot;, &quot;HOST_UNIQUE&quot;],
    &quot;flavorgroup_names&quot;: []
}
</code></pre></div>
<p>Requires the permission <code>flavors:create</code></p>
<blockquote>
<p><strong>Note</strong>:The HOST_UNIQUE Flavor parts, used by Red Hat Enterprise Linux and
VMWare ESXi host types, MUST be created for each registered host of
that type, and should in general be imported from that host. This
means that importing the HOST_UNIQUE flavor should always be done
for each host registered.</p>
</blockquote>
<p>To import ONLY the HOST_UNIQUE Flavor part from a host:</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{ 
    &quot;connection_string&quot;: &quot;&lt;connection string&gt;&quot;,
    &quot;partial_flavor_types&quot;: [&quot;HOST_UNIQUE&quot;],
    flavorgroup_names&quot;: []
}
</code></pre></div>
<p>Requires the permission <code>flavors:create</code></p>
<h3 id="622-creating-a-flavor-manually">6.2.2  Creating a Flavor Manually</h3>
<p>Flavors can be directly created (rather than importing from a sample
host) if the required information is known. If no Flavorgroup is
specified, the Flavor will be placed in the <code>automatic</code> group. Note that
the <code>label</code> is a required field and must be unique.</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{
    &quot;connection_string&quot;: &quot;&quot;,
    &quot;flavor_collection&quot;: {
        &quot;flavors&quot;: [
            {
                &quot;meta&quot;: {
                    &quot;vendor&quot;: &quot;INTEL&quot;,
                    &quot;description&quot;: {
                        &quot;flavor_part&quot;: &quot;PLATFORM&quot;,
                        &quot;label&quot;: &quot;Intel Corporation_SE5C610.86B.01.01.1008.031920151331_TPM2.0&quot;,
                        &quot;bios_name&quot;: &quot;Intel Corporation&quot;,
                        &quot;bios_version&quot;: &quot;SE5C620.86B.00.01.0004.071220170215&quot;,
                        &quot;tpm_version&quot;: &quot;2.0&quot;
                    }
                },
                &quot;hardware&quot;: {
                    &quot;processor_info&quot;: &quot;…&quot;,
                    &quot;processor_flags&quot;: &quot;…&quot;,
                    &quot;feature&quot;: {
                        &quot;tpm&quot;: {
                            &quot;enabled&quot;: true,
                            &quot;pcr_banks&quot;: [
                                &quot;SHA1&quot;,
                                &quot;SHA256&quot;
                            ]
                        },
                        &quot;txt&quot;: {
                            &quot;enabled&quot;: true
                        }
                    }
                },
                &quot;pcrs&quot;: {
                    &quot;SHA1&quot;: {
                        &quot;pcr_0&quot;: {
                            &quot;value&quot;: &quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;
                        },
                        &quot;pcr_17&quot;: {
                            &quot;value&quot;: &quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;,
                            &quot;event&quot;: ...
                        }
</code></pre></div>
<p>Requires the permission <code>flavors:create</code></p>
<h2 id="63-creating-the-default-software-flavor-linux-only">6.3  Creating the Default SOFTWARE Flavor (Linux Only)</h2>
<p>As part of the new Application Integrity feature added in Intel® SecL-DC
version 1.5, a new default SOFTWARE Flavor part is provided so that the
Linux Trust Agent itself can be measured and included in the attestation
process. The default SOFTWARE Flavor includes a manifest for the static
files and folders in the Trust Agent. The manifest is automatically
deployed to each Linux Trust Agent during the provisioning step.</p>
<blockquote>
<p><strong>Note</strong>: The Linux Trust Agent <strong>must</strong> be rebooted after the
Provisioning step is completed (typically Provisioning happens during
installation, based on whether all of the required variables are set
in the trustagent.env file). Rebooting allows the default SOFTWARE
Flavor manifest to be measured and extended to the TPM PCRs. If the
reboot is not performed, the system will require a SOFTWARE Flavor,
but the measurements will not exist, and the system will appear
Untrusted. If an un-rebooted host is used to create the SOFTWARE
Flavor, the Flavor will be created based on measurements that do not
exist, and will fail.</p>
</blockquote>
<p>The <code>SOFTWARE</code> Flavor part should be created separately from the other
Flavor parts. Only one default <code>SOFTWARE</code> Flavor needs to be created for
each version of the Linux Trust Agent. If the <code>SOFTWARE</code> Flavor for the
same Trust Agent version is imported multiple times, subsequent imports
will fail as the Flavor already exists.</p>
<p>To import the <code>SOFTWARE</code> Flavor part from a host:</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{ 
    &quot;connection_string&quot;: &quot;&lt;connection string&gt;&quot;,
    &quot;partial_flavor_types&quot;: [&quot;SOFTWARE&quot;],
    flavorgroup_names&quot;: []
}
</code></pre></div>
<p>Requires the permission <code>flavors:create</code></p>
<h2 id="64-creating-and-provisioning-asset-tags">6.4  Creating and Provisioning Asset Tags</h2>
<p>Asset Tags represent a set of key/value pairs that can be associated
with a host in hardware. This enables usages around restricting
workflows to specific hosts based on tags, which could include location
information, compliance tags, etc.</p>
<p>ISecL creates Asset Tags by creating a certificate containing the list
of key/value pairs to be tagged to the host, with the host’s hardware
UUID as the certificate subject. A hash of this certificate is then
written to an NVRAM index in the host’s TPM. This value is included in
TPM quotes, and can be attested using an Asset Tag flavor that matches
up the expected value and the actual key/value pairs.</p>
<h3 id="641-creating-asset-tag-certificates">6.4.1  Creating Asset Tag Certificates</h3>
<p>Asset Tag certificates can be created with a single REST API call, with
any number of key/value pairs. Note that one certificate must be created
for each host to be tagged, even if they will all be tagged with
identical key/value pairs.</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/tag-certificates
Authorization: Bearer &lt;token&gt;

{
    &quot;hardware_uuid&quot;: &quot;&lt;hardware UUID of host to be tagged&gt;&quot;,
    &quot;selection_content&quot;: [
        {
            &quot;name&quot;: &quot;&lt;key&gt;&quot;,
            &quot;value&quot;: &quot;&lt;value&gt;&quot;
        },
        {
            &quot;name&quot;: &quot;&lt;key&gt;&quot;,
            &quot;value&quot;: &quot;&lt;value&gt;&quot;
        },
        {
            &quot;name&quot;: &quot;&lt;key&gt;&quot;,
            &quot;value&quot;: &quot;&lt;value&gt;&quot;
        }
    ]
}
</code></pre></div>
<h3 id="642-deploying-asset-tags">6.4.2  Deploying Asset Tags</h3>
<h4 id="6421-red-hat-enterprise-linux">6.4.2.1  Red Hat Enterprise Linux</h4>
<p>Asset Tags can be provisioned to a Windows or RHEL host via a REST API
request on the Verification Service that will in turn make a request to
the Trust Agent on the host to be tagged.</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/rpc/deploy-tag-certificate
Authorization: Bearer &lt;token&gt;

{
    &quot;certificate_id&quot;: &quot;&lt;certificate ID&gt;&quot;
}
</code></pre></div>
<h4 id="6422-vmware">6.4.2.2  VMWare</h4>
<p>Since VMWare ESXi hosts do not use a Trust Agent, the process for
writing Asset Tags to a VMWare host is different from RHEL. A
new interface has been added to ESXi via a new <code>esxcli</code> command starting
in vSphere 6.5 Update 2 that allows the Asset Tag information to be
written to the TPM via a command-line command. The older process is also
described below.</p>
<p>The high-level workflow for using Asset Tags with VMWare ESXi is:</p>
<ol>
<li>Create the Asset Tag Certificate for the host.</li>
<li>Calculate the Certificate Hash value.</li>
<li>Provision the Certificate Hash value to the host TPM and reboot</li>
<li>Create the Asset Tag Flavor.</li>
</ol>
<blockquote>
<p><strong>Note</strong>: Asset Tag is currently not supported for VMWare hosts
using TPM 2.0.</p>
</blockquote>
<h5 id="64221-calculate-the-certificate-hash-value">6.4.2.2.1  Calculate the Certificate Hash Value</h5>
<p>Only the hash value of the Asset Tag Certificate can be provisioned to
the TPM, due to the low size of the NVRAM.</p>
<ol>
<li>
<p>Retrieve the Asset Tag Certificate. The Asset Tag Certificate can be
    retrieved either from the response when the Asset Tag certificate is
    created, or by using a GET API request to retrieve the certificate:</p>
<div class="highlight"><pre><span></span><code>GET https://verification.service.com:8443/hvs/v2/tag-certificates?subjectEqualTo=&lt;HardwareUUID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
</li>
<li>
<p>Copy only the <code>certificate</code> value (this will be the certificate in
    encoded format) and write the data to a file on a Linux system.
    Remove any line breaks and save the file. Assuming the filename used
    is <code>tag-cert</code> use the following to generate the correct hash:</p>
<div class="highlight"><pre><span></span><code>cat tag-cert <span class="p">|</span> base64 --decode <span class="p">|</span> openssl dgst -sha1 <span class="p">|</span> awk -F<span class="s2">&quot; &quot;</span> <span class="s1">&#39;{print $2}&#39;</span>
</code></pre></div>
<p>This hash value will be what is actually written to the TPM NVRAM.</p>
</li>
</ol>
<h5 id="64222-provision-the-certificate-hash-to-the-host-tpm">6.4.2.2.2  Provision the Certificate Hash to the Host TPM</h5>
<p>Due to a new feature added in vSphere 6.5 Update 2, the process for
provisioning Asset Tags on VMWare ESXi hosts has been significantly
improved. Both the old and new process for provisioning Asset Tags is
documented below. Intel recommends using vSphere 6.5 Update 2 or later
due to the significant difference in the process.</p>
<h6 id="vsphere-65-update-2-or-later"><strong>vSphere 6.5 Update 2 or Later</strong></h6>
<p>Starting in ESXi 6.5u2, you can now use SSH to write Asset Tags directly
with no need for TPM clears, reboots, PXE, or BIOS access. SSH to the
ESXi host using root credentials. Then use the command:</p>
<ol>
<li>
<p>```shell
    esxcli hardware tpm tag set -d <hash>
    <div class="highlight"><pre><span></span><code>You can use the following command to verify that the tag was written:

```shell
esxcli hardware tpm tag get
</code></pre></div></p>
</li>
<li>
<p>Reboot the host. After rebooting, the TPM PCR 22 will have the
    measured value of the hash.</p>
</li>
</ol>
<h6 id="vsphere-65-update-1-or-older"><strong>vSphere 6.5 Update 1 or Older</strong></h6>
<p>There is no direct interface from VMWare vCenter or ESXi previous to
vSphere 6.5 Update 2 that will write the Tag information to the host
TPM.</p>
<p>Writing Asset Tag information to a TPM requires TPM ownership; VMWare
ESXi takes TPM ownership with a secret password at boot time. This means
that the process for writing Asset Tags to a VMWare host requires:</p>
<ol>
<li>
<p>Clear TPM ownership.</p>
<ul>
<li>This can be done via the system BIOS, or using One Touch Activation
  through the IPMI interface (if enabled by the server OEM).</li>
</ul>
</li>
<li>
<p>Reactivate TPM/TXT.</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Booting to an OS that has the ability to issue TPM commands</p>
</li>
<li>
<p>Typically the provisioning OS used is Ubuntu or RHEL, booted
     temporarily using PXE.</p>
</li>
<li>
<p>Writing the Tag information</p>
</li>
<li>
<p>The TPM index 0x40000010 must be defined, and the hash of the Asset
     Tag certificate must be written to that index.</p>
</li>
<li>
<p>Clear TPM ownership.</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Reactivate TPM/TXT</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Boot back to VMWare ESXi.</p>
</li>
</ol>
<p>When the system is rebooted to ESXi, the Trusted Boot process will
extend the value to PCR22, and this value can be used during
attestation.</p>
<h5 id="64223-creating-the-asset-tag-flavor-vmware-esxi-only">6.4.2.2.3  Creating the Asset Tag Flavor (VMWare ESXi Only)</h5>
<p>While for RHEL and Windows hosts the Asset Tag Flavor is automatically
created during the Tag Provisioning step, for VMWare ESXi hosts the
Flavor must be created by importing it from the host after the Tag has
been provisioned.</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{   
    &quot;connection_string&quot;: &quot;&lt;VMWare vCenter connection string&gt;&quot;,
    &quot;partial_flavor_types&quot;: [&quot;ASSET_TAG&quot;]
}
</code></pre></div>
<p>Once the Asset Tag Flavor is imported, the host can be attested
including Asset Tags as normal.</p>
<h2 id="65-retrieving-current-attestation-reports">6.5  Retrieving Current Attestation Reports</h2>
<div class="highlight"><pre><span></span><code>GET https://verification.service.com:8443/hvs/v2/reports?latestPerHost=true
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h2 id="66-retrieving-current-host-state-information">6.6  Retrieving Current Host State Information</h2>
<div class="highlight"><pre><span></span><code>GET https://verification.service.com:8443/hvs/v2/host-status?latestPerHost=true
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h2 id="67-upgrading-hosts-in-the-datacenter-to-a-new-bios-or-os-version">6.7  Upgrading Hosts in the Datacenter to a New BIOS or OS Version</h2>
<p>Software and firmware updates are a common occurrence in the datacenter.
Automatic Flavor matching makes this process relatively simple:</p>
<ol>
<li>
<p>Create a new Flavor for the new version. This may be manually
    created or imported directly from a sample host that has already
    received the upgrade. Be sure to create new Flavors for each TPM
    version represented in your datacenter.</p>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/flavors
Authorization: Bearer &lt;token&gt;

{ 
    &quot;connection_string&quot;: &quot;&lt;connection string&gt;&quot;,
    &quot;partial_flavor_types&quot;: [&quot;PLATFORM&quot;, &quot;OS&quot;, &quot;HOST_UNIQUE&quot;],
    flavorgroup_names&quot;: []
}
</code></pre></div>
</li>
<li>
<p>Update the hosts to the new software or firmware version as normal.
    On the next attestation attempt, the Verification Service will
    automatically match the updated hosts to the new Flavor.</p>
</li>
<li>
<p>(Optional) If desired, delete the Flavor for the older version after
    the update is completed. This will cause any hosts that are still
    using the old version to attest as Untrusted. Which can easily flag
    hosts that missed the upgrade for remediation.</p>
<div class="highlight"><pre><span></span><code>DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;flavorId&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
</li>
</ol>
<h2 id="68-removing-hosts-from-the-verification-service">6.8  Removing Hosts From the Verification Service</h2>
<p>Hosts can be deleted at any time. Reports for that host will remain in
the Verification Service database for audit purposes.</p>
<div class="highlight"><pre><span></span><code>DELETE https://verification.service.com:8443/hvs/v2/hosts/&lt;hostId&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>The <code>hostId</code> can be retrieved either at the time the host is created, or
by searching hosts using the host’s hostname.</p>
<h2 id="69-removing-flavors">6.9  Removing Flavors</h2>
<p>Flavors can be deleted; this will cause any hosts that match the deleted
Flavor to evaluate as Untrusted. This can be done if, for example, an
old BIOS version needs to be retired and should no longer exist in the
datacenter. By deleting the PLATFORM Flavor, hosts with the old BIOS
version will attest as Untrusted, flagging them for easy remediation.</p>
<div class="highlight"><pre><span></span><code>DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;flavorId&gt;
</code></pre></div>
<h2 id="610-invalidating-asset-tags">6.10 Invalidating Asset Tags</h2>
<p>Asset Tags can be deleted in two ways.</p>
<p>Deleting the <code>ASSET_TAG</code> Flavor part will retain the Asset Tag
certificate in the database, but will cause the host using this Tag to
no longer use the Asset Tag for attestation (the Tag result will be
disregarded and no tags will be exposed in the attestation Reports).</p>
<div class="highlight"><pre><span></span><code>DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;assetTagflavorId&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>Deleting the actual Asset Tag certificate will remove the certificate
from the database, but will not actually affect attestation results (the
authority for attestation results is the Flavor).</p>
<div class="highlight"><pre><span></span><code>DELETE https://verification.service.com:8443/hvs/v2/tag-certificates/&lt;assetTagCertificateId&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<h2 id="611-remediating-an-untrusted-attestation">6.11  Remediating an Untrusted attestation</h2>
<p>Hosts can become Untrusted for a wide variety of causes. The first clue
to finding the root cause for an Untrusted attestation is the
attestation Report itself – the Report will show Trust results for the
<code>PLATFORM</code>, <code>OS</code>, <code>HOST_UNIQUE</code>, and <code>ASSET_TAG</code> Flavor parts individually,
along with the <code>OVERALL</code> trust. If the Report shows that the PLATFORM
Flavor part trust is “false” for example, it means that the PLATFORM
measurements did not match any Flavors in the host’s Flavorgroup.</p>
<p>Untrusted attestation Reports will contain <strong>faults</strong> that describe the
specific attestation rules that were not satisfied. This often shows
enough information to describe the cause of the Untrusted status. A
fault like <strong>RequiredButNotDefined</strong> means that a Flavor part is required
by the Flavorgroup policy, but no Flavors for that Flavor part exist in
the Flavorgroup (for example, generally Flavorgroups should always
require a PLATFORM Flavor part; if no PLATFORM Flavors are in the
Flavorgroup, hosts in the Flavorgroup will attest with this fault).</p>
<p>Other faults include:</p>
<p><strong>"PcrMatchesConstant"</strong> - describes a rule that evaluates whether a TPM
PCR has a specific value</p>
<p><strong>"PcrEventLogIntegrity"</strong> - the module event log is replayed during
attestation to verify that the resulting measurement matches the actual
value in the module PCR. If the replay does not match, it indicates the
event log cannot itself be trusted.</p>
<p><strong>"AikCertificateTrusted"</strong> – This rule evaluates whether the TPM quote
was signed by the TPM associated with this host. As part of host
registration, the public half of the Attestation Identity Keypair is
captured, and this public key is used to verify the signature on TPM
quotes from that host.</p>
<p>See the Appendix for a full list of the rules evaluated during
Attestation.</p>
<p>The Flavor matching engine will use the most-similar Flavor for the
attestation Report in the case of an Untrusted result.</p>
<p>The fault will explain in a general sense what rule the host attestation
violated. To remediate, the rule will need to be satisfied. This could
mean creating a new Flavor to match the actual observed values, or it
could mean that the host has been tampered with and should have its BIOS
flashed or OS reloaded.</p>
<h2 id="612-attestation-reporting">6.12  Attestation Reporting</h2>
<p>Attestation results are delivered in the form of Host Reports. A Report
can delivered in several different formats, which can change the type of
data returned.</p>
<p>The preferred format for Host Reports is a SAML attestation. A
SAML-formatted report includes a chain or signatures that provides
auditability for the Report. The SAML attestation will include the base
trust status of the host, as well as the overall trust for each
individual Flavor used in the attestation. The Report will also contain
host information, such as TPM version, Operating System name and
version, BIOS version, etc. The SAML Report will not, however, contain
individual measurements and comparisons of values. This format of the
Report is ideal for securely communicating the trust status of a host
and for audit history.</p>
<p>Attestation Reports can also be retrieved in <code>json</code> or <code>xml</code> format. These
formats will not include the signature chain provided in the SAML
format, but will contain the actual measurement values and expected
Flavor values used for comparison. These reports are typically used for
remediation, because they will show specifically why a given Host
attested as Untrusted.</p>
<p>The format for a Report is determined by the <code>Accept</code> header in the
request.</p>
<p>Attestations are automatically generated in the Verification Service by
a repeating scheduled background process. This process looks for
Attestation Reports that are close to expiration, and triggers a new
Attestation Report. By default, Attestation Reports are valid for 90
minutes, and the background refresh process will trigger a new
attestation when a Report is found to be within 3 minutes of expiration.</p>
<p>A user can either retrieve the most recent currently valid Attestation
Report for a given host, or may trigger a new Attestation Report to be
generated. Typically, it is best to retrieve an existing Report for
performance reasons. Generating a new Attestation Report requires the
generation of a new TPM quote from the TPM of the host being attested;
TPM performance differs greatly between vendors, and a quote can take
anywhere between 2-7 seconds to generate.</p>
<h3 id="6121-sample-call-generating-a-new-attestation-report">6.12.1  Sample Call – Generating a New Attestation Report</h3>
<div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/reports
Authorization: Bearer &lt;token&gt;

{
    &quot;host_name&quot;:&quot;host-1&quot;
}
</code></pre></div>
<p>Requires the permission <code>reports:create</code></p>
<h3 id="6122-sample-call-retrieving-an-existing-attestation-report">6.12.2  Sample Call – Retrieving an Existing Attestation Report</h3>
<div class="highlight"><pre><span></span><code>GET https://verification.service.com:8443/hvs/v2/reports?hostName=HostName.server.com
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>Below are the supported criteria options in order of precedence. If no
host filter criteria is specified, then results are returned for all
active hosts.</p>
<ul>
<li>
<p><code>id</code> - unique UUID of the report entry in the database</p>
</li>
<li>
<p><code>hostId</code> - unique UUID of the host entry in the database</p>
</li>
<li>
<p><code>hostName</code> - name of the host</p>
</li>
<li>
<p><code>hostHardwareId</code> - hardware UUID of the host</p>
</li>
<li>
<p><code>hostStatus</code> - current state of the host, which supports the following
    options:</p>
<ul>
<li>CONNECTED - host is in connected state</li>
<li>QUEUE - host is in queue to be processed</li>
<li>CONNECTION_FAILURE - connection failure</li>
<li>UNAUTHORIZED - unauthorized</li>
<li>AIK_NOT_PROVISIONED - AIK certificate is not provisioned</li>
<li>EC_NOT_PRESENT - endorsement certificate is not present</li>
<li>MEASURED_LAUNCH_FAILURE - TXT measured launch failure</li>
<li>TPM_OWNERSHIP_FAILURE - TPM ownership failureTPM_NOT_PRESENT - TPM is not present</li>
<li>UNSUPPORTED_TPM - unsupported TPM version</li>
<li>UNKNOWN - unknown host state</li>
</ul>
</li>
</ul>
<p>Requires the permissions <code>reports:search</code></p>
<p>Other search criteria may also be used. By default, the most recent
currently valid attestation is returned. However, different query
parameters can be used to retrieve all attestations for a specific host
over the last 30 days, for example.</p>
<h2 id="613-integration">6.13  Integration</h2>
<p>Intel® SecL can be integrated with scheduler services (or potentially
other services) to provide additional security controls. For example, by
integrating Intel® SecL with the OpenStack scheduler service, the
OpenStack placement service can incorporate the Intel® SecL security
attributes into VM scheduling.</p>
<h3 id="6131-the-integration-hub">6.13.1  The Integration Hub</h3>
<p>The Integration Hub acts as the integration point between the Verification Service and a third party service. The primary purpose of the Hub is to collect and maintain up-to-date attestation information, and to “push” that information to the external service. The secondary purpose is to allow for multitenancy, the Verification Service does not allow for permissions to be applied for specific hosts, so a user with the “attestation” role can access all attestations for all hosts. By using separate Integration Hub instances for each Cloud environment (or "tenant"), the Hub will push attestations only for the associated hosts to a given tenant’s integration endpoints.</p>
<p>For example, Tenant A is using hosts 1-10 for an OpenStack environment. Tenant B is using hosts 11-15 for a Docker environment. Two Hub instances must be configured, one managing tenant A's OpenStack cluster and a second instance managing Tenant B's Docker environment.  Each integration Hub will automatically retrieve the list of hosts used by its configured orchestration endpoint, retrieve the attestation reports only for those hosts, and push the attestation attribute information to each configured endpoint. Neither tenant will have access to the Verification Service, and will not be able to see attestation or other host details regarding infrastructure used by other tenants.</p>
<p>Different integration endpoints can be added to the Integration Hub through a plugin architecture. By default, the Attestation Hub includes plugins for OpenStack and Kubernetes (Kubernetes deployments require the additional installation of two Intel® SecL-DC Custom Resource Definitions on the Kube Control Plane).</p>
<p><img src="Images\integration2" alt="image-20200621122316170" style="zoom:150%;" /></p>
<h3 id="6132-integration-with-openstack">6.13.2  Integration with OpenStack</h3>
<p>Starting in the Rocky release, OpenStack can now use “Traits” to provide qualitative data about Nova Compute hosts, and to establish Trait requirements for VM instances. The updated scheduler will place VMs
requiring a given Trait on Nova Compute nodes that meet the Trait requirements.</p>
<p>Intel SecL-DC uses the Integration Hub to continually push platform integrity and Asset Tag information to the OpenStack Traits resources.  This means the OpenStack scheduler natively supports workload scheduling incorporating Intel SecL-DC security attributes, including attestation report Trust status and Asset Tags. The OpenStack Placement Service will automatically attempt to place images with Trait requirements on compute nodes that have those Traits.</p>
<blockquote>
<p><strong>NOTE</strong>: This control only applies to instances launched using the
OpenStack scheduler, and the Traits functions will not affect
manually-launched instances where a specific Compute Node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing OpenStack interfaces and does not modify OpenStack code.  The
datacenter owner or OpenStack administrator is responsible for the
security of the OpenStack workload scheduling process in general, and
Intel recommends following published OpenStack security best
practices.</p>
</blockquote>
<h4 id="61321-prerequisites">6.13.2.1  Prerequisites</h4>
<ul>
<li>
<p>Verification Service must be installed and running.</p>
</li>
<li>
<p>OpenStack* Rocky (or later) Nova, Glance, Horizon, and Keystone services must
    be installed and running</p>
</li>
<li>
<p>The Integration Hub must be installed and running.</p>
</li>
</ul>
<h4 id="61322-setting-image-traits">6.13.2.2  Setting Image Traits</h4>
<p>Image Traits define the policy for which Traits are required for that
Image to be launched on a Nova Compute node. By setting these Traits to
“required,” the OpenStack scheduler will require these same Traits to be
present on a Nova Compute node in order to launch instances of the
image.</p>
<p>To set the Image Traits for Intel SecL-DC, a specific naming convention
is used. This naming convention will match the Traits that the
Integration Hub will automatically push to OpenStack. Two types of
Traits are currently supported – one Trait is used to require that the
Compute Node be Trusted in the Attestation Report, and the other Trait
is used to require specific Asset Tag key/value pairs.</p>
<p>To require a <code>Trusted</code> Attestation Report:</p>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_TRUSTED=required
</code></pre></div>
<p>The naming convention for Asset Tags is more flexible, and any number of
these Traits can be used simultaneously.</p>
<blockquote>
<p><strong>Note</strong>: All of the Traits must be present on the Compute Node for the
scheduler to allow instances to land, so be sure not to set mutually
exclusive Asset Tag values.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_AT_TAG_&lt;key&gt;__&lt;value&gt;=required`
</code></pre></div>
<p>For example, to define a Trait that will require an Asset Tag where
<code>State = CA</code> use the following:</p>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_AT_TAG__STATE_CA= required
</code></pre></div>
<p>These Traits can be set using CLI commands for OpenStack Glance:</p>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">set</span> --property trait:CUSTOM_ISECL_AT_STATE__CA<span class="o">=</span>required &lt;image_name&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">set</span> --property trait:CUSTOM_ISECL_TRUSTED<span class="o">=</span>required &lt;image_name&gt;
</code></pre></div>
<p>To remove a Trait so that it is no longer required for an Image:</p>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">unset</span> --property trait:CUSTOM_ISECL_AT_STATE__CA &lt;image_name&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">unset</span> --property trait:CUSTOM_ISECL_TRUSTED &lt;image_name&gt;
</code></pre></div>
<h4 id="61323-configuring-the-integration-hub-for-use-with-openstack">6.13.2.3  Configuring the Integration Hub for Use with OpenStack</h4>
<p>The Integration Hub must be configured with the API URLs and credentials for the OpenStack instance it will integrate with.  This can be done during installation using the "OPENSTACK_..." variables shown in the <code>ihub.env</code> answer file  sample (see the Installing the Integration Hub section).</p>
<p>However, this configuration can also be performed after installation using CLI commands:</p>
<div class="highlight"><pre><span></span><code>ihub setup openstack --endpoint-url=&quot;http://openstack:5000/v3&quot; --endpoint-user=&quot;username&quot; --endpoint-pass=&quot;password&quot;
</code></pre></div>
<p>Restart the Integration Hub after configuring the endpoint. Note that "endpoint name" should be replaced with any user-friendly name for the OpenStack instance you would prefer.</p>
<h4 id="61327-scheduling-instances">6.13.2.7  Scheduling Instances</h4>
<p>Once Trait requirements are set for Images and the Integration Hub is
configured to push attributes to OpenStack, instances can be launched in
OpenStack as normal. As long as the OpenStack Nova scheduler is used to
schedule the workloads, only compliant Compute Nodes will be scheduled
to run instances of controlled Images.</p>
<blockquote>
<p><strong>NOTE</strong>: This control only applies to instances launched using the
OpenStack scheduler, and the Traits functions will not affect
manually-launched instances where a specific Compute Node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing OpenStack interfaces and does not modify OpenStack code.  The
datacenter owner or OpenStack administrator is responsible for the
security of the OpenStack workload scheduling process in general, and
Intel recommends following published OpenStack security best
practices.</p>
</blockquote>
<h3 id="6133-integration-with-kubernetes">6.13.3  Integration with Kubernetes</h3>
<p>Through the use of Custom Resource Definitions for the Kubernetes
Control Plane, Intel® Security Libraries can make Kubernetes aware of Intel®
SecL security attributes and make them available for pod orchestration.
In this way, a security-sensitive pod can be launched only on <code>Trusted</code>
physical worker nodes, or on physical worker nodes that match specified
Asset Tag values.</p>
<blockquote>
<p><strong>NOTE</strong>: This control only applies to pods launched using the
Kubernetes scheduler, and these scheduling controls will not affect
manually-launched instances where a specific worker node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing Kubernetes interfaces and does not modify Kubernetes code,
using only the standard Custom Resource Definition mechanism to add
this functionality to the Kubernetes Control Plane.  The datacenter owner or
Kubernetes administrator is responsible for the security of the
Kubernetes workload scheduling process in general, and Intel
recommends following published Kubernetes security best practices.</p>
</blockquote>
<h4 id="61331-prerequisites">6.13.3.1  Prerequisites</h4>
<ul>
<li>
<p>Verification Service must be installed and running.</p>
</li>
<li>
<p>Kubernetes Control Plane Node must be installed and running</p>
</li>
<li>
<p>The supported Kubernetes versions are from <code>1.14.8</code>-<code>1.17.3</code> and the
    integration is validated with <code>1.14.8</code> and <code>1.17.3</code></p>
</li>
<li>
<p>Kubernetes Worker Nodes must be configured as physical hosts and
    attached to the Control Plane Node</p>
</li>
</ul>
<h4 id="61332-installing-the-intel-secl-custom-resource-definitions">6.13.3.2  Installing the Intel® SecL Custom Resource Definitions</h4>
<p>Intel® SecL uses Custom Resource Definitions to add the ability to base
orchestration decisions on Intel® SecL security attributes to
Kubernetes. These CRDs allow Kubernetes administrators to configure pods
to require specific security attributes so that the Kubernetes Control Plane
Node will schedule those pods only on Worker Nodes that match the
specified attributes.</p>
<p>Two CRDs are required for integration with Intel® SecL – an extension
for the Control Plane nodes, and a scheduler extension. A single installer will
deploy both of these CRDs. The extensions are deployed as a Kubernetes
deployment in the <code>isecl</code> namespace.</p>
<p>To deploy the Kubernetes integration CRDs for Intel® SecL:</p>
<ol>
<li>
<p>Copy the <code>isecl-k8s-extensions</code> installer to the Kubernetes Control Plane Node
    and execute the installer</p>
<div class="highlight"><pre><span></span><code>./isecl-k8s-extensions-v3.3.1.bin
</code></pre></div>
</li>
<li>
<p>Add a mount path to the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file for the Intel
    SecL scheduler extension:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extendedsched</span>
  <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</li>
<li>
<p>Add a volume path to the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file for the Intel
    SecL scheduler extension:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/</span>
    <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extendedsched</span>
</code></pre></div>
</li>
<li>
<p>Add <code>policy-config-file</code> path in the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file under <code>command</code> section:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--policy-config-file=/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/scheduler-policy.json</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--bind-address=127.0.0.1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--kubeconfig=/etc/kubernetes/scheduler.conf</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--leader-elect=true</span>
</code></pre></div>
</li>
<li>
<p>Wait for the isecl-controller and isecl-scheduler pods to be into
    running state</p>
<p><code>shell
kubectl get pods -n isecl</code></p>
</li>
<li>
<p>Create role bindings on the Kubernetes Control Plane Node:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl create clusterrolebinding isecl-clusterrole --clusterrole=system:node --user=system:serviceaccount:isecl:isecl

kubectl create clusterrolebinding isecl-crd-clusterrole --clusterrole=isecl-controller --user=system:serviceaccount:isecl:isecl
</code></pre></div>
<ol>
<li>Copy the Integration Hub public key to the Kubernetes Control Plane Node:</li>
</ol>
<div class="highlight"><pre><span></span><code>scp -r /etc/ihub/ihub_public_key.pem k8s.maseter.server:/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/
</code></pre></div>
<ol>
<li>Run the command <code>systemctl restart kubelet</code> to restart all the control
   plane container services, including the base scheduler.</li>
</ol>
<p>The scheduler yaml is present under
<code>/opt/isecl-k8s-extensions/yamls/isecl-scheduler.yaml</code></p>
<ol>
<li>If the Controller and/or Scheduler deployments are deleted, the
   following steps need to be performed:</li>
</ol>
<p>a. Edit <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> and
remove/comment the following content and restart kubelet</p>
<p>​   <code>--policy-config-file=/opt/isecl-k8s-extensions/isecl-k8sscheduler/config/scheduler-policy.json</code></p>
<p>​   <code>systemctl restart kubelet</code></p>
<p>b. Redeploy scheduler and controller</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-controller.yaml
kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-scheduler.yaml
</code></pre></div>
<p>c. Edit <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> and
add/uncomment the following content and restart kubelet</p>
<p>​   <code>--policy-config-file=/opt/isecl-k8s-extensions/isecl-k8sscheduler/config/scheduler-policy.json</code></p>
<p>​   <code>systemctl restart kubelet</code></p>
<p>d. Logs will be appended to older logs in
/var/log/isecl-k8s-extensions</p>
<ol>
<li>Whenever the CRD's are deleted and restarted for updates, the CRD's
    using the yaml files present under <code>/opt/isecl-k8s-extensions/yamls/</code>.
    Kubernetes Version 1.14-1.15 uses crd-1.14.yaml and 1.16-1.17 uses
    crd-1.17.yaml</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl delete hostattributes.crd.isecl.intel.com
kubectl apply -f /opt/isecl-k8s-extensions/yamls/crd-&lt;version&gt;.yaml
</code></pre></div>
<ol>
<li>(Optional) Verify that the Intel ® SecL Custom Resource Definitions
    have been started:</li>
</ol>
<p>To verify the Intel SecL CRDs have been deployed:</p>
<div class="highlight"><pre><span></span><code>kubectl get crds
</code></pre></div>
<h4 id="61333-configuring-the-integration-hub-for-use-with-kubernetes">6.13.3.3   Configuring the Integration Hub for Use with Kubernetes</h4>
<p>The Integration Hub should be installed after the Intel SecL CRDs have already been installed on the Kubernetes Control Plane.  If the Hub has already been installed without an available tenant endpoint, the installer can simply be rerun with a modified ihub.env answer file containing the required tenant variables.</p>
<p>The ihub.env answer file requires two variables to be configured with information from the Kubernetes environment before installation:  </p>
<div class="highlight"><pre><span></span><code>KUBERNETES_CERT_FILE=/etc/ihub/apiserver.crt
</code></pre></div>
<p>This file can be copied from the Kuberetes Control Plane Node, and can be found at the following path: 
/etc/kubernetes/pki/apiserver.crt</p>
<div class="highlight"><pre><span></span><code>KUBERNETES_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6Ik......
</code></pre></div>
<p>This token can be retrieved from Kubernetes using the following command:</p>
<div class="highlight"><pre><span></span><code>kubectl get secrets -n isecl -o jsonpath=&quot;{.items[?(@.metadata.annotations[&#39;kubernetes\.io/service-account\.name&#39;]==&#39;default&#39;)].data.token}&quot;|base64 --decode
</code></pre></div>
<p>See section 3.15.7 on Installing the Integration Hub.  Use the following variables in the ihub.env answer file:</p>
<div class="highlight"><pre><span></span><code># Authentication URL and service account credentials
AAS_API_URL=https://isecl-aas:8444/aas
IHUB_SERVICE_USERNAME=&lt;Username for the Hub service user&gt;
IHUB_SERVICE_PASSWORD=&lt;Password for the Hub service user&gt;

# CMS URL and CMS webserivce TLS hash for server verification
CMS_BASE_URL=https://isecl-cms:8445/cms/v1
CMS_TLS_CERT_SHA384=&lt;TLS hash&gt;

# TLS Configuration
TLS_SAN_LIST=127.0.0.1,192.168.1.1,hub.server.com #comma-separated list of IP addresses and hostnames for the Hub to be used in the Subject Alternative Names list in the TLS Certificate

# Verification Service URL
ATTESTATION_SERVICE_URL=https://isecl-hvs:8443/hvs/v2
ATTESTATION_TYPE=HVS

# Kubernetes Integration Credentials - required for Kubernetes integration only
KUBERNETES_URL=https://kubernetes:6443/
KUBERNETES_CRD=custom-isecl
KUBERNETES_CERT_FILE=/etc/ihub/apiserver.crt
KUBERNETES_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6Ik......

# Installation admin bearer token for CSR approval request to CMS - mandatory
BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…
</code></pre></div>
<h4 id="61336-configuring-pods-to-require-intel-secl-attributes">6.13.3.6  Configuring Pods to Require Intel® SecL Attributes</h4>
<ol>
<li>
<p>(Optional) Verify that the worker nodes have had their Intel® SecL
    security attributes populated:</p>
<div class="highlight"><pre><span></span><code>kubectl get nodes --show-labels
</code></pre></div>
<p>The output should show the Trust staus and any Asset Tags applied to
all of the registered Worker Nodes.</p>
</li>
<li>
<p>Add the following to any Pod creation files:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">affinity</span><span class="p">:</span>
    <span class="nt">nodeAffinity</span><span class="p">:</span>
      <span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
        <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.trusted</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="s">&quot;true&quot;</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_Country</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">US</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_Customer</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Coke</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Pepsi</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_State</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
</code></pre></div>
</li>
</ol>
<p>The <code>isecl.trusted</code> key defines the requirement for a Trusted host. Only
one of these keys should be used. The <code>isecl.TAG_</code> keys indicate Asset
Tags; if the workload should only launch on hosts with the <code>COUNTRY=US</code> Asset Tag, the pod should be launched with the matchExpression key
<code>isecl.TAG_COUNTRY</code> with the value <code>US</code>.</p>
<p>All of the matchExpression definitions must be true for a given worker
node to launch the pod – in the example above, the host must be
attested as Trusted with Asset Tags <code>Country=US</code> ,<code>Customer=Customer1</code> and <code>State=CA</code>. If the worker node has
additional Asset Tags beyond the ones required, the pod will still be
able to be launched on that node. However, if one of the specified
Tags is missing or has a different value, that worker node will not be
used for that pod.</p>
<h4 id="61337-tainting-untrusted-worker-nodes">6.13.3.7  Tainting Untrusted Worker Nodes</h4>
<p>Optionally, the Intel® SecL Kubernetes CRDs can be configured to flag
worker nodes as <code>tainted</code> to prevent any pods from launching on them.
This restriction is applied regardless of whether the pod has a specific
trust policy – if a worker node is flagged as <code>tainted</code> no pods will be
launched on that worker.</p>
<p>This setting is disabled by default. To enable this setting:</p>
<ol>
<li>
<p>Edit the <code>isecl-controller.yaml</code> file under
    <code>/opt/isecl-k8s-extensions/yamls/isecl-controller.yaml</code> and set
    <code>TAINT_UNTRUSTED_NODES=true</code></p>
</li>
<li>
<p>Run</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-controller.yaml
</code></pre></div>
</li>
</ol>
<p>Worker nodes that attest as untrusted will be <code>tainted</code> with the
NoExecute flag and unable to launch pods.</p>
<p>If a worker was previously considered tainted and the untrusted state is
resolved, the Intel® SecL CRDs will remove the tainted flag and the
worker will be able to launch pods again.</p>
<h1 id="7-workload-confidentiality">7  Workload Confidentiality</h1>
<p>Workload Confidentiality builds upon Platform Attestation to protect
data in virtual machine and container images. At its core, this feature
is about allowing an image owner to set policies that define the
conditions under which their image will be allowed to run; if the policy
conditions are met, the decryption key will be provided, and if the
conditions are not met, the image will remain encrypted and
inaccessible. This provides a level of enforcement beyond integration
with orchestrators, and protects sensitive data when the image is at
rest.</p>
<p>Workload Encryption relies on Platform Attestation to define the
security attributes of hosts. When a protected image is launched, the
Workload Agent on the host launching the VM or container image will
detect the attempt (using either Libvirt hooks for VMs, or as a function
of the Docker Secure Overlay Driver in the case of containers) and use
the Image ID to find the Image Flavor on the Workload Service. The
Workload Service will retrieve the current trust report for the host
launching the image, and use that report to make a key retrieval request
to the key transfer URL retrieved from the image flavor. The key
transfer URL refers to the URL to the image owner’s Key Broker Service,
along with the ID of the key needed.</p>
<p>In a typical production deployment, a Cloud Service Provider would
enable Intel® SecL-DC security controls by installing the Intel® SecL-DC
applications (with the exception of the Key Broker and Workload Policy
Manager), and configuring each workload host to be Trusted (as per the
Platform Integrity Attestation use case).</p>
<p>The owner of the workload image(s) to be protected (for example, the end
customer of the CSP) must install a Key Broker Service (which must be
available for network communication from the Workload Service hosted on
the CSP), the Workload Policy Manager, and their own Authentication and
Authorization Service and Certificate Management Service (these will
manage authentication and certificates for the KBS and WPM).</p>
<p>Any number of image owner customers with their own unique
KBS/WPM/AAS/CMS deployments may protect images that can be run by a
single CSP deployment.</p>
<p>The image owner will use the WPM to encrypt any image(s) to be
protected; the WPM will automatically create a new image encryption key
using the KBS, and will output the encrypted image and an Image Flavor.
The image owner can then upload the encrypted image to the CSP’s image
storage service, and then upload the Image Flavor to the CSP-hosted WLS.</p>
<p><img src="Images\image-encryption.png" alt="image-20200622081105459" style="zoom:150%;" /></p>
<p>When a compute host at the CSP attempts to launch a protected image, the
WLA on the host will detect the launch request, and will issue a key
transfer request to the WLS. The WLS will use the image ID to retrieve
the Image Flavor, which contains the key retrieval URL for that image.
This URL is hosted on the KBS of the image owner (which is why the KBS
must be available to network requests from the WLS). The WLS will access
the HVS to retrieve the current Platform Integrity Attestation report
for the host, and will use this report to make a key transfer request to
the KBS at the key transfer URL.</p>
<p>The KBS will receive the request, verify that the Platform Integrity
Attestation report is signed using a known SAML signing key (verifying
that the report comes from a known and trusted HVS), and will then
verify that the report shows that the host is trusted.</p>
<p>If these requirements are met, the KBS will use the host’s Binding Key
(the public half of an asymmetric keypair generated by the host’s TPM
and included in the attestation report) as a Key Encryption Key to seal
the Image Encryption Key to the TPM of the host that was attested.</p>
<p>When the host receives the response to the key request, it will unseal
the Image Encryption Key using its TPM. Because the Key Encryption Key
is unique to this host’s TPM, only the actual host that was attested
will be able to gain access to the image.</p>
<p>With the Image Encryption Key, the host’s WLA will create the
appropriate encrypted volume(s) for the image and begin the launch as
normal.</p>
<p>The WLA does not retain the key on disk; if/when the host is rebooted or
the WLA is restarted, restarting the workloads based on protected images
will trigger new key requests based on new Platform Integrity
Attestation reports. In this way, if a host is compromised in a method
detectable by the Platform Integrity feature, protected images will be
unable to launch on this server.</p>
<p><img src="C:\Users\raghave2\Desktop\Product Guide Markdown\images\workload-decryption" alt="image-20200622081137301" style="zoom:150%;" /></p>
<h2 id="71-virtual-machine-confidentiality">7.1  Virtual Machine Confidentiality</h2>
<h3 id="711-prerequisites">7.1.1  Prerequisites</h3>
<p>To enable Virtual Machine Confidentiality, the following Intel® SecL-DC
components must be installed and available:</p>
<ul>
<li>
<p>Authentication and Authorization Service</p>
</li>
<li>
<p>Certificate Management Service</p>
</li>
<li>
<p>Key Broker Service</p>
</li>
<li>
<p>Host Verification Service</p>
</li>
<li>
<p>Workload Service</p>
</li>
<li>
<p>Trust Agent + Workload Agent (on each virtualization host)</p>
</li>
<li>
<p>Workload Policy Manager</p>
</li>
</ul>
<p>See the Installation subsection on Recommended Service Layout for
recommendations on how/where to install each service.</p>
<p>It is strongly recommended to use a VM orchestration solution (for
example, OpenStack) with the Intel® SecL-DC Integration Hub to
schedule encrypted workloads on compute hosts that have already been
pre-checked for their Platform Integrity status. See the Platform
Integrity Attestation subsection on Integration with OpenStack for an
example.</p>
<p>You will need at least one QCOW2-format virtual machine image (for
quick testing purposes, a very small minimal premade image like CirrOS
is recommended; a good place to look for testing images is the
OpenStack Image Guide found here:
<a href="https://docs.openstack.org/image-guide/obtain-images.html">https://docs.openstack.org/image-guide/obtain-images.html</a>).</p>
<p>One or more hypervisor compute nodes running QEMU/KVM is required.
Each of these nodes must have the Intel® SecL-DC Trust Agent and
Workload Agent installed, and they must be registered with the
Verification Service. Each of these servers should show as <code>trusted</code> see the Platform Integrity Attestation section for details. You should
have Flavors that match the system configuration for these hosts, and
attestation reports should show all Flavor parts as <code>trusted=true</code>
Hosts that are not trusted (including servers where there is no trust
status, like hosts with no Trust Agent) will fail to launch any
encrypted workloads.</p>
<h3 id="712-workflow">7.1.2  Workflow</h3>
<h4 id="7121-encrypting-images">7.1.2.1  Encrypting Images</h4>
<div class="highlight"><pre><span></span><code>wpm create-image-flavor -l &lt;user-friendly unique label&gt; -i &lt;path to image file&gt; -e &lt;output path and filename <span class="k">for</span> encrypted image&gt; -o &lt;output path <span class="k">for</span> JSON image flavor&gt;<span class="sb">`</span>
</code></pre></div>
<p>After generating the encrypted image with the WPM, the encrypted image
can be uploaded to the Image Storage service of choice (for example,
OpenStack Glance). Note that the ID of the image in this Image Storage
service must be retained and used for the next steps.</p>
<h4 id="7122-uploading-the-image-flavor">7.1.2.2  Uploading the Image Flavor</h4>
<div class="highlight"><pre><span></span><code>POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/flavors
Authorization: Bearer &lt;token&gt;

{&lt;Image Flavor content from WPM output&gt;}
</code></pre></div>
<p>Use the above API request to upload the Image Flavor to the WLS. The
Image Flavor will tell other Intel® SecL-DC components the Key Transfer
URL for this image.</p>
<h4 id="7123-creating-the-image-flavor-to-image-id-association">7.1.2.3  Creating the Image Flavor to Image ID Association</h4>
<p>The WLS needs to know the ID of the image as it exists in the image
storage service used by the CSP (for example, OpenStack Glance). Use the
below API request to create an association between the Image Flavor
created in the previous step and the image ID.</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/images
Authorization: Bearer &lt;token&gt;

{
    &quot;id&quot;: &quot;&lt;image ID on image storage&gt;&quot;,
    &quot;flavor_ids&quot;: [&quot;&lt;Image Flavor ID&gt;&quot;]
}
</code></pre></div>
<h4 id="7124-launching-encrypted-vms">7.1.2.4  Launching Encrypted VMs</h4>
<p>Instances of the protected images can now be launched as normal.
Encrypted images will only be accessible on hosts with a Platform
Integrity Attestation report showing the host is trusted.</p>
<p>If the VM is launched on a host that is not trusted, the launch will
fail, as the decryption key will not be provided.</p>
<h2 id="72-container-confidentiality">7.2  Container Confidentiality</h2>
<h3 id="721-container-integrity-and-confidentiality-with-docker">7.2.1  Container Integrity and Confidentiality with Docker</h3>
<h4 id="7211-docker-container-integrity">7.2.1.1  Docker Container Integrity</h4>
<p>Intel® recommends using Docker Notary to verify the integrity of Docker
container images at launch.</p>
<p><a href="https://docs.docker.com/notary/getting_started/">https://docs.docker.com/notary/getting_started/</a></p>
<h4 id="7212-prerequisites">7.2.1.2  Prerequisites</h4>
<p>To enable Docker Container Confidentiality, the following Intel® SecL-DC
components must be installed and available:</p>
<ul>
<li>
<p>Authentication and Authorization Service</p>
</li>
<li>
<p>Certificate Management Service</p>
</li>
<li>
<p>Key Broker Service</p>
</li>
<li>
<p>Host Verification Service</p>
</li>
<li>
<p>Workload Service</p>
</li>
<li>
<p>Trust Agent + Workload Agent (on each Docker host)</p>
</li>
<li>
<p>Workload Policy Manager</p>
</li>
</ul>
<p>See the Installation subsection on Recommended Service Layout for
recommendations on how/where to install each service.</p>
<p>It is strongly recommended to use a container orchestration solution
(for example, Kubernetes) with the Intel® SecL-DC Integration Hub to
schedule encrypted Docker containers on compute hosts that have
already been pre-checked for their Platform Integrity status. See the
Platform Integrity Attestation subsection on Integration with
Kubernetes for an example.</p>
<p>You will need at least one Docker container image. For quick testing
purposes, any small public image can be used.  Some examples can be found here:</p>
<p><a href="https://github.com/jessfraz/dockerfiles/">https://github.com/jessfraz/dockerfiles/</a><br />
Image names:</p>
<ol>
<li>
<p>Openvpn</p>
</li>
<li>
<p>k8scan</p>
</li>
<li>
<p>postfix</p>
</li>
</ol>
<p>One or more Docker container worker nodes running Docker 19.03 is
required. Each of these nodes must have the Intel® SecL-DC Trust Agent
and Workload Agent installed, and they must be registered with the
Verification Service. Each of these servers should show as “trusted;”
see the Platform Integrity Attestation section for details. You should
have Flavors that match the system configuration for these hosts, and
attestation reports should show all Flavor parts as “trusted=true.”
Hosts that are not trusted (including servers where there is no trust
status, like hosts with no Trust Agent) will fail to launch any
encrypted workloads.</p>
<blockquote>
<p><strong>Important Note:</strong> Docker version 19.03.13 is specifically required,
and other versions are not supported. Installation of the Workload
Agent for Docker Container Confidentiality will <strong>replace</strong> the
existing Docker binaries (the client and daemon, in /usr/bin/dockerd
and /usr/bin/docker) with a recompiled Docker engine that includes the
Secure Overlay Driver. This is what allows the launch of encrypted
containers to be intercepted and decrypted. The Docker runtime must
not be upgraded or downgraded to any other version; doing so will
cause encrypted Docker Containers to fail to launch.</p>
<p>In the future, the Container Encryption feature will be modified to
use OCI-standard container encryption without the need for
recompilation or file replacement.</p>
</blockquote>
<h4 id="7213-workflow">7.2.1.3  Workflow</h4>
<h5 id="72131-encrypting-docker-container-images">7.2.1.3.1  Encrypting Docker Container Images</h5>
<p>The first step is encryption of a Docker Container image. The WPM is a
command line utility that will perform the actual image encryption and
allow the resulting encrypted image to be uploaded to a Docker Registry.</p>
<p>The commands needed are slightly different depending on whether Notary
is being used to validate container integrity.</p>
<p>If Notary is not being used:</p>
<p><code>wpm create-container-image-flavor -i &lt;container image name&gt; -t &lt;tag-name&gt; -e -f &lt;Dockerfile Path&gt; -d &lt;dirPath&gt; -o &lt;output
path for JSON image flavor&gt;</code></p>
<p>If Notary is being used:</p>
<p><code>wpm create-container-image-flavor -i &lt;imageName&gt; -t &lt;TagName&gt; -e
-s -n https://&lt;notaryIP&gt;:&lt;notaryPort&gt;/ -f &lt;Dockerfile Path&gt; -d &lt;dirPath&gt;</code></p>
<p>Also, if Notary is being used, set the following environment variable
before uploading the image to the Registry:</p>
<p><code>export DOCKER_CONTENT_TRUST=1</code></p>
<p>After generating the encrypted image with the WPM, the encrypted image
can be uploaded to a local Docker Registry.</p>
<h5 id="72132-uploading-the-image-flavor">7.2.1.3.2  Uploading the Image Flavor</h5>
<div class="highlight"><pre><span></span><code>POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/flavors
Authorization: Bearer &lt;token&gt;

{&lt;Image Flavor content from WPM output&gt;}
</code></pre></div>
<p>Use the above API request to upload the Image Flavor to the WLS. The
Image Flavor will tell other Intel® SecL-DC components the Key Transfer
URL for this image.</p>
<h5 id="72133-creating-the-image-flavor-to-image-id-association">7.2.1.3.3  Creating the Image Flavor to Image ID Association</h5>
<p>For Docker images stored in a Docker Registry, the ID is typically an
MD5 hash. This format must be converted for use with the Workload
Service. To get the non-truncated ID of the image, use the Docker
command:</p>
<p><code>docker images --no-trunc</code></p>
<p>Next, convert this to a UUID that can be used by Intel® SecL:</p>
<p><code>wpm get-container-image-id &lt;image-full-md5id&gt;</code></p>
<p>The output will be a UUID, which will be considered the ID of the image
for the WLS.</p>
<p>Use the below API request to create an association between the Image
Flavor created in the previous step and the image ID.</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/images
Authorization: Bearer &lt;token&gt;

{
    &quot;id&quot;: &quot;&lt;image ID on image storage&gt;&quot;,
    &quot;flavor_ids&quot;: [&quot;&lt;Image Flavor ID&gt;&quot;]
}
</code></pre></div>
<h5 id="72134-launching-encrypted-docker-containers">7.2.1.3.4  Launching Encrypted Docker Containers</h5>
<p>Containers of the protected images can now be launched as normal using
Kubernetes pods and deployments. Encrypted images will only be
accessible on hosts with a Platform Integrity Attestation report showing
the host is trusted.</p>
<p>If the Docker Container is launched on a host that is not trusted, the
launch will fail, as the decryption key will not be provided.</p>
<h3 id="722-container-confidentiality-with-cri-o-and-skopeo">7.2.2  Container Confidentiality with Cri-o and Skopeo</h3>
<h4 id="7221-prerequisites">7.2.2.1  Prerequisites</h4>
<p>Container Confidentiality with Cri-o and Skopeo requires modified versions of both Cri-o and Skopeo.  Both of these are automatically built with the Intel SecL build scripts, and can be found here after the script has executed:</p>
<div class="highlight"><pre><span></span><code>isecl/cc-crio/binaries/
</code></pre></div>
<p><a href="https://github.com/lumjjb/skopeo/tree/sample_integration">Skopeo</a></p>
<ul>
<li>
<p>The patched version of Skopeo 0.1.41-dev must be installed on each Worker Node: <a href="https://github.com/lumjjb/skopeo/tree/sample_integration">https://github.com/lumjjb/skopeo/tree/sample_integration</a>. </p>
</li>
<li>
<p>The Skopeo wrapper that allows Skopeo to interface with the ISecL components must be installed on each Worker Node: <a href="https://github.com/lumjjb/skopeo/blob/sample_integration/vendor/github.com/lumjjb/seclkeywrap/keywrapper_secl.go">https://github.com/lumjjb/skopeo/blob/sample_integration/vendor/github.com/lumjjb/seclkeywrap/keywrapper_secl.go</a>.</p>
</li>
<li>
<p>Copy the Skopeo wrapper into /usr/bin: </p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>cp isecl/cc-crio/binaries/skopeo /usr/bin/skopeo
</code></pre></div>
<ul>
<li>Add the following to the crio.service definition to always start Cri-o with the Intel SecL policy parameters enabled:</li>
</ul>
<div class="highlight"><pre><span></span><code>vi /usr/local/lib/systemd/system/crio.service
ExecStart=/usr/local/bin/crio \
          $CRIO_CONFIG_OPTIONS \
          $CRIO_RUNTIME_OPTIONS \
          $CRIO_STORAGE_OPTIONS \
          $CRIO_NETWORK_OPTIONS \
          $CRIO_METRICS_OPTIONS \
          --decryption-secl-parameters secl:enabled
</code></pre></div>
<p><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cri-o">Cri-o 1.17</a></p>
<ul>
<li>
<p>The patched version of Cri-o 1.17 must be installed on each Worker Node:   <a href="https://github.com/lumjjb/cri-o/blob/1.16_encryption_sample_integration">https://github.com/lumjjb/cri-o/blob/1.16_encryption_sample_integration</a>. </p>
</li>
<li>
<p>Copy the CRI-O binary from IsecL build script to /usr/bin/:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>cp isecl/cc-crio/binaries/crio /usr/bin/crio
</code></pre></div>
<ul>
<li>
<p>The Cri-o wrapper that allows Cri-o to interface with ISecL components must be installed on each Worker Node: <a href="https://github.com/lumjjb/cri-o/blob/1.16_encryption_sample_integration/vendor/github.com/lumjjb/seclkeywrap/keywrapper_secl.go">https://github.com/lumjjb/cri-o/blob/1.16_encryption_sample_integration/vendor/github.com/lumjjb/seclkeywrap/keywrapper_secl.go</a>.</p>
</li>
<li>
<p>GoLang 1.14.4 or later must be installed on each Kubernetes Worker Node</p>
</li>
<li>
<p>Crictl must be installed on each Kubernetes Worker Node</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>$ VERSION=&quot;v1.17.0&quot;
$ wget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz
$ sudo tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin
$ rm -f crictl-$VERSION-linux-amd64.tar.gz
</code></pre></div>
<ul>
<li>
<p>Kubernetes must be configured to use Cri-o and Skopeo</p>
</li>
<li>
<p>Platform Integrity Attestation must be configured for the physical Kubernetes Worker Nodes.</p>
</li>
<li>
<p>This includes, at minimum, the CMS; AAS; HVS; KBS; WPM; and the Trust Agent must be installed on each Worker Node.  See the Installation section for details installing these services.</p>
</li>
<li>
<p>Each Kubernetes Worker Node should be Trusted in the attestation reports generated by the HVS.</p>
</li>
<li>
<p>Only physical Worker Nodes are supported at this time.  </p>
</li>
</ul>
<h4 id="7222-workflow">7.2.2.2  Workflow</h4>
<h6 id="skopeo-commands">Skopeo Commands</h6>
<div class="highlight"><pre><span></span><code>skopeo copy source-image destination-image

 Options:

--encryption-key [secl:asset_tag|keyfile] Specifies the encryption protocol. When using secl protocol, provide either &quot;any&quot; or an asset tag in the form &quot;at_key:at_value&quot;; only one asset tag can be used at this time. Alternatively, a specific key can be provided to be used for encryption.

--decryption-key [secl:enabled|keyfile] specifies the decryption Alternatively, a specific key can be provided to be used for decryption. This flag can be repeated if an image requires more than one key to be decrypted.
</code></pre></div>
<p>See <a href="https://github.com/lumjjb/skopeo/blob/sample_integration/docs/skopeo-copy.1.md">https://github.com/lumjjb/skopeo/blob/sample_integration/docs/skopeo-copy.1.md</a> for more details.</p>
<h6 id="examples">Examples</h6>
<p>Copy a container image from a registry to a local server:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy docker://docker.io/library/nginx:latest oci:nginx_local
</code></pre></div>
<p>To encrypt an image (this will allow the image to run only on Trusted platforms):</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy --encryption-key secl:any oci:nginx_local oci:nginx_secl_enc
</code></pre></div>
<p>To encrypt an image with an Asset Tag (this will allow the image to run only on Trusted platforms with the specified Asset tag):</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy --encryption-key secl:asset_tag_key:asset_tag_value oci:nginx_local oci:nginx_secl_enc_w_at
</code></pre></div>
<p>To decrypt an image:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy --decryption-key secl:enabled oci:nginx_secl_enc oci:nginx_secl_dec
</code></pre></div>
<p>To copy an encrypted image without decryption:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy oci:nginx_secl_enc oci:nginx_secl_enc_copy
</code></pre></div>
<p>To copy a local image to a remote registry:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy oci:nginx_secl_enc docker://10.80.245.116/nginx_secl_enc:latest
</code></pre></div>
<h6 id="prepare-an-image">Prepare an Image</h6>
<p>Convert the image to an OCI image using Skopeo:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy docker-daemon:custom-image:latest oci:custom-image:latest
</code></pre></div>
<p>Encrypt the image using Skopeo copy command</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy --encryption-key secl:any oci:custom-image:latest oci:custom-image:enc
</code></pre></div>
<p>Push the image to a registry:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy oci:custom-image:enc docker://Registry.server.com:5000/custom-image:enc
</code></pre></div>
<p>Alternatively, encrypt the image and push it to a registry in a single step:</p>
<div class="highlight"><pre><span></span><code>$ skopeo copy --encryption-key secl:any oci:custom-image:latest docker://registry.server.com:5000/custom-image:enc
</code></pre></div>
<h5 id="72221-pulling-and-encrypting-a-container-image">7.2.2.2.1 Pulling and Encrypting a Container Image</h5>
<p>Skopeo can be used to pull a container image from an external registry (a private Docker registry is used in teh examples below). This image may be encrypted already, but if you wish to pull an image for encryption, it must be in plaintext format. Skopeo has a wrapper that can interact with the Workload Policy Manager. When trying to encrypt an image, Skopeo calls the WPM CLI fetch-key command. In the command, the KBS is called in order to create a new key. The return from the KBS includes the key retrieval URL, which is used when trying to decrypt. After the key is returned to the WPM, the WPM passes the key back to Skopeo. Skopeo uses the key to encrypt the image layer by layer as well as associate the encrypted image with the key's URL. Skopeo then uploads the encrypted image to a remote container registry.</p>
<p>The modified Cri-o and wrapper will modify the Cri-o commands to allow Intel SecL policies to be utilized.</p>
<h5 id="72222-launching-an-encrypted-container-image">7.2.2.2.2 Launching an Encrypted Container Image</h5>
<p>Cri-o allows for pulling and decryption of an encrypted container image from a container registry. When trying to pull and decrypt a container image, Cri-o has a hook that calls into the Workload Agent (WLA). The WLA will call into the Workload Service (WLS) and pass it the key URL associated with the encrypted image as well as the host's hardware UUID. These two serve as input to /keys endpoint of the WLS. The WLS initializes a HVS client in order to retrieve the host SAML report and then validates the report. If the host is trusted, the WLS will attempt to get the key. First, it will check if it's been cached alredy. If not, it will initialize a KBS client. The WLS uses this client to retrieve the key from the KBS. If the key is retrieved, it will be cached in the WLS temporarily so that the WLS will not need to requery the KBS if attempting to decrypt with the same key. The key is then passed back to the WLA as the return of the WLS's keys API. Finally, the key is returned to Cri-o, which uses the key to decrypt the container image layer by layer.</p>
<p>Containers of the protected images can now be launched as normal using Kubernetes pods and deployments. Encrypted images will only be accessible on hosts with a Platform Integrity Attestation report showing the host is trusted. If the Crio Container is launched on a host that is not trusted, the launch will fail, as the decryption key will not be provided.</p>
<h1 id="8-trusted-virtual-kubernetes-worker-nodes">8  Trusted Virtual Kubernetes Worker Nodes</h1>
<p>While the existing Platform Integrity Attestation functions support
bare-metal Kubernetes Worker Nodes, using Virtual Machines to host the
Worker Nodes is a common deployment architecture. This feature aims to
help extend the Chain of Trust to protect the integrity of Virtual
Machines, including virtual Kubernetes Worker Nodes. This feature
requires the foundational Platform integrity Attestation feature as a
prerequisite for the bare-metal servers hosting the virtual Worker
Nodes.</p>
<blockquote>
<p><strong>Note</strong>: This feature requires a degree of separation between the VM
and Kubernetes infrastructure. All physical, bare-metal servers should
be virtualization hosts, and all Kubernetes Worker Nodes should be
Virtual Machines running on those physical virtualization hosts.
Kubernetes clusters should not use a mixture of both virtual and
bare-metal Workers. The physical virtualization clusters should not
include a mixture of hosts protected by Intel® SecL Platform integrity
Attestation and hosts that are not protected. VM trust reports can
only be generated for VM instances launched on hosts with Intel® SecL
services enabled.</p>
<p><strong>Also important to note is that this feature alone will not prevent
any VMs from launching</strong>. VMs will still be launched on Untrusted
platforms unless additional steps are taken (for example, using
OpenStack orchestration integration with Intel® SecL, or using the
Workload Confidentiality feature to encrypt the Kubernetes Worker Node
VM image). This feature generates VM attestation reports that can be
used to audit compliance and extend the Chain of Trust, and relies on
other datacenter policies and/or Intel® SecL features to enforce
compliance.</p>
</blockquote>
<p>When libvirt initiates a VM Start, the Intel® SecL-DC Workload Agent
will create a report for the VM that associates the VM’s trust status
with the trust status of the host launching the VM. This VM report will
be retrievable via the Workload Service, and contains the hardware UUID
of the physical server hosting the VM. This UUID can be correlated to
the Trust Report of that server at the time of VM launch, creating an
audit trail validating that the VM launched on a trusted platform. A new
report is created for every VM Start, which includes actions like VM
migrations, so that each time a VM is launched or moved a new report is
generated ensuring an accurate trust status.</p>
<p>By using Platform Integrity and Data Sovereignty-based orchestration (or
Workload Confidentiality with encrypted worker VMs) for the Virtual
Machines to ensure that the virtual Kubernetes Worker nodes only launch
on trusted hardware, these VM trust reports provide an auditing
capability to extend the Chain of Trust to the virtual Worker Nodes.</p>
<p>Optionally, the Kubernetes Worker Node VM images can be encrypted and
protected as per the Workload Confidentiality feature of Intel® SecL.
This adds a layer of enforcement – rather than simply reporting whether
the VM started on a Trusted platform (and is therefore Trusted),
Workload Confidentiality ensures that the Worker Node VM image can only
be decrypted on compliant platforms.</p>
<p>In both cases (with VM image encryption and without), the VM Trust
Reports are accessed through the Workload Service:</p>
<div class="highlight"><pre><span></span><code>GET https://&lt;Workload Service IP or Hostname&gt;:5000/wls/reports?instance_id=&lt;instance ID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>This query will return the latest VM trust report for the provided
Instance ID (the Instance ID is the VM’s ID as it is identified by
Libvirt; in OpenStack this would correspond directly to the OpenStack
Instance ID).</p>
<p>As a best practice, Intel® recommends using an orchestration layer (such
as OpenStack) integrated with Intel® SecL to launch VMs only on Trusted
platforms. See the previous section, “Integration” under the “Platform
Integrity Attestation” feature for details.</p>
<p>As an additional layer of protection, the Kubernetes Worker Node VM
images can be encrypted using the Workload Confidentiality feature. This
adds cryptographic enforcement to the workload orchestration and ensures
instances of the Worker Node images will only be launched on Trusted
platforms.</p>
<h2 id="81-prerequisites">8.1  Prerequisites</h2>
<ul>
<li>
<p>All physical, bare-metal servers should be virtualization hosts.
    Virtualization hosts must be Linux platforms using Libvirt.</p>
</li>
<li>
<p>All Kubernetes Worker Nodes should be Virtual Machines running on
    those physical virtualization hosts.</p>
</li>
<li>
<p>Kubernetes clusters must not use a mixture of both virtual and
    bare-metal Workers.</p>
</li>
<li>
<p>The physical virtualization clusters must not include a mixture of
    hosts protected by Intel® SecL Platform integrity Attestation and
    hosts that are not protected. VM trust reports can only be generated
    for VM instances launched on hosts with Intel® SecL services
    enabled.</p>
</li>
<li>
<p>The Intel® SecL Platform integrity Attestation feature must be used
    to protect all physical virtualization hosts. These platforms must
    all be registered with the Verification Service, must have the Trust
    Agent installed and running, and must be Trusted. See the Platform
    integrity Attestation section for details.</p>
</li>
<li>
<p>In addition to the services required by Platform Integrity
    Attestation, the Workload Agent must be installed on each physical
    virtualization host, and the Workload Service must be installed on
    the management plane.</p>
</li>
<li>
<p>(Optional; recommended) Virtual Machines should be orchestrated
    using an Intel® SecL-supported orchestrator, such as OpenStack. This
    will help launch the VMs only on compliant platforms.</p>
</li>
<li>
<p>(Optional) Virtual Machine Images may be encrypted using the
    Workload Confidentiality feature. This adds a layer of cryptographic
    enforcement to the orchestration of virtual worker VMs, ensuring
    that the VMs can only be launched on compliant platforms.</p>
</li>
</ul>
<h2 id="82-workflow">8.2  Workflow</h2>
<p>There are no additional steps required to enable this feature; if the
Workload Agent is running on the physical virtualization host, VM trust
reports will automatically be generated at every VM Start. Intel®
strongly recommends using an orchestration integration for the VM
management layer (for example, the provided Integration Hub integration
with OpenStack) to help ensure that the worker node VMs only launch on
Trusted physical hosts. If no orchestration is used, the platform
service provider should ensure that all physical hosts are always in a
Trusted state and take action to ensure Untrusted platforms cannot
launch VMs.</p>
<p>The primary benefit of the Trusted Virtual Kubernetes Worker Node
feature is auditability of the Chain of Trust. By retrieving the VM
Trust Report from the Workload Service for a given Worker Node instance,
auditors can verify that the VM launched on a Trusted platform. The VM
trust report also includes the hardware UUID of the physical host. This
UUID, along with the time that the VM instance was launched, can be used
to pull the correlating physical host trust report from the Verification
Service to provide proof of compliance.</p>
<p>To retrieve a VM trust report from the Workload Service:</p>
<div class="highlight"><pre><span></span><code>GET https://&lt;Workload Service IP or Hostname&gt;:5000/wls/reports?instance_id=&lt;instance ID&gt;
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<p>This will return the latest report for the specified instance ID.</p>
<h2 id="83-sample-vm-trust-report">8.3  Sample VM Trust Report</h2>
<p>A sample VM Trust Report from the Workload Service is below. The report
is generated by the Workload Agent and signed using the host’s TPM, then
stored in the Workload Service. The report contains some key attributes:</p>
<p><strong>instance_id</strong>: This is the ID of the instance. In OpenStack, this
would correlate directly to the Instance ID for the VM.</p>
<p><strong>image_id</strong>: This is the ID for the source image used to launch the
instance. In OpenStack, this correlates directly to the Image ID for the
VM.</p>
<p><strong>host_hardware_uuid</strong>: The hardware UUID of the physical host that
started the VM. This attribute identifies which host performed the VM
start and attested the VM. This UUID can be used to query the
Verification Service to retrieve attestations of the host. By
correlating the VM Trust Report with the Host Trust Report, we can
verify that this instance was started on a Trusted platform.</p>
<p><strong>image_encrypted</strong>: True or False based on whether the source image
was protected using the Workload Confidentiality feature.</p>
<p><strong>trusted</strong>: True or False, based on whether the VM instance was started
on a Trusted platform. Because the report is generated at every <code>vm
start</code> through Libvirt, a new report will be generated whenever the VM
is turned on or migrated, reflecting the state of the VM and its host at
every opportunity for the state to change.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Response</span> <span class="na">xmlns=</span><span class="s">&quot;http://wls.server.com/wls/reports&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;instance_manifest&gt;</span>
        <span class="nt">&lt;instance_info&gt;</span>
            <span class="nt">&lt;instance_id&gt;</span>bd06385a-5530-4644-a510-e384b8c3323a<span class="nt">&lt;/instance_id&gt;</span>
            <span class="nt">&lt;host_hardware_uuid&gt;</span>00964993-89c1-e711-906e-00163566263e<span class="nt">&lt;/host_hardware_uuid&gt;</span>
            <span class="nt">&lt;image_id&gt;</span>773e22da-f687-47ca-89e7-5df655c60b7b<span class="nt">&lt;/image_id&gt;</span>
        <span class="nt">&lt;/instance_info&gt;</span>
        <span class="nt">&lt;image_encrypted&gt;</span>true<span class="nt">&lt;/image_encrypted&gt;</span>
    <span class="nt">&lt;/instance_manifest&gt;</span>
    <span class="nt">&lt;policy_name&gt;</span>Intel VM Policy<span class="nt">&lt;/policy_name&gt;</span>
    <span class="nt">&lt;results&gt;</span>
        <span class="nt">&lt;e&gt;</span>
            <span class="nt">&lt;rule&gt;</span>
                <span class="nt">&lt;rule_name&gt;</span>EncryptionMatches<span class="nt">&lt;/rule_name&gt;</span>
                <span class="nt">&lt;markers&gt;</span>
                    <span class="nt">&lt;e&gt;</span>IMAGE<span class="nt">&lt;/e&gt;</span>
                <span class="nt">&lt;/markers&gt;</span>
                <span class="nt">&lt;expected&gt;</span>
                    <span class="nt">&lt;name&gt;</span>encryption_required<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/expected&gt;</span>
            <span class="nt">&lt;/rule&gt;</span>
            <span class="nt">&lt;flavor_id&gt;</span>3a3e1ccf-2618-4a0d-8426-fb7acb1ebabc<span class="nt">&lt;/flavor_id&gt;</span>
            <span class="nt">&lt;trusted&gt;</span>true<span class="nt">&lt;/trusted&gt;</span>
        <span class="nt">&lt;/e&gt;</span>
    <span class="nt">&lt;/results&gt;</span>
    <span class="nt">&lt;trusted&gt;</span>true<span class="nt">&lt;/trusted&gt;</span>
    <span class="nt">&lt;data&gt;</span>eyJpbnN0YW5jZV9tYW5pZmVzdC…data&gt;
        <span class="nt">&lt;hash_alg&gt;</span>SHA-256<span class="nt">&lt;/hash_alg&gt;</span>
        <span class="nt">&lt;cert&gt;</span>-----BEGIN CERTIFICATE-----
…
-----END CERTIFICATE-----<span class="nt">&lt;/cert&gt;</span>
        <span class="nt">&lt;signature&gt;</span>…<span class="nt">&lt;/signature&gt;</span>
    <span class="nt">&lt;/Response&gt;</span>
</code></pre></div>
<h1 id="9-flavor-management">9  Flavor Management</h1>
<h2 id="91-flavor-format-definitions">9.1  Flavor Format Definitions</h2>
<p>A Flavor is a standardized set of expectations that determines what
platform measurements will be considered “trusted.” Flavors are
constructed in a specific format, containing a metadata section
describing the Flavor, and then various other sections depending on the
Flavor type or Flavor part.</p>
<h3 id="911-meta">9.1.1  Meta</h3>
<p>The first part of a Flavor is the <code>meta</code> section:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;meta&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;PLATFORM&quot;</span><span class="p">,</span>
        <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This section defines the Flavor part and any versioning information.</p>
<blockquote>
<p><strong>NOTE</strong>:  Even when the BIOS or OS version remains the same, the actual
measurements in the measured boot process will be different between
TPM 1.2 and TPM 2.0, and so the TPM version is captured here as
well. The attributes in the Meta section are used by the Flavor
matching engine when matching Flavors to Hosts.  Note that TPM 1.2 is supported only for VMware ESXi hosts.</p>
</blockquote>
<h3 id="912-hardware">9.1.2  Hardware</h3>
<p>The <code>hardware</code> section is unique to PLATFORM flavor parts:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;hardware&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;processor_info&quot;</span><span class="p">:</span> <span class="s2">&quot;54 06 05 00 FF FB EB BF&quot;</span><span class="p">,</span>
    <span class="nt">&quot;processor_flags&quot;</span><span class="p">:</span> <span class="s2">&quot;fpu vme de …&quot;</span><span class="p">,</span>
    <span class="nt">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;tpm&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;pcr_banks&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;SHA1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SHA256&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;txt&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This part of the Flavor defines expected hardware attributes of the
host, and contains processor and TPM-related attributes.</p>
<h3 id="pcrs">PCRs</h3>
<p>The last section of a Flavor is the “PCRs” section, which contains the
actual expected measurements for any PCRs. This section will contain PCR
measurements for each applicable algorithm supported by the TPM (SHA1
only for TPM 1.2, SHA256 and SHA1 sections for TPM 2.0).</p>
<p>Some PCRs simply have a value and nothing else. Other PCRs, however,
contain different <code>event</code> measurements. This indicates that separate
individual platform or OS components are independently measured and
extended to the same PCR. PCRs with event measurements will contain an
<code>Event</code> array that lists, in the correct order, all of the events in the
measurement event log that are extended to this PCR. When the
Verification Service attests a host against a given Flavor, each
measurement event is compared to the Flavor value, and all of the events
are replayed to confirm that a replay of all of the measurement
extensions do in fact result in the hash seen in the PCR value. In this
way, the Verification Service can ensure that the measurement event log
contents are secure, and the individual measurements can be attested so
that the cause for an Untrusted attestation can easily be seen.</p>
<p>The full PCRs section is not shown here due to length; see the sample
Flavor sections for a full sample.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="err">...</span>
</code></pre></div>
<h3 id="914-sample-platform-flavor">9.1.4  Sample PLATFORM Flavor</h3>
<p>The <code>PLATFORM</code> Flavor part encompasses measurements that are unique to a
specific platform, including the server OEM, BIOS version, etc. A
PLATFORM Flavor can be <code>shared</code> across all hosts of the same model that
have the same BIOS version.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavor_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot; PLATFORM&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;hardware&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;processor_info&quot;</span><span class="p">:</span> <span class="s2">&quot;54 06 05 00 FF FB EB BF&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;processor_flags&quot;</span><span class="p">:</span> <span class="s2">&quot;fpu vme de …&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;tpm&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                            <span class="nt">&quot;pcr_banks&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s2">&quot;SHA1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;SHA256&quot;</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;txt&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ffb1806465d2de1b7531fd5a2a6effaad7c5a047&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3d42560dcf165a5557b3156a21583f2c6dbef10e&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;274f929dbab8b98a7031bbcd9ea5613c2a28e5e6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ca96de412b4e8c062e570d3013d2fccb4b20250a&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d123e2f2b30f1effa8d9522f667af0dac4f48cfb&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f3742133e1a0deb48177a74ed225418e5cf73fd1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;db83f0e8a1773c21164c17986037cdf8afc1bbdc1b815772c6da1befb1a7f8a3&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;50bd58407a1893056eacff493245cfe785f045b2c0e1cc3e6e9eb5812d8d91bd&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9301981c093654d5aa3430ba05c880a52eb22b9e18248f5f93e1fe1dab1cb947&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2785d1ed65f6b5d4b555dc24ce5e068a44ce8740fe77e01e15a10b1ff66cca90&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</code></pre></div>
<h3 id="915-sample-os-flavor">9.1.5  Sample OS Flavor</h3>
<p>An OS Flavor encompasses all of the measurements unique to a given OS.
This includes the OS kernel and other measurements.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavor_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;OS&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;os_name&quot;</span><span class="p">:</span> <span class="s2">&quot;RedHatEnterpriseServer&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;os_version&quot;</span><span class="p">:</span> <span class="s2">&quot;7.3&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;vmm_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;vmm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ffb1806465d2de1b7531fd5a2a6effaad7c5a047&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3d42560dcf165a5557b3156a21583f2c6dbef10e&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;274f929dbab8b98a7031bbcd9ea5613c2a28e5e6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ca96de412b4e8c062e570d3013d2fccb4b20250a&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d123e2f2b30f1effa8d9522f667af0dac4f48cfb&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f3742133e1a0deb48177a74ed225418e5cf73fd1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;50bd58407a1893056eacff493245cfe785f045b2c0e1cc3e6e9eb5812d8d91bd&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9301981c093654d5aa3430ba05c880a52eb22b9e18248f5f93e1fe1dab1cb947&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2785d1ed65f6b5d4b555dc24ce5e068a44ce8740fe77e01e15a10b1ff66cca90&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;26e1d98742f79c950dc637f8c067b0b72a1b0e8ff75db4e609c7e17321acf3f4&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;0f6e0c7a5944963d7081ea494ddff1e9afa689e148e39f684db06578869ea38b&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;27808f64e6383982cd3bcc10cfcb3457c0b65f465f779d89b668839eaf263a67&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;c89ad1d1e9adaa7ecfee2abce763b92472685f7d1b9f3799bf49974b66ed9638&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;81b88e268e697ccf1790d41b9de748a8f395acfb47aa67c9845479d4e8456f77&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span><span class="p">:</span> <span class="s2">&quot;automatic&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="916-sample-host_unique-flavor">9.1.6  Sample HOST_UNIQUE Flavor</h3>
<p>Host-Unique flavors define measurements for a specific host. This can be
either a single large flavor that incorporates all of the host
measurements into a single flavor document used only to attest a single
host, or can be a small subset of measurements that are specific to a
single host. For example, some VMWare module measurements will change
from one host to the next, while most others will be shared assuming the
same ESXi build is used. The full Flavor requirement for such a host
would include Host-Unique flavors to cover the measurements that are
unique to only this one host, and would still use a generic PLATFORM and
OS flavor for the other measurements that would be identical for other
similarly configured hosts.</p>
<blockquote>
<p><strong>Note</strong>:The HOST_UNIQUE Flavors are unique to a specific host, and should
always be imported directly from the specific host. </p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;4d387cbd-f72b-4742-b4e5-c5b0ffed59e0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Purley11&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;os_name&quot;</span><span class="p">:</span> <span class="s2">&quot;RedHatEnterpriseServer&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;os_version&quot;</span><span class="p">:</span> <span class="s2">&quot;7.4&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;hardware_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;00448C61-46F2-E711-906E-001560A04062&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f9ef8c53ddfc8096d36eda5506436c52b4bfa2bd451a89aaa102f03181722176&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;09f468dfc1d98a1fee86eb7297a56b0e097d57be66db4eae539061332da2e723&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;pcr_18&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;c1f7bfdae5f270d9f13aa9620b8977951d6b759f1131fe9f9289317f3a56efa1&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;48695f747a3d494710bd14d20cb0a93c78a485cc&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;b1f8db372e396bb128280821b7e0ac54a5ec2791&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;pcr_18&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;983ec7db975ed31e2c85ef8e375c038d6d307efb&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="917-sample-asset_tag-flavor">9.1.7  Sample ASSET_TAG Flavor</h3>
<p>Asset Tag flavor parts are unique to Asset Tag attestation. These
flavors verify that the Asset Tag data in the host’s TPM correctly
matches the most recently created, currently valid Asset Tag certificate
that has been deployed to that host.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;b3e0c056-5b6c-4b6b-95c4-de5f1473cac0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;ASSET_TAG&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hardware_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Hardware UUID of the server to be tagged&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;external&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;asset_tag&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;tag_certificate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;encoded&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Tag certificate in base64 encoded format&gt;&quot;</span><span class="p">,</span>
                <span class="nt">&quot;issuer&quot;</span><span class="p">:</span> <span class="s2">&quot;CN=assetTagService&quot;</span><span class="p">,</span>
                <span class="nt">&quot;serial_number&quot;</span><span class="p">:</span> <span class="mi">1519153541461</span><span class="p">,</span>
                <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Hardware UUID of the server to be tagged&gt;&quot;</span><span class="p">,</span>
                <span class="nt">&quot;not_before&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-20T11:05:41-0800&quot;</span><span class="p">,</span>
                <span class="nt">&quot;not_after&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-20T11:05:41-0800&quot;</span><span class="p">,</span>
                <span class="nt">&quot;fingerprint_sha384&quot;</span><span class="p">:</span> <span class="s2">&quot;46001d8472e56de423aac7c55f061404d27d50e497dfc21a861ef1965d7ac1e44887aee918fb5805385a3cbdf820899d&quot;</span><span class="p">,</span>
                <span class="nt">&quot;attribute&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="92-flavor-matching">9.2  Flavor Matching</h2>
<p>Flavors are matched to host by objects called <code>Flavor Groups</code> A Flavor
Group represents a set of rules to satisfy for a set of flavors to be
matched to a host for attestation. For example, a Flavor Group can
require that a <code>PLATFORM</code> Flavor and an <code>OS</code> Flavor be used for attestation.
Without this level of association, a host that matches measurements for
only a <code>PLATFORM</code> flavor, for example, can be attested as Trusted, even
though the OS Flavor would attest the host as Untrusted.</p>
<p>Flavor matching can be automatic (the default), or can explicitly
specify a host to which the Flavor Group must apply.</p>
<p>Automatic flavor matching allows for more ease in datacenter lifecycle
management with updates and patches that may cause the appropriate
flavors to change over time. Automatic flavor matching will trigger a
new matching action when a new flavor is added, when an existing flavor
is deleted, or when a host is initially attested as Untrusted. The
system will automatically attempt to find a new set of flavors that
match the Flavor Group rules that will attest the host as Trusted. For
example, if a host in your datacenter has recently had a BIOS update,
the next attestation will cause the host to appear Untrusted (because
the <code>PLATFORM</code> measurements will now differ). Using automatic flavor
matching, the Verification Service will automatically search for a new
<code>PLATFORM</code> flavor that matches the actual BIOS version and measurement
seen on the host. If a new BIOS version is successfully found, the
Verification Service will use the new version for attestation, and the
host will appear Trusted. If no matching <code>PLATFORM</code> flavor is found, the
host will appear Untrusted. When automatic flavor matching is used,
think of the various flavors in the Verification Service as a collection
of valid configurations, and an attested host matching any combination
of those configurations (within the confines of the Flavor Group
requirements for which flavor types must be present) will be attested as
Trusted.</p>
<p>Host-based flavor matching explicitly maps a specific host to a flavor.
Host-based attestation requires that a host saves its entire
configuration in a composite flavor document in the system, and then
later validates against this flavor to detect any changes. In this case,
if a host received a BIOS upgrade, the host will attest as Untrusted,
and no attempt will be made to re-match a new flavor. An administrator
will need to explicitly specify a new flavor to be used for that host.</p>
<h3 id="921-when-does-flavor-matching-happen">9.2.1  When Does Flavor Matching Happen?</h3>
<p>Generally speaking, a new Flavor match operation is triggered whenever a
host is registered, whenever a host is attested and would be untrusted,
and whenever a Flavor is added to or removed from a Flavor group.</p>
<p>When a new host is registered, the Verification Service will retrieve
the Host Report and derive the platform information needed for Flavor
matching (BIOS version, server OEM, OS type and version, TPM version,
etc.). The Verification Service then searches through the Flavors in the
same Flavor group that the host is in, and finds any Flavors that match
the platform information.</p>
<p>If a Flavor is deleted, the Verification Service finds any hosts that
are currently associated with that Flavor, and attempts to match them to
alternative Flavors.</p>
<p>If a Flavor is added, the Verification Service looks for any hosts in
the same Flavor group that are not currently matched to a Flavor of the
appropriate Flavor part, and checks to see whether those hosts should be
mapped to the new Flavor.</p>
<p>If a new Report is generated for a host and would not result in a
Trusted attestation, the Verification Service will first repeat the
Flavor matching process to be sure that no matching Flavors exist in the
host’s Flavor group that would result in a Trusted attestation. If the
Service still finds no matching Flavors, the host will appear as
Untrusted.</p>
<h3 id="922-flavor-matching-performance">9.2.2  Flavor Matching Performance</h3>
<p>Flavor matching causes affected hosts to be moved into the <code>QUEUE</code> state
while the host and Flavor are evaluated to determine whether the host
and Flavor should be linked. Hosts can remain in the QUEUE state for
varying amounts of time based on the extent of the Flavor match
required. This means that the trust status of a host will not be
actually updated to reflect a new Flavor until after the process
finishes, which may take a few seconds or minutes depending on the
number of registered hosts, Flavors in the same Flavorgroup, etc.</p>
<p>If a new host is registered, only that host will be added to the queue,
and other hosts will be unaffected. The Verification Service will look
for only the <code>HOST\_UNIQUE</code> flavor part applicable to that specific host,
and then will look at all PLATFORM and OS Flavors in the same
Flavorgroup has the host, using the Flavor metadata and host info to
narrow the results. The Service will match the new host to the most
similar Flavors, and then move the host to the <code>CONNECTED</code> state and
generate a new trust report.</p>
<p>When a new PLATFORM or OS Flavor is created, the Service will instead
add all hosts in the same Flavorgroup as the new Flavors to the queue.
Each host in the queue will then be re-evaluated against every <code>PLATFORM</code> and <code>OS</code> Flavor in the Flavorgroup to determine the closest match.</p>
<p>This means that adding a new Flavor can cause more hosts to each spend
more time in the QUEUE state, as compared to adding a new host. For this
reason, as a best practice for initial population of Flavors and hosts
for a new deployment, it is suggested that Flavors be created before
registering hosts. This is not a concern after the initial population of
Flavors and hosts.</p>
<h3 id="923-flavor-groups">9.2.3  Flavor Groups</h3>
<p>Flavor Groups represent a collection of one or more Flavors that are
possible matches for a collection of one or more hosts. Flavor Groups
link to both Flavors and hosts – a host in Flavor Group "ABC" will only
be matched to Flavors in Flavor Group "ABC"</p>
<h3 id="924-default-flavor-group">9.2.4  Default Flavor Group</h3>
<p>By default the Verification Service includes a Flavor Group named
<code>automatic</code> and another named <code>unique</code> During host registration, the
<code>automatic</code> Flavor Group is used as a default selection if no other
Flavor Group is specified.</p>
<h4 id="9241-automatic">9.2.4.1  automatic</h4>
<p>The automatic Flavor Group is used as the default Flavor Group for all
hosts and all Flavor parts. If no other Flavor Groups are specified when
creating Flavors or Hosts, all Hosts and Flavors will be added to this
group. This is useful for datacenters that want to manage a single set
of acceptable configurations for all hosts.</p>
<h4 id="9242-unique">9.2.4.2  unique</h4>
<p>The unique Flavor Group is used to contain <code>HOST\_UNIQUE</code> Flavors. This
Flavorgroup is used by the backend software and should not be managed
manually.</p>
<h3 id="925-flavor-match-policies">9.2.5  Flavor Match Policies</h3>
<p>Flavor Match Policies are used to define how the Flavor Match engine
will match Flavors to hosts for attestation for a given Flavor Group.
Each Flavor part can have defined Flavor Match Policies within a given
Flavor Group.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;OS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;HOST_UNIQUE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;SOFTWARE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The sample Policy above would require that a <code>PLATFORM</code> Flavor part be
matched, but any <code>PLATFORM</code> Flavor part in the Flavor Group may be
matched. The <code>OS</code> Flavor Part will only be required if there is an <code>OS</code> Flavor part in the Flavor Group; if there are no <code>OS</code> Flavor parts in the
Group, the match will not be required. If more than one <code>OS</code> Flavor part
exists in the Group, all of those <code>OS</code> parts will be required to match for
a host to be Trusted.</p>
<h4 id="9251-default-flavor-match-policy">9.2.5.1  Default Flavor Match Policy</h4>
<p>The <code>automatic</code> Flavor Group, and any Flavor Group created without
explicitly defining a Flavor Match Policy, will be created using the
following Flavor Match Policy. This is the default behavior for Flavor
Matching:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;OS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;HOST_UNIQUE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;SOFTWARE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="9252-any_of">9.2.5.2  ANY_OF</h4>
<p>The <code>ANY_OF</code> Policy allows any Flavor of the specified Flavor part to be
matched. If the Flavor Group contains OS Flavor 1 and OS Flavor 2, a
host will be Trusted if it matches either OS Flavor 1 or OS Flavor 2.</p>
<h4 id="9253-all_of">9.2.5.3  ALL_OF</h4>
<p>The <code>ALL_OF</code> Policy requires all Flavors of the specified Flavor Part in
the Flavor Group to be matched. For example, if Flavor Group X contains
PLATFORM Flavor Part 1 and <code>PLATFORM</code> Flavor Part 2, a host in Flavor
Group X will need to match both <code>PLATFORM</code> Flavor 1 and <code>PLATFORM</code> Flavor 2
to attest as Trusted. If the host matches only one of the Flavors, or
neither of them, the host will be attested as Untrusted.</p>
<h4 id="9254-latest">9.2.5.4  LATEST</h4>
<p>The <code>LATEST</code> Policy requires that the most recently created Flavor of the
specified Flavor part be used when matching to a host. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required_if_defined&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ASSET_TAG</code> Flavor parts by default use the above Policy. This means that
if Asset Tag Flavors are in the Flavor Group, the most recently created
Asset Tag Flavor will be used. If no Asset Tag Flavors are present in
the Flavor Group, then this Flavor part will be ignored.</p>
<h4 id="9255-required">9.2.5.5  REQUIRED</h4>
<p>The <code>REQUIRED</code> Policy requires a Flavor of the specified part to be
matched. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>This policy means that a <code>PLATFORM</code> Flavor part must be used; if the
Flavor Group contains no <code>PLATFORM</code> Flavor parts, hosts in this Flavor
Group will always count as Untrusted.</p>
<h4 id="9256-required_if_defined">9.2.5.6  REQUIRED_IF_DEFINED</h4>
<p>The <code>REQUIRED_IF_DEFINED</code> Policy requires that a Flavor part be used if
a Flavor of that part exists. If no Flavor part of this type exists in
the Flavor Group, the Flavor part will not be required.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required_if_defined&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ASSET_TAG</code> Flavor parts by default use the above Policy. This means that
if Asset Tag Flavors are in the Flavor Group, the most recently created
Asset Tag Flavor will be used. If no Asset Tag Flavors are present in
the Flavor Group, then this Flavor part will be ignored.</p>
<h3 id="926-flavor-match-event-triggers">9.2.6  Flavor Match Event Triggers</h3>
<p>Several events will cause the background queue service to attempt to
re-match Flavors and hosts:</p>
<ol>
<li>
<p>Host registration</p>
<p>This event is the first time a host will be attempted to be matched to
appropriate Flavors in the same Flavor Group, and affects only the host
that was added (other hosts will not be re-matched to Flavors when you
add a new host).</p>
</li>
<li>
<p>Flavor creation</p>
<p>When a new Flavor is added to a Flavor Group, the queue system will
repeat the Flavor match operation for all hosts in the same Flavor Group
as the new Flavor.</p>
</li>
<li>
<p>Flavor deletion</p>
<p>When a Flavor is deleted, the queue system will repeat the Flavor match
operation for all hosts in the same Flavor Group as the deleted Flavor.</p>
</li>
<li>
<p>Creation of a new Attestation Report</p>
<p>When a new Attestation Report is generated, if the host would attest as
Untrusted with the currently-matched Flavors, the host being attested
will be re-matched as part of the Report generation process. This
ensures that Reports are always generated using the best possible Flavor
matches available in the database.</p>
</li>
</ol>
<h3 id="927-sample-flavorgroup-api-calls">9.2.7  Sample Flavorgroup API Calls</h3>
<h4 id="9271-create-a-new-flavorgroup">9.2.7.1  Create a New Flavorgroup</h4>
<div class="highlight"><pre><span></span><code>POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/flavorgroups
Authorization: Bearer &lt;token&gt;

{
    &quot;flavorgroup_name&quot;: &quot;firstTest&quot;,
    &quot;flavor_match_policy_collection&quot;: {
        &quot;flavor_match_policies&quot;: [
            {
                &quot;flavor_part&quot;: &quot; PLATFORM&quot;,
                &quot;match_policy&quot;: {
                    &quot;match_type&quot;: &quot;ANY_OF&quot;,
                    &quot;required&quot;: &quot;REQUIRED&quot;
                }
            }
        ]
    }
}
</code></pre></div>
<p>Response:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;a0950923-596b-41f7-b9ad-09f525929ba1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span><span class="p">:</span> <span class="s2">&quot;firstTest&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavor_match_policy_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavor_match_policies&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot; PLATFORM&quot;</span><span class="p">,</span>
                <span class="nt">&quot;match_policy&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;match_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ANY_OF&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="s2">&quot;REQUIRED&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="93-software-flavor-management">9.3  SOFTWARE Flavor Management</h2>
<h3 id="931-what-is-a-software-flavor">9.3.1  What is a SOFTWARE Flavor?</h3>
<p>A <code>SOFTWARE</code> Flavor part defines the measurements expected for a specific
application, or a specific set of files and folders on the physical
host. <code>SOFTWARE</code> Flavors can be used to attest the boot-time integrity of
any static files or folders on a physical server.</p>
<p>A single server can have multiple SOFTWARE Flavors associated. Intel®
SecL-DC provides a <code>default</code> SOFTWARE Flavor that is deployed to each
Trust Agent server during the provisioning step. This default Flavor
includes the static files and folders of the Trust Agent itself, so that
the Trust Agent is measured during the server boot process, and its
integrity is included in the attestation of the other server
measurements.</p>
<p>Using <code>SOFTWARE</code> Flavors consists of two parts – creating the actual
<code>SOFTWARE</code> Flavor, and deploying the <code>SOFTWARE</code> Flavor manifest to the host.</p>
<h3 id="932-creating-a-software-flavor-part">9.3.2  Creating a SOFTWARE Flavor part</h3>
<p>Creating a new <code>SOFTWARE</code> Flavor requires creating a manifest of the files
and folders that need to be measured.</p>
<p>There are three different types of entries for the manifest:
<code>Directories</code>, <code>Symlinks</code>and <code>Files</code>.</p>
<h4 id="9321-directories">9.3.2.1  Directories</h4>
<p>A Directory defines measurement rules for measuring a directory.
Effectively this involves listing the contents of the directory and
hashing the results; in this way, a Directory measurement can verify
that no files have been added or removed from the directory specified,
but will not measure the integrity of individual files (ie, files can
change within the directory, but cannot be renamed, added, or removed).</p>
<p>Directory entries can use regular expressions to define explicit Include
and Exclude filters. For example, <code>Exclude=\*.log</code> would exclude all
files ending with .log from the measurement, meaning files with the .log
extension can be added or removed from the directory.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Dir</span> <span class="na">Type=</span><span class="s">&quot;dir&quot;</span> <span class="na">Include=</span><span class="s">&quot;.*&quot;</span> <span class="na">Exclude=</span><span class="s">&quot;&quot;</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/hypertext/WEB-INF&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h4 id="9322-symlinks">9.3.2.2  Symlinks</h4>
<p>A Symlink entry defines a symbolic link that will be measured. The
actual symbolic link is hashed, not the file or folder the symlink
points to. In this way, the measurement will detect the symbolic link
being modified to point to a different location, but the actual file or
folder pointed to can have its contents change.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Symlink</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/bin/tpm_nvinfo&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h4 id="9323-files">9.3.2.3  Files</h4>
<p>Individual files can be explicitly specified for measurement as well.
Each file listed will be hashed and extended separately. This means that
if any file explicitly listed this way changes its contents or is
deleted or moved, the measurement will change, and the host will become
Untrusted.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;File</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/bin/module_analysis_da.sh&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h3 id="933-sample-software-flavor-creation-call">9.3.3  Sample SOFTWARE Flavor Creation Call</h3>
<p>Creating a new <code>SOFTWARE</code> Flavor requires specifying a sample host where
the application, files or folders that will be measured are currently
present. The measurements specified in the manifest will be captures
when this call is executed, and the Verification Service will
communicate with the Trust Agent and create a <code>SOFTWARE</code> Flavor based on
the file measurements.</p>
<p>The Connection String must point to the sample Trust Agent host. The
Label defines the name of the new Flavor (ideally this should be the
name of the application being measured for easier management).</p>
<div class="highlight"><pre><span></span><code>POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/flavor-from-app-manifest
Authorization: Bearer &lt;token&gt;

&lt;ManifestRequest xmlns=&quot;lib:wml:manifests-req:1.0&quot;&gt;
    &lt;connectionString&gt;intel:https://trustagent.server.com:1443;u=trustagentUsername;p=trustagentPassword&lt;/connectionString&gt;
    &lt;Manifest xmlns=&quot;lib:wml:manifests:1.0&quot; DigestAlg=&quot;SHA384&quot; Label=&quot;Tomcat&quot; Uuid=&quot;&quot;&gt;+
        &lt;Dir Type=&quot;dir&quot; Include=&quot;.*&quot; Exclude=&quot;&quot; Path=&quot;/opt/trustagent/hypertext/WEB-INF&quot; /&gt;
        &lt;Symlink Path=&quot;/opt/trustagent/bin/tpm_nvinfo&quot; /&gt;
        &lt;File Path=&quot;/opt/trustagent/bin/module_analysis_da.sh&quot; /&gt;
    &lt;/Manifest&gt;
&lt;/ManifestRequest&gt;
</code></pre></div>
<h3 id="934-deploying-a-software-flavor-manifest-to-a-host">9.3.4  Deploying a SOFTWARE Flavor Manifest to a Host</h3>
<p>Once the SOFTWARE Flavor has been created, it can be deployed to any
number of Trust Agent servers. This requires the Flavor ID (returned
from Flavor creation) and the Host ID (returned from host registration).
The Verification Service will send a request to the appropriate Trust
Agent and create the manifest.</p>
<blockquote>
<p><strong>Note</strong>: After the SOFTWARE Flavor manifest is deployed to a host,
the host <strong>must</strong> be rebooted. This will allow the measurements
specified in the Flavor to be taken and extended to the TPM. Until the
host is rebooted, the host will now appear Untrusted, as it now
requires measurements from a SOFTWARE Flavor that have not yet been
extended to the TPM.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/rpc/deploy-software-manifest
Authorization: Bearer &lt;token&gt;

{  
   &quot;flavor_id&quot;:&quot;a6544ff4-6dc7-4c74-82be-578592e7e3ba&quot;,  
   &quot;host_id&quot;:&quot;a6544ff4-6dc7-4c74-82be-578592e7e3ba&quot;
}
</code></pre></div>
<h3 id="935-software-flavor-matching">9.3.5  SOFTWARE Flavor Matching</h3>
<p>The default Flavor Match Policy for SOFTWARE Flavor parts is
<code>ALL_OF</code>,<code>REQUIRED_IF_DEFINED</code>. This means that all Software Flavors
defined in a Flavorgroup must match to all hosts in that Flavorgroup. If
no SOFTWARE Flavors are in the Flavorgroup, then hosts can still be
considered Trusted.</p>
<p>Because the default uses the <code>ALL_OF</code> Policy, it’s recommended to use
Flavorgroups dedicated to specific software loadouts. For example, if a
number of hosts will act as virtualization hosts and will have <code>SOFTWARE</code>
Flavors for the hypervisor and VM management applications, those hosts
should be placed in their own Flavorgroup as they will all run similar
or identical application loadouts. If another group of servers in the
datacenter will act as container hosts, these hosts might need <code>SOFTWARE</code> Flavors that include attestation of container runtimes and management
applications, and will have a very different application loadout from
the VM-based hosts. These should be placed in their own Flavorgroup, so
that the VM hosts are attested using the hypervisor-related <code>SOFTWARE</code> Flavors, and the container hosts are attested using the
container-related <code>SOFTWARE</code> Flavors.</p>
<p>As with other Flavor parts, hosts will be matched to Flavors in the same
Flavorgroup that the host is added to, and will not be matched to
Flavors in different Flavorgroups. Flavor matching will happen on the
same events as for other Flavor parts.</p>
<h3 id="936-kernel-upgrades">9.3.6  Kernel Upgrades</h3>
<p>Because the Application Integrity functionality involves adding a
measurement agent (<code>tbootXM</code>) to <code>initrd</code>, an additional process must be
followed when updating the OS kernel to ensure the new initrd also
contains the measurement agent. This is not required if Application
Integrity will not be used.</p>
<ol>
<li>
<p>Update grub to have the boot menu-entry created for the new kernel
    version in grub.cfg (<code>grub2-mkconfig -o \&lt;path to grub file\&gt;</code>)</p>
</li>
<li>
<p>Reboot the host and boot into new kernel menu-entry.</p>
</li>
<li>
<p>Generate a new initrd with tbootXM.
    (<code>/opt/tbootxm/bin/generate\_initrd.sh</code>)</p>
</li>
<li>
<p>Copy the generated initrd to the boot drectory. (<code>cp
    /var/tbootxm/\&lt;generated initrd file name\&gt; /boot/</code>)</p>
</li>
<li>
<p>Update the <code>TCB protection</code> menu-entry with the new kernel version.</p>
<ol>
<li>
<p>Source <code>rustagent.env</code>, or</p>
<div class="highlight"><pre><span></span><code><span class="err">expor</span><span class="kc">t</span> <span class="err">GRUB_FILE=/boo</span><span class="kc">t</span><span class="err">/e</span><span class="kc">f</span><span class="err">i/EFI/redha</span><span class="kc">t</span><span class="err">/grub.c</span><span class="kc">f</span><span class="err">g</span>
</code></pre></div>
</li>
<li>
<p>Run the configure_host script:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /opt/tbootxm/bin  
./configure_host.sh
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>Update the default boot menu-entry to have new kernel version. (edit
   <code>/etc/default/grub</code>)</p>
</li>
<li>
<p>Update the grub to reflect the updates. (<code>grub2-mkconfig -o \&lt;path to
   grub file\&gt;</code>)</p>
</li>
<li>
<p>Reboot the host and boot into TCB protection menu-entry.</p>
</li>
</ol>
<p>After updating the system with the new <code>initrd</code>, the Software Flavor
should attest as Trusted. Note that changing <code>grub</code> and <code>initrd</code> does result
in a new <code>OS</code> Flavor measurements, so an updated <code>OS</code> Flavor should be
imported after updating the kernel and regenerating <code>initrd</code>.</p>
<h1 id="10-scalability-and-sizing">10  Scalability and Sizing</h1>
<h2 id="101-configuration-maximums">10.1  Configuration Maximums</h2>
<h3 id="1011-registered-hosts">10.1.1  Registered Hosts</h3>
<p>The Intel® SecL Verification Service can support a maximum of 2000
registered hosts with a single Verification Service instance with
default settings.</p>
<h3 id="1012-hdd-space">10.1.2  HDD Space</h3>
<p>The HDD space recommendations below represent expected log and database
growth using default settings. Altering the database or log rotation
settings, or the SAML expiration setting, may change the amount of disk
space required. For default settings, 100 GB of disk space is
recommended.</p>
<h2 id="102-database-rotation-settings">10.2  Database Rotation Settings</h2>
<p>The Intel® SecL Verification Service database will automatically rotate
the audit log table after one million records, and will retain up to ten
total rotations. These settings are user-configurable if a longer
retention period is needed.</p>
<p><strong>mtwilson.audit.log.num.rotations</strong> - defines the maximum number of
rotations before the oldest rotation is deleted to make space for a new
rotation.</p>
<p><strong>mtwilson.audit.log.max.row.count</strong> – defines the maximum number of
rows in the audit log table before a rotation will occur.</p>
<h2 id="103-log-rotation">10.3  Log Rotation</h2>
<p>The Intel® SecL services (the Verification Service, Trust Agent, and
Integration Hub) use Logrotate to rotate logs automatically during a
daily cron job.</p>
<p>By default, logs are rotated once per month or when they exceed 1 GB in
size, whichever comes first, and 12 total rotations will be retained.</p>
<h1 id="11-intel-security-libraries-configuration-settings">11  Intel Security Libraries Configuration Settings</h1>
<h2 id="111-verification-service">11.1  Verification Service</h2>
<h3 id="1111-installation-answer-file-options">11.1.1  Installation Answer File Options</h3>
<div class="highlight"><pre><span></span><code># Authentication URL and service account credentials - mandatory
AAS_API_URL=https://isecl-aas:8444/aas
HVS_SERVICE_USERNAME=HVS_service
HVS_SERVICE_PASSWORD=password

# CMS URL and CMS webserivce TLS hash for server verification - mandatory
CMS_BASE_URL=https://isecl-cms:8445/cms/v1
CMS_TLS_CERT_SHA384=digest

# Installation admin bearer token for CSR approval request to CMS - mandatory
BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

# Skip setup - optional
HVS_NOSETUP=false #default=false

# Logging options - optional
HVS_LOGLEVEL=info              # options: critical|error|warning|info|debug|trace, default=&#39;info&#39;
HVS_LOG_MAX_LENGTH=300         # default=300
HVS_ENABLE_CONSOLE_LOG=false   # default=false

# HRRS configuration - optional
HRRS_REFRESH_PERIOD=2m0s       # default=2m0s
HRRS_REFRESH_LOOK_AHEAD=5m0s   # default=5m0s

# FVS configuration - optional
FVS_NUMBER_OF_VERIFIERS=20                    # default=20
FVS_NUMBER_OF_DATA_FETCHERS=20                # default=20
FVS_SKIP_FLAVOR_SIGNATURE_VERIFICATION=false  # default=false

# In case of trusted flavor storage, flavor signature verification can be skipped
# using following flag - optional
SKIP_FLAVOR_SIGNATURE_VERIFICATION=false # default=false

# TLS certificate configuration - optional
TLS_COMMON_NAME=&quot;HVS TLS Certificate&quot;      # default=&quot;HVS TLS Certificate&quot;
TLS_SAN_LIST=127.0.0.1,localhost           # default=127.0.0.1,localhost

# Server configuration - optional
HVS_PORT=8443                        # default=8443
HVS_SERVER_READ_TIMEOUT=30s          # default=30s
HVS_SERVER_READ_HEADER_TIMEOUT=10s   # default=10s
HVS_SERVER_WRITE_TIMEOUT=10s         # default=10s
HVS_SERVER_IDLE_TIMEOUT=10s          # default=10s
HVS_SERVER_MAX_HEADER_BYTES=1048576  # default=1048576

# Database - mandatory
HVS_DB_USERNAME=runner
HVS_DB_PASSWORD=test
HVS_DB_SSLCERTSRC=/tmp/dbcert.pem          # This doesn&#39;t need to be specified if HVS_DB_SSLCERT is given

# Database - optional
HVS_DB_HOSTNAME=localhost                  # default=localhost
HVS_DB_NAME=hvs-pg-db                      # default=hvs-pg-db
HVS_DB_PORT=5432                           # default=5432
HVS_DB_SSLMODE=verify-full                 # default=verify-full ;other options are like allow, prefer, require, verify-ca
HVS_DB_SSLCERT=/etc/hvs/hvsdbcert.pem      # default=/etc/hvs/hvsdbcert.pem

# Webservice configuration - Optional
HVS_PORT=8443
HVS_SERVER_READ_TIMEOUT=30s
HVS_SERVER_READ_HEADER_TIMEOUT=10s
HVS_SERVER_WRITE_TIMEOUT=10s
HVS_SERVER_IDLE_TIMEOUT=10s
HVS_SERVER_MAX_HEADER_BYTES=1048576

# Logging - Optional
HVS_LOG_MAX_LENGTH=300
HVS_ENABLE_CONSOLE_LOG=false

# Flavor Signing Configuration - Optional
FLAVOR_SIGNING_KEY_FILE=/etc/hvs/trusted-keys/flavor-signing.key
FLAVOR_SIGNING_CERT_FILE=/etc/hvs/certs/trustedca/flavor-signing.pem
FLAVOR_SIGNING_COMMON_NAME=HVS Flavor Signing Certificate

# SAML Configuration - Optional
SAML_KEY_FILE=/etc/hvs/trusted-keys/saml.key
SAML_CERT_FILE=/etc/hvs/certs/trustedca/saml-cert.pem
SAML_COMMON_NAME=HVS SAML Certificate

# Endorsement CA Configuration - Optional
ENDORSEMENT_CA_KEY_FILE=/etc/hvs/trusted-keys/endorsement-ca.key
ENDORSEMENT_CA_CERT_FILE=/etc/hvs/certs/trustedca/EndorsementCA.pem
ENDORSEMENT_CA_COMMON_NAME=HVS Endorsement Certificate
ENDORSEMENT_CA_ISSUER=intel-secl
ENDORSEMENT_CA_VALIDITY_YEARS=5

# Privacy CA Configuration - Optional
PRIVACY_CA_KEY_FILE=/etc/hvs/trusted-keys/privacy-ca.key
PRIVACY_CA_CERT_FILE=/etc/hvs/certs/trustedca/privacy-ca-cert.pem
PRIVACY_CA_COMMON_NAME=HVS Privacy Certificate
PRIVACY_CA_ISSUER=intel-secl
PRIVACY_CA_VALIDITY_YEARS=5

# Asset Tag Configuration - Optional
TAG_CA_KEY_FILE=/etc/hvs/trusted-keys/tag-ca.key
TAG_CA_CERT_FILE=/etc/hvs/certs/trustedca/tag-ca-cert.pem
TAG_CA_COMMON_NAME=HVS Tag Certificate
TAG_CA_ISSUER=intel-secl
TAG_CA_VALIDITY_YEARS=5
</code></pre></div>
<h3 id="1112-configuration-options">11.1.2  Configuration Options</h3>
<p>The Verification Service configuration is stored in the
file <code>/etc/hvs/config.yml</code>:</p>
<div class="highlight"><pre><span></span><code>tls:
  cert-file: /etc/hvs/tls-cert.pem
  key-file: /etc/hvs/tls.key
  common-name: Mt Wilson TLS Certificate
  san-list: 127.0.0.1,localhost
saml:
  common:
    cert-file: /etc/hvs/certs/trustedca/saml-cert.pem
    key-file: /etc/hvs/trusted-keys/saml.key
    common-name: mtwilson-saml
  issuer: AttestationService
  validity-days: 1
flavor-signing:
  cert-file: /etc/hvs/certs/trustedca/flavor-signing.pem
  key-file: /etc/hvs/trusted-keys/flavor-signing.key
  common-name: VS Flavor Signing Certificate
privacy-ca:
  cert-file: /etc/hvs/certs/trustedca/privacy-ca/privacy-ca-cert.pem
  key-file: /etc/hvs/trusted-keys/privacy-ca.key
  common-name: HVS Privacy Certificate
  issuer: intel-secl
  validity-years: 5
endorsement-ca:
  cert-file: /etc/hvs/certs/endorsement/EndorsementCA.pem
  key-file: /etc/hvs/trusted-keys/endorsement-ca.key
  common-name: HVS Endorsement Certificate
  issuer: intel-secl
  validity-years: 5
tag-ca:
  cert-file: /etc/hvs/certs/trustedca/tag-ca-cert.pem
  key-file: /etc/hvs/trusted-keys/tag-ca.key
  common-name: HVS Tag Certificate
  issuer: intel-secl
  validity-years: 5
aik-certificate-validity-years: 5
server:
  port: 8898
  read-timeout: 30s
  read-header-timeout: 10s
  write-timeout: 30s
  idle-timeout: 10s
  max-header-bytes: 1048576
log:
  max-length: 30000
  enable-stdout: true
  level: TRACE
db:
  vendor: postgres
  host: localhost
  port: &quot;5432&quot;
  name: hvs_db
  username: root
  password: password
  ssl-mode: allow
  ssl-cert: /etc/hvs/hvsdbsslcert.pem
  conn-retry-attempts: 5
  conn-retry-time: 1
hrrs:
  refresh-period: 2m0s
  refresh-look-ahead: 5m0s
fvs:
  number-of-verifiers: 20
  number-of-data-fetchers: 20
  skip-flavor-signature-verification: true                    
</code></pre></div>
<h3 id="1113-command-line-options">11.1.3  Command-Line Options</h3>
<p>The Verification Service supports several command-line commands that can
be executed only as the Root user:</p>
<p>Syntax:</p>
<p><code>hvs &lt;command&gt;</code></p>
<h4 id="11131-help">11.1.3.1  Help</h4>
<p><code>hvs help</code></p>
<p>Displays the list of available CLI commands.</p>
<h4 id="11132-start">11.1.3.2  Start</h4>
<p><code>hvs start</code></p>
<p>Starts the services.</p>
<h4 id="11133-stop">11.1.3.3  Stop</h4>
<p><code>hvs stop</code></p>
<p>Stops the services.</p>
<h4 id="11135-status">11.1.3.5  Status</h4>
<p><code>hvs status</code></p>
<p>Reports whether the service is currently running.</p>
<h4 id="11136-uninstall">11.1.3.6  Uninstall</h4>
<p><code>hvs uninstall</code></p>
<p>Uninstalls the service, including the deletion of all files and folders.
Database content is not removed. See section 14.1 for additional
details.</p>
<h4 id="11137-version">11.1.3.7  Version</h4>
<p><code>hvs version</code></p>
<p>Reports the version of the service.</p>
<h4 id="111310-erase-data">11.1.3.10  Erase-data</h4>
<p><code>hvs erase-data</code></p>
<p>Deletes all non-user information from the database.  All data in teh following tables will be deleted; the database schema will be preserved:</p>
<div class="highlight"><pre><span></span><code> flavor_host 
 flavor_flavorgroup
 flavorgroup_host
 queue
 report
 host_status
 flavorgroup
 host
 flavor
 host_credential
 tag_certificate
 audit_log_entry
 tls_policy
</code></pre></div>
<h4 id="111316-setup">11.1.3.16  Setup</h4>
<p><code>hvs setup &lt;task&gt; [--help] [--force] [-f &lt;answer-file&gt;]</code></p>
<p>​                --help                      show help message for setup task</p>
<p>​                --force                     existing configuration will be overwritten if this flag is set</p>
<p>​                -f|--file <answer-file>     the answer file with required argument</p>
<p>Re-runs the installation setup tasks, or the specific tasks listed.</p>
<h3 id="1114-directory-layout">11.1.4  Directory Layout</h3>
<p>The Host Verification Service installs by default to  the
following folders:</p>
<p>/etc/hvs/</p>
<p>This directory contains the config.yml configuration file, the database connection ssl cerificate, and the webservice TLS certificate.</p>
<p>/etc/hvs/</p>
<p>├── certs</p>
<p>│   ├── endorsement</p>
<p>│   │   ├── EndorsementCA-external.pem</p>
<p>│   │   └── EndorsementCA.pem</p>
<p>│   ├── trustedca</p>
<p>│   │   ├── flavor-signing.pem</p>
<p>│   │   ├── privacy-ca</p>
<p>│   │   │   └── privacy-ca-cert.pem</p>
<p>│   │   ├── root</p>
<p>│   │   │   ├── 58f6bcfcd.pem</p>
<p>│   │   │   ├── vmware-cert1.pem</p>
<p>│   │   │   └── vmware-cert2.pem</p>
<p>│   │   ├── saml-cert.pem</p>
<p>│   │   └── tag-ca-cert.pem</p>
<p>│   └── trustedjwt</p>
<p>│       └── f29aa4ab3.pem</p>
<p>├── config.yml</p>
<p>├── hvsdbsslcert.pem</p>
<p>├── tls-cert.pem</p>
<p>├── tls.key</p>
<p>└── trusted-keys</p>
<p>​    ├── endorsement-ca.key</p>
<p>​    ├── flavor-signing.key</p>
<p>​    ├── privacy-ca.key</p>
<p>​    ├── saml.key</p>
<p>​    └── tag-ca.key</p>
<h2 id="112-trust-agent">11.2  Trust Agent</h2>
<h3 id="1121-installation-answer-file-options">11.2.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAS_API_URL</td>
<td>AAS_API_URL=https://{host}:{port}/aas/v1</td>
<td>API URL for Authentication Authorization Service (AAS).</td>
</tr>
<tr>
<td>AUTOMATIC_PULL_MANIFEST</td>
<td>AUTOMATIC_PULL_MANIFEST=Y</td>
<td>Instructs the installer to automatically pull application-manifests from HVS similar to tagent setup get-configured-manifest</td>
</tr>
<tr>
<td>AUTOMATIC_REGISTRATION</td>
<td>AUTOMATIC_REGISTRATION=Y</td>
<td>Instructs the installer to automatically register the host with HVS similar to running tagent setup create-host and tagent setup create-host-unique-flavor.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsjdkMTdiNmUz...</td>
<td>JWT from AAS that contains "install" permissions needed to access ISecL services during provisioning and registration</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td>CMS_BASE_URL=https://{host}:{port}/cms/v1</td>
<td>API URL for Certificate Management Service (CMS).</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td>CMS_TLS_CERT_SHA384=bd8ebf5091289958b5765da4...</td>
<td>SHA384 Hash sum for verifying the CMS TLS certificate.</td>
</tr>
<tr>
<td>MTWILSON_API_URL</td>
<td>MTWILSON_API_URL=https://{host}:{port}/hvs/v2</td>
<td>The url used during setup to request information from HVS.</td>
</tr>
<tr>
<td>PROVISION_ATTESTATION</td>
<td>PROVISION_ATTESTATION=Y</td>
<td>When present, enables/disables whether tagent setup is called during installation. If trustagent.env is not present, the value defaults to no ('N').</td>
</tr>
<tr>
<td>SAN_LIST</td>
<td>SAN_LIST=10.123.100.1,201.102.10.22,mya.example.com</td>
<td>CSV list that sets the value for SAN list in the TA TLS certificate. Defaults to 127.0.0.1.</td>
</tr>
<tr>
<td>TA_TLS_CERT_CN</td>
<td>TA_TLS_CERT_CN=Acme Trust Agent 007</td>
<td>Sets the value for Common Name in the TA TLS certificate. Defaults to CN=trustagent.</td>
</tr>
<tr>
<td>TPM_OWNER_SECRET</td>
<td>TPM_OWNER_SECRET=625d6...</td>
<td>20 byte hex value to be used as the secret key when taking ownership of the TPM. <em>Note: If this field is not specified, GTA will generate a random secret key.</em></td>
</tr>
<tr>
<td>TPM_QUOTE_IPV4</td>
<td>TPM_QUOTE_IPV4=no</td>
<td>When enabled (=y), uses the local system's ip address as a salt when processing a quote nonce. This field must align with the configuration of HVS.</td>
</tr>
<tr>
<td>TA_SERVER_READ_TIMEOUT</td>
<td>TA_SERVER_READ_TIMEOUT=30</td>
<td>Sets tagent server ReadTimeout. Defaults to 30 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_READ_HEADER_TIMEOUT</td>
<td>TA_SERVER_READ_HEADER_TIMEOUT=10</td>
<td>Sets tagent server ReadHeaderTimeout. Defaults to 30 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_WRITE_TIMEOUT</td>
<td>TA_SERVER_WRITE_TIMEOUT=10</td>
<td>Sets tagent server WriteTimeout. Defaults to 10 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_IDLE_TIMEOUT</td>
<td>TA_SERVER_IDLE_TIMEOUT=10</td>
<td>Sets tagent server IdleTimeout. Defaults to 10 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_MAX_HEADER_BYTES</td>
<td>TA_SERVER_MAX_HEADER_BYTES=1048576</td>
<td>Sets tagent server MaxHeaderBytes. Defaults to 1MB(1048576)</td>
</tr>
<tr>
<td>TA_ENABLE_CONSOLE_LOG</td>
<td>TA_ENABLE_CONSOLE_LOG=true</td>
<td>When set true, tagent logs are redirected to stdout. Defaults to false</td>
</tr>
<tr>
<td>TRUSTAGENT_LOG_LEVEL</td>
<td>TRUSTAGENT_LOG_LEVEL=debug</td>
<td>The logging level to be saved in config.yml during installation ("trace", "debug", "info").</td>
</tr>
<tr>
<td>TRUSTAGENT_PORT</td>
<td>TRUSTAGENT_PORT=10433</td>
<td>The port on which the trust-agent service will listen.</td>
</tr>
</tbody>
</table>
<h3 id="1122-configuration-options">11.2.2  Configuration Options</h3>
<p>The Trust Agent configuration settings are managed in
<code>/opt/trustagent/configuration/config.yml</code></p>
<table>
<thead>
<tr>
<th><strong>Setting</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>tpmquoteipv4: true</td>
<td>When enabled, the Trust Agent will perform an additional hash of the nonce using the bytes from the Trust Agent server IP when returning TPM quotes. This should always be set to True.</td>
</tr>
<tr>
<td>logging:</td>
<td></td>
</tr>
<tr>
<td>loglevel: info</td>
<td>Defines the Trust Agent logging level</td>
</tr>
<tr>
<td>logenablestdout: false</td>
<td>If set to True, the Trust Agent will log to stdout. By default this is False and the logs are sent to /var/log/trustagent/trustagent.log</td>
</tr>
<tr>
<td>logentrymaxlength: 300</td>
<td>Defines the maximum length of a single log entry</td>
</tr>
<tr>
<td>webservice:</td>
<td></td>
</tr>
<tr>
<td>port: 1443</td>
<td>Defines the port on which the Trust Agent API server will listen</td>
</tr>
<tr>
<td>readtimeout: 30s</td>
<td></td>
</tr>
<tr>
<td>readheadertimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>writetimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>idletimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>maxheaderbytes: 1048576</td>
<td></td>
</tr>
<tr>
<td>hvs:</td>
<td></td>
</tr>
<tr>
<td>url: <a href="https://0.0.0.0:8443/hvs/v2">https://0.0.0.0:8443/hvs/v2</a></td>
<td>Defines the baseurl for the Verification Service</td>
</tr>
<tr>
<td>tpm:</td>
<td></td>
</tr>
<tr>
<td>ownersecretkey: 625d6d8...1be0b4e957</td>
<td>Defines the TPM ownership secret. This is randomly generated unless manually specified during installation in the trustagent.env file. Note that changing this value may require clearing the TPM ownership in the server BIOS.</td>
</tr>
<tr>
<td>aiksecretkey: 59acd1367...edcbede60c</td>
<td>Defines the AIK secret. Randomly generated. If this is changed, a new AIK will need to be provisioned.</td>
</tr>
<tr>
<td>aas:</td>
<td></td>
</tr>
<tr>
<td>baseurl: <a href="https://0.0.0.0:8444/aas/">https://0.0.0.0:8444/aas/</a></td>
<td>Defines the base URL for the AAS</td>
</tr>
<tr>
<td>cms:</td>
<td></td>
</tr>
<tr>
<td>baseurl: <a href="https://0.0.0.0:8445/cms/v1">https://0.0.0.0:8445/cms/v1</a></td>
<td>Defines the base URL for the CMS</td>
</tr>
<tr>
<td>tlscertdigest: 330086b3...ae477c8502</td>
<td>Defines the SHA383 hash of the CMS TLS certificate</td>
</tr>
<tr>
<td>tls:</td>
<td></td>
</tr>
<tr>
<td>certsan: 10.1.2.3,server.domain.com,localhost</td>
<td>Comma-separated list of hostnames and IP addresses for the Trust Agent. Used in the Agent TLS certificate.</td>
</tr>
<tr>
<td>certcn: Trust Agent TLS Certificate</td>
<td>Common Name for the Trust Agent TLS certificate</td>
</tr>
</tbody>
</table>
<h3 id="1123-command-line-options">11.2.3  Command-Line Options</h3>
<h4 id="11231-available-commands">11.2.3.1  Available Commands</h4>
<h5 id="112311-help">11.2.3.1.1  help</h5>
<p>Show the help message.</p>
<h5 id="112312-setup-task">11.2.3.1.2  setup [task]</h5>
<p>Run setup task. Available Tasks for 'setup':</p>
<h6 id="tagent-setup-all">tagent setup (all)</h6>
<p>- Runs all setup tasks to provision the trust agent.</p>
<p>- Required environment variables: AAS_API_URL, CMS_BASE_URL,</p>
<p>CMS_TLS_CERT_SHA384, BEARER_TOKEN, MTWILSON_API_URL</p>
<h6 id="tagent-setup-trustagentenv">tagent setup trustagent.env</h6>
<p>- Runs all setup tasks to provision the trust agent using
trustagent.env</p>
<p>file for environment variables (the file must contain all of the</p>
<p>required environment variables listed in 'tagent setup (all)'. See</p>
<p>"Environment variables" below).</p>
<h6 id="tagent-setup-download-ca-cert">tagent setup download-ca-cert</h6>
<p>- Fetches the latest CMS Root CA Certificates, overwriting existing</p>
<p>files.</p>
<p>- Required environment variables: BEARER_TOKEN, CMS_BASE_URL</p>
<h6 id="tagent-setup-download-cert">tagent setup download-cert</h6>
<p>- Fetches a signed TLS Certificate from CMS, overwriting existing</p>
<p>files.</p>
<p>- Required environment variables: CMS_BASE_URL,
CMS_TLS_CERT_SHA384</p>
<h6 id="tagent-setup-update-certificates">tagent setup update-certificates</h6>
<p>- Runs 'download-ca-cert' and 'download-cert'</p>
<p>- Required environment variables: CMS_BASE_URL,
CMS_TLS_CERT_SHA384, BEARER_TOKEN</p>
<h6 id="tagent-setup-provision-attestation">tagent setup provision-attestation</h6>
<p>- Runs setup tasks associated with HVS/TPM provisioning.</p>
<p>- Required environment variables: BEARER_TOKEN, MTWILSON_API_URL</p>
<h6 id="tagent-setup-create-host">tagent setup create-host</h6>
<p>- Registers the trust agent with the verification service.</p>
<p>- Required environment variables: BEARER_TOKEN, MTWILSON_API_URL</p>
<h6 id="tagent-setup-create-host-unique-flavor">tagent setup create-host-unique-flavor</h6>
<p>- Populates the verification service with the host unique flavor</p>
<p>- Required environment variables: BEARER_TOKEN, MTWILSON_API_URL</p>
<h6 id="tagent-setup-get-configured-manifest">tagent setup get-configured-manifest</h6>
<p>- Uses environment variables to pull application-integrity.</p>
<p>manifests from the verification service.</p>
<p>- Required Environment variables: BEARER_TOKEN, MTWILSON_API_URL,</p>
<p>FLAVOR_UUIDS or FLAVOR_LABELS</p>
<h6 id="environment-variables-used-by-tagent-setup">Environment variables used by tagent setup:</h6>
<p>* Indicates the environment variable is optional.</p>
<p>AAS_API_URL</p>
<p>- Used by the trust agent service to validate jwt/bearer tokens.</p>
<p>- Ex. AAS_API_URL=https://{host}:{port}/aas/v1</p>
<p>AUTOMATIC_PULL_MANIFEST*</p>
<p>- When 'Y', instructs the installer to download application manifests</p>
<p>using the FLAVOR_UUIDS or FLAVOR_LABELS environment variables by
running</p>
<p>'get-configured-manifest'. Defaults to 'N'.</p>
<p>- Ex. AUTOMATIC_PULL_MANIFEST=Y</p>
<p>AUTOMATIC_REGISTRATION*</p>
<p>- When 'Y', instructs the installer to register the host with HVS by</p>
<p>running 'create-host' and 'create-host-unique-flavor'. Defaults to 'N'.</p>
<p>- Ex. AUTOMATIC_REGISTRATION=Y</p>
<p>BEARER_TOKEN</p>
<p>- 'jwt' token used during setup to communicate to CMS and HVS.</p>
<p>- Ex. BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsjdkMTdiNmUz...</p>
<p>CMS_BASE_URL</p>
<p>- URL used by setup to download root-ca and tls certificates from</p>
<p>CMS.</p>
<p>- Ex. CMS_BASE_URL=https://{host}:{port}/cms/v1</p>
<p>CMS_TLS_CERT_SHA384</p>
<p>- SHA384 sum used during setup to secure communications with CMS.</p>
<p>- Ex. CMS_TLS_CERT_SHA384=bd8ebf5091289958b5765da4...</p>
<p>MTWILSON_API_URL</p>
<p>- The URL used during setup to collect information from HVS.</p>
<p>- MTWILSON_API_URL=https://{host}:{port}/hvs/v2</p>
<p>PROVISION_ATTESTATION*</p>
<p>- When 'Y', instructs the installer to provision the host with HVS by</p>
<p>calling 'tagent setup'. Defaults to 'N'.</p>
<p>- Ex. AUTOMATIC_REGISTRATION=Y</p>
<p>SAN_LIST*</p>
<p>- CSV list that sets the value for SAN list in the TA TLS certificate.</p>
<p>Defaults to "127.0.0.1,localhost".</p>
<p>- Ex. SAN_LIST=10.123.100.1,201.102.10.22,my.example.com</p>
<p>TA_ENABLE_CONSOLE_LOG*</p>
<p>- When set to 'true', trust agent logs are redirected to stdout.
Defaults</p>
<p>to false.</p>
<p>- Ex. TA_ENABLE_CONSOLE_LOG=true</p>
<p>TA_SERVER_IDLE_TIMEOUT*</p>
<p>- Sets the trust agent service's idle timeout. Defaults to 10 seconds.</p>
<p>- Ex. TA_SERVER_IDLE_TIMEOUT=10</p>
<p>TA_SERVER_MAX_HEADER_BYTES*</p>
<p>- Sets trust agent service's maximum header bytes. Defaults to 1MB.</p>
<p>- Ex. TA_SERVER_MAX_HEADER_BYTES=1048576</p>
<p>TA_SERVER_READ_TIMEOUT*</p>
<p>- Sets trust agent service's read timeout. Defaults to 30 seconds.</p>
<p>- Ex. TA_SERVER_READ_TIMEOUT=30</p>
<p>TA_SERVER_READ_HEADER_TIMEOUT*</p>
<p>- Sets trust agent service's read header timeout. Defaults to 30
seconds.</p>
<p>- Ex. TA_SERVER_READ_HEADER_TIMEOUT=10</p>
<p>TA_SERVER_WRITE_TIMEOUT*</p>
<p>- Sets trust agent service's write timeout. Defaults to 10 seconds.</p>
<p>- Ex. TA_SERVER_WRITE_TIMEOUT=10</p>
<p>TA_TLS_CERT_CN*</p>
<p>- Sets the value for Common Name in the TA TLS certificate. Defaults</p>
<p>to "Trust Agent TLS Certificate".</p>
<p>- Ex. TA_TLS_CERT_CN=Acme Trust Agent 007</p>
<p>TPM_OWNER_SECRET*</p>
<p>- When provided, setup uses the 40 character hex string for the TPM</p>
<p>owner password. The TPM owner secret is generated when not provided.</p>
<p>- Ex. TPM_OWNER_SECRET=625d6d8a18f98bf764760fa392b8c01be0b4e959</p>
<p>TPM_QUOTE_IPV4*</p>
<p>- When 'Y', used the local system's ip address a salt when processing</p>
<p>TPM quotes. Defaults to 'N'.</p>
<p>- Ex. TPM_QUOTE_IPV4=Y</p>
<p>TRUSTAGENT_LOG_LEVEL*</p>
<p>- Sets the verbosity level of logging (trace|debug|info|error).
Defaults</p>
<p>to 'info'.</p>
<p>- Ex. TRUSTAGENT_LOG_LEVEL=debug</p>
<p>TRUSTAGENT_PORT*</p>
<p>- The port on which the trust agent service will listen.</p>
<p>- Ex. TRUSTAGENT_PORT=10433</p>
<h5 id="112313-uninstall">11.2.3.1.3  uninstall</h5>
<p>Uninstall trust agent.</p>
<h5 id="112314-version">11.2.3.1.4  version</h5>
<p>Print build version info.</p>
<h5 id="112315-start">11.2.3.1.5  start</h5>
<p>Start the trust agent service.</p>
<h5 id="112316-stop">11.2.3.1.6  stop</h5>
<p>Stop the trust agent service.</p>
<h5 id="112327-status">11.2.3.2.7  status</h5>
<p>Get the status of the trust agent service.</p>
<h3 id="1124-directory-layout">11.2.4  Directory Layout</h3>
<h4 id="11241-windows">11.2.4.1  Windows</h4>
<h4 id="11242-linux">11.2.4.2 Linux</h4>
<p>The Linux Trust Agent installs by default to <code>/opt/trustagent</code>, with the
following subfolders:</p>
<h5 id="112421-bin">11.2.4.2.1  Bin</h5>
<p>Contains executables and scripts.</p>
<h5 id="112422-configuration">11.2.4.2.2  Configuration</h5>
<p>Contains the <code>config.yml</code> configuration file, as well as certificates and
keystores. This includes the AIK public key blob after provitioning.</p>
<h5 id="112423-var">11.2.4.2.3  Var</h5>
<p>Contains information gathered from the platform and SOFTWARE Flavor
manifests. All files with the name <code>manifest_*.xml</code> will be parsed to
define measurements during boot. Generally these should be automatically
provisioned from the Verification Service when creating/deploying
SOFTWARE Flavors.</p>
<h2 id="113-integration-hub">11.3  Integration Hub</h2>
<h3 id="1131-installation-answer-file">11.3.1  Installation Answer File</h3>
<div class="highlight"><pre><span></span><code># Authentication URL and service account credentials
AAS_API_URL=https://isecl-aas:8444/aas
IHUB_SERVICE_USERNAME=&lt;Integration Hub Service User username&gt;
IHUB_SERVICE_PASSWORD=&lt;Integration Hub Service User password&gt;

# CMS URL and CMS webserivce TLS hash for server verification
CMS_BASE_URL=https://isecl-cms:8445/cms/v1
CMS_TLS_CERT_SHA384=&lt;TLS hash&gt;

# TLS Configuration
TLS_SAN_LIST=127.0.0.1,192.168.1.1,hub.server.com #comma-separated list of IP addresses and hostnames for the Hub to be used in the Subject Alternative Names list in the TLS Certificate

# Verification Service URL
ATTESTATION_SERVICE_URL=https://isecl-hvs:8443/hvs/v2
ATTESTATION_TYPE=HVS

#Integration tenant type.  Currently supported values are &quot;KUBENETES&quot; or &quot;OPENSTACK&quot;
TENANT=&lt;KUBERNETES or OPENSTACK&gt;

# OpenStack Integration Credentials - required for OpenStack integration only
OPENSTACK_AUTH_URL=&lt;OpenStack Keystone URL; typically http://openstack-ip:5000/&gt;
OPENSTACK_PLACEMENT_URL=&lt;OpenStack Nova API URL; typically http://openstack-ip:8778/&gt;
OPENSTACK_USERNAME=&lt;OpenStack username&gt;
OPENSTACK_PASSWORD=&lt;OpenStack password&gt;

# Kubernetes Integration Credentials - required for Kubernetes integration only
KUBERNETES_URL=https://kubernetes:6443/
KUBERNETES_CRD=custom-isecl
KUBERNETES_CERT_FILE=/etc/ihub/apiserver.crt
KUBERNETES_TOKEN=eyJhbGciOiJSUzI1NiIsImtpZCI6Ik......

# Installation admin bearer token for CSR approval request to CMS - mandatory
BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

#Optional, configures the polling interval at which the Hub retrieves attestations from the HVS
POLL_INTERVAL_MINUTES=2

#Optional, runs the installer skipping setup
IHUB_NO_SETUP=false

#Optional, configures the TLS certificate common name
TLS_COMMON_NAME=Integration Hub TLS Certificate

#Optional, log configuration
LOG_MAX_LENGTH=1500
LOG_LEVEL=Info
LOG_ENABLE_STDOUT=true
</code></pre></div>
<h3 id="1132-configuration-options">11.3.2  Configuration Options</h3>
<div class="highlight"><pre><span></span><code>config-file: /etc/ihub/config
log:
  max-length: 1500
  enable-stdout: true
  level: trace
ihub:
  service-username: admin@hub
  service-password: hubAdminPass
  poll-interval-minutes: 1
aas:
  url: https://&lt;aas_ip&gt;:8444/aas
cms:
  url: https://&lt;cms_ip&gt;:8445/cms/v1/
  tls-cert-digest: 8a035e3cdd...
attestation-service:
  attestation-url: https://&lt;hvs_ip&gt;:8443/hvs/v2
  attestation-type: HVS
end-point:
  type: KUBERNETES or OPENSTACK
  url: https://&lt;kubernetes_ip&gt;:6443/ or OpenStack Nova URL
  crd-name: custom-isecl
  token: eyJhbGciOiJSUzI...
  username: OpenStack Username
  password: OpenStack Password
  auth-url: OpenStack Authentication URL
  cert-file: /etc/ihub/apiserver.crt
tls:
  cert-file: /etc/ihub/tls-cert.pem
  key-file: /etc/ihub/tls-key.pem
  common-name: Integration Hub TLS Certificate
  san-list: 127.0.0.1,localhost
</code></pre></div>
<h3 id="1133-command-line-options">11.3.3  Command-Line Options</h3>
<h4 id="11331-available-commands">11.3.3.1  Available Commands</h4>
<h5 id="113311-help">11.3.3.1.1  Help</h5>
<p><code>ihub -h | --help</code></p>
<p>Displays the list of available CLI commands.</p>
<h5 id="113312-start">11.3.3.1.2  Start</h5>
<p><code>ihub start</code></p>
<p>Starts the services.</p>
<h5 id="113313-stop">11.3.3.1.3  Stop</h5>
<p><code>ihub stop</code></p>
<p>Stops the services.</p>
<h5 id="113315-status">11.3.3.1.5  Status</h5>
<p><code>ihub status</code></p>
<p>Reports whether the service is currently running.</p>
<h5 id="113315-uninstall">11.3.3.1.5  Uninstall</h5>
<p><code>ihub uninstall [--purge]</code></p>
<p>Uninstalls the service, including the deletion of all files and folders.
Database content is not removed. If the <code>--purge</code> option is used, database
content will be removed during the uninstallation.</p>
<h5 id="113316-version">11.3.3.1.6  Version</h5>
<p><code>ihub -v | --version</code></p>
<p>Reports the version of the service.</p>
<h5 id="1133110-setup">11.3.3.1.10  Setup</h5>
<div class="highlight"><pre><span></span><code>ihub setup &lt;task&gt; [--help] [--force] [-f &lt;answer-file&gt;]
</code></pre></div>
<p>Re-runs the installation setup tasks, or the specific tasks listed.</p>
<p>--help                      Shows help message for setup tasks  </p>
<p>--force                     Any existing configuration will be overwritten if this flag is set</p>
<p>-f|--file <answer-file>     Path to the ihub.env answer file</p>
<p>Available Tasks for setup:</p>
<p>​        all                                 Runs all setup tasks</p>
<p>​        download-ca-cert                    Download CMS root CA certificate</p>
<p>​        download-cert-tls                   Download CA certificate from CMS for tls</p>
<p>​        attestation-service-connection      Establish Attestation service connection</p>
<p>​        tenant-service-connection           Establish Tenant service connection</p>
<p>​        create-signing-key                  Create signing key for IHUB</p>
<p>​        download-saml-cert                  Download SAML certificate from Attestation service</p>
<h3 id="1134-directory-layout">11.3.4  Directory Layout</h3>
<p>The ihub installs by default to /etc/ihub.  This directory contains the config.yaml configuration file,  saml certificate, trusted ca, and the webservice TLS certificate.</p>
<p>/etc/ihub/</p>
<p>├── apiserver.crt</p>
<p>├── certs</p>
<p>│   ├── saml</p>
<p>│   │   └── saml-cert.pem</p>
<p>│   └── trustedca</p>
<p>│       └── 58f6bcfcd.pem</p>
<p>├── config.yml</p>
<p>├── ihub_private_key.pem</p>
<p>├── ihub_public_key.pem</p>
<p>├── tls-cert.pem</p>
<p>└── tls-key.pem</p>
<h4 id="1341-logs">1.3.4.1  Logs</h4>
<p>/var/logs/ihub</p>
<h2 id="114-certificate-management-service">11.4  Certificate Management Service</h2>
<h3 id="1141-installation-answer-file-options">11.4.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CMS_NOSETUP</td>
<td>false</td>
<td>Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data.</td>
</tr>
<tr>
<td>CMS_PORT</td>
<td>8445</td>
<td>Defines the HTTPS port the service will use.</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;Hostname or IP address of the AAS>:8444/aas/</td>
<td>URL to connect to the AAS, used during setup for authentication.</td>
</tr>
<tr>
<td>AAS_TLS_SAN</td>
<td>\&lt;Comma-separated list of IPs/hostnames for the AAS></td>
<td>SAN list populated in special JWT token, this token is used by AAS to get TLS certificate signed from CMS. SAN list in this token and CSR generated by AAS must match.</td>
</tr>
<tr>
<td>LOG_ROTATION_PERIOD</td>
<td>hourly, daily, weekly, monthly, yearly</td>
<td>log rotation period, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_COMPRESS</td>
<td>Compress</td>
<td>Old versions of log files are compressed with gzip, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_DELAYCOMPRESS</td>
<td>delaycompress</td>
<td>Postpone compression of the previous log file to the next rotation cycle, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_COPYTRUNCATE</td>
<td>Copytruncate</td>
<td>Truncate the original log file in place after creating a copy,'create' creates new one, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_SIZE</td>
<td>1K</td>
<td>Log files are rotated when they grow bigger than size bytes, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_OLD</td>
<td>12</td>
<td>Log files are rotated count times before being removed, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>CMS_CA_CERT_VALIDITY</td>
<td>5</td>
<td>CMS Root Certificate Validity in years</td>
</tr>
<tr>
<td>CMS_CA_ORGANIZATION</td>
<td>INTEL</td>
<td>CMS Certificate Organization</td>
</tr>
<tr>
<td>CMS_CA_LOCALITY</td>
<td>US</td>
<td>CMS Certificate locality</td>
</tr>
<tr>
<td>CMS_CA_PROVINCE</td>
<td>CA</td>
<td>CMS Certificate province</td>
</tr>
<tr>
<td>CMS_CA_COUNTRY</td>
<td>USA</td>
<td>CMS Certificate country</td>
</tr>
<tr>
<td>CMS_TLS_SAN_LIST</td>
<td></td>
<td>Comma-separated list of IP addresses and hostnames to be added to the SAN list of CMS server</td>
</tr>
<tr>
<td>CMS_SERVER_READ_TIMEOUT</td>
<td>30s</td>
<td>MS server - ReadTimeout is the maximum duration for reading the entire request, including the body.</td>
</tr>
<tr>
<td>CMS_SERVER_READ_HEADER_TIMEOUT</td>
<td>10s</td>
<td>CMS server - ReadHeaderTimeout is the amount of time allowed to read request headers</td>
</tr>
<tr>
<td>CMS_SERVER_WRITE_TIMEOUT</td>
<td>10s</td>
<td>CMS server - WriteTimeout is the maximum duration before timing out writes of the response.</td>
</tr>
<tr>
<td>CMS_SERVER_IDLE_TIMEOUT</td>
<td>10s</td>
<td>CMS server - IdleTimeout is the maximum amount of time to wait for the next request when keep-alives are enabled.</td>
</tr>
<tr>
<td>CMS_SERVER_MAX_HEADER_BYTES</td>
<td>1048576</td>
<td>CMS server - MaxHeaderBytes controls the maximum number of bytes the server will read parsing the request header's keys and values, including the request line.</td>
</tr>
<tr>
<td>AAS_JWT_CN</td>
<td>AAS JWT Signing Certificate</td>
<td>CN of AAS JWT certificate, this gets populated in special JWT token. AAS must send JWT certificate CSR with this CN.</td>
</tr>
<tr>
<td>AAS_TLS_CN</td>
<td>AAS TLS Certificate</td>
<td>CN of AAS TLS certificate, this gets populated in special JWT token. AAS must send TLS certificate CSR with this CN.</td>
</tr>
<tr>
<td>AAS_TLS_SAN</td>
<td></td>
<td>SAN list populated in special JWT token, this token is used by AAS to get TLS certificate signed from CMS. SAN list in this token and CSR generated by AAS must match.</td>
</tr>
</tbody>
</table>
<h3 id="1142-configuration-options">11.4.2  Configuration Options</h3>
<p>The CMS configuration can be found in <code>/etc/cms/config.yml</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8445</span>
<span class="nt">loglevel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="nt">authserviceurl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://&lt;AAS IP or hostname&gt;:8444/aas/</span>
<span class="nt">cacertvalidity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="nt">organization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">INTEL</span>
<span class="nt">locality</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SC</span>
<span class="nt">province</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
<span class="nt">country</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">US</span>
<span class="nt">keyalgorithm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rsa</span>
<span class="nt">keyalgorithmlength</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3072</span>
<span class="nt">rootcacertdigest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;sha384&gt;</span>
<span class="nt">tlscertdigest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;sha384&gt;</span>
<span class="nt">tokendurationmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="nt">aasjwtcn</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">aastlscn</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">aastlssan</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">authdefender</span><span class="p">:</span>
  <span class="nt">maxattempts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">intervalmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">lockoutdurationmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</code></pre></div>
<h3 id="1143-command-line-options">11.4.3  Command-Line Options</h3>
<h4 id="11431-help">11.4.3.1  Help</h4>
<p><code>cms help</code></p>
<p>Displays the list of available CLI commands.</p>
<h4 id="11432-start">11.4.3.2  Start</h4>
<p><code>cms start</code></p>
<p>Starts the services.</p>
<h4 id="11433-stop">11.4.3.3  Stop</h4>
<p><code>cms stop</code></p>
<p>Stops the service.</p>
<h4 id="11435-status">11.4.3.5  Status</h4>
<p><code>cms status</code></p>
<p>Reports whether the service is currently running.</p>
<h4 id="11436-uninstall">11.4.3.6  Uninstall</h4>
<p><code>cms uninstall</code></p>
<p>Uninstalls the service, including the deletion of all files and folders.</p>
<h4 id="11437-version">11.4.3.7  Version</h4>
<p><code>cms version</code></p>
<p>Reports the version of the service.</p>
<h4 id="11438-tlscertsha384">11.4.3.8  Tlscertsha384</h4>
<p>Shows the SHA384 of the TLS certificate.</p>
<h4 id="11439-setup-task">11.4.3.9  setup [task]</h4>
<p>Runs a specific setup task.</p>
<p>Avaliable Tasks for setup:</p>
<h5 id="cms-setup-server-portport"><code>cms setup server [--port=&lt;port&gt;]</code></h5>
<p>- Setup http server on \&lt;port></p>
<p>- Environment variable CMS_PORT=\&lt;port> can be set alternatively</p>
<h5 id="cms-setup-root_ca-force"><code>cms setup root_ca [--force]</code></h5>
<p>- Create its own self signed Root CA keypair in /etc/cms for quality of
life</p>
<p>- Option [--force] overwrites any existing files, and always generate
new Root CA keypair</p>
<h5 id="cms-setup-tls-force-host_nameshost_names"><code>cms setup tls [--force] [--host_names=&lt;host_names&gt;]</code></h5>
<p>- Create its own root_ca signed TLS keypair in /etc/cms for quality of
life</p>
<p>- Option [--force] overwrites any existing files, and always generate
root_ca signed TLS keypair</p>
<p>- Argument \&lt;host_names> is a list of host names used by local
machine, seperated by comma</p>
<p>- Environment variable CMS_HOST_NAMES=\&lt;host_names> can be set
alternatively</p>
<h5 id="cms-setup-cms_auth_token-force"><code>cms setup cms_auth_token [--force]</code></h5>
<p>- Create its own self signed JWT keypair in /etc/cms/jwt for quality of
life</p>
<p>- Option [--force] overwrites any existing files, and always generate
new JWT keypair and token</p>
<h3 id="1144-directory-layout">11.4.4  Directory Layout</h3>
<p>The Certificate Management Service installs by default to <code>/opt/cms</code> with
the following folders.</p>
<h4 id="11441-bin">11.4.4.1  Bin</h4>
<p>This folder contains executable scripts.</p>
<h4 id="11442-cacerts">11.44.2 Cacerts</h4>
<p>This folder contains the CMS root CA certificate.</p>
<h2 id="115-authentication-and-authorization-service">11.5  Authentication and Authorization Service</h2>
<h3 id="1151-installation-answer-file-options">11.5.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CMS_BASE_URL</td>
<td>https://&lt;cms IP or hostname>/cms/v1/</td>
<td>Required; Provides the URL for the CMS.</td>
</tr>
<tr>
<td>AAS_NOSETUP</td>
<td>false</td>
<td>Optional. Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data.</td>
</tr>
<tr>
<td>AAS_DB_HOSTNAME</td>
<td>localhost</td>
<td>Required. Hostname or IP address of the AAS database</td>
</tr>
<tr>
<td>AAS_DB_PORT</td>
<td>5432</td>
<td>Required. Database port number</td>
</tr>
<tr>
<td>AAS_DB_NAME</td>
<td>pgdb</td>
<td>Required. Database name</td>
</tr>
<tr>
<td>AAS_DB_USERNAME</td>
<td>dbuser</td>
<td>Required. Database username</td>
</tr>
<tr>
<td>AAS_DB_PASSWORD</td>
<td>dbpassword</td>
<td>Required. Database password</td>
</tr>
<tr>
<td>AAS_DB_SSLMODE</td>
<td>verify-ca</td>
<td>Defines the SSL mode for the connection to the database. If not specified, the database connection will not use certificate verification. If specified, certificate verification will be required for database connections.</td>
</tr>
<tr>
<td>AAS_DB_SSLCERTSRC</td>
<td>/usr/local/pgsql/data/server.crt</td>
<td>Optional, required if the<code>“AAS_DB_SSLMODE</code> is set to <code>verify-ca</code> Defines the location of the database SSL certificate.</td>
</tr>
<tr>
<td>AAS_DB_SSLCERT</td>
<td>\&lt;path_to_cert_file_on_system></td>
<td>Optional. The <code>AAS_DB_SSLCERTSRC</code> variable defines the source location of the database SSL certificate; this variable determines the local location. If the former option is used without specifying this option, the service will copy the SSL certificate to the default configuration directory.</td>
</tr>
<tr>
<td>AAS_ADMIN_USERNAME</td>
<td>admin@aas</td>
<td>Required. Defines a new AAS administrative user. This user will be able to create new users, new roles, and new role-user mappings. This user will have the <code>AAS:Administrator</code> role.</td>
</tr>
<tr>
<td>AAS_ADMIN_PASSWORD</td>
<td>aasAdminPass</td>
<td>Required. Password for the new AAS admin user.</td>
</tr>
<tr>
<td>AAS_JWT_CERT_SUBJECT</td>
<td>"AAS JWT Signing Certificate"</td>
<td>Optional. Defines the subject of the JWT signing certificate.</td>
</tr>
<tr>
<td>AAS_JWT_TOKEN_DURATION_MINS</td>
<td>5</td>
<td>Optional. Defines the amount of time in minutes that an issued token will be valid.</td>
</tr>
<tr>
<td>SAN_LIST</td>
<td>127.0.0.1,localhost,10.x.x.x</td>
<td>Comma-separated list of IP addresses and hostnames that will be valid connection points for the service. Requests sent to the service using an IP or hostname not in this list will be denied, even if it resolves to this service.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>Required. Token from the CMS generated during CMS setup that allows the AAS to perform initial setup tasks.</td>
</tr>
<tr>
<td>LOG_LEVEL</td>
<td>Critical, error, warning, info, debug, trace</td>
<td>Optional. Defaults to INFO. Changes the log level used.</td>
</tr>
</tbody>
</table>
<h3 id="1152-configuration-options">11.5.2  Configuration Options</h3>
<h3 id="1153-command-line-options">11.5.3  Command-Line Options</h3>
<h4 id="11531-help">11.5.3.1  Help</h4>
<p>Displays the list of available CLI commands.</p>
<h4 id="11532-setup-task">11.5.3.2  setup \&lt;task></h4>
<p>Executes a specific setup task. Can be used to change the current
configuration.</p>
<p>Available Tasks for setup:</p>
<h5 id="115321-authservice-setup-all">11.5.3.2.1  authservice setup all</h5>
<p>- Runs all setup tasks</p>
<h5 id="115322-authservice-setup-database-force-argumentsargument_value">11.5.3.2.2  authservice setup database [-force] [--arguments=\&lt;argument_value>]</h5>
<p>- Available arguments are:</p>
<p>- db-host alternatively, set environment variable AAS_DB_HOSTNAME</p>
<p>- db-port alternatively, set environment variable AAS_DB_PORT</p>
<p>- db-user alternatively, set environment variable AAS_DB_USERNAME</p>
<p>- db-pass alternatively, set environment variable AAS_DB_PASSWORD</p>
<p>- db-name alternatively, set environment variable AAS_DB_NAME</p>
<p>- db-sslmode
\&lt;disable|allow|prefer|require|verify-ca|verify-full></p>
<p>alternatively, set environment variable AAS_DB_SSLMODE</p>
<p>- db-sslcert path to where the certificate file of database. Only
applicable</p>
<p>for db-sslmode=\&lt;verify-ca|verify-full. If left empty, the cert</p>
<p>will be copied to /etc/authservice/tdcertdb.pem</p>
<p>alternatively, set environment variable AAS_DB_SSLCERT</p>
<p>- db-sslcertsrc \&lt;path to where the database ssl/tls certificate file></p>
<p>mandatory if db-sslcert does not already exist</p>
<p>alternatively, set environment variable AAS_DB_SSLCERTSRC</p>
<p>- Run this command with environment variable AAS_DB_REPORT_MAX_ROWS
and</p>
<p>AAS_DB_REPORT_NUM_ROTATIONS can update db rotation arguments</p>
<h5 id="115323-authservice-setup-server-portport">11.5.3.2.3  <code>authservice setup server [--port=&lt;port&gt;]</code></h5>
<p>- Setup http server on \&lt;port></p>
<p>- Environment variable AAS_PORT=\&lt;port> can be set alternatively</p>
<p>authservice setup tls [--force] [--host_names=\&lt;host_names>]</p>
<p>- Use the key and certificate provided in /etc/threat-detection if
files exist</p>
<p>- Otherwise create its own self-signed TLS keypair in /etc/authservice
for quality of life</p>
<p>- Option [--force] overwrites any existing files, and always generate
self-signed keypair</p>
<p>- Argument \&lt;host_names> is a list of host names used by local
machine, seperated by comma</p>
<p>- Environment variable AAS_TLS_HOST_NAMES=\&lt;host_names> can be set
alternatively</p>
<h5 id="115324-authservice-setup-admin-userusername-passpassword">11.5.3.2.4  <code>authservice setup admin [--user=&lt;username&gt;] [--pass=&lt;password&gt;]</code></h5>
<p>- Environment variable AAS_ADMIN_USERNAME=\&lt;username> can be set
alternatively</p>
<p>- Environment variable AAS_ADMIN_PASSWORD=\&lt;password> can be set
alternatively</p>
<h5 id="115325-authservice-setup-download_ca_cert-force">11.5.3.2.5  <code>authservice setup download_ca_cert [--force]</code></h5>
<p>- Download CMS root CA certificate</p>
<p>- Option [--force] overwrites any existing files, and always
downloads new root CA cert</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<h5 id="115326-authservice-setup-download_cert-tls-force">11.5.3.2.6  <code>authservice setup download_cert TLS [--force]</code></h5>
<p>- Generates Key pair and CSR, gets it signed from CMS</p>
<p>- Option [--force] overwrites any existing files, and always
downloads newly signed TLS cert</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>- Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
CMS</p>
<p>- Environment variable KEY_PATH=\&lt;key_path> to override default
specified in config</p>
<p>- Environment variable CERT_PATH=\&lt;cert_path> to override default
specified in config</p>
<p>- Environment variable AAS_TLS_CERT_CN=\&lt;TLS CERT COMMON NAME> to
override default specified in config</p>
<p>- Environment variable AAS_CERT_ORG=\&lt;CERTIFICATE ORGANIZATION> to
override default specified in config</p>
<p>- Environment variable AAS_CERT_COUNTRY=\&lt;CERTIFICATE COUNTRY> to
override default specified in config</p>
<p>- Environment variable AAS_CERT_LOCALITY=\&lt;CERTIFICATE LOCALITY> to
override default specified in config</p>
<p>- Environment variable AAS_CERT_PROVINCE=\&lt;CERTIFICATE PROVINCE> to
override default specified in config</p>
<p>- Environment variable SAN_LIST=\&lt;san> list of hosts which needs
access to service</p>
<h5 id="115327-authservice-setup-jwt">11.5.3.2.7  <code>authservice setup jwt</code></h5>
<p>- Create jwt signing key and jwt certificate signed by CMS</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>- Environment variable AAS_JWT_CERT_CN=\&lt;CERTIFICATE SUBJECT> AAS
JWT Certificate Subject</p>
<p>- Environment variable AAS_JWT_INCLUDE_KEYID=\&lt;KEY ID> AAS include
key id in JWT Token</p>
<p>- Environment variable AAS_JWT_TOKEN_DURATION_MINS=\&lt;DURATION> JWT
Token validation minutes</p>
<p>- Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
CMS</p>
<h4 id="115328-start">11.5.3.2.8  Start</h4>
<p>Starts the service.</p>
<h4 id="115329-status">11.5.3.2.9  Status</h4>
<p>Displays the current status of the service.</p>
<h4 id="1153210-stop">11.5.3.2.10  Stop</h4>
<p>Stops the service.</p>
<h4 id="1153211-tlscertsha384">11.5.3.2.11  tlscertsha384</h4>
<p>Shows the SHA384 of the TLS certificate.</p>
<h4 id="1153212-uninstall">11.5.3.2.12  Uninstall</h4>
<p>Removes the service. Use the “--purge” flag to also delete all data.</p>
<h4 id="1153213-version">11.5.3.2.13  Version</h4>
<p>Shows the version of the service.</p>
<h3 id="1154-directory-layout">11.5.4  Directory Layout</h3>
<p>The Verification Service installs by default to <code>/opt/authservice</code> with
the following folders.</p>
<h4 id="11541-bin">11.5.4.1 Bin</h4>
<p>Contains executable scripts and binaries.</p>
<h4 id="11542-dbscripts">11.5.4.2  dbscripts</h4>
<p>Contains database scripts.</p>
<h2 id="116-workload-service">11.6  Workload Service</h2>
<h3 id="1161-installation-answer-file-options">11.6.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>WLS_LOGLEVEL</td>
<td>INFO</td>
<td>(Optional) Alternatives include WARN and DEBUG. Sets the log level for the service.</td>
</tr>
<tr>
<td>WLS_NOSETUP</td>
<td>false</td>
<td>(Optional) Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data. Defaults to “false” if unset.</td>
</tr>
<tr>
<td>WLS_PORT</td>
<td>5000</td>
<td>(Optional) Defines the HTTPS port used by the service Defaults to 5000 if unset.</td>
</tr>
<tr>
<td>WLS_DB_HOSTNAME</td>
<td>localhost</td>
<td>(Required) Database hostname</td>
</tr>
<tr>
<td>WLS_DB</td>
<td>wlsdb</td>
<td>(Required) Database name</td>
</tr>
<tr>
<td>WLS_DB_PORT</td>
<td>5432</td>
<td>(Required) Database port number</td>
</tr>
<tr>
<td>WLS_DB_USERNAME</td>
<td>wlsdbuser</td>
<td>(Required) Database username</td>
</tr>
<tr>
<td>WLS_DB_PASSWORD</td>
<td>wlsdbuserpass</td>
<td>(Required) Database password</td>
</tr>
<tr>
<td>HVS_URL</td>
<td>https://\&lt;HVS IP address or hostname>:8443/hvs/v2/</td>
<td>(Required) Base URL for the HVS</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;AAS IP address or hostname>:8444/aas</td>
<td>Base URL for the AAS</td>
</tr>
<tr>
<td>SAN_LIST</td>
<td>127.0.0.1,localhost,10.x.x.x</td>
<td>Comma-separated list of IP addresses and hostnames that will be valid connection points for the service. Requests sent to the service using an IP or hostname not in this list will be denied, even if it resolves to this service.</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td></td>
<td>Base URL for the CMS</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>(Required) Token from the CMS generated during CMS setup that allows the AAS to perform initial setup tasks.</td>
</tr>
<tr>
<td>WLS_TLS_CERT_CN</td>
<td>'WLS TLS Certificate</td>
<td>(Optional) Set the Common name for TLS cert to be downloaded from CMS. Default is 'WLS TLS Certificate'.</td>
</tr>
<tr>
<td>WLS_CERT_ORG</td>
<td>'INTEL'</td>
<td>(Optional) Set the Organization in Subject of CSR. Default is 'INTEL'.</td>
</tr>
<tr>
<td>WLS_CERT_COUNTRY</td>
<td>'US'</td>
<td>(Optional) Set the Country in Subject of CSR. Default is 'US'.</td>
</tr>
<tr>
<td>WLS_CERT_PROVINCE</td>
<td>'SF'</td>
<td>(Optional) Set the Province in Subject of CSR. Default is 'SF'.</td>
</tr>
<tr>
<td>WLS_CERT_LOCALITY</td>
<td>'SC'</td>
<td>(Optional) Set the Locality in Subject of CSR. Default is 'SC'.</td>
</tr>
<tr>
<td>KEY_CACHE_SECONDS</td>
<td>300</td>
<td>(Optional) Set the time till which the key will be cached. Default is '300 seconds'.</td>
</tr>
<tr>
<td>WLS_LOGLEVEL</td>
<td>Info, debug, error, warn</td>
<td>(Optional) Set the log level.</td>
</tr>
<tr>
<td>KEY_PATH</td>
<td></td>
<td>(Optional) Redefines the path to the keystore folder</td>
</tr>
<tr>
<td>CERT_PATH</td>
<td></td>
<td>(Optional) Redefines the path to the certificates folder</td>
</tr>
</tbody>
</table>
<h3 id="1162-configuration-options">11.6.2  Configuration Options</h3>
<p>The Workload Service configuration can be found in
<code>/etc/workload-service/config.yml</code>:</p>
<div class="highlight"><pre><span></span><code>port: 5000
cmstlscertdigest: &lt;sha384&gt;
postgres:
  dbname: wlsdb
  user: &lt;database username&gt;
  password: &lt;database password&gt;
  hostname: &lt;database IP or hostname&gt;
  port: 5432
  sslmode: false
hvs_api_url: https://&lt;HVS IP or hostname&gt;:8443/hvs/v2/
cms_base_url: https://&lt;CMS IP or hostname&gt;:8445:/cms/v1/
aas_api_url: https://&lt;AAS IP or hostname&gt;:8444/aas/
subject:
  tlscertcommonname: WLS TLS Certificate
  organization: INTEL
  country: US
  province: SF
  locality: SC
wls:
  user: &lt;username of service account used by WLS to access other services&gt;&gt;
  password: &lt;password&gt;
loglevel: info
key_cache_seconds: 300
</code></pre></div>
<h3 id="1163-command-line-options">11.6.3  Command-Line Options</h3>
<p>The Workload Service supports several command-line commands that can be
executed only as the Root user:</p>
<p>Syntax:</p>
<p><code>workload-service &lt;command&gt;</code></p>
<h4 id="11631-help">11.6.3.1  Help</h4>
<p>Available Commands:</p>
<p>help|-help|--help Show this help message</p>
<p>start Start workload-service</p>
<p>stop Stop workload-service</p>
<p>status Determine if workload-service is running</p>
<p>uninstall [--purge] Uninstall workload-service. --purge option needs
to be applied to remove configuration and data files</p>
<p>setup Setup workload-service for use</p>
<p>Setup command usage: workload-service \&lt;command> [task...]</p>
<p>Available tasks for setup:</p>
<p>download_ca_cert</p>
<p>- Download CMS root CA certificate</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>download_cert TLS</p>
<p>- Generates Key pair and CSR, gets it signed from CMS</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>- Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
CMS</p>
<p>- Environment variable KEY_PATH=\&lt;key_path> to override default
specified in config</p>
<p>- Environment variable CERT_PATH=\&lt;cert_path> to override default
specified in config</p>
<p>- Environment variable WLS_TLS_CERT_CN=\&lt;COMMON NAME> to override
default specified in config</p>
<p>- Environment variable WLS_CERT_ORG=\&lt;CERTIFICATE ORGANIZATION> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_COUNTRY=\&lt;CERTIFICATE COUNTRY> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_LOCALITY=\&lt;CERTIFICATE LOCALITY> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_PROVINCE=\&lt;CERTIFICATE PROVINCE> to
override default specified in config</p>
<p>server Setup http server on given port</p>
<p>-Environment variable WLS_PORT=\&lt;port> should be set</p>
<p>database Setup workload-service database</p>
<p>Required env variables are:</p>
<p>- WLS_DB_HOSTNAME : database host name</p>
<p>- WLS_DB_PORT : database port number</p>
<p>- WLS_DB_USERNAME : database user name</p>
<p>- WLS_DB_PASSWORD : database password</p>
<p>- WLS_DB : database schema name</p>
<p>hvsconnection Setup task for setting up the connection to the Host
Verification Service(HVS)</p>
<p>Required env variables are:</p>
<p>- HVS_URL : HVS URL</p>
<p>aasconnection Setup to create workload service user roles in AAS</p>
<p>- AAS_API_URL : AAS API URL</p>
<p>- BEARER_TOKEN : Bearer Token</p>
<p>logs Setup workload-service log level</p>
<p>- Environment variable WLS_LOG_LEVEL=\&lt;log level> should be set</p>
<h4 id="11632-start">11.6.3.2  start</h4>
<p>Start workload-service</p>
<h4 id="11633-stop">11.6.3.3  stop</h4>
<p>Stop workload-service</p>
<h4 id="11634-status">11.6.3.4  status</h4>
<p>Determine if workload-service is running</p>
<h4 id="11635-uninstall">11.6.3.5  uninstall</h4>
<p>[--purge] Uninstall workload-service. --purge option needs to be
applied to remove configuration and data files</p>
<h4 id="11636-setup">11.6.3.6  setup</h4>
<p>Setup workload-service for use</p>
<p>Setup command usage: workload-service \&lt;command> [task...]</p>
<h5 id="116361-download_ca_cert">11.6.3.6.1  download_ca_cert</h5>
<p>- Download CMS root CA certificate</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<h5 id="116362-download_cert-tls">11.6.3.6.2  download_cert TLS</h5>
<p>- Generates Key pair and CSR, gets it signed from CMS</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>- Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
CMS</p>
<p>- Environment variable KEY_PATH=\&lt;key_path> to override default
specified in config</p>
<p>- Environment variable CERT_PATH=\&lt;cert_path> to override default
specified in config</p>
<p>- Environment variable WLS_TLS_CERT_CN=\&lt;COMMON NAME> to override
default specified in config</p>
<p>- Environment variable WLS_CERT_ORG=\&lt;CERTIFICATE ORGANIZATION> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_COUNTRY=\&lt;CERTIFICATE COUNTRY> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_LOCALITY=\&lt;CERTIFICATE LOCALITY> to
override default specified in config</p>
<p>- Environment variable WLS_CERT_PROVINCE=\&lt;CERTIFICATE PROVINCE> to
override default specified in config</p>
<h5 id="116363-server">11.6.3.6.3  server</h5>
<p>Setup http server on given port</p>
<p>-Environment variable WLS_PORT=\&lt;port> should be set</p>
<h5 id="116364-database-setup-workload-service-database">11.6.3.6.4  database     Setup workload-service database</h5>
<p>Required env variables are:</p>
<p>- WLS_DB_HOSTNAME : database host name</p>
<p>- WLS_DB_PORT : database port number</p>
<p>- WLS_DB_USERNAME : database user name</p>
<p>- WLS_DB_PASSWORD : database password</p>
<p>- WLS_DB : database schema name</p>
<h5 id="116365-hvsconnection">11.6.3.6.5  hvsconnection</h5>
<p>Setup task for setting up the connection to the Host Verification
Service(HVS)</p>
<p>Required env variables are:</p>
<p>- HVS_URL : HVS URL</p>
<h5 id="116366-aasconnection">11.6.3.6.6  aasconnection</h5>
<p>Setup to create workload service user roles in AAS</p>
<p>- AAS_API_URL : AAS API URL</p>
<p>- BEARER_TOKEN : Bearer Token</p>
<h5 id="116367-logs">11.6.3.6.7  logs</h5>
<p>Setup workload-service log level</p>
<p>- Environment variable WLS_LOG_LEVEL=\&lt;log level> should be set</p>
<h3 id="1164-directory-layout">11.6.4 Directory Layout</h3>
<p>The Workload Service installs by default to /opt/wls with the following
folders.</p>
<h2 id="117-key-broker-service">11.7  Key Broker Service</h2>
<h3 id="1171-installation-answer-file-options">11.7.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Default Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>USERNAME</td>
<td></td>
<td>KBS admin username</td>
</tr>
<tr>
<td>PASSWORD</td>
<td></td>
<td>KBS admin password</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td></td>
<td>Required for generating TLS certificate</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td></td>
<td>SHA384 digest of CMS TLS certificate</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td></td>
<td>AAS baseurl</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td></td>
<td>JWT token for installation user</td>
</tr>
<tr>
<td>KMS_HOME</td>
<td>/opt/kms</td>
<td>Application home directory</td>
</tr>
<tr>
<td>KBS_SERVICE_USERNAME</td>
<td>kms</td>
<td>Non-root user to run KMS</td>
</tr>
<tr>
<td>JETTY_PORT</td>
<td>80</td>
<td>The server will listen for HTTP connections on this port</td>
</tr>
<tr>
<td>JETTY_SECURE_PORT</td>
<td>443</td>
<td>The server will listen for HTTPS connections on this port</td>
</tr>
<tr>
<td>KMS_LOG_LEVEL</td>
<td>INFO</td>
<td>Sets the root log level in logback.xml</td>
</tr>
<tr>
<td>KMS_NOSETUP</td>
<td>false</td>
<td>Skips setup during installation if set to true</td>
</tr>
<tr>
<td>ENDPOINT_URL</td>
<td><a href="http://localhost">http://localhost</a></td>
<td>Endpoint to be used in key transfer url</td>
</tr>
<tr>
<td>KEY_MANAGER_PROVIDER</td>
<td>DirectoryKeyManager</td>
<td>Key manager to be used for key management</td>
</tr>
<tr>
<td>KBS_SERVICE_PASSWORD</td>
<td></td>
<td>This password protects the configuration file and the password vault. It must be set before installing and before starting the KBS</td>
</tr>
<tr>
<td>KMS_TLS_CERT_IP</td>
<td></td>
<td>IP addresses to be included in SAN list</td>
</tr>
<tr>
<td>KMS_TLS_CERT_DNS</td>
<td></td>
<td>DNS addresses to be included in SAN list</td>
</tr>
<tr>
<td>BARBICAN_PROJECT_ID</td>
<td></td>
<td>OpenStack Barbican project id</td>
</tr>
<tr>
<td>BARBICAN_ENDPOINT_URL</td>
<td></td>
<td>OpenStack Barbican endpoint url</td>
</tr>
<tr>
<td>BARBICAN_KEYSTONE_PUBLIC_ENDPOINT</td>
<td></td>
<td>OpenStack Keystone endpoint url</td>
</tr>
<tr>
<td>BARBICAN_TENANTNAME</td>
<td></td>
<td>OpenStack Barbican tenant name</td>
</tr>
<tr>
<td>BARBICAN_USERNAME</td>
<td></td>
<td>OpenStack Barbican admin username</td>
</tr>
<tr>
<td>BARBICAN_PASSWORD</td>
<td></td>
<td>OpenStack Barbican admin password</td>
</tr>
</tbody>
</table>
<h3 id="1172-configuration-options">11.7.2  Configuration Options</h3>
<h3 id="1173-command-line-options">11.7.3 Command-Line Options</h3>
<p>The Key Broker Service supports several command-line commands that can
be executed only as the Root user:</p>
<p>Usage:
        kbs <command> [arguments]</p>
<p>Available Commands:
        help|-h|--help                                  Show this help message
        version|-v|--version                         Show the version of current kbs build
        setup <task>                                     Run setup task
        start                                                      Start kbs
        status                                                   Show the status of kbs
        stop                                                      Stop kbs
        uninstall [--purge]                              Uninstall kbs
                --purge                                         all configuration and data files will be removed if this flag is set</p>
<p>Usage of kbs setup:
        kbs setup <task> [--help] [--force] [-f <answer-file>]
                --help                                              show help message for setup task
                --force                                              existing configuration will be overwritten if this flag is set
                -f|--file <answer-file>             the answer file with required arguments</p>
<p>Available Tasks for setup:
        all                                                               Runs all setup tasks
        server                                                        Setup http server on given port
        download-ca-cert                                    Download CMS root CA certificate
        download-cert-tls                                    Download CA certificate from CMS for tls
        create-default-key-transfer-policy        Create default key transfer policy for KBS</p>
<h5 id="_1"></h5>
<h3 id="1174-directory-layout">11.7.4  Directory Layout</h3>
<p>The Verification Service installs by default with the following folders:</p>
<h4 id="optkbsbin">/opt/kbs/bin</h4>
<p>Contains KBS binaries</p>
<h4 id="etckbs">/etc/kbs/</h4>
<p>Contains KBS configuration files</p>
<h4 id="varlogkbs">/var/log/kbs/</h4>
<p>Contains KBS logs</p>
<h2 id="118-workload-agent">11.8  Workload Agent</h2>
<h3 id="1181-installation-answer-file-options">11.8.1  Installation Answer File Options</h3>
<h3 id="1182-configuration-options">11.8.2  Configuration Options</h3>
<h3 id="1183-command-line-options">11.8.3  Command-Line Options</h3>
<p>Available Commands:</p>
<h4 id="11831-help">11.8.3.1  Help</h4>
<p>wlagent help|-help|--help Show help message</p>
<h4 id="11832-setup">11.8.3.2  setup</h4>
<p>wlagent setup [task] Run setup task</p>
<h5 id="118321-available-tasks-for-setup">11.8.3.2.1  Available Tasks for setup</h5>
<h6 id="signingkey">SigningKey</h6>
<p>Generate a TPM signing key</p>
<h6 id="bindingkey">BindingKey</h6>
<p>Generate a TPM binding key</p>
<h6 id="registersigningkey">RegisterSigningKey</h6>
<p>Register a signing key with the host verification service</p>
<ul>
<li>Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
    Verification service</li>
</ul>
<h6 id="registerbindingkey">RegisterBindingKey</h6>
<p>Register a binding key with the host verification service</p>
<ul>
<li>Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
    Verification service</li>
</ul>
<h4 id="11833-start">11.8.3.3  start</h4>
<p>Start wlagent</p>
<h4 id="11834-stop">11.8.3.4  stop</h4>
<p>Stop wlagent</p>
<h4 id="11835-status">11.8.3.5  status</h4>
<p>Reports the status of wlagent service</p>
<h4 id="11836-uninstall">11.8.3.6  uninstall</h4>
<p>Uninstall wlagent</p>
<h4 id="11837-uninstall-purge">11.8.3.7  uninstall --purge</h4>
<p>Uninstalls workload agent and deletes the existing configuration
directory</p>
<h4 id="11838-version">11.8.3.8  version</h4>
<p>Reports the version of the workload agent</p>
<h3 id="1184-directory-layout">11.8.4  Directory Layout</h3>
<p>The Workload Agent installs by default to /opt/workload-agent with the
following folders.</p>
<h4 id="11841-bin">11.8.4.1  Bin</h4>
<p>Contains scripts and executable binaries.</p>
<h2 id="119-workload-policy-manager">11.9  Workload Policy Manager</h2>
<h3 id="1191-installation-answer-file-options">11.9.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>KMS_API_URL</td>
<td>https://\&lt;IP address or hostname of the KBS>:9443/v1/</td>
<td>Required. Defines the baseurl for the Key Broker Service. The WPM uses this URL to request new encryption keys when encrypting images.</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td></td>
<td>Required. SHA384 hash of the CMS TLS certificate</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td>https://\&lt;IP address or hostname for CMS>:8445/cms/v1/</td>
<td>Required. Defines the base URL for the CMS owned by the image owner. Note that this CMS may be different from the CMS used for other components.</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;IP address or hostname for AAS>:8444/aas</td>
<td>Required. Defines the baseurl for the AAS owned by the image owner. Note that this AAS may be different from the AAS used for other components.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>Required; token from CMS with permissions used for installation.</td>
</tr>
<tr>
<td>WPM_WITH_CONTAINER_SECURITY</td>
<td>“yes” or “no”</td>
<td>Optional, defaults to “no.” Defines whether the WPM will support Docker Container encryption. If this is set to Yes, the appropriate prerequisites for Docker Container encryption will be installed. If this is set to “no,” the WPM will not be able to encrypt Docker Container images, and will only be usable to encrypt Virtual Machine images.</td>
</tr>
<tr>
<td>WPM_LOG_LEVEL</td>
<td>INFO (default), DEBUG</td>
<td>Optional; defines the log level for the WPM. Defaults to INFO.</td>
</tr>
<tr>
<td>WPM_SERVICE_PASSWORD</td>
<td></td>
<td>Defines the credentials for the WPM to use to access the KBS</td>
</tr>
<tr>
<td>WPM_SERVICE_USERNAME</td>
<td></td>
<td>Defines the credentials for the WPM to use to access the KBS</td>
</tr>
</tbody>
</table>
<h3 id="1192-configuration-options">11.9.2  Configuration Options</h3>
<h3 id="1193-command-line-options">11.9.3  Command-Line Options</h3>
<p>The Workload Policy Manager supports several command-line commands that
can be executed only as the Root user:</p>
<p>Syntax:</p>
<p>wpm \&lt;command></p>
<h4 id="11931-create-image-flavor">11.9.3.1  create-image-flavor</h4>
<p>Creates a new image flavor and encrypts a source image. Output is the
image flavor in JSON format and the encrypted image.</p>
<p>usage: wpm create-image-flavor [-l label] [-i in] [-o out] [-e
encout] [-k key]</p>
<p>-l, --label image flavor label</p>
<p>-i, --in input image file path</p>
<p>-o, --out (optional) output image flavor file path</p>
<p>if not specified, will print to the console</p>
<p>-e, --encout (optional) output encrypted image file path</p>
<p>if not specified, encryption is skipped</p>
<p>-k, --key (optional) existing key ID</p>
<p>if not specified, a new key is generated</p>
<h4 id="11932-create-container-image-flavor">11.9.3.2  create-container-image-flavor</h4>
<p>Used to encrypt Docker container images and generate a container image
flavor.</p>
<p>usage: wpm create-container-image-flavor [-i img-name] [-t tag] [-f
dockerFile] [-d build-dir] [-k keyId]</p>
<p>[-e] [-s] [-n notaryServer] [-o out-file]</p>
<p>-i, --img-name container image name</p>
<p>-t, --tag (optional)container image tag name</p>
<p>-f, --docker-file (optional) container file path</p>
<p>to build the container image</p>
<p>-d, --build-dir (optional) build directory to</p>
<p>build the container image</p>
<p>-k, --key-id (optional) existing key ID</p>
<p>if not specified, a new key is generated</p>
<p>-e, --encryption-required (optional) boolean parameter specifies if</p>
<p>container image needs to be encrypted</p>
<p>-s, --integrity-enforced (optional) boolean parameter specifies if</p>
<p>container image should be signed</p>
<p>-n, --notary-server (optional) specify notary server url</p>
<p>-o, --out-file (optional) specify output file path</p>
<h4 id="11933-get-container-image-id">11.9.3.3  get-container-image-id</h4>
<h4 id="11934-create-software-flavor">11.9.3.4  create-software-flavor</h4>
<p>Not currently supported; intended for future functionality.</p>
<h4 id="11935-uninstall">11.9.3.5  Uninstall</h4>
<p>Removes the WPM.</p>
<h4 id="11936-help">11.9.3.6  --help</h4>
<p>Displays help text</p>
<h4 id="11937-version">11.9.3.7  --version</h4>
<p>Displays the WPM version</p>
<h4 id="11938-setup">11.9.3.8  Setup</h4>
<p>usage : wpm setup [\&lt;tasklist>]</p>
<p>\&lt;tasklist>-space separated list of tasks</p>
<h5 id="119381-wpm-setup">11.9.3.8.1  wpm setup</h5>
<h5 id="119382-wpm-setup-createenvelopekey">11.9.3.8.2  wpm setup CreateEnvelopeKey</h5>
<h5 id="119383-wpm-setup-registerenvelopekey">11.9.3.8.3  wpm setup RegisterEnvelopeKey</h5>
<h5 id="119384-wpm-setup-download_ca_cert-force">11.9.3.8.4  wpm setup download_ca_cert [--force]</h5>
<p>- Download CMS root CA certificate</p>
<p>- Option [--force] overwrites any existing files, and always
downloads new root CA cert</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<h5 id="119385-wpm-setup-download_cert-flavor-signing-force">11.9.3.8.5 wpm setup download_cert Flavor-Signing [--force]</h5>
<p>- Generates Key pair and CSR, gets it signed from CMS</p>
<p>- Option [--force] overwrites any existing files, and always
downloads newly signed Flavor Signing cert</p>
<p>- Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
<p>- Environment variable BEARER_TOKEN=\&lt;token> for authenticating with
CMS</p>
<p>- Environment variable KEY_PATH=\&lt;key_path> to override default
specified in config</p>
<p>- Environment variable CERT_PATH=\&lt;cert_path> to override default
specified in config</p>
<p>- Environment variable WPM_FLAVOR_SIGN_CERT_CN=\&lt;COMMON NAME> to
override default specified in config</p>
<p>- Environment variable WPM_CERT_ORG=\&lt;CERTIFICATE ORGANIZATION> to
override default specified in config</p>
<p>- Environment variable WPM_CERT_COUNTRY=\&lt;CERTIFICATE COUNTRY> to
override default specified in config</p>
<p>- Environment variable WPM_CERT_LOCALITY=\&lt;CERTIFICATE LOCALITY> to
override default specified in config</p>
<p>- Environment variable WPM_CERT_PROVINCE=\&lt;CERTIFICATE PROVINCE> to
override default specified in config</p>
<h1 id="12-certificate-and-key-management">12  Certificate and Key Management</h1>
<h2 id="121-host-verification-service-certificates-and-keys">12.1  Host Verification Service Certificates and Keys</h2>
<p>The Host Verification Service has several unique certificates not
present on other services.</p>
<h3 id="1211-saml">12.1.1  SAML</h3>
<p>The SAML Certificate a is used to sign SAML attestation reports, and is
itself signed by the Root Certificate. This certificate is unique to the
Verification Service.</p>
<p><code>/opt/hvs/configuration/saml.crt</code></p>
<p><code>/opt/hvs/configuration/saml.crt.pem</code></p>
<p><code>/opt/hvs/configuration/SAML.jks</code></p>
<p>The SAML Certificate can be replaced with a user-specified keypair and
certificate chain using the following command:</p>
<p>mtwilson replace-saml-key-pair --private-key=new.key.pem
--cert-chain=new.cert-chain.pem</p>
<p>This will:</p>
<ul>
<li>
<p>Replace key pair in <code>/opt/hvs/configuration/SAML.jks</code>, alias
    samlkey1</p>
</li>
<li>
<p>Update <code>/opt/hvs/configuration/saml.crt</code> with saml DER public key
    cert</p>
</li>
<li>
<p>Update <code>/opt/hvs/configuration/saml.crt.pem</code> with saml PEM public
    key cert</p>
</li>
<li>
<p>Update configuration properties:</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>saml.key.password to null
saml.certificate.dn
saml.issuer
</code></pre></div>
When the SAML certificate is replaced, all hosts will immediately be
added to a queue to generate a new attestation report, since the old
signing certificate is no longer valid. No service restart is necessary.</p>
<p>If the Integration Hub is being used, the new SAML certificate will need
to be imported to the Hub.</p>
<h3 id="1212-asset-tag">12.1.2  Asset Tag</h3>
<p>The Asset tag Certificate is used to sign all Asset Tag Certificates.
This certificate is unique to the Verification Service.</p>
<p><code>/opt/hvs/configuration/tag-cacerts.pem</code></p>
<p>The Asset Tag Certificate can be replaced with a user-specified keypair
and certificate chain using the following command:</p>
<p><code>mtwilson replace-tag-key-pair --private-key=new.key.pem
--cert-chain=new.cert-chain.pem</code></p>
<p>This will:</p>
<ul>
<li>
<p>Replace key pair in database table mw_file (cakey is private and
    public key pem formatted, cacerts is cert chain)</p>
</li>
<li>
<p>Update <code>/opt/hvs/configuration/tag-cacerts.pem with cert chain</code></p>
</li>
<li>
<p>Update configuration properties:</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>tag.issuer.dn
</code></pre></div>
No service restart is needed. However, all existing Asset Tags will be
considered invalid, and will need to be recreated. It is recommended to
delete any existing Asset Tag certificates and Flavors, and then
recreate and deploy new Tags.</p>
<h3 id="1213-privacy-ca">12.1.3  Privacy CA</h3>
<p>The Privacy CA certificate is used as part of the certificate chain for
creating the Attestation Identity Key (AIK) during Trust Agent
provisioning. The Privacy CA must be a self-signed certificate. This
certificate is unique to the Verification Service.</p>
<p>The Privacy CA certificate is used by Trust Agent nodes during Trust
Agent provisioning; if the Privacy CA certificate is changed, all Trust
Agent nodes will need to be re-provisioned.</p>
<p><code>/opt/hvs/configuration/PrivacyCA.p12</code></p>
<p><code>/opt/hvs/configuration/PrivacyCA.pem</code></p>
<p>The Privacy CA Certificate can be replaced with a user-specified keypair
and certificate chain using the following command:</p>
<p><code>mtwilson replace-pca-key-pair --private-key=new.key.pem
--cert-chain=new.cert-chain.pem</code></p>
<p>This will:</p>
<ul>
<li>
<p>Replace key pair in <code>/opt/hvs/configuration/PrivacyCA.p12</code>, alias
    1</p>
</li>
<li>
<p>Update <code>/opt/hvs/configuration/PrivacyCA.pem</code> with cert</p>
</li>
<li>
<p>Update configuration properties:</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>mtwilson.privacyca.aik.issuer
mtwilson.privacyca.aik.validity.days
</code></pre></div>
After the Privacy CA certificate is replaced, all Trust Agent hosts will
need to be re-provisioned with a new AIK:</p>
<p><code>tagent setup download-mtwilson-privacy-ca-certificate --force</code></p>
<p><code>tagent setup request-aik-certificate --force</code></p>
<p><code>tagent restart</code></p>
<h3 id="1214-endorsement-ca">12.1.4  Endorsement CA</h3>
<p>The Endorsement CA is a self-signed certificate used during Trust Agent
provisioning.</p>
<p><code>/opt/hvs/configuration/EndorsementCA.p12</code></p>
<p><code>/opt/hvs/configuration/EndorsementCA.pem</code></p>
<p>The Endorsement CA Certificate can be replaced with a user-specified
keypair and certificate chain using the following command:</p>
<p><code>mtwilson replace-eca-key-pair --private-key=new.key.pem
--cert-chain=new.cert-chain.pem</code></p>
<p>This will:</p>
<ul>
<li>
<p>Replace key pair in <code>/opt/hvs/configuration/EndorsementCA.p12</code>,
    alias 1</p>
</li>
<li>
<p>Update <code>/opt/hvs/configuration/EndorsementCA.pem</code> with accepted
    ECs</p>
</li>
<li>
<p>Update configuration properties:</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>mtwilson.privacyca.ek.issuer
mtwilson.privacyca.ek.validity.days
</code></pre></div>
After the Endorsement CA certificate is replaced, all Trust Agent hosts
will need to be re-provisioned with a new Endorsement Certificate:</p>
<p><code>tagent setup request-endorsement-certificate --force</code></p>
<p><code>tagent restart</code></p>
<h2 id="122-tls-certificates">12.2  TLS Certificates</h2>
<p>TLS certificates for each service are issued by the Certificate
Management Service during installation. If the CMS root certificate is
changed, or to regenerate the TLS certificate for a given service, use
the following commands (note: environment variables will need to be set;
typically these are the same variables set in the service installation
.env file):</p>
<ul>
<li><code>&lt;servicename&gt; download_ca_cert</code></li>
<li>
<p>Download CMS root CA certificate</p>
</li>
<li>
<p>Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
</li>
<li>
<p><code>&lt;servicename&gt; download_cert TLS</code> </p>
</li>
<li>
<p>Generates Key pair and CSR, gets it signed from CMS</p>
</li>
<li>
<p>Environment variable CMS_BASE_URL=\&lt;url> for CMS API url</p>
</li>
<li>
<p>Environment variable BEARER_TOKEN=\&lt;token> for authenticating
        with CMS</p>
</li>
<li>
<p>Environment variable KEY_PATH=\&lt;key_path> to override default
        specified in config</p>
</li>
<li>
<p>Environment variable CERT_PATH=\&lt;cert_path> to override
        default specified in config</p>
</li>
</ul>
<h1 id="13-uninstallation">13  Uninstallation</h1>
<p>This section describes steps used for uninstalling Intel SecL-DC
services.</p>
<ol>
<li>This section does not apply for containerized deployments. To
    uninstall a containerized deployment, simply shut down the container
    and delete the persistence volumes.</li>
</ol>
<h2 id="131-host-verification-service">13.1 Host Verification Service</h2>
<p>To uninstall the Verification Service, run the following command:</p>
<p><code>hvs uninstall</code></p>
<p>The hvs uninstall command will not delete any database content. To
completely uninstall and delete all database content and user data, run
the following:</p>
<p><code>hvs erase-data</code></p>
<p><code>hvs uninstall</code></p>
<blockquote>
<p><strong>Note:</strong>The uninstall command must be issued last, because the uninstall
process removes the scripts that execute the other commands, along
with all database connectivity info.</p>
</blockquote>
<h2 id="132-trust-agent">13.2  Trust Agent</h2>
<p>To uninstall the Trust Agent, run the following command:</p>
<p><code>tagent uninstall</code></p>
<p>Backs up the configuration directory and removes all Trust Agent files,
except for configuration files which are saved and restored.</p>
<p>Removes following directories:</p>
<ol>
<li>
<p><code>/usr/local/bin/tagent</code></p>
</li>
<li>
<p>TRUSTAGENT_HOME : `/opt/trustagent</p>
</li>
<li>
<p><code>/opt/tbootxm</code></p>
</li>
<li>
<p><code>/var/log/trustagent/measurement.*</code></p>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong>TPM ownership can be preserved by retaining the TPM owner secret. If
the Operating System will also be cleared, Linux systems will also
require the /usr/local/var/lib/tpm/system.data file to be preserved.
This file must be preserved from after ownership is taken, and then
replaced after the OS reload before the Trust Agent attempts to
reassert ownership.</p>
</blockquote>
<p>If the ownership secret and/or<code>system.data</code> file are not preserved,
reinstallation will require clearing TPM ownership.</p>
<h2 id="133-integration-hub">13.3  Integration Hub</h2>
<p>To uninstall the Integration Hub, run the following command:</p>
<p><code>ihub uninstall</code></p>
<h1 id="14appendix">14Appendix</h1>
<h2 id="141-pcr-definitions">14.1  PCR Definitions</h2>
<h3 id="1411-red-had-enterprise-linux">14.1.1  Red Had Enterprise Linux</h3>
<h4 id="14111-tpm-20">14.1.1.1  TPM 2.0</h4>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td><p>BIOS ROM and Flash Image</p>
<p>Initial Boot Block (Intel® BootGuard only)</p></td>
<td><p>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as the PLATFORM Flavor.</p>
<p>(Intel® BootGuard only): Extends measurements based on the Intel® BootGuard profile configuration and production vs non-production ACM flags; ACM signature; BootGuard key manifest hash; Boot Policy Manifest Signature</p></td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 7</td>
<td>Intel® BootGuard configuration and profiles</td>
<td>Describes the success of the IBB measurement event.</td>
<td><ul>
<li><p>All (Intel® BootGuard only)</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 17</td>
<td>ACM</td>
<td>BIOS AC registration information<br />
Digest of Processor S-CRTM<br />
Digest of Policycontrol<br />
Digest of all matching elements used by the policy<br />
Digest of STM<br />
Digest of Capability field of OsSinitData<br />
Digest of MLE<br />
For TA hosts, this PCR includes measurements of the OS, InitRD, and UUID. This changes with every install due to InitRD and UUID change.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>Digest of public key modulus used to verify SINIT signature<br />
Digest of Processor S-CRTM<br />
Digest of Capability field of OSSinitData table<br />
Digest of PolicyControl field of used policy<br />
Digest of LCP</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td><p>For ESXi and Trust Agent hosts, this PCR contains individual measurements of all of the non-Kernel modules.</p>
<p>For Linux hosts, this PCR is a measurement of the OS, InitRD, and UUID.</p></td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="1412-vmware-esxi">14.1.2  VMWare ESXi</h3>
<h4 id="14121-tpm-12">14.1.2.1  TPM 1.2</h4>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td>BIOS ROM and Flash Image</td>
<td>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as the PLATFORM Flavor.</td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 17</td>
<td>ACM</td>
<td>This PCR measures the SINIT ACM, and is hardware platform-specific. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>This PCR measures the tboot and hypervisor version. In ESXi hosts, only the tboot version is measured.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td><p>For ESXi and Trust Agent hosts, this PCR contains individual measurements of all of the non-Kernel modules.</p>
<p>For Citrix Xen hosts, this PCR is a measurement of the OS, InitRD, and UUID.</p></td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 20</td>
<td><p>For ESXi only.</p>
<p>VM Kernel and VMK Boot</p></td>
<td>This PCR is used only by ESXi hosts and is blank for all other host types.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 22</td>
<td>Asset Tag</td>
<td>This PCR contains the measurement of the SHA1 of the Asset Tag Certificate provisioned to the TPM, if any.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li></li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="14122-tpm-20">14.1.2.2  TPM 2.0</h4>
<p>VMWare supports TPM 2.0 with Intel TXT starting in vSphere 6.7 Update 1.
Earlier versions will support TPM 1.2 only.</p>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td>BIOS ROM and Flash Image</td>
<td>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as part of the PLATFORM flavor.</td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 17</td>
<td>ACM</td>
<td>This PCR measures the SINIT ACM, and is hardware platform-specific. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>This PCR measures the tboot and hypervisor version. In ESXi hosts, only the tboot version is measured. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td>For ESXi this PCR contains individual measurements of all of the non-Kernel modules – this includes all of the VIBs installed on the ESXi host. This is part of the OS flavor. Note that two ESXi hosts with the same version of ESXi installed may require different OS flavors if different VIBs are installed.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 20</td>
<td><p>For ESXi only.</p>
<p>VM Kernel and VMK Boot</p></td>
<td>This PCR is used only by ESXi hosts for some host-specific measurements, and is part of the host-unique flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 22</td>
<td>Asset Tag</td>
<td>Asset Tag is not currently supported for TPM 2.0 with ESXi.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li></li>
</ul></td>
</tr>
</tbody>
</table>

<h2 id="a1-attestation-rules">A.1  Attestation Rules</h2>
<table>
<thead>
<tr class="header">
<th>Platform</th>
<th>TPM</th>
<th>Flavor Type</th>
<th>Rules to be verified</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>RHEL</td>
<td>2.0</td>
<td>HARDWARE</td>
<td><p>PcrMatchesConstant rule for PCR 0</p>
<p>PcrEventLogIncludes rule for PCR 17 (LCP_DETAILS_HASH, BIOSAC_REG_DATA, OSSINITDATA_CAP_HASH, STM_HASH, MLE_HASH, NV_INFO_HASH, tb_policy, CPU_SCRTM_STAT, HASH_START, LCP_CONTROL_HASH)</p>
<p>PcrEventLogIntegrity rule for PCR 17</p></td>
<td><p>Evaluation of PcrEventLogIncludes would not include initrd and vmlinuz modules. They would be handled in host_specific flavor.</p>
<p>Evaluation of PcrEventLogIntegrity rule would also include OS modules (initrd &amp; vmlinuz)</p></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td>PcrEventLogIntegrity rule for PCR 17</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>HOST_SPECIFIC</td>
<td>PcrEventLogIncludes rule for PCR 17 (initrd &amp; vmlinuz)</td>
<td></td>
</tr>
<tr class="odd">
<td>VMware ESXi</td>
<td>1.2</td>
<td>PLATFORM</td>
<td><p>PcrMatchesConstant rule for PCR 0</p>
<p>PcrMatchesConstant rule for PCR 17</p></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 18</p>
<p>PcrMatchesConstant rule for PCR 20</p>
<p>PcrEventLogEqualsExcluding rule for PCR 19 (excludes dynamic modules based on component name)</p>
<p>PcrEventLogIntegrity rule for PCR 19</p></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>PcrMatchesConstant rule for PCR 22</td>
<td></td>
</tr>
<tr class="even">
<td>VMware ESXi</td>
<td>2.0</td>
<td></td>
<td>NOT SUPPORTED</td>
<td></td>
</tr>
<tr class="odd">
<td>Windows</td>
<td>1.2</td>
<td>PLATFORM</td>
<td>PcrMatchesConstant rule for PCR 0</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 13</p>
<p>PcrMatchesConstant rule for PCR 14</p></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td></td>
</tr>
<tr class="even">
<td>Windows</td>
<td>2.0</td>
<td>PLATFORM</td>
<td>PcrMatchesConstant rule for PCR 0</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 13</p>
<p>PcrMatchesConstant rule for PCR 14</p></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td>AssetTagMatches rule needs to be updated to verify the key-value pairs after verifying the tag certificate.</td>
</tr>
</tbody>
</table>

<h2 id="a2-intel-txt-and-the-trusted-boot-process">A.2  Intel TXT and the Trusted Boot Process</h2>
<h1 id="_2"><img src="C:\Users\raghave2\Desktop\Product Guide Markdown\images\trustedbootprocess" alt="image-20200622105132912" style="zoom:150%;" /></h1>
<p><span style="color: blue; font-size: 2.5em; font-weight: 700;">Intel® Security Libraries - Datacenter Functional Security</span></p>
<p><span style="color: blue; font-size: 1.5em;border-block-end: solid black;">Product Guide</span></p>
<p><span style="color: blue; font-size: 1em;font-style: italic;">August 2020</span>
<span style="color: blue; font-size: 1em;font-style: italic;">Revision 3.0</span></p>
<div style="page-break-after: always"></div>
<p><span style="color: black; font-size: 2em">Disclaimer</span><br/>
<strong>Notice:</strong> This document contains information on products in the design phase of development. The information here is subject to change without notice. Do not finalize a design with this information.</p>
<p>Intel technologies’ features and benefits depend on system configuration and may require enabled hardware, software, or service activation. Learn more at intel.com, or from the OEM or retailer.</p>
<p>No computer system can be absolutely secure. Intel does not assume any liability for lost or stolen data or systems or any damages resulting from such losses.</p>
<p>You may not use or facilitate the use of this document in connection with any infringement or other legal analysis concerning Intel products described herein. You agree to grant Intel a non-exclusive, royalty-free license to any patent claim thereafter drafted which includes subject matter disclosed herein.</p>
<p>No license (express or implied, by estoppel or otherwise) to any intellectual property rights is granted by this document.</p>
<p>The products described may contain design defects or errors known as errata which may cause the product to deviate from published
specifications. Current characterized errata are available on request.</p>
<p>This document contains information on products, services and/or processes in development. All information provided here is subject to
change without notice. Contact your Intel representative to obtain the latest Intel product specifications and roadmaps.</p>
<p>Intel disclaims all express and implied warranties, including without limitation, the implied warranties of merchantability, fitness for a particular purpose, and non-infringement, as well as any warranty arising from course of performance, course of dealing, or usage in trade.</p>
<p><strong>Warning:</strong> Altering PC clock or memory frequency and/or voltage may (i) reduce system stability and use life of the system, memory and
processor; (ii) cause the processor and other system components to fail; (iii) cause reductions in system performance; (iv) cause additional heat or other damage; and (v) affect system data integrity. Intel assumes no responsibility that the memory, included if used with altered clock frequencies and/or voltages, will be fit for any particular purpose.
Check with memory manufacturer for warranty and additional details.</p>
<p>Tests document performance of components on a particular test, in specific systems. Differences in hardware, software, or configuration
will affect actual performance. Consult other sources of information to evaluate performance as you consider your purchase. For more complete information about performance and benchmark results, visit <a href="http://www.intel.com/performance">http://www.intel.com/performance</a>.</p>
<p>Cost reduction scenarios described are intended as examples of how a given Intel- based product, in the specified circumstances and
configurations, may affect future costs and provide cost savings. Circumstances will vary. Intel does not guarantee any costs or cost
reduction.</p>
<p>Results have been estimated or simulated using internal Intel analysis or architecture simulation or modeling, and provided to you for
informational purposes. Any differences in your system hardware, software or configuration may affect your actual performance.</p>
<p>Intel does not control or audit third-party benchmark data or the web sites referenced in this document. You should visit the referenced web site and confirm whether referenced data are accurate.</p>
<p>Intel is a sponsor and member of the Benchmark XPRT Development Community, and was the major developer of the XPRT family of benchmarks. Principled Technologies is the publisher of the XPRT family of benchmarks. You should consult other information and performance tests to assist you in fully evaluating your contemplated purchases.</p>
<p>Copies of documents which have an order number and are referenced in this document may be obtained by calling 1-800-548-4725 or by visiting <a href="http://www.intel.com/design/literature.htm">www.intel.com/design/literature.htm.</a></p>
<p>Intel, the Intel logo, Intel TXT, and Xeon are trademarks of Intel Corporation in the U.S. and/or other countries.</p>
<p>*Other names and brands may be claimed as the property of others.</p>
<p>Copyright © 2020, Intel Corporation. All Rights Reserved.</p>
<div style="page-break-after: always"></div>
<p><span style="color: black; font-size: 2em">Revision History</span></p>
<table>
<tbody>
<tr class="odd">
<td>Document Number</td>
<td>Revision<br />
Number</td>
<td>Description</td>
<td>Date</td>
</tr>
<tr class="even">
<td></td>
<td>1</td>
<td><ul>
<li><p>Updated for all GA Failures</p></li>
</ul></td>
<td>May 2019</td>
</tr>
<tr class="odd">
<td></td>
<td>1.5</td>
<td><ul>
<li><p>Updated for version 1.5 release</p></li>
</ul></td>
<td>July 2019</td>
</tr>
<tr class="even">
<td></td>
<td>1.6 BETA</td>
<td><ul>
<li><p>Updated for 1.6 BETA release</p></li>
</ul></td>
<td>November 2019</td>
</tr>
<tr class="odd">
<td></td>
<td>1.6</td>
<td><ul>
<li><p>Updated for version 1.6 release</p></li>
</ul></td>
<td>December 2019</td>
</tr>
<tr class="even">
<td></td>
<td>2.0</td>
<td><ul>
<li><p>Updated for version 2.0 release</p></li>
</ul></td>
<td>February 2020</td>
</tr>
<tr class="odd">
<td></td>
<td>2.1</td>
<td><ul>
<li><p>Updated for version 2.1 release</p></li>
</ul></td>
<td>April 2020</td>
</tr>
<tr class="even">
<td></td>
<td>2.2</td>
<td><ul>
<li><p>Updated for version 2.2 release</p></li>
</ul></td>
<td>June 2020</td>
</tr>
<tr class="odd">
<td></td>
<td>3.0</td>
<td><ul>
<li><p>Updated for version 3.0 release</p></li>
</ul></td>
<td>August 2020</td>
</tr>
</tbody>
</table>

<div style="page-break-after: always"></div>
<h1 id="table-of-contents_1">Table of Contents</h1>
<p>[[<em>TOC</em>]]</p>
<div style="page-break-after: always"></div>
<h2 id="1-introduction_1">1  Introduction</h2>
<h2 id="11-overview_1">1.1  Overview</h2>
<p>Intel Security Libraries for Datacenter is a collection of software applications and development libraries intended to help turn Intel platform security  features into real-world security use cases.</p>
<h3 id="111-trusted-computing_1">1.1.1  Trusted Computing</h3>
<p>Trusted Computing consists of a set of industry standards defined by the Trusted Computing Group to harden systems and data against attack. These
standards include verifying platform integrity, establishing identity, protection of keys and secrets, and more. One of the functions of Intel Security Libraries is to provide a “Trusted Platform,” using Intel security technologies to add visibility, auditability, and control to server platforms.</p>
<h4 id="1111-the-chain-of-trust_1">1.1.1.1  The Chain of Trust</h4>
<p>In a Trusted Computing environment, a key concept is verification of the integrity of the underlying platform. Verifying platform integrity typically means cryptographic measurement and/or verification of firmware and software components. The process by which this measurement and verification takes place affects the overall strength of the assertion that the measured and verified components have not been altered. Intel refers to this process as the “<em>Chain of Trust</em>,” whereby at boot time, a sequence of cryptographic measurements and signature verification events happen in a defined order, such that
measurement/verification happens before execution, and each entity responsible for performing a measurement or verification is measured by
another step earlier in the process. Any break in this chain leads to an opportunity for an attacker to modify code and evade detection.</p>
<h4 id="1112-hardware-root-of-trust_1">1.1.1.2  Hardware Root of Trust</h4>
<p>The <em>Root of Trust,</em> the first link in the chain, can be one of several different options. Anything that happens in the boot process before the Root of Trust must be considered to be within the “trust boundary,” signifying components whose trustworthiness cannot be assessed. For this reason, it’s best to use a Root of Trust that starts as early in the system boot process as possible, so that the Chain of Trust during the boot process can cover as much as possible. </p>
<p>Multiple Root of Trust options exist, ranging from firmware to hardware. In general, a hardware Root of Trust will have a smaller “trust
boundary” than a firmware Root of Trust. A hardware Root of Trust will also have the benefit of immutability – where firmware can easily be
flashed and modified, hardware is much more difficult to tamper with.</p>
<h5 id="intel-trusted-execution-technology-intel-txt">Intel® Trusted Execution Technology (Intel® TXT)</h5>
<p>Intel® Trusted Execution Technology is a hardware Root of Trust feature available on Intel® server platforms starting with the Grantley generation. Intel® TXT is enabled in the system BIOS (typically under the Processor > Advanced tab), and requires Intel® VT-d and Intel VT-x features to be enabled as prerequisites (otherwise the option will be grayed out). Intel® TXT will ship “disabled” by default.</p>
<h5 id="intel-bootguard-intel-btg">Intel® BootGuard (Intel® BtG)</h5>
<p>Intel® BootGuard is a hardware Root of Trust feature available on Intel® server platforms starting with the Purley-Refresh generation. Unlike
Intel® TXT, Intel® BtG is configured in platform fuses, not in the system BIOS. Intel® BtG is fused into several “profiles” that determine the behavior of the feature. Intel® BtG supports both “verify” and “measure” profiles; in “verify” profiles, Intel® BtG will verify the signature of the platform Initial Boot Block (IBB). In “measure”profiles, Intel® BtG will hash the IBB and extend that measurement to a TPM PCR. It is recommended that Intel® BtG be fused into the “measure and verify” profile for maximum protection and auditability.</p>
<p>Because the Intel® BtG profile is configured using fuses, the server OEM/ODM will determine the profile used at manufacturing time. Please contact your server vendor to determine what Intel® BtG profiles are available in their product line.</p>
<p>Because Intel® BtG only measures/verifies the integrity of the IBB, it’s important to have an additional technology handle measurements later in the boot process. Intel® TXT can provide this function using tboot to invoke SINIT, and UEFI SecureBoot can alternatively provide similar functionality (note that Linux users should properly configure Shim and use a signed kernel for UEFI SecureBoot).</p>
<h4 id="1113-supported-trusted-boot-options_1">1.1.1.3  Supported Trusted Boot Options</h4>
<p>Intel® SecL-DC supports several options for Trusted Computing, depending
on the features available on the platform.</p>
<p><img src="images\tboot options.png" style="zoom:150%;" /></p>
<p><strong><em>Note</em></strong>: <em>A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on
RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.</em></p>
<h4 id="1114-remote-attestation_1">1.1.1.4  Remote Attestation</h4>
<p>Trusted computing consists primarily of two activities – measurement, and attestation. Measurement is the act of obtaining cryptographic representations for the system state. Attestation is the act of comparing those cryptographic measurements against expected values to determine whether the system booted into an acceptable state. </p>
<p>Attestation can be performed either locally, on the same host that is to be attested, or remotely, by an external authority. The trusted boot process can optionally include a local attestation involving the evaluation of a TPM-stored Launch Control Policy (LCP). In this case, the host’s TPM will compare the measurements that have been taken so far to a set of expected PCR values stored in the LCP; if there is a mismatch, the boot process is halted entirely. </p>
<p>Intel® SecL utilizes remote attestation, providing a remote Verification Service that maintains a database of expected measurements (or “flavors”), and compares the actual boot-time measurements from any number of hosts against its database to provide an assertion that the host booted into a “trusted” or “untrusted” state. Remote attestation is typically easier to centrally manage (as opposed to creating an LCP for each host and entering the policy into the host’s TPM), does not halt the boot process allowing for easier remediation, and separates the attack surface into separate components that must both be compromised to bypass security controls.</p>
<p>Both local and remote attestation can be used concurrently. However, Intel® SecL, and this document, will focus only on remote attestation. For more information on TPM Launch Control Policies, consult the <em>Intel Trusted Execution Technology (Intel TXT) Software Development Guide</em> (<a href="https://www.intel.com/content/dam/www/public/us/en/documents/guides/intel-txt-software-development-guide.pdf">https://www.intel.com/content/dam/www/public/us/en/documents/guides/intel-txt-software-development-guide.pdf</a>).</p>
<h3 id="112-intel-security-libraries-for-datacenter-features_1">1.1.2  Intel® Security Libraries for Datacenter Features</h3>
<h4 id="1121-platform-integrity_1">1.1.2.1  Platform Integrity</h4>
<p>Platform Integrity is the use case enabled by the specific implementation of the Chain of Trust and Remote Attestation concepts. This involves the use of a Root of Trust to begin an unbroken chain of platform measurements at server boot time, with measurements extended to the Trusted Platform Module and compared against expected values to verify the integrity of measured components. This use case is foundational for other Intel® SecL use cases.</p>
<h4 id="1122-data-sovereignty_1">1.1.2.2  Data Sovereignty</h4>
<p>Data Sovereignty builds on the Platform Integrity use case to allow physical TPMs to be written with Asset Tags containing any number of key/value pairs. This use case is typically used to identify the geographic location of the physical server, but can also be used to identify other attributes. For example, the Asset Tags provided by the Data Sovereignty use case could be used to identify hosts that meet specific compliance requirements and can run controlled workloads.</p>
<h4 id="1123-application-integrity_1">1.1.2.3  Application Integrity</h4>
<p>Added in the Intel® SecL-DC 1.5 release, Application Integrity allows any files and folders on a Linux host system to be included in the Chain of Trust integrity measurements. These measurements are attested by the Verification Service along with the other platform measurements, and are included in determining the host’s overall Trust status. The measurements are performed by a measurement agent called tbootXM, which is built into initrd during Trust Agent installation. Because initrd is included in other Trusted Computing measurements, this allows Intel® SecL-DC to carry the Chain of Trust all the way to the Linux filesystem.</p>
<h4 id="1124-workload-confidentiality-for-virtual-machines-and-containers_1">1.1.2.4  Workload Confidentiality for Virtual Machines and Containers</h4>
<p>Added in the Intel® SecL-DC 1.6 release, Workload Confidentiality allows virtual machine and Docker container images to be encrypted at rest, with key access tied to platform integrity attestation. Because security attributes contained in the platform integrity attestation report are used to control access to the decryption keys, this feature provides both protection for at-rest data, IP, code, etc in Docker container or virtual machine images, and also enforcement of image-owner-controlled placement policies. When decryption keys are released, they are sealed to the physical TPM of the host that was attested, meaning that only a server that has successfully met the policy requirements for the image can actually gain access.</p>
<p>Workload Confidentiality begins with the Workload Policy Manager (WPM) and a qcow2 or Docker image that needs to be protected. The WPM is a lightweight application that will request a new key from the Key Broker, use that key to encrypt the image, and generate an Image Flavor. The image owner will then upload the encrypted image to their desired image storage service (for example, OpenStack Glance or a local Docker Registry), and the image ID from the image storage will be uploaded along with the Image Flavor to the Intel® SecL Workload Service. When that image is used to launch a new VM or container, the Workload Agent will intercept the VM or container start and request the decryption key for that image from the Workload Service. The Workload Service will use the image ID and the Image Flavor to find the key transfer URL for the appropriate Key Broker, and will query the Verification Service for the latest Platform Integrity trust attestation report for the host. The Key Broker will use the attestation report to determine whether the host meets the policy requirements for the key transfer, and to verify that the report is signed by a Verification Service known to the Broker. If the report is genuine and meets the policy requirements, the image decryption key is sealed using an asymmetric key from that host’s TPM, and sent back to the Workload Service. The Workload Service then caches the key for 5 minutes (to avoid performance issues for multiple rapid launch requests; note that these keys are still wrapped using a sealing key unique to the hosts TPM, so multiple hosts would require multiple keys even for an identical image) and return the wrapped key to the Workload Agent on the host, which then uses the host TPM to unseal the image decryption key. The key is then used to create a new LUKS volume, and the image is decrypted into this volume. </p>
<p>This functionality means that a physical host must pass policy requirements in order to gain access to the image key, and the image will be encrypted at rest both in image storage and on the compute host.</p>
<p>Beginning with the Intel® SecL-DC version 2.1 release, the Key Broker now supports 3<sup>rd</sup>-party key managers that are KMIP-compliant. The Key Broker has been updated to use the “libkmip” client.</p>
<h4 id="1125-signed-flavors_1">1.1.2.5  Signed Flavors</h4>
<p>Added in the Intel® SecL-DC 1.6 release, Flavor signing is an improvement to the existing handling of expected attestation measurements, called “Flavors.” This feature adds the ability to digitally sign Flavors so that the integrity of the expected measurements themselves can be verified when attestations occur. This also means that Flavors can be more securely transferred between different Verification Service instances.</p>
<p>Flavor signing is seamlessly added to the existing Flavor creation process (both importing from a sample host and “manually” creating a Flavor using the POST method to the /v2/flavors resource). When a Flavor is created, the Verification Service will sign it using a signing certificate signed by the Certificate Management Service (this is created during Verification Service setup). Each time that the Verification Service evaluates a Flavor, it will first verify the signature on that Flavor to ensure the integrity of the Flavor contents before it is used to attest the integrity of any host.</p>
<h4 id="1126-trusted-virtual-kubernetes-worker-nodes_1">1.1.2.6  Trusted Virtual Kubernetes Worker Nodes</h4>
<p>Added in the Intel® SecL-DC version 2.1 release, this feature provides a Chain of Trust solution extending to Kubernetes Worker Nodes deployed as Virtual Machines. This feature addresses Kubernetes deployments that use Virtual Machines as Worker Nodes, rather than using bare-metal servers. </p>
<p>When libvirt initiates a VM Start, the Intel® SecL-DC Workload Agent will create a report for the VM that associates the VM’s trust status with the trust status of the host launching the VM. This VM report will be retrievable via the Workload Service, and contains the hardware UUID of the physical server hosting the VM. This UUID can be correlated to the Trust Report of that server at the time of VM launch, creating an audit trail validating that the VM launched on a trusted platform. A new report is created for every VM Start, which includes actions like VM migrations, so that each time a VM is launched or moved a new report is generated ensuring an accurate trust status.</p>
<p>By using Platform Integrity and Data Sovereignty-based orchestration (or Workload Confidentiality with encrypted worker VMs) for the Virtual Machines to ensure that the virtual Kubernetes Worker nodes only launch on trusted hardware, these VM trust reports provide an auditing capability to extend the Chain of Trust to the virtual Worker Nodes.</p>
<div style="page-break-after: always"></div>
<h1 id="2-intel-security-libraries-components_1">2  Intel® Security Libraries Components</h1>
<h2 id="21-certificate-management-service_1">2.1  Certificate Management Service</h2>
<p>Starting with Intel® SecL-DC 1.6, most non-TPM-related certificates used by Intel® SecL-DC applications will be issued by the new Certificate Management Service. This includes acting as a root CA and issuing TLS certificates for all of the various web services. </p>
<h2 id="22-authentication-and-authorization-service_1">2.2  Authentication and Authorization Service</h2>
<p>Starting with Intel® SecL-DC 1.6, authentication and authorization for all Intel® SecL applications will be centrally managed by the new Authentication and Authorization Service (AAS). Previously, each application would manage its own users and permissions independently; this change allows authentication and authorization management to be centralized.</p>
<h2 id="23-verification-service_1">2.3  Verification Service</h2>
<p>The Verification Service component of Intel® Security Libraries performs the core Platform Integrity and Data Sovereignty functionality by acting as a remote attestation authority.</p>
<p>Platform security technologies like Intel® TXT, Intel® BootGuard, and UEFI SecureBoot extend measurements of platform components (such as the system BIOS/UEFI, OS kernel, etc) to a Trusted Platform module as the server boots. Known-good measurements for each of these components can be directly imported from a sample server. These expected measurements can then be compared against actual measurements from registered servers, allowing the Verification Service to attest to the "trustiness" of the platform, meaning whether the platform booted into a "known-good" state.</p>
<h2 id="24-workload-service_1">2.4  Workload Service</h2>
<p>The Workload Service acts as a management service for handling Workload Flavors (Flavors used for Virtual Machines and Containers). In the Intel® SecL-DC 1.6 release, the Workload Service uses Flavors to map decryption key IDs to image IDs. When a launch request for an encrypted workload image is intercepted by the Workload Agent, the Workload Service will handle mapping the image ID to the appropriate key ID and key request URL, and will initiate the key transfer request to the Key Broker. </p>
<h2 id="25-trust-agent_1">2.5  Trust Agent</h2>
<p>The Trust Agent resides on physical servers and enables both remote attestation and the extended chain of trust capabilities. The Agent maintains ownership of the server's Trusted Platform Module, allowing secure attestation quotes to be sent to the Verification Service. Incorporating the Intel® SecL HostInfo and TpmProvider libraries, the Trust Agent serves to report on platform security capabilities and platform integrity measurements. </p>
<p>The Trust Agent is supported for Windows<em> Server 2016 Datacenter and Red Hat Enterprise Linux</em> (RHEL) 8.1 and later. </p>
<h2 id="26-workload-agent_1">2.6  Workload Agent</h2>
<p>The Workload Agent is the component responsible for handling all of the functions needed for Workload Confidentiality for virtual machines and Docker containers on a physical server. The Workload Agent uses libvirt hooks to identify VM lifecycle events (VM start, stop, hibernate, etc), and intercepts those events to perform needed functions like requesting decryption keys, creation and deletion of encrypted LUKS volumes, using the TPM to unseal decryption keys, etc. The WLA also includes the Docker SecureOverlay Driver that performs analogous functionality for Docker containers.</p>
<h2 id="27-integration-hub_1">2.7  Integration Hub</h2>
<p>The Integration Hub acts as a middle-man between the Verification Service and one or more scheduler services (such as OpenStack* Nova), and "pushes" attestation information retrieved from the Verification Service to one or more scheduler services according to an assignment of hosts to specific tenants. In this way, Tenant A can receive attestation information for hosts that belong to Tenant A, but receive no information about hosts belonging to Tenant B. </p>
<p>The Integration Hub serves to disassociate the process of retrieving attestations from actual scheduler queries, so that scheduler services can adhere to best practices and retain better performance at scale. The Integration Hub will regularly query the Intel® SecL Verification Service for SAML attestations for each host. The Integration Hub maintains only the most recent currently valid attestation for each host, and will refresh attestations when they would expire. The Integration Hub will verify the signature of the SAML attestation for each host assigned to a tenant, then parse the attestation status and asset tag information, and then will securely push the parsed key/value pairs to the plugin endpoints enabled.</p>
<p>The Integration Hub features a plugin design for adding new scheduler endpoint types. Currently the Integration Hub supports OpenStack Nova and Kubernetes endpoint plugins. Other integration plugins may be added.</p>
<h2 id="28-workload-policy-manager_1">2.8  Workload Policy Manager</h2>
<p>The Workload Policy Manager is a Linux command line utility used by an image owner to encrypt VM (qcow2) or container (Docker) images, and to create an Image Flavor used to provide the encryption key transfer URL during launch requests. The WPM utility will use an existing or request a new key from the Key Broker Service, use that key to encrypt the image, and output the Image Flavor in JSON format. The encrypted image can then be uploaded to the image store of choice (like OpenStack Glance), and the Image Flavor can be uploaded to the Workload Service. The ID of the image on the image storage system is then mapped to the Image Flavor in the WLS; when the image is used to launch a new instance, the WLS will find the Image Flavor associated with that image ID, and use the Image Flavor to determine the key transfer URL.</p>
<h2 id="29-key-broker-service_1">2.9  Key Broker Service</h2>
<p>The Key Broker Service is effectively a policy compliance engine. Its job is to manage key transfer requests for encrypted images, releasing keys only to servers that meet policy requirements. The Key Broker registers one or more SAML signing certificates from any Verification Services that it will trust. When a key transfer request is received, the request includes a trust attestation report signed by the Verification Service. If the signature matches a registered SAML key, the Broker will then look at the actual report to ensure the server requesting the key matches the image policy (currently only overall system trust is supported as a policy requirement). If the report indicates the policy requirements are met, the image decryption key is wrapped using a public key unique to the TPM of the host that was attested in the report, such that only the host that was attested can unseal the decryption key and gain access to the image.</p>
<div style="page-break-after: always"></div>
<h1 id="3-intel-security-libraries-installation_1">3  Intel® Security Libraries Installation</h1>
<h2 id="31-building-from-source_1">3.1  Building from Source</h2>
<p>Intel® Security Libraries is distributed as open source code, and must be compiled into installation binaries before installation.</p>
<p>Instructions and sample scripts for building the Intel® SecL-DC components can be found here:</p>
<p><a href="https://01.org/intel-secl/documentation/build-installation-scripts">https://01.org/intel-secl/documentation/build-installation-scripts</a></p>
<p>After the components have been built, the installation binaries can be found in the directories created by the build scripts. </p>
<div class="highlight"><pre><span></span><code>&lt;servicename&gt;/out/&lt;servicename&gt;.bin
</code></pre></div>
<p>In addition, the build script will produce some sample database creation scripts that can be used during installation to configure database requirements (instructions are given in the installation sections):</p>
<p>create_db: <code>authservice/out/create_db.sh</code></p>
<p>install_pgdb: <code>authservice/out/install_pgdb.sh</code></p>
<h2 id="32-hardware-considerations_1">3.2  Hardware Considerations</h2>
<p>Intel® SecL-DC supports and uses a variety of Intel security features, but there are some key requirements to consider before beginning an installation. Most important among these is the Root of Trust configuration. This involves deciding what combination of TXT, Boot Guard, tboot, and UEFI Secure Boot to enable on platforms that will be attested using Intel® SecL. </p>
<p>Key points: </p>
<ul>
<li>
<p>At least one "Static Root of Trust" mechanism must be used (TXT and/or BtG)</p>
</li>
<li>
<p>For Legacy BIOS systems, tboot must be used</p>
</li>
<li>
<p>For UEFI mode systems, UEFI SecureBoot must be used*</p>
</li>
</ul>
<p>Use the chart below for a guide to acceptable configuration options. .</p>
<p><img src="images\hardware_considerations.png" alt="image-20200620161440899" style="zoom:150%;" /></p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.</em>
</p>
</blockquote>
<h2 id="33-recommended-service-layout_1">3.3  Recommended Service Layout</h2>
<p>The Intel® SecL-DC services can be installed in a variety of layouts, partially depending on the use cases desired and the OS of the server(s) to be protected. In general, the Intel® SecL-DC applications can be divided into management services that are deployed on the network on the management plane, and host or node components that must be installed on each protected server. </p>
<p>Management services can typically be deployed anywhere with network access to all of the protected servers. This could be a set of individual VMs per service; containers; or all installed on a single physical or virtual machine.</p>
<p>Node components must be installed on each protected physical server. Typically this is needed for Linux deployments.</p>
<h3 id="331-platform-integrity_1">3.3.1  Platform Integrity</h3>
<p>The most basic use case enabled by Intel® SecL-DC, Platform Integrity requires only the Verification Service and, to protect Windows or Linux hosts, the Trust Agent. This also enables the Application Integrity use case by default for Linux systems.</p>
<p>The Integration Hub may be added to provide integration support for OpenStack or Kubernetes. The Hub is often installed on the same machine as the Verification Service, but optionally can be installed separately.</p>
<h3 id="332-workload-confidentiality_1">3.3.2  Workload Confidentiality</h3>
<p>Workload Confidentiality introduces a number of additional services and agents. For a POC environment, all of the management services can be installed on a single machine or VM. This includes:</p>
<p>Certificate Management Service (CMS)</p>
<p>Authorization and Authentication Service (AAS)</p>
<p>Host Verification Service (HVS)</p>
<p>Workload Service (WLS)</p>
<p>Integration Hub (HUB)</p>
<p>Key Broker Service (KBS) with backend key management </p>
<p>Workload Policy Manager (WPM)</p>
<p>In a production environment, it is strongly suggested that the WPM and KBS be deployed (with their own CMS and AAS) separately for each image owner. For a Cloud Service Provider, this would mean that each customer/tenant who will use the Workload Confidentiality feature would have their own dedicated AAS/CMS/KBS/WPM operated on their own networks, not controlled by the CSP. This is because the Key Broker and WPM are the tools used to define the policies that will allow images to launch, and these policies and their enforcement should remain entirely under the control of the image owner.</p>
<p>The node components must be installed on each protected physical server:</p>
<p>Trust Agent (TA)</p>
<p>Workload Agent (WLA)</p>
<p><img src="images\service_layout" alt="image-20200620161752980" style="zoom:150%;" /></p>
<h2 id="34-installingconfiguring-the-database_1">3.4  Installing/Configuring the Database</h2>
<p>The Intel® SecL-DC Authentication and Authorization Service (AAS) requires a Postgresql 11 database. Scripts <code>(install_pgdb.sh</code>, <code>create_db.sh</code>) are provided with the AAS that will automatically add the Postgresql repositories and install/configure a sample database. If this script will not be used, a Postgresql 11 database must be installed by the user before executing the AAS installation.</p>
<h3 id="341-using-the-provided-database-installation-script_1">3.4.1  Using the Provided Database Installation Script</h3>
<p>Install a sample Postgresql 11 database using the <code>install_pgdb.sh</code> script. This script will automatically install the Postgresql database and client packages required.</p>
<p>Add the Postgresql 11 repository:</p>
<p><a href="https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm">https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm</a></p>
<p>Create the <code>iseclpgdb.env</code> answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ISECL_PGDB_IP_INTERFACES</span><span class="o">=</span>localhost
<span class="nv">ISECL_PGDB_PORT</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">ISECL_PGDB_SAVE_DB_INSTALL_LOG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">ISECL_PGDB_CERT_DNS</span><span class="o">=</span>localhost
<span class="nv">ISECL_PGDB_CERT_IP</span><span class="o">=</span><span class="m">127</span>.0.0.1
</code></pre></div>
<p>Note that the values above assume that the database will be accessed locally. If the database server will be external to the Intel® SecL services, change these values to the hostname or FQDN and IP address where the client will access the database server.</p>
<p>Run the following command:</p>
<div class="highlight"><pre><span></span><code>dnf module disable postgresql -y
</code></pre></div>
<p>Execute the installation script:</p>
<div class="highlight"><pre><span></span><code>./install_pgdb.sh
</code></pre></div>
<blockquote>
<p><strong><em>Note</em></strong>: <em>The database installation only needs to be performed once if the same database server will be used for all services that require a database. Only the "create_db" step needs to be repeated if the database server will be shared.</em></p>
</blockquote>
<h3 id="342-provisioning-the-database_1">3.4.2  Provisioning the Database</h3>
<p>Each Intel® SecL service that uses a database (the Authentication and Authorization Service, the Verification Service, the Integration Hub, the Workload Service) requires its own schema and access. After installation, the database must be created initialized and tables created. Execute the <code>create_db.sh</code> script to configure the database. </p>
<p>If a single shared database server will be used for each Intel® SecL service (for example, if all management plane services will be installed on a single VM), run the script multiple times, once for each service that requires a database.</p>
<p>If separate database servers will be used (for example, if the management plane services will reside on separate systems and will use their own local database servers), execute the script on each server hosting a database.</p>
<div class="highlight"><pre><span></span><code>./create_db.sh &lt;database name&gt; &lt;database_username&gt; &lt;database_password&gt;
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>./create_db.sh isecl_hvs_db hvs_db_username hvs_db_password
./create_db.sh isecl_aas_db aas_db_username aas_db_password
./create_db.sh isecl_wls_db wls_db_username wls_db_password
./create_db.sh isecl_hub_db hub_db_username hub_db_password
</code></pre></div>
<p>Note that the database name, username, and password details for each service must be used in the corresponding installation answer file for that service. </p>
<h3 id="343-database-server-tls-certificate_1">3.4.3  Database Server TLS Certificate</h3>
<p>The database client for Intel® SecL services requires the database TLS certificate to authenticate communication with the database server. </p>
<p>If the database server for a service is located on the same server that the service will run on, only the path to this certificate is needed. If the provided Postgres scripts are used, the certificate will be located in <code>/usr/local/pgsql/data/server.crt</code></p>
<p>If the database server will be run separately from the Intel® SecL service(s), the certificate will need to be copied from the database server to the service machine before installing the Intel® SecL services. </p>
<p>The database client for Intel® SecL services will validate that the Subject Alternative Names in the database server’s TLS certificate contain the hostname(s)/IP address(es) that the clients will use to access the database server. If configuring a database without using the provided scripts, ensure that these attributes are present in the database TLS certificate.</p>
<h2 id="35-installing-the-certificate-management-service_1">3.5  Installing the Certificate Management Service</h2>
<h3 id="351-required-for_1">3.5.1  Required For</h3>
<p>The CMS is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="352-supported-operating-systems_1">3.5.2  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Certificate Management Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="353-recommended-hardware_1">3.5.3  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>10 GB</p>
</li>
<li>
<p>One network interface with network access to all Intel® SecL-DC services</p>
</li>
</ul>
<h3 id="354-installation_1">3.5.4  Installation</h3>
<p>To install the Intel® SecL-DC Certificate Management Service:</p>
<ol>
<li>
<p>Copy the Certificate Management Service installation binary to the <code>/root</code> /directory.</p>
</li>
<li>
<p>Create the <code>cms.env</code> installation answer file for an unattended installation:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nv">AAS_TLS_SAN</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the AAS&gt;
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;Authentication and Authorization Service IP or Hostname&gt;:8444/aas
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;Comma-separated list of IP addresses and hostnames <span class="k">for</span> the CMS&gt;,127.0.0.1,localhost 
</code></pre></div>
<p>The SAN list will be used to authenticate the Certificate Signing Request from the AAS to the CMS. Only a CSR originating from a host matching the SAN list will be honored. Later, in the AAS <code>authservice.env</code> installation answer file, this same SAN list will be provided for the AAS installation. These lists must match, and must be valid for IPs and/or hostnames used by the AAS system. If both the AAS and CMS will be installed on the same system, "127.0.0.1,localhost" may be used. The SAN list variables also accept the wildcards “?” (for single-character wildcards) and "*" (for multiple-character wildcards) to allow address ranges or multiple FQDNs.</p>
<p>The <code>AAS_API_URL</code> represents the URL for the AAS that will exist after the AAS is installed.</p>
<p>For all configuration options and their descriptions, refer to the Intel® SecL Configuration section on the Certificate Management Service.</p>
<ol>
<li>Execute the installer binary.</li>
</ol>
<div class="highlight"><pre><span></span><code>./cms-v3.3.1.bin
</code></pre></div>
<pre><code>When the installation completes, the Certificate Management Service is available. The services can be verified by running cms status from the command line.
</code></pre>
<div class="highlight"><pre><span></span><code> cms status
</code></pre></div>
<p>After installation is complete, the CMS will output a bearer token to the console. This token will be used with the AAS during installation to authenticate certificate requests to the CMS. If this token expires or otherwise needs to be recreated, use the following command:</p>
<pre><code>```shell
cms setup cms_auth_token --force
```
</code></pre>
<p>In addition, the SHA384 digest of the CMS TLS certificate will be needed for installation of the remaining Intel® SecL services. The digest can be obtained using the following command:</p>
<div class="highlight"><pre><span></span><code>cms tlscertsha384
</code></pre></div>
<h2 id="36-installing-the-authentication-and-authorization-service_1">3.6  Installing the Authentication and Authorization Service</h2>
<h3 id="361-required-for_1">3.6.1  Required For</h3>
<p>The AAS is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="362-prerequisites_1">3.6.2  Prerequisites</h3>
<p>The following must be completed before installing the Authentication and Authorization Service:</p>
<ul>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service database must be available</p>
</li>
</ul>
<h3 id="363-package-dependencies_1">3.6.3  Package Dependencies</h3>
<p>The Intel® SecL-DC Authentication and Authorization Service (AAS) requires a Postgresql 11 database. A script (<code>install_pgdb.sh</code>) is provided with the AAS that will automatically add the Postgresql repositories and install/configure a sample database. If this script will not be used, a Postgresql 11 database must be installed by the user before executing the AAS installation.</p>
<h3 id="364-supported-operating-systems_1">3.6.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Authentication and Authorization Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="365-recommended-hardware_1">3.6.5  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>10 GB</p>
</li>
<li>
<p>One network interface with network access to all Intel® SecL-DC services</p>
</li>
</ul>
<h3 id="366-installation_1">3.6.6  Installation</h3>
<p>To install the AAS, a bearer token from the CMS is required. This bearer token is output at the end of the CMS installation. However, if a new token is needed, simply use the following command from the CMS command line:</p>
<div class="highlight"><pre><span></span><code>cms setup cms_auth_token --force
</code></pre></div>
<p>Create the <code>authservice.env</code> installation answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;CMS IP or hostname&gt;:8445/cms/v1/
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;CMS TLS certificate sha384&gt;
<span class="nv">AAS_DB_HOSTNAME</span><span class="o">=</span>&lt;IP or hostname of database server&gt;
<span class="nv">AAS_DB_PORT</span><span class="o">=</span>&lt;database port number<span class="p">;</span> default is <span class="m">5432</span>&gt;
<span class="nv">AAS_DB_NAME</span><span class="o">=</span>&lt;database name&gt;
<span class="nv">AAS_DB_USERNAME</span><span class="o">=</span>&lt;database username&gt;
<span class="nv">AAS_DB_PASSWORD</span><span class="o">=</span>&lt;database password&gt;
<span class="nv">AAS_DB_SSLCERTSRC</span><span class="o">=</span>&lt;path to database TLS certificate<span class="p">;</span> the default location is typically /usr/local/pgsql/data/server.crt&gt;
<span class="nv">AAS_ADMIN_USERNAME</span><span class="o">=</span>&lt;username <span class="k">for</span> AAS administrative user&gt;
<span class="nv">AAS_ADMIN_PASSWORD</span><span class="o">=</span>&lt;password <span class="k">for</span> AAS administrative user&gt;
<span class="nv">SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the AAS<span class="p">;</span> this should match the value <span class="k">for</span> the AAS_TLS_SAN <span class="k">in</span> the cms.env file from the CMS installation&gt;
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;bearer token from CMS installation&gt;
</code></pre></div>
<p>Execute the AAS installer:</p>
<div class="highlight"><pre><span></span><code>./authservice-v3.3.1.bin
</code></pre></div>
<blockquote>
<p><strong><em>Note:</em></strong> <em>The <code>AAS_ADMIN</code> credentials specified in this answer file will have administrator rights for the AAS and can be used to create other users, create new roles, and assign roles to users.</em></p>
</blockquote>
<h3 id="367-creating-users_1">3.6.7  Creating Users</h3>
<p>After installation is complete, a number of roles and user accounts must be generated. Most of these accounts will be service users, used by the various Intel® SecL services to work together. Another set of users will be used for installation permissions, and a final administrative user will be created to provide the initial authentication interface for the actual human user. The administrative user can be used to create additional users with appropriately restricted roles based on organizational needs.</p>
<p>Creating these required users and roles is facilitated by a script that will accept credentials and some configuration settings from an answer file and automate the process.</p>
<p>Create the <code>populate-users.env</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ISECL_INSTALL_COMPONENTS</span><span class="o">=</span>KBS,TA,WLS,WPM,AH,HVS,WLA,AAS

<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;AAS IP address or hostname&gt;:8444/aas
<span class="nv">AAS_ADMIN_USERNAME</span><span class="o">=</span>&lt;AAS username&gt;
<span class="nv">AAS_ADMIN_PASSWORD</span><span class="o">=</span>&lt;AAS password&gt;

<span class="nv">HVS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Host Verification Service&gt;
<span class="nv">IH_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Integration Hub&gt;
<span class="nv">WLS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Workload Service&gt;
<span class="nv">KBS_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Key Broker Service&gt;
<span class="nv">TA_CERT_SAN_LIST</span><span class="o">=</span>&lt;comma-separated list of IPs and hostnames <span class="k">for</span> the Trust Agent&gt;

<span class="nv">HVS_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the HVS service user&gt;
<span class="nv">HVS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the HVS service user&gt;

<span class="nv">IH_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the Hub service user&gt;
<span class="nv">IH_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the Hub service user&gt;

<span class="nv">WPM_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WPM service user&gt;
<span class="nv">WPM_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WPM service user&gt;

<span class="nv">WLS_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WLS service user&gt;
<span class="nv">WLS_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WLS service user&gt;

<span class="nv">WLA_SERVICE_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the WLA service user&gt;
<span class="nv">WLA_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the WLA service user&gt;

<span class="nv">GLOBAL_ADMIN_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the global Administrator user
<span class="nv">GLOBAL_ADMIN_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the global Administrator user

<span class="nv">INSTALL_ADMIN_USERNAME</span><span class="o">=</span>&lt;Username <span class="k">for</span> the installation user
<span class="nv">INSTALL_ADMIN_PASSWORD</span><span class="o">=</span>&lt;Password <span class="k">for</span> the global installation user
</code></pre></div>
<blockquote>
<p><strong><em>Note</em></strong>: <em>The <code>ISECL_INSTALL_COMPONENTS</code> variable is a comma-separated list of the components that will be used in your environment. Not all services are required for every use case. If a given service will not be used in your deployment, simply delete the unnecessary service abbreviation from the <code>ISECL_INSTALL_COMPONENTS</code> list, and leave the SAN and credential variables for that service blank.</em></p>
<p><strong><em>Note</em></strong>:  <em>The SAN list variables each support wildcards( "</em>" and "?"). <em>In particular, without wildcards the Trust Agent SAN list would need to explicitly list each hostname or IP address for all Trust Agents that will be installed, which is not generally feasible. Using wildcards, domain names and entire IP ranges can be included in the SAN list, which will allow any host matching those ranges to install the relevant service. The SAN list specified here must exactly match the SAN list for the applicable service in that service’s env installation file.</em></p>
</blockquote>
<p>Execute the populate-users script:</p>
<div class="highlight"><pre><span></span><code>./populate-users.sh
</code></pre></div>
<blockquote>
<p><strong><em>Note:</em></strong>  <em>The script can be executed with the <code>–output_json</code> argument to create the <code>populate-user.json</code>.This json output file will contain all of the users created by the script, along with usernames, passwords, and role assignments. This file can be used both as a record of the service and administrator accounts, and can be used as alternative inputs to recreate the same users with the same credentials in the future if needed. Be sure to protect this file if the <code>–output_json</code> argument is used.</em></p>
</blockquote>
<p>The script will automatically generate the following users:</p>
<p>Verification Service User</p>
<p>Integration Hub Service User</p>
<p>Workload Policy Manager Service User</p>
<p>Workload Service User Name</p>
<p>Workload Service User</p>
<p>Global Admin User</p>
<p>Installation User</p>
<p>These user accounts will be used during installation of several of the Intel® SecL-DC applications. In general, whenever credentials are required by an installation answer file, the variable name should match the name of the corresponding variable used in the <code>populate-users.env</code> file.</p>
<p>The Global Admin user account has all roles for all services. This is a default administrator account that can be used to perform any task, including creating any other users. In general this account is useful for POC installations, but in production it should be used only to create user accounts with more restrictive roles. The administrator credentials should be protected and not shared.</p>
<p>The populate-users script will also output an installation token. This token has all privileges needed for installation of the Intel® SecL services, and uses the credentials provided with the <code>INSTALLATION_ADMIN_USERNAME</code> and password. The remaining Intel ® SecL-DC services require this token (set as the <code>BEARER_TOKEN</code> variable in the installation env files) to grant the appropriate privileges for installation. By default this token will be valid for two hours; the populate-users script can be rerun with the same <code>populate-users.env</code> file to regenerate the token if more time is required, or the <code>INSTALLATION_ADMIN_USERNAME</code> and password can be used to generate an authentication token. </p>
<h2 id="37-installing-the-host-verification-service_1">3.7  Installing the Host Verification Service</h2>
<p>This section details how to install the Intel® SecL-DC services. For instructions on running these services as containers, see the following section.</p>
<h3 id="371-required-for_1">3.7.1  Required For</h3>
<p>The Host Verification Service is REQUIRED for all use cases.</p>
<ul>
<li>
<p>Platform Integrity with Data Sovereignty and Signed Flavors</p>
</li>
<li>
<p>Application Integrity</p>
</li>
<li>
<p>Workload Confidentiality (both VMs and Docker Containers)</p>
</li>
</ul>
<h3 id="372-prerequisites_1">3.7.2  Prerequisites</h3>
<p>The following must be completed before installing the Verification Service:</p>
<ul>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service must be installed and available</p>
</li>
<li>The Verification Service database must be available</li>
</ul>
<h3 id="373-package-dependencies_1">3.7.3  Package Dependencies</h3>
<p>The Intel® Security Libraries Verification Service requires the following packages and their dependencies:</p>
<ul>
<li>logback</li>
<li>Postgres* client and server 11.6 (server component optional if an external Postgres database is used)</li>
<li>unzip</li>
<li>zip</li>
<li>openssl</li>
<li>wget</li>
<li>net-tools</li>
<li>python3-policycoreutils</li>
</ul>
<p>If they are not already installed, the Verification Service installer attempts to install these automatically using the package manager. Automatic installation requires access to package repositories (the RHEL subscription repositories, the EPEL repository, or a suitable mirror), which may require an Internet connection. If the packages are to be installed from the package repository, be sure to update the repository package lists before installation.</p>
<h3 id="374-supported-operating-systems_1">3.7.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Verification Service supports Red Hat Enterprise Linux 8.2.</p>
<h3 id="375-recommended-hardware_1">3.7.5  Recommended Hardware</h3>
<ul>
<li>
<p>4 vCPUs</p>
</li>
<li>
<p>RAM: 8 GB</p>
</li>
<li>
<p>100 GB</p>
</li>
<li>
<p>One network interface with network access to all managed servers</p>
</li>
<li>
<p>(Optional) One network interface for Asset Tag provisioning (only required for “pull” tag provisioning; required to provision Asset Tags to VMware ESXi servers).</p>
</li>
</ul>
<h3 id="376-installation_1">3.7.6  Installation</h3>
<p>To install the Verification Service, follow these steps:</p>
<ol>
<li>
<p>Copy the Verification Service installation binary to the <code>/root</code> directory.</p>
</li>
<li>
<p>Create the <code>hvs.env</code> installation answer file.</p>
</li>
</ol>
<p>A sample minimal <code>hvs.env</code> file is provided below. For all configuration options and their descriptions, refer to the Intel® SecL Configuration section  on the Verification Service.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials </span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">HVS_SERVICE_USERNAME</span><span class="o">=</span>HVS_service
<span class="nv">HVS_SERVICE_PASSWORD</span><span class="o">=</span>password

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification </span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>digest

<span class="c1"># TLS Configuration</span>
<span class="nv">SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,192.168.1.1,hvs.server.com <span class="c1">#comma-separated list of IP addresses and hostnames for the HVS to be used in the Subject Alternative Names list in the TLS Certificate</span>

<span class="c1"># Installation admin bearer token for CSR approval request to CMS </span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

<span class="c1"># Database </span>
<span class="nv">HVS_DB_NAME</span><span class="o">=</span>mw_as
<span class="nv">HVS_DB_USERNAME</span><span class="o">=</span>runner
<span class="nv">HVS_DB_PASSWORD</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">HVS_DB_SSLCERTSRC</span><span class="o">=</span>/tmp/dbcert.pem  <span class="c1"># Not required if VS_DB_SSLCERT is given</span>
</code></pre></div>
<ol>
<li>Execute the installer binary.</li>
</ol>
<p><code>shell
./hvs-v3.3.1.bin</code></p>
<p>When the installation completes, the Verification Service is available. The services can be verified by running <strong>hvs status</strong> from the Verification Service command line.</p>
<p>```shell
   hvs status
<div class="highlight"><pre><span></span><code>## 3.8  Installing the Workload Service

### 3.8.1  Required For

The WLS is REQUIRED for the following use cases.

* Workload Confidentiality (both VMs and Docker Containers)

### 3.8.2  Prerequisites

The following must be completed before installing the Workload Service:

* The Certificate Management Service must be installed and available

* The Authentication and Authorization Service must be installed and available

* The Verification Service must be installed and available

* The Workload Service database must be available



### 3.8.3  Supported Operating Systems

The Intel® Security Libraries Workload Service supports Red Hat Enterprise Linux 8.2

### 3.8.4  Recommended Hardware

### 3.8.5  Installation

* Copy the Workload Service installation binary to the `/root` directory.

* Create the `workload-service.env` installation answer file

  ```shell
  WLS_DB_USERNAME=&lt;database username&gt;
  WLS_DB_PASSWORD=&lt;database password&gt;
  WLS_DB_HOSTNAME=&lt;IP or hostname of database server&gt;
  WLS_DB_PORT=&lt;Database port; 5432 by default&gt;
  WLS_DB=&lt;name of the WLS database&gt;
  WLS_DB_SSLCERTSRC=&lt;path to database TLS certificate; the default location is typically /usr/local/pgsql/data/server.crt &gt;
  HVS_URL=https://&lt;Ip address or hostname of the Host verification Service&gt;:8443/hvs/v2/
  WLS_SERVICE_USERNAME=&lt;username for WLS service account&gt;
  WLS_SERVICE_PASSWORD=&lt;password for WLS service account&gt;
  CMS_BASE_URL=https://&lt;IP or hostname to CMS&gt;:8445/cms/v1/
  CMS_TLS_CERT_SHA384=&lt;sha384 of CMS TLS certificate&gt;
  AAS_API_URL=https://&lt;IP or hostname to AAS&gt;:8444/aas/
  SAN_LIST=&lt;comma-separated list of IPs and hostnames for the WLS&gt;
  BEARER_TOKEN=&lt;Installation token from populate-users script&gt;
  ```

* Execute the WLS installer binary:

  ```shell
  ./wls-v3.3.1.bin
  ```



## 3.9  Installing the Trust Agent for Linux

### 3.9.1  Required For

The Trust Agent for Linux is REQUIRED for all use cases.

* Platform Integrity with Data Sovereignty and Signed Flavors

* Application Integrity

* Workload Confidentiality (both VMs and Docker Containers)

### 3.9.2  Package Dependencies

The Trust Agent requires the following packages and their dependencies:

* Tboot (Optional, for TXT-based deployments **without** UEFI SecureBoot only) 

* openssl

* tar

* redhat-lsb

If they are not already installed, the Trust Agent installer attempts to install these automatically using the package manager. Automatic installation requires access to package repositories (the RHEL subscription repositories, the EPEL repository, or a suitable mirror), which may require an Internet connection. If the packages are to be installed from the package repository, be sure to update the repository package lists before installation.

Tboot will not be installed automatically. Instructions for installing and configuring tboot are documented later in this section.

### 3.9.3  Supported Operating Systems

The Intel® Security Libraries Trust Agent for Linux supports Red Hat Enterprise Linux 8.2. 

### 3.9.4  Prerequisites

The following must be completed before installing the Trust Agent:

* Supported server hardware including an Intel® Xeon® processor with Intel Trusted Execution Technology activated in the system BIOS.

* Trusted Platform Module (version 2.0) installed and activated in the system BIOS, with cleared ownership status. 

&gt; ***Note:*** *For Linux systems, TPM 1.2 and TPM resource sharing to applications other than the Trust Agent are not supported at this time. Do not install trousers or another TSS stack application after installing the Trust Agent on Linux systems*

* System must be booted to a tboot boot option OR use UEFI SecureBoot.

&gt; ***Note***: *A security bug related to UEFI Secure Boot and Grub2 modules has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.*

* (Provisioning step only) Intel® SecL Verification Service server installed and active.

* (REQUIRED for servers configured with TXT and tboot only) If the server is installed using an LVM, the LVM name must be identical for all Trust Agent systems. The Grub bootloader line that calls the Linux kernel will contain the LVM name of the root volume, and this line with all arguments is part of what is measured in the TXT/Tboot boot process. This will cause the OS Flavor measurements to differ between two otherwise identical hosts if their LVM names are different. Simply using a uniform name for the LVM during OS installation will resolve this possible discrepancy. 

* (Optional, REQUIRED for Virtual Machine Confidentiality only):

* QEMU/KVM must be installed

* Libvirt must be installed

* (Optional, REQUIRED for Docker Container Confidentiality only): Docker CE 19.03.13 must be installed

&gt; ***Note***: *The specific Docker-CE version 19.03.13 is required for Docker Container Confidentiality. Only this version is supported for this use case.*

#### 3.9.4.1  Tboot Installation

&gt; ***Note***: *A solution to a security bug has resulted in some modules required by tboot to not be available on RedHat 8 UEFI systems. Tboot therefore cannot be used currently on RedHat 8. A future tboot release is expected to resolve this dependency issue and restore support for UEFI mode.*

Tboot is required to build a complete Chain of Trust for Intel® TXT systems that are not using UEFI Secure Boot. Tboot acts to initiate the Intel® TXT SINIT ACM (Authenticated Code Module), which populates several TPM measurements including measurement of the kernel, grub command line, and initrd. Without either tboot or UEFI Secure Boot, the Chain of Trust will be broken because the OS-related components will be neither measured nor signature-verified prior to execution. Because tboot acts to initiate the Intel® TXT SINIT ACM, tboot is only required for platforms using Intel® TXT, and is not required for platforms using another hardware Root of Trust technology like Intel® Boot Guard.

Intel® SecL-DC requires tboot 1.9.7 or greater. For most platforms, the version of tboot available from the RedHat software repository will meet all requirements. Some newer platforms and platform firmware versions may require a later version of tboot, including later versions than are available on the RedHat software repositories. This is due to updates that can be made to the Intel® TXT SINIT ACM behavior, and the SINIT ACM is contained in the BIOS firmware. 

If a newer version of tboot is required than is available from the repository, the most current version can be found here:

https://sourceforge.net/projects/tboot/files/tboot/


Tboot requires configuration of the grub boot loader after installation. To install and configure tboot:

1. Install tboot

   ```shell
   yum install tboot-1.9.10
   ```

   &gt; **Note:** An issue in the latest version of tboot(version 1.9.12) has caused it to be unusable on RHEL 8.2 legacy mode machines. This will be fixed in an upcoming version of tboot. Its is recommeded to use tboot version 1.9.10 for the time being.

2. Make a backup of your current `grub.cfg` file

   The below examples assume RedHat has been installed on a platform using Legacy boot mode.The grub path will be slightly different for platforms using Legacy BIOS.

   ```shell
   cp /boot/grub2/grub.cfg /boot/grub2/grub.bak
   ```

3. Generate a new `grub.cfg` with the tboot boot option

    ```shell
    grub2-mkconfig -o /boot/grub2/grub.cfg
    ```

4. Update the default boot option

   Ensure that the `GRUB_DEFAULT` value is set to the tboot option. The tboot boot option can be found by looking in the `/boot/redhat/grub.cfg` file. For example (the precise menu entry may be different, but should say &quot;tboot&quot;):

   `menuentry **&#39;Red Hat Enterprise Linux GNU/Linux, with tboot 1.9.7 and Linux 4.18.0-147.el8.x86_64**&#39; --class red --class gnu-     linux --class gnu --class os --class tboot {`

```shell
    vi /etc/default/grub
</code></pre></div></p>
<p><code>GRUB_DEFAULT='Red Hat Enterprise Linux GNU/Linux, with tboot 1.9.7 and Linux 4.18.0-147.el8.x86_64'</code></p>
<ol>
<li>Reboot the system</li>
</ol>
<p>Because measurement happens at system boot, a reboot is needed to boot to the tboot boot option and populate measurements in the TPM.</p>
<ol>
<li>Verify a successful trusted boot with tboot</li>
</ol>
<p>Tboot provides the <code>txt-stat</code> command to show the tboot log. The first part of the output of this command can be used to verify a successful trusted launch. In the output below, note the “TXT measured launch” and “secrets flag set” at the bottom. Both of these should show "<strong>TRUE</strong>" if the tboot measured launch was successful. If either of these show "<strong>FALSE</strong>" the measured launch has failed. This usually simply indicates that the tboot boot option was not selected during boot.</p>
<p>If the measured launch was successful, proceed to install the Trust Agent.</p>
<div class="highlight"><pre><span></span><code>    Intel<span class="o">(</span>r<span class="o">)</span> TXT Configuration Registers:
           STS: 0x0001c091
               senter_done: TRUE
               sexit_done: FALSE
               mem_config_lock: FALSE
               private_open: TRUE
               locality_1_open: TRUE
               locality_2_open: TRUE
           ESTS: 0x00
               txt_reset: FALSE
           E2STS: 0x0000000000000006
               secrets: TRUE
           ERRORCODE: 0x00000000
           DIDVID: 0x00000001b0078086
               vendor_id: 0x8086
               device_id: 0xb007
               revision_id: 0x1
           FSBIF: 0xffffffffffffffff
           QPIIF: 0x000000009d003000
           SINIT.BASE: 0x6fec0000
           SINIT.SIZE: 262144B <span class="o">(</span>0x40000<span class="o">)</span>
           HEAP.BASE: 0x6ff00000
           HEAP.SIZE: 1048576B <span class="o">(</span>0x100000<span class="o">)</span>
           DPR: 0x0000000070000051
               lock: TRUE
               top: 0x70000000
               size: 5MB <span class="o">(</span>5242880B<span class="o">)</span>
           PUBLIC.KEY:
               9c <span class="m">78</span> f0 d8 <span class="m">53</span> de <span class="m">85</span> 4a 2f <span class="m">47</span> <span class="m">76</span> 1c <span class="m">72</span> b8 6a <span class="m">11</span>
               <span class="m">16</span> 4a <span class="m">66</span> a9 <span class="m">84</span> c1 aa d7 <span class="m">92</span> e3 <span class="m">14</span> 4f b7 1c 2d <span class="m">11</span>

   ***********************************************************
            TXT measured launch: TRUE
            secrets flag set: TRUE
   ***********************************************************
</code></pre></div>
<h3 id="395-installation_1">3.9.5  Installation</h3>
<p>Installation of the Trust Agent is split into two major steps: Installation, which covers the creation of system files and folders, and Provisioning, which involves the creation of keys and secrets and links the Trust Agent to a specific Verification Service. Both operations can be performed at the same time using an installation answer file. Without the answer file, the Trust Agent can be installed and left in an un-provisioned state regardless of whether a Verification Service is up and running, until such time as the datacenter administrator is ready to run the provisioning step and link the Trust Agent to a Verification Service.</p>
<p>To install the Trust Agent for Linux:</p>
<ul>
<li>
<p>Copy the Trust Agent installation binary to the <code>/root</code> directory.</p>
</li>
<li>
<p>(Optional; required to perform Provisioning and Installation at the same time.) Create the<code>trustagent.env</code> answer file in the <code>/root</code> directory (for full configuration options, see section 9.2). The minimum configuration options for installation are provided below.</p>
</li>
</ul>
<p>For Platform Attestation only, provide the following in <code>trustagent.env</code> </p>
<p><code>shell
  HVS_URL=https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2
  PROVISION_ATTESTATION=y
  GRUB_FILE=&lt;path to grub.cfg&gt;
  CURRENT_IP=&lt;Trust Agent IP address&gt;
  CMS_TLS_CERT_SHA384=&lt;CMS TLS digest&gt;
  BEARER_TOKEN=&lt;Installation token from populate-users script&gt;
  AAS_API_URL=https://&lt;AAS IP or Hostname&gt;:8444/aas
  CMS_BASE_URL=https://&lt;CMS IP or Hostname&gt;:8445/cms/v1
  SAN_LIST=&lt;Comma-separated list of IP addresses and hostnames for the TAgent matching the SAN list specified in the populate-users script; may include wildcards&gt;</code></p>
<p>For Workload Confidentiality with VM Encryption, add the following (<strong>in addition to</strong> the basic Platform Attestation sample):</p>
<p><code>shell
  WLA_SERVICE_USERNAME=&lt;Username for the WLA service user&gt;
  WLA_SERVICE_PASSWORD=&lt;Username for the WLA service user&gt;
  WLS_API_URL=https://&lt;WLS IP address or hostname&gt;:5000/wls/</code></p>
<p>For Workload Confidentiality with Docker Container Encryption, add the following (<strong>in addition to</strong> the basic Platform Attestation sample):</p>
<p><code>shell
  WLA_SERVICE_USERNAME=&lt;Username for the WLA service user&gt;
  WLA_SERVICE_PASSWORD=&lt;Username for the WLA service user&gt;
  WLS_API_URL=https://&lt;WLS IP address or hostname&gt;:5000/wls/
  WA_WITH_CONTAINER_SECURITY=yes
  NO_PROXY=&lt;Registry_ip&gt;
  HTTPS_PROXY=&lt;proxy_url&gt;
  INSECURE_SKIP_VERIFY=&lt;TRUE/FALSE based on registry configured with http/https respectively&gt;
  REGISTRY_SCHEME_TYPE=https</code></p>
<ul>
<li>Execute the Trust Agent installer and wait for the installation to complete.</li>
</ul>
<div class="highlight"><pre><span></span><code>./trustagent-v3.3.1.bin
</code></pre></div>
<p>If the <code>trustagent.env</code> answer file was provided with the minimum required options, the Trust Agent will be installed and also Provisioned to the Verification Service specified in the answer file.</p>
<p>If no answer file was provided, the Trust Agent will be installed, but will not be Provisioned. TPM-related functionality will not be available from the Trust Agent until the Provisioning step is completed.</p>
<p>The Trust Agent will add a new grub menu entry for application measurement. This new entry will include tboot if the existing grub contains tboot as the default boot option.</p>
<blockquote>
<p><strong><em>Note:</em></strong>  <em>If the Linux Trust Agent is installed without being Provisioned, the Trust Agent process will not actually run until the Provisioning step has been completed.</em></p>
</blockquote>
<ul>
<li>Legacy BIOS systems using tboot ONLY) Update the grub boot loader:</li>
</ul>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
<ul>
<li>After Provisioning is completed, the Linux Trust Agent must be rebooted so that the default SOFTWARE Flavor manifest can be measured and extended to the TPM. If the Workload Agent will also be installed on the system (see the next section), wait to reboot the server until after the Workload Agent has been installed, as this modifies the default SOFTWARE Flavor manifest.</li>
</ul>
<h2 id="310-installing-the-workload-agent_1">3.10  Installing the Workload Agent</h2>
<h3 id="3101-required-for_1">3.10.1  Required For</h3>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3102-supported-operating-systems_1">3.10.2  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Workload Agent supports Red Hat Enterprise
Linux 8.2</p>
<h3 id="3103-prerequisites_1">3.10.3  Prerequisites</h3>
<p>The following must be completed before installing the Workload Agent:</p>
<ul>
<li>
<p>Intel® SecL Trust Agent installed and active.</p>
</li>
<li>
<p>cryptsetup</p>
</li>
<li>
<p>(REQUIRED for Virtual Machine Confidentiality only):</p>
</li>
<li>
<p>QEMU/KVM must be installed</p>
</li>
<li>
<p>libvirt must be installed</p>
</li>
<li>
<p>Libvirt must be configured to set the "remember_owner" property to "0".  </p>
</li>
</ul>
<p>Edit the qemu.conf configuration file:</p>
<div class="highlight"><pre><span></span><code>vi /etc/libvirt/qemu.conf
</code></pre></div>
<p>Set "remember_owner" to "0":</p>
<div class="highlight"><pre><span></span><code>remember_owner = 0
</code></pre></div>
<p>Restart the libvirtd service:</p>
<div class="highlight"><pre><span></span><code>systemctl restart libvirtd  
</code></pre></div>
<p>If this step is not performed before launching encrypted VMs, on VM restart you will see errors similar to the following:</p>
<div class="highlight"><pre><span></span><code>&quot;Error starting domain: internal error: child reported (status=125): Requested operation is not valid: Setting different SELinux label on /var/lib/nova/instances/15d7ec2f-27ad-41ed-9632-32a83c3d10ef/disk which is already in use&quot;
</code></pre></div>
<ul>
<li>
<p>(REQUIRED for Docker Container Confidentiality only): Docker CE
    19.03.13 must be installed</p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>The specific Docker-CE version 19.03.13 is required for
Docker Container Confidentiality. Only this version is supported for
this use case.</em></p>
</blockquote>
</li>
</ul>
<h3 id="3104-installation_1">3.10.4  Installation</h3>
<ul>
<li>
<p>Copy the Workload Agent installation binary to the <code>/root</code>/ directory</p>
</li>
<li>
<p>Verify that the <code>trustagent.env</code> answer file is present. This file was
  necessary for installing/provisioning the Trust Agent. Note that the
  additional content required for Workload Confidentiality with either
  VM Encryption or Docker Container Encryption must be included in the
  <code>trustagent.env</code> file (samples provided in the previous section) for
  use by the Workload Agent.</p>
</li>
<li>
<p>Execute the Workload Agent installer binary.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>./workload-agent-v3.3.1.bin
</code></pre></div>
<ul>
<li>(Legacy BIOS systems using tboot ONLY) Update the grub boot loader:</li>
</ul>
<div class="highlight"><pre><span></span><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div>
<ul>
<li>Reboot the server. The Workload Agent populates files that are
  needed for the default <code>SOFTWARE</code> Flavor, and a reboot is required for
  those measurements to happen.</li>
</ul>
<h2 id="311-trust-agent-provisioning">3.11  Trust Agent Provisioning</h2>
<p>"Provisioning" the Trust Agent involves connecting to a Verification
Service to download the Verification Service PrivacyCA certificate,
create a new Attestation Identity Keypair in the TPM, and verify or
create the TPM Endorsement Certificate and Endorsement Key. The
Verification Service PrivacyCA root certificate is used to sign the EC,
and the EC is used to generate the Attestation Identity Keypair. The AIK
is used by the Verification Service to verify the integrity of quotes
from the host’s TPM.</p>
<p>Provisioning can be performed separately from installation (meaning you
can install the Trust Agent without Provisioning, and then Provision
later). If the <code>trustagent.env</code> answer file is present and has the
required Verification Service information during installation, the Agent
will automatically run the Provisioning steps.</p>
<blockquote>
<p><strong><em>Note:</em></strong> <em>The <code>trustagent.env</code> answer file must contain user credentials for a
user with sufficient privileges. The minimum role required for
performing provisioning is the "trustagent_provisioner" role.</em></p>
<p><strong><em>Note:</em></strong> <em>If the Linux Trust Agent is installed without being Provisioned, the
Trust Agent process will not actually run until the Provisioning
step has been completed.</em></p>
</blockquote>
<p>If the answer file is not present during installation, the Agent can be
Provisioned later by adding the <code>trustagent.env</code> file and running the
following command:</p>
<div class="highlight"><pre><span></span><code><span class="na">tagent provision-attestation &lt;trustagent.env or trustagent.ini file</span>
<span class="na">path&gt;</span>
</code></pre></div>
<h2 id="312-trust-agent-registration">3.12  Trust Agent Registration</h2>
<p>Registration creates a host record with connectivity details and other
host information in the Verification Service database. This host record
will be used by the Verification Service to retrieve TPM attestation
quotes from the Trust Agent to generate an attestation report.</p>
<p>The Trust Agent can register the host with a Verification Service by
running the following command (the <code>trustagent.env</code> or <code>trustagent.ini</code>
answer file must be present in the current working directory):</p>
<div class="highlight"><pre><span></span><code>tagent create-host
</code></pre></div>
<p>Hosts can also be registered using a REST API request to the
Verification Service:</p>
<div class="highlight"><pre><span></span><code><span class="err">POST &lt;https://verification.service.com:8443/hvs/v2/hosts&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;host_name&quot;</span><span class="p">:</span> <span class="nt">&quot;&lt;hostname of host to be registered&gt;&quot;</span>
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;intel:https://&lt;hostname or IP address&gt;:1443&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavorgroup_names&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;description&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p><strong><em>Note:</em></strong> <em>When a new host is registered, the Verification Service will
automatically attempt to match the host to appropriate Flavors. If
appropriate Flavors are not found, the host will still be
registered, but will be in an Untrusted state until/unless
appropriate Flavors are added to the Verification Service.</em></p>
</blockquote>
<p><img src="images\ta_registration.png" alt="image-20200621070159371" style="zoom:150%;" /></p>
<h2 id="313-importing-the-host_unique-flavor">3.13  Importing the HOST_UNIQUE Flavor</h2>
<p>RHEL and VMWare ESXi hosts have measured components that are unique to
each host. This means that a special <code>HOST_UNIQUE</code> flavor part needs to
be imported for each RHEL and ESXi host, in addition to any other OS or
Platform Flavors.</p>
<blockquote>
<p><strong><em>Note:</em></strong> <em>Importing a Flavor requires user credentials for a user with
sufficient privileges. The minimum role required for creating the
<code>HOST_UNIQUE</code> Flavor part is the “host_unique_flavor_creator”
role. This role can only create <code>HOST_UNIQUE</code> Flavor parts, and
cannot create any other Flavors.</em></p>
</blockquote>
<p>On Red Hat Enterprise Linux hosts with the Trust Agent, this can be
performed from the Trust Agent command line (this requires the
trustagent.env answer file to be present in the current working
directory):</p>
<div class="highlight"><pre><span></span><code>tagent create-host-unique-flavor
</code></pre></div>
<p>This can also be performed using a REST API (required for VMWare ESXi
hosts):</p>
<div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span> 
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="314-installing-the-integration-hub">3.14  Installing the Integration Hub</h2>
<blockquote>
<p><strong><em>Note:</em></strong> <em>The Integration Hub is only required to integrate Intel® SecL with
third-party scheduler services, such as OpenStack Nova or
Kubernetes. The Hub is not required for usage models that do not
require Intel® SecL security attributes to be pushed to an
integration endpoint.</em></p>
</blockquote>
<h3 id="3141-required-for">3.14.1  Required For</h3>
<p>The Hub is REQUIRED for the following use cases.</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<p>The Hub is OPTIONAL for the following use cases (used only if
orchestration or other integration support is needed):</p>
<ul>
<li>Platform Integrity with Data Sovereignty and Signed Flavors</li>
<li>Application Integrity</li>
</ul>
<h3 id="3142-deployment-architecture-considerations-for-the-hub">3.14.2  Deployment Architecture Considerations for the Hub</h3>
<p>A separate Hub instance is REQUIRED for each Cloud environment (also referred to as a Hub "tenant").  For example, if a single datacenter will have an OpenStack cluster and also two separate Kubernetes clusters, a total of three Hub instances must be installed, though additional instances of other Intel SecL services are not required (in the same example, only a single Verification Service is required).  Each Hub will manage a single orchestrator environment.  If multiple orchestrator environments will be managed, be sure to create separate database schema names for each separate Hub.  Each Hub instance should be installed on a separate VM or physical server</p>
<h3 id="3143-prerequisites">3.14.3  Prerequisites</h3>
<p>The Intel® Security Libraries Integration Hub can be run as a VM or as a
bare-metal server. The Hub may be installed on the same server (physical
or VM) as the Verification Service.</p>
<ul>
<li>The Verification Service must be installed and available</li>
<li>The Authentication and Authorization Service must be installed and
    available</li>
<li>The Certificate Management Service must be installed and available</li>
<li>The Integration Hub database must be available</li>
<li>(REQUIRED for Kubernetes integration only) The Intel SecL Custom Resource Definitions must be installed and available (see the Integration section for details)</li>
</ul>
<h3 id="3144-package-dependencies">3.14.4  Package Dependencies</h3>
<p>The Intel® SecL Integration Hub requires a number of packages and their
dependencies:</p>
<p>If these are not already installed, the Integration Hub installer
attempts to install these packages automatically using the package
manager. Automatic installation requires access to package repositories
(the RHEL subscription repositories, the EPEL repository, or a suitable
mirror), which may require an Internet connection. If the packages are
to be installed from the package repository, be sure to update your
repository package lists before installation.</p>
<h3 id="3145-supported-operating-systems">3.14.5  Supported Operating Systems</h3>
<p>The Intel Security Libraries Integration Hub supports Red Hat Enterprise
Linux 8.2</p>
<h3 id="3146-recommended-hardware">3.14.6  Recommended Hardware</h3>
<ul>
<li>
<p>1 vCPUs</p>
</li>
<li>
<p>RAM: 2 GB</p>
</li>
<li>
<p>1 GB free space to install the Verification Service services.
    Additional free space is needed for the Integration Hub database and
    logs (database and log space requirements are dependent on the
    number of managed servers).</p>
</li>
<li>
<p>One network interface with network access to the Verification
    Service.</p>
</li>
<li>
<p>One network interface with network access to any integration
    endpoints (for example, OpenStack Nova).</p>
</li>
</ul>
<h3 id="3147-installing-the-integration-hub">3.14.7  Installing the Integration Hub</h3>
<p>To install the Integration Hub, follow these steps:</p>
<ol>
<li>
<p>Copy the Integration Hub installation binary to the<code>/root</code>
    directory.</p>
</li>
<li>
<p>Create the <code>ihub.env</code> installation answer file. See the
    sample file below.</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials</span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">IHUB_SERVICE_USERNAME</span><span class="o">=</span>&lt;Integration Hub Service User username&gt;
<span class="nv">IHUB_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Integration Hub Service User password&gt;

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification</span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;TLS hash&gt;

<span class="c1"># TLS Configuration</span>
<span class="nv">TLS_SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,192.168.1.1,hub.server.com <span class="c1">#comma-separated list of IP addresses and hostnames for the Hub to be used in the Subject Alternative Names list in the TLS Certificate</span>

<span class="c1"># Verification Service URL</span>
<span class="nv">ATTESTATION_SERVICE_URL</span><span class="o">=</span>https://isecl-hvs:8443/hvs/v2
<span class="nv">ATTESTATION_TYPE</span><span class="o">=</span>HVS

<span class="c1"># OpenStack Integration Credentials - required for OpenStack integration only</span>
<span class="nv">OPENSTACK_IP</span><span class="o">=</span>&lt;OpenStack Nova IP or hostname&gt;
<span class="nv">OPENSTACK_AUTH_PORT</span><span class="o">=</span>&lt;OpenStack Keystone port<span class="p">;</span> <span class="m">5000</span> by default&gt;
<span class="nv">OPENSTACK_API_PORT</span><span class="o">=</span>&lt;OpenStack Nova API port<span class="p">;</span> <span class="m">8778</span> by default&gt;
<span class="nv">OPENSTACK_USERNAME</span><span class="o">=</span>&lt;OpenStack username&gt;
<span class="nv">OPENSTACK_PASSWORD</span><span class="o">=</span>&lt;OpenStack password&gt;

 <span class="c1"># Kubernetes Integration Credentials - required for Kubernetes integration only</span>
<span class="nv">TENANT</span><span class="o">=</span>KUBERNETES
<span class="nv">KUBERNETES_URL</span><span class="o">=</span>https://kubernetes:6443/
<span class="nv">KUBERNETES_CRD</span><span class="o">=</span>custom-isecl
<span class="nv">KUBERNETES_CERT_FILE</span><span class="o">=</span>&lt;path where Kubernetes api_server.crt is copied&gt;
<span class="nv">KUBERNETES_TOKEN</span><span class="o">=</span>&lt;Token fetched from kubernetes secret of ISECL-Controller&gt;

<span class="c1"># Installation admin bearer token for CSR approval request to CMS - mandatory</span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

<span class="c1"># Report Signing Certificate URL and service TLS hash for server verification</span>
<span class="c1"># Required for Platform Integrity Attestation attributes.  Not required for SGX attributes.</span>
<span class="nv">REPORT_SIGNING_CERT_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">REPORT_SIGNING_SERVICE_TLS_CERT_SHA384</span><span class="o">=</span>bb3a1…
</code></pre></div>
3. Execute the installer binary.</p>
<div class="highlight"><pre><span></span><code>./ihub-v3.3.1.bin
</code></pre></div>
<p>After installation, the Hub must be configured to integrate with a Cloud orchestration platform (for example, OpenStack or Kubernetes).  See the Integration section for details.</p>
<h2 id="315-installing-the-key-broker-service">3.15  Installing the Key Broker Service</h2>
<h3 id="3151-required-for_1">3.15.1  Required For</h3>
<p>The KBS is REQUIRED for the following use cases:</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3152-prerequisites">3.15.2  Prerequisites</h3>
<p>The following must be completed before installing the Key Broker:</p>
<ul>
<li>
<p>The Verification Service must be installed and available</p>
</li>
<li>
<p>The Authentication and Authorization Service must be installed and
    available</p>
</li>
<li>
<p>The Certificate Management Service must be installed and available</p>
</li>
<li>
<p>(Recommended; Required if a 3^rd^-party Key Management Server will
    be used) A KMIP 2.0-compliant 3^rd^-party Key management Server must
    be available.</p>
<ul>
<li>
<p>The Key Broker will require the KMIP server’s client
    certificate, client key and root ca certificate.</p>
</li>
<li>
<p>The Key Broker uses the libkmip client to connect to a KMIP
    server</p>
</li>
<li>
<p>The Key Broker has been validated using the pykmip 0.9.1 KMIP
    server as a 3^rd^-party Key Management Server. While any general
    KMIP 2.0-compliant Key Management Server should work,
    implementation differences among KMIP providers may prevent
    functionality with specific providers.</p>
</li>
</ul>
</li>
</ul>
<h3 id="3153-package-dependencies">3.15.3  Package Dependencies</h3>
<h3 id="3154-supported-operating-systems">3.15.4  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Key Broker Service supports Red Hat
Enterprise Linux 8.2</p>
<h3 id="3155-recommended-hardware">3.15.5  Recommended Hardware</h3>
<h3 id="3156-installation">3.15.6  Installation</h3>
<ol>
<li>
<p>Copy the Key Broker installation binary to the <code>/root</code> directory.</p>
</li>
<li>
<p>Create the installation answer file <code>kbs.env</code>:</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="nv">SAN_LIST</span><span class="o">=</span><span class="c1">#comma-separated list of IP addresses and hostnames for the KBS to be used in the Subject Alternative Names list in the TLS Certificat</span>
<span class="nv">ENDPOINT_URL</span><span class="o">=</span>https://&lt;kbs IP or hostname&gt;:&lt;kbs_port&gt;/v1
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;CMS IP or hostname&gt;:8445/cms/v1/
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;SHA384 <span class="nb">hash</span> of CMS TLS certificate&gt;
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;AAS IP or hostname&gt;:8444/aas
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;Installation token from populate-users script&gt;
</code></pre></div>
   #OPTIONAL , only when using 3<sup>rd</sup>-Party KMIP Compliant KMS Server
   KEY_MANAGER=KMIP
   KMIP_SERVER_IP=<IP address of the KMIP server>
   KMIP_SERVER_PORT=<Port where KMIP Server is listening on>
   KMIP_CLIENT_KEY_PATH=<KMIP Client Key Path>
   KMIP_ROOT_CERT_PATH=<KMIP Server Root Certificate Path>
   KMIP_CLIENT_CERT_PATH=<KMIP Client Certificate Path></p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<ol>
<li>
<p>Execute the KBS installer.</p>
<div class="highlight"><pre><span></span><code>./kbs-v3.3.1.bin
</code></pre></div>
</li>
</ol>
<h4 id="31561-configure-the-key-broker-to-use-a-kmip-compliant-key-management-server">3.15.6.1  Configure the Key Broker to use a KMIP-compliant Key Management Server</h4>
<p>The Key Broker immediately after installation will be configured to use
a filesystem key management solution if not configured for KMIP. This should be used only for
testing and POC purposes; using a secure 3<sup>rd</sup>-party Key management
Server should be used for production deployments. To configure the Key
Broker to point to a 3<sup>rd</sup>-party KMIP-compliant Key Management Server:</p>
<ol>
<li>
<p>Ensure the KMIP server’s client certificate, client key and root ca are accessible for reading by Key Broker Service</p>
</li>
<li>
<p>Update the <code>config.yml</code> for the following variables under <code>/etc/kbs/config.yml</code>
    <div class="highlight"><pre><span></span><code><span class="nt">kmip</span><span class="p">:</span>
  <span class="nt">server-ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;IP address of the KMIP server&gt;</span>
  <span class="nt">server-port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;Port where KMIP Server is listening on&gt;</span>
  <span class="nt">client-cert-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;KMIP Client Certificate Path&gt;</span>
  <span class="nt">client-key-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;KMIP Client Key Path&gt;</span>
  <span class="nt">root-cert-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;KMIP Server Root Certificate Path&gt;</span>
</code></pre></div></p>
</li>
<li>
<p>Restart the Key Broker for the settings to take effect</p>
<div class="highlight"><pre><span></span><code>kbs stop<span class="p">;</span>kbs start
</code></pre></div>
</li>
</ol>
<h3 id="3157-importing-verification-service-certificates">3.15.7  Importing Verification Service Certificates</h3>
<p>After installation, the Key Broker must import the SAML and PrivacyCA
certificates from any Verification Services it will trust. This provides
the Key Broker a way to ensure that only attestations that come from a
"known" Verification Service. The SAML and PrivacyCA certificates needed
can be found on the Verification Service.</p>
<h4 id="31571-importing-a-saml-certificate">3.15.7.1  Importing a SAML certificate</h4>
<p>Use OpenSSL to display the SAML certificate content:</p>
<div class="highlight"><pre><span></span><code>cat /etc/hvs/certs/trustedca/saml-cert.pem
</code></pre></div>
<p>Use the SAML certificate output in the following POST call to the Key
Broker:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Key Broker IP address or hostname&gt;:&lt;Key Broker Port&gt;/kbs/v1/saml-certificates</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Content-Type: application/x-pem-file 
-----BEGIN CERTIFICATE-----
MIID/DCCAmSgAwIBAgIBCDANBgkqhkiG9w0BAQwFADBQMQswCQYDVQQGEwJVUzEL
MAkGA1UECBMCU0YxCzAJBgNVBAcTAlNDMQ4wDAYDVQQKEwVJTlRFTDEXMBUGA1UE
AxMOQ01TIFNpZ25pbmcgQ0EwHhcNMjAxMTE4MDQwMjAwWhcNMjExMTE4MDQwMjAw
WjAfMR0wGwYDVQQDExRIVlMgU0FNTCBDZXJ0aWZpY2F0ZTCCAaIwDQYJKoZIhvcN
AQEBBQADggGPADCCAYoCggGBALisc9JJeupLBk22pnARt9CP6CJQn1iEMbLvvkZ0
tCbuG9wX5LUoyPFGELDcHrK2E5eLqLUrxCgHa6zTkokgoh3Oj/PXG3JoqZsK2hVd
VHyL82JnjLrB93SsNwlo7002V35RaAvWln+Z9fJtY9gOB7LS+UCchVYXduFYSG8m
sXkGkG60VvQlpFYYTO773/DV/zj2cZmL2l3/6OLX+QeCG8UtRo7iqNloD+788sSd
CQKx2m3PxRd195cTNGBarOMJwzPu8/w+bbk8E3wO/IdjO7Mh3K5yNRr1V99sFG5h
RyjZwgfO7RYOp2B8hMZENeWvUGB1QiNwsKvC27HE4WkkCsF+HCcKDwEGUY1/NmRq
pj6yaBajsKM326agPk8Roihgea4NdWQrfpa/W3ZmMLceggtwY4PJeonEuLiidKAk
Tg13XRUQ1yq9mUFnY5pZCFvO1liu7P2xtr6xvAFdX/KsPaXZRnOwzSODkhmS6NNe
lsj1JCUtR/rVJVmIA7dBcxPZEwIDAQABoxIwEDAOBgNVHQ8BAf8EBAMCBsAwDQYJ
KoZIhvcNAQEMBQADggGBAB0dXcAmSnU4Sda6UfToUTO3PotwCS/e4Tm5RoKzYfqz
R6UQF1dlcVhkS1mz3wl1EZbeOJU61QiSACfAG05SU2KtrZ0h7//nJT/0N0hwGzhL
9c0r10QYss3LqI9eUAddtqjyQf8baJtuFruBQjoFytqzp6XQ9gtPL5XcLyl9C4xy
sWpKRfiB3Px5Agi18RiVM3/hBDGfVbcb/v8dWJM28MJs5ZWgrb/HdfMUQJFdYHOc
AU+WpxGjaftTiD9Is5lTOb3ESKMkz7fEW6YXulTkij2P9m5pcoZIPPZbnXQWJzot
emz5RgbYVBE4R6tZNJ1IyZhDiY4O1MjpCYhzaAoPVPD9lYIHLQcMHH56xx0Y24Fv
wFIIU6C6OatLDLApRBMFeZa/xFgf2qNjm+1wu5N79EB9xukqzIw+lR+dXYAHgChW
PrYK5F500/BiTmNtNC+EiwLs6RQU4ZBXki8U/uBFB7f5vnk8LxPm4NlP0GSCJhAr
<span class="nv">fpo2VjlPKVVUUUTQGxZV0Q</span><span class="o">==</span>
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIENTCCAp2gAwIBAgIBAzANBgkqhkiG9w0BAQwFADBHMQswCQYDVQQGEwJVUzEL
MAkGA1UECBMCU0YxCzAJBgNVBAcTAlNDMQ4wDAYDVQQKEwVJTlRFTDEOMAwGA1UE
AxMFQ01TQ0EwHhcNMjAxMTE4MDQwMDAwWhcNMjUxMTE4MDQwMDAwWjBQMQswCQYD
VQQGEwJVUzELMAkGA1UECBMCU0YxCzAJBgNVBAcTAlNDMQ4wDAYDVQQKEwVJTlRF
TDEXMBUGA1UEAxMOQ01TIFNpZ25pbmcgQ0EwggGiMA0GCSqGSIb3DQEBAQUAA4IB
jwAwggGKAoIBgQCyjonRwxZ8UbWkzAcQn6SnyOlQzzdOVW2+WNh61tMfRVioSykA
otuG1hhgApULbyUmBsJSmNU4oQjnlblpsH+LOLLHHlM8tCA5oX9XGzlpQVp+Dr17
vK69lN0Ner2hqVxmJy2evN93rV+nsFrdx2O2/JcptkPKQUc+EcqDOPbMgIBWjRpT
lVeyEIoWBBxAwtoUxpCMBXtSnxVB7+6Yc3apONj8wF5Ie7qBXXOTH3II3tAYNFiA
O1ivNER8zNr2Aia14V/lQUlHzwB94TBMFLPzR4T2bXiGH2wfW4Z35ULdW8avcKSR
r9KSQ4JtREp2xsJ9AYr89WPljiKvf6wJaTFT1BnR/cvBtpsKbrppbiJrYqbuRa8m
0vcZ278dM4sGMLUqa7AnMXWHqI6MjqulN2RHIkQ/J3ih0Q8GLDJaruiJnNOeGiDo
mL0LxJFEy5OGH3AUioOGRHdF0suFneRv3emY6FSMSXuofLfn59I7ik630cfj3r7X
1xzuqUbZE70uqCUCAwEAAaMjMCEwDgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQF
MAMBAf8wDQYJKoZIhvcNAQEMBQADggGBAJiIWLM16WqIyT/D59Q+xDptL/kP4BVs
HemKCqIwJ9N1JzFH5W4chCv0u5R4Gcb4q7HOtbhjTm/W1u6EVWetLVQeNSOizqf5
NjNoA3eZH8MWn6q93rBuWtZebpDMNYYFgRvPU4d8lKfRV4JdcYlyLo0wbzzF9AOJ
0CIBNBcYJXZqZeqrnPBzMZe7RVvoTIu2VOYk+RIvao8jgCZOwEqe3RMBnaF2psIO
OrnmSMtLDKoPSVyOYt4R/agSFtiOIHnddmR6djvkVNgkvg8B1WuElU/9W0Tlxn/A
AblH+qq6FVQLzWOITkCu/YN4W222zR0EeMsaZ7NEkxHMrhj4giFB+AnjEL04XDjz
G2Vcq4c3Ka4ZBZv3Q6nWgK6RfrqAJL+tGS8YX9Bt08J7q41wje63QhUjtmaL3gTu
4WqlKxedoBweEpD4x0CIcxtVA48NmFS9NQse6wAsq3GvKCcSsCBUgyKMnmDb5Y+g
lynfJLtgmHDcO7+8I0ZU2zBu8k8GotnBrQ<span class="o">==</span>
-----END CERTIFICATE-----
</code></pre></div></p>
<h4 id="31572-importing-a-privacyca-certificate">3.15.7.2  Importing a PrivacyCA Certificate</h4>
<p>Use OpenSSL to display the PrivacyCA certificate content:</p>
<div class="highlight"><pre><span></span><code>openssl x509 -in /etc/hvs/certs/trustedca/privacy-ca/privacy-ca-cert.pem
</code></pre></div>
<p>Use the PrivacyCA certificate output in the following POST call to the
Key Broker:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Key Broker IP address or hostname&gt;:&lt;Key Broker Port&gt;/kbs/v1/tpm-identity-certificates</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Content-Type: application/x-pem-file 
-----BEGIN CERTIFICATE-----
MIIHaDCCBdCgAwIBAgIGAW72eWZ9MA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNVBAMT
EG10d2lsc29uLXBjYS1haWswHhcNMTkxMjExMTkzOTQxWhcNMjkxMjEwMTkzOTQx
WjAbMRkwFwYDVQQDExBtdHdpbHNvbi1wY2EtYWlrMIIBojANBgkqhkiG9w0BAQEF
AAOCAY8AMIIBigKCAYEAmWqBr2YiycZbF/QgFbxTr4YiHtueWBdW0sibtH1QRSbI
KtkbFsmr6J6QiLBaXcF7KVN6DaD0j5sU4cZSttqKwlSUnn07xjWJRP1EcvSaufO1
MarewgBpFQcI2T6aTs1ziV77BoKz0kWteURz1jT1KSwuattxTelpmgucDp98MqW/
uWsliHUVxh51JTE1yn7Vf1QCWz3a+NDH98Lgr5ks337yx3VBK59Dwtsmfsrd5tMn
IuV9Jw0Y2UEdDi004FXI4q64MsMpWA7t5ONRAU+VNU0Y3saXeNBDg9J363imOHIH
haP8ixDhqZ+Xb/TGafgFeEHBkJTv6bWpDqodbWVDbgZloxJzcNgtimQw3RbyrB3C
KijlEo5BQY6bOcdMG7gCq77u/fbOvLb5IXzS8ZDpwuwCQNnBP4UJXwAflO7COG7P
mpj9bTV1OtFiPtYFc4JdGdaf1Pl2zWGeR0c3PIzYQxqvtTVtFX+oRWRsgaEdxKf7
LJx4aIjXwP2s6PIiOSalAgMBAAGjggOwMIIDrDCCAbMGA1UdDgSCAaoEggGmMIIB
ojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAmWqBr2YiycZbF/QgFbxTr4Yi
HtueWBdW0sibtH1QRSbIKtkbFsmr6J6QiLBaXcF7KVN6DaD0j5sU4cZSttqKwlSU
nn07xjWJRP1EcvSaufO1MarewgBpFQcI2T6aTs1ziV77BoKz0kWteURz1jT1KSwu
attxTelpmgucDp98MqW/uWsliHUVxh51JTE1yn7Vf1QCWz3a+NDH98Lgr5ks337y
x3VBK59Dwtsmfsrd5tMnIuV9Jw0Y2UEdDi004FXI4q64MsMpWA7t5ONRAU+VNU0Y
3saXeNBDg9J363imOHIHhaP8ixDhqZ+Xb/TGafgFeEHBkJTv6bWpDqodbWVDbgZl
oxJzcNgtimQw3RbyrB3CKijlEo5BQY6bOcdMG7gCq77u/fbOvLb5IXzS8ZDpwuwC
QNnBP4UJXwAflO7COG7Pmpj9bTV1OtFiPtYFc4JdGdaf1Pl2zWGeR0c3PIzYQxqv
tTVtFX+oRWRsgaEdxKf7LJx4aIjXwP2s6PIiOSalAgMBAAEwDwYDVR0TAQH/BAUw
AwEB/zCCAeAGA1UdIwSCAdcwggHTgIIBpjCCAaIwDQYJKoZIhvcNAQEBBQADggGP
ADCCAYoCggGBAJlqga9mIsnGWxf0IBW8U6+GIh7bnlgXVtLIm7R9UEUmyCrZGxbJ
q+iekIiwWl3BeylTeg2g9I+bFOHGUrbaisJUlJ59O8Y1iUT9RHL0mrnztTGq3sIA
aRUHCNk+mk7Nc4le+waCs9JFrXlEc9Y09SksLmrbcU3paZoLnA6ffDKlv7lrJYh1
FcYedSUxNcp+1X9UAls92vjQx/fC4K+ZLN9+8sd1QSufQ8LbJn7K3ebTJyLlfScN
GNlBHQ4tNOBVyOKuuDLDKVgO7eTjUQFPlTVNGN7Gl3jQQ4PSd+t4pjhyB4Wj/IsQ
4amfl2/0xmn4BXhBwZCU7+m1qQ6qHW1lQ24GZaMSc3DYLYpkMN0W8qwdwioo5RKO
QUGOmznHTBu4Aqu+7v32zry2+SF80vGQ6cLsAkDZwT+FCV8AH5Tuwjhuz5qY/W01
dTrRYj7WBXOCXRnWn9T5ds1hnkdHNzyM2EMar7U1bRV/qEVkbIGhHcSn+yyceGiI
18D9rOjyIjkmpQIDAQABoR+kHTAbMRkwFwYDVQQDExBtdHdpbHNvbi1wY2EtYWlr
ggYBbvZ5Zn0wDQYJKoZIhvcNAQELBQADggGBAC3PEB8Av0PBJgrJMxzMbuf1FCdD
AUrfYmP81Hs0/v70efviMEF2s3GAyLHD9v+1nNFCQrjcNCar18k45BlcodBEmxKA
DZoioFykRtlha6ByVvuN6wD93KQbKsXPKhUp8X67fLuOcQgfc3BoDRlw/Ha1Ib6X
fliE+rQzLCOgClK7ZdTwl9Ok0VbR7Mbal/xShIqr2WopjBtal9p4RsnIxilTHI+m
qzbV8zvZXYfYtEb3MMMT5EnjIV8O498KKOjxohD2vqaxqItd58pOi6z/q5f4pLHc
DvdsJecJEoWb2bxWQdBgthMjX6AUV/B5G/LTfaPwVbTLdEc+S6Nrobf/TFYV0pvG
OzF3ltYag0fupuYJ991s/JhVwgJhCGq7YourDGkNIWAjt0Z2FWuQKnxWvmResgkS
WTeXt+1HCFSo5WcAZWV8R9FYv7tzFxPY8aoLj82sgrOE4IwRqaA8KMbq3anF4RCk
+D8k6etqMcNHFS8Fj6GlCd80mb4Q3sxuCiBvZw<span class="o">==</span>
-----END CERTIFICATE-----
</code></pre></div></p>
<h2 id="316-installing-the-workload-policy-manager">3.16  Installing the Workload Policy Manager</h2>
<h3 id="3161-required-for_1">3.16.1  Required For</h3>
<p>The WPM is REQUIRED for the following use cases.</p>
<ul>
<li>Workload Confidentiality (both VMs and Docker Containers)</li>
</ul>
<h3 id="3162-package-dependencies">3.16.2  Package Dependencies</h3>
<p>(Required only if Docker Container encryption is needed) <code>Docker-ce
19.03.13</code> must be installed. This is needed only if the option
<code>WPM_WITH_CONTAINER_SECURITY=yes</code> is set in the <code>wpm.env</code> answer
file.</p>
<h3 id="3163-supported-operating-systems">3.16.3  Supported Operating Systems</h3>
<p>The Intel® Security Libraries Workload Policy Manager supports Red Hat
Enterprise Linux 8.2.</p>
<h3 id="3164-recommended-hardware">3.16.4  Recommended Hardware</h3>
<ul>
<li>
<p>2 vCPUs</p>
</li>
<li>
<p>RAM: 8 GB</p>
</li>
<li>
<p>100 GB</p>
</li>
<li>
<p>One network interface with network access to the Key Broker and
    Workload Service</p>
</li>
<li>
<p>Additional memory and disk space may be required depending on the
    size of images to be encrypted</p>
</li>
</ul>
<h3 id="3165-installation">3.16.5  Installation</h3>
<ol>
<li>
<p>Copy the WPM installer to the <code>/root</code> directory</p>
</li>
<li>
<p>Create the <code>wpm.env</code> answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">KMS_API_URL</span><span class="o">=</span>https://&lt;IP address or hostname of the KBS&gt;:9443/v1/
<span class="nv">WPM_SERVICE_USERNAME</span><span class="o">=</span>&lt;WPM_Service username from populate-users script&gt;
<span class="nv">WPM_SERVICE_PASSWORD</span><span class="o">=</span>&lt;WPM Service password from populate-users script&gt;
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;Sha384 <span class="nb">hash</span> of the CMS TLS certificate&gt;
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://&lt;IP address or hostname <span class="k">for</span> CMS&gt;:8445/cms/v1/
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://&lt;Hostname or IP address of the AAS&gt;:8444/aas
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>&lt;Installation token from populate-users script&gt;
</code></pre></div>
<p>For Docker Container Encryption only, add the following line to the
wpm.env installation answer file:</p>
<div class="highlight"><pre><span></span><code><span class="nv">WPM_WITH_CONTAINER_SECURITY</span><span class="o">=</span>yes
</code></pre></div>
</li>
<li>
<p>Execute the WPM installer:</p>
<div class="highlight"><pre><span></span><code>./wpm-v3.3.1.bin
</code></pre></div>
</li>
</ol>
<div style="page-break-after: always"></div>
<h1 id="4-authentication_1">4  Authentication</h1>
<p>Beginning in the Intel® SecL-DC 1.6 release, authentication is centrally
managed by the Authentication and Authorization Service (AAS). This
service uses a Bearer Token authentication method, which replaces the
previous HTTP BASIC authentication. This service also centralizes the
creation of roles and users, allowing much easier management of users,
passwords, and permissions across all Intel® SecL-DC services.</p>
<p>To make an API request to an Intel® SecL-DC service, an authentication
token is now required. API requests must now include an Authorization
header with an appropriate token:</p>
<p><code>Authorization: Bearer $TOKEN</code></p>
<p>The token is issued by the AAS and will expire after a set amount of
time. This token may be used with any Intel® SecL-DC service, and will
carry the appropriate permissions for the role(s) assigned to the
account the token was generated for.</p>
<h2 id="41-create-token_1">4.1  Create Token</h2>
<p>To request a new token from the AAS:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST &lt;https://&lt;AAS IP or hostname&gt;:8444/aas/token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>The response will be a token that can be used in the Authorization
header for other requests. The length of time for which the token will
be valid is configured on the AAS using the key
<code>AAS_JWT_TOKEN_DURATION_MINS</code> (in the installation answer file during
installation) or <code>aas.jwt.token.duration.mins</code> (configured on the AAS
after installation). In both cases the value is the length of time in
minutes that issued tokens will remain valid before expiring.</p>
<h2 id="42-user-management_1">4.2  User Management</h2>
<p>Users in Intel® SecL-DC are no longer restrained to a specific service,
as they are now centrally managed by the Authentication and
Authorization Service. Any user may now be assigned roles for any
service, allowing user accounts to be fully defined by the tasks needed.</p>
<h3 id="421-username-and-password-requirements_1">4.2.1  Username and Password requirements</h3>
<p>Passwords have the following constraints:</p>
<ul>
<li>
<p>cannot be empty - i.e must at least have one character</p>
</li>
<li>
<p>maximum length of 255 characters</p>
</li>
</ul>
<p>Usernames have the following requirements:</p>
<ul>
<li>
<p>Format: username[@host_name[domain]]</p>
</li>
<li>
<p>[@host_name[domain]] is optional</p>
</li>
<li>
<p>username shall be minimum of 2 and maximum of 255 characters</p>
</li>
<li>
<p>username allowed characters are alphanumeric, ., -, _ - but cannot
    start with -.</p>
</li>
<li>
<p>Domain name must meet requirements of a host name or fully qualified
    internet host name</p>
</li>
<li>
<p>Examples</p>
<ul>
<li>admin, admin_wls, admin@wls, <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#119;&#108;&#115;&#46;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;">&#97;&#100;&#109;&#105;&#110;&#64;&#119;&#108;&#115;&#46;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;</a>,
    <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#108;&#115;&#45;&#97;&#100;&#109;&#105;&#110;&#64;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;">&#119;&#108;&#115;&#45;&#97;&#100;&#109;&#105;&#110;&#64;&#105;&#110;&#116;&#101;&#108;&#46;&#99;&#111;&#109;</a></li>
</ul>
</li>
</ul>
<h3 id="422-create-user_1">4.2.2  Create User</h3>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;IP or hostname of AAS&gt;:8444/aas/users</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="423-search-user_1">4.2.3  Search User</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET https://&lt;IP or hostname of AAS&gt;:8444/aas/users?&lt;parameter&gt;=&lt;value&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h3 id="424-change-user-password_1">4.2.4  Change User Password</h3>
<p><div class="highlight"><pre><span></span><code><span class="err">PATCH https://&lt;IP or hostname of AAS&gt;:8444/aas/users/changepassword</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;username&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;old_password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;old_password&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;new_password&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;new_password&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;password_confirm&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;new_password&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="425-delete-user_1">4.2.5  Delete User</h3>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://&lt;IP or hostname of AAS&gt;:8444/aas/users/&lt;User ID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h2 id="43-roles-and-permissions_1">4.3  Roles and Permissions</h2>
<p>Permissions in Intel® SecL-DC are managed by Roles. Roles are a set of
predefined permissions applicable to a specific service. Any number of
Roles may be applied to a User. While new Roles can be created, each
Intel® SecL service defines permissions that are applicable to specific
predetermined Roles. This means that only pre-defined Roles will
actually have any permissions. Role creation is intended to allow Intel®
SecL-DC services to define their permissions while allowing role and
user management to be centrally managed on the AAS. When a new service
is installed, it will use the Role creation functions to define roles
applicable for that service in the AAS.</p>
<h3 id="431-create-role_1">4.3.1  Create Role</h3>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;AAS IP or Hostname&gt;:8444/aas/roles</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Service name&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Role Name&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;permissions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="err">&lt;array</span> <span class="err">o</span><span class="kc">f</span> <span class="err">permissio</span><span class="kc">ns</span><span class="err">&gt;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<ul>
<li>
<p><code>service</code> field contains a minimum of 1 and maximum of 20 characters.
    Allowed characters are alphanumeric plus the special characters -,
    _, @, ., ,</p>
</li>
<li>
<p><code>name</code> field contains a minimum of 1 and maximum of 40 characters.
    Allowed characters are alphanumeric plus the special characters -,
    _, @, ., ,</p>
</li>
<li>
<p><code>service</code> and <code>name</code> fields are mandatory</p>
</li>
<li>
<p><code>context</code> field is optional and can contain up to 512 characters.
    Allowed characters are alphanumeric plus -, _, @, ., ,,=,;,:,*</p>
</li>
<li>
<p><code>permissions</code> field is optional and allow up to a maximum of 512
    characters.</p>
</li>
</ul>
<p>The Permissions array must a comma-separated list of permissions
formatted as <code>resource:action:</code></p>
<p>Permissions required to execute specific API requests are listed with
the API resource and method definitions in the API documentation.</p>
<h3 id="432-search-roles_1">4.3.2  Search Roles</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET https://&lt;AAS IP or Hostname&gt;:8444/aas/roles?&lt;parameter&gt;=&lt;value&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>Search parameters supported:</p>
<div class="highlight"><pre><span></span><code>Service=&lt;name of service&gt;
Name=&lt;role name&gt;
Context=&lt;context&gt;
contextContains=&lt;partial &quot;context&quot; string&gt;
allContexts=&lt;true or false&gt;
filter=false
</code></pre></div>
<h3 id="433-delete-role_1">4.3.3  Delete Role</h3>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://&lt;AAS IP or Hostname&gt;:8444/aas/roles/&lt;role ID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h3 id="434-assign-role-to-user_1">4.3.4  Assign Role to User</h3>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;AAS IP or Hostname&gt;:8444/aas/users/&lt;user ID&gt;/roles</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;role_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;comma-separated list of role IDs&gt;&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="435-list-roles-assigned-to-user_1">4.3.5  List Roles Assigned to User</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET https://&lt;AAS IP or Hostname\&gt;:8444/aas/users/&lt;user ID&gt;/roles</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h3 id="436-remove-role-from-user_1">4.3.6  Remove Role from User</h3>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://&lt;AAS IP or Hostname&gt;:8444/aas/users/&lt;userID&gt;/roles/&lt;role ID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h3 id="437-role-definitions_1">4.3.7  Role Definitions</h3>
<p>The following roles are created during installation (or by the
<code>CreateUsers</code> script) and exist by default.</p>
<table>
<thead>
<tr>
<th><strong>Role Name</strong></th>
<th align="left"><strong>Permissions</strong></th>
<th><strong>Utility</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>TA:Administrator</td>
<td align="left">TA:*:*</td>
<td>Used by the Verification Service to access Trust Agent APIs, including retrieval of TPM quotes, provisioning Asset Tags and SOFTWARE Flavors, etc.</td>
</tr>
<tr>
<td>HVS:ReportRetriever</td>
<td align="left">HVS: ["reports:retrieve:*", "reports:search:*", "hosts:search:*", "hosts:retrieve:*"]</td>
<td>Used by the Integration Hub to retrieve attestation reports from the Verification Service</td>
</tr>
<tr>
<td>KMS:Keymanager</td>
<td align="left">KBS: ["keys:create:*", "keys:transfer:*"]</td>
<td>Used by the WPM to create and retrieve symmetric encryption keys to encrypt workload images</td>
</tr>
<tr>
<td>WLS:FlavorsImageRetrieval</td>
<td align="left">WLS: image_flavors:retrieve:*</td>
<td>Used by the Workload Agent during Workload Confidentiality flows to retrieve the image Flavor</td>
</tr>
<tr>
<td>HVS: ReportCreator</td>
<td align="left">HVS: ["reports:create:*"]</td>
<td>Used by the Workload Service to create new attestation reports on the Verification Service as part of Workload Confidentiality key retrievals.</td>
</tr>
<tr>
<td>Administrator</td>
<td align="left">*:*:*</td>
<td>Global administrator role used for the initial administrator account. This role has all permissions across all services, including permissions to create new roles and users.</td>
</tr>
<tr>
<td>AAS: Administrator</td>
<td align="left">*:*:*</td>
<td>Administrator role for the AAS only. Has all permissions for AAS resources, including the ability to create or delete users and roles.</td>
</tr>
<tr>
<td>AAS: RoleManager</td>
<td align="left">AAS: [roles:create:*, roles:retrieve:*, roles:search:*, roles:delete:*]</td>
<td>AAS role that allows all actions for Roles, but cannot create or delete Users or assign Roles to Users.</td>
</tr>
<tr>
<td>AAS: UserManager</td>
<td align="left">AAS: [users:create:*, users:retrieve:*, users:store:*, users:search:*, users:delete:*]</td>
<td>AAS role with all permissions for Users, but has no ability to create Roles or assign Roles to Users.</td>
</tr>
<tr>
<td>AAS: UserRoleManager</td>
<td align="left">AAS: [user_roles:create:*, user_roles:retrieve:*, user_roles:search:*, user_roles:delete:*,</td>
<td>AAS role with permissions to assign Roles to Users, but cannot create delete or modify Users or Roles.</td>
</tr>
<tr>
<td>HVS: AttestatioNRegister</td>
<td align="left">HVS: [host_tls_policies:create:*, hosts:create:*, hosts:store:*, hosts:search:*, host_unique_flavors:create:*, flavors:search:*, tpm_passwords:retrieve:*, tpm_passwords:create:*, host_aiks:certify:*</td>
<td>Role used for Trust Agent provisioning. Used to create the installation token provided during installation.</td>
</tr>
<tr>
<td>HVS: Certifier</td>
<td align="left">HVS: host_signing_key_certificates:create:*</td>
<td>Used for installation of the Workload Agent</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always"></div>
<h1 id="5-connection-strings_1">5  Connection Strings</h1>
<p>Connection Strings define a remote API resource endpoint that will be
used to communicate with the registered host for retrieving TPM quotes
and other host information. Connection Strings differ based on the type
of host.</p>
<h2 id="51-trust-agent-windows-and-linux">5.1  Trust Agent (Windows and Linux)</h2>
<p>The Trust Agent connection string connects directly to the Trust Agent
on a given host. The Verification Service will use a service account
with the needed Trust Agent permissions to connect to the Trust Agent.
In previous Intel® SecL versions, each Trust Agent had its own unique
user access controls. Starting in the 1.6 release, all authentication
has been centralized with the new Authentication and Authorization
Service, eliminating the need for credentials to be provided for
connection strings connecting to Trust Agent resources.</p>
<div class="highlight"><pre><span></span><code><span class="err">intel:https://&lt;HostNameOrIp&gt;:1443</span>
</code></pre></div>
<h2 id="52-vmware-esxi_1">5.2  VMware ESXi</h2>
<h3 id="521-importing-vmware-tls-certificates_1">5.2.1 Importing VMware TLS Certificates</h3>
<p>Before connecting to vCenter to register hosts or clusters, the vCenter TLS certificate needs to be imported to the Verification Service.  This must be done for each vCenter server that the Verification Service will connect to, for importing Flavors or registering hosts.</p>
<ol>
<li>Download the root CA certs from vCenter:</li>
</ol>
<p>```shell
wget --no-proxy "*" https://<vCenter IP or hostname>/certs/download.zip --no-check-certificate
   <div class="highlight"><pre><span></span><code>This downloads all the root CA certificates for you into `download.zip` file. 

```shell
unzip download.zip
</code></pre></div></p>
<p>All of the certificates will be stored under <code>&lt;pwd&gt;/certs/</code>. Certs will be in <code>PEM</code> format.</p>
<ol>
<li>Upload the certificates to the HVS</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="err">POST https://%3CIP%3E:8443/hvs/v2/ca-certificates</span>

<span class="err">{</span>
<span class="err">    &quot;name&quot;: &quot;&lt;cert name&gt;&quot;,</span>
<span class="err">    &quot;type&quot;: &quot;root&quot;,</span>
<span class="err">    &quot;certificate&quot;: &quot;MIIELTCCAxW...&quot;</span>
<span class="err">}</span>
</code></pre></div>
<blockquote>
<p><strong><em>Note:</em></strong> <em>Please make sure that the certificate does not contain any other characters other than the base64 characters like that of <code>\n</code> or <code>-----BEGIN CERTIFICATE-----</code> etc.</em></p>
</blockquote>
<ol>
<li>After upload is successful, restart the HVS</li>
</ol>
<div class="highlight"><pre><span></span><code>hvs restart
</code></pre></div>
<h3 id="522-registering-a-vmware-esxi-host_1">5.2.2  Registering a VMware ESXi Host</h3>
<p>The VMware ESXi connection string is actually directed to vCenter, not
the actual ESXi host. Many ESXi hosts managed by the same vCenter server
will use the same connection string. The username and password specified
are vCenter credentials, and the vCenter "Validate Session" privilege is
required for access.</p>
<div class="highlight"><pre><span></span><code>vmware:https://&lt;vCenterHostNameOrIp&gt;:443/sdk<span class="p">;</span><span class="nv">h</span><span class="o">=</span>&lt;hostname of ESXi host&gt;<span class="p">;</span><span class="nv">u</span><span class="o">=</span>&lt;username&gt;<span class="p">;</span><span class="nv">p</span><span class="o">=</span>&lt;password&gt;
</code></pre></div>
<div style="page-break-after: always"></div>
<h1 id="6-platform-integrity-attestation_1">6  Platform Integrity Attestation</h1>
<p>Platform attestation is the cornerstone use case for ISecL. Platform
attestation involves taking measurements of system components during
system boot, and then cryptographically verifying that the actual
measurements taken matched a set of expected or approved values,
ensuring that the measured components were in an acceptable or "<strong>trusted</strong>"
state at the time of the last system boot.</p>
<p>ISecL leverages the Trusted Compute Group specification for a trusted
boot process, extending measurements of platform components to registers
in a Trusted Platform Module, and securely generating quotes of those
measurements from the TPM for remote comparison to expected values
(attestation).</p>
<p>This section includes basic REST API examples for these workflows. See
the Javadoc for more detailed documentation on REST APIs supported by
ISecL.</p>
<p>Typical workflows in the datacenter might include:</p>
<ul>
<li>
<p>Creating a set of acceptable flavors for attestation with automatic
    flavor matching that represent the known-good measurements for
    acceptable BIOS and OS versions in the datacenter</p>
</li>
<li>
<p>Registering hosts for attestation with automatic flavor matching</p>
</li>
<li>
<p>Upgrading hosts in the datacenter to a new BIOS or OS version</p>
</li>
<li>
<p>Removing hosts from the Verification Service</p>
</li>
<li>
<p>Removing flavors</p>
</li>
<li>
<p>Provisioning asset tags to hosts</p>
</li>
<li>
<p>Invalidating asset tags</p>
</li>
<li>
<p>Retrieving current attestation reports</p>
</li>
<li>
<p>Retrieving current host state information</p>
</li>
<li>
<p>Remediating an untrusted attestation</p>
</li>
</ul>
<h2 id="61-host-registration_1">6.1  Host Registration</h2>
<p>Registration creates a host record with connectivity details and other
host information in the Verification Service database. This host record
will be used by the Verification Service to retrieve TPM attestation
quotes from the Trust Agent to generate an attestation report.</p>
<h3 id="611-trust-agent_1">6.1.1  Trust Agent</h3>
<h4 id="6111-registration-via-trust-agent-command-line_1">6.1.1.1  Registration via Trust Agent Command Line</h4>
<p>The Trust Agent can register the host with a Verification Service by
running the following command:</p>
<div class="highlight"><pre><span></span><code>tagent create-host &lt;Verification Service base URL&gt; &lt;username&gt; &lt;password&gt;
</code></pre></div>
<blockquote>
<p><strong><em>Note</em></strong>: <em>Because VMWare ESXi hosts do not use a Trust Agent, this method is
not applicable for registration of ESXi hosts.</em></p>
</blockquote>
<h3 id="612-registration-via-verification-service-api_1">6.1.2  Registration via Verification Service API</h3>
<p>Any Trust Agent or VMware ESXi host/cluster can be registered using a
Verification Service API request. Registration can be performed with or
without a set of existing Flavors. Rules for Flavor matching can be set
by using the Flavor Group in the request; if no Flavor Group is
specified, the <code>mtwilson_automatic</code> Flavor Group will be used. See the
Flavor Management section for additional details on Flavors, Flavor
Groups, and Flavor matching.</p>
<h4 id="6121-special-note-for-vmware-esxi-hosts-and-teh-vcenter-tls-certificate">6.1.2.1  Special Note for VMware ESXi Hosts and teh vCenter TLS Certificate</h4>
<h4 id="6122-sample-call_1">6.1.2.2  Sample Call</h4>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/hosts</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;host_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;hostname of host to be registered&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;description&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Requires the permission <code>hosts:create</code></p>
<h4 id="6123-sample-call-for-esxi-cluster-registration_1">6.1.2.3  Sample Call for ESXi Cluster Registration</h4>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/hosts</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot; esxi_clusters&quot;</span><span class="p">:</span> <span class="p">[</span>
       <span class="p">{</span>
          <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">,</span>
          <span class="nt">&quot;cluster_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;cluster name&gt;&quot;</span>
       <span class="p">}</span>
    <span class="p">]</span>
 <span class="p">}</span>
</code></pre></div></p>
<p>Requires the permission <code>esxi_clusters:create</code></p>
<h2 id="62-flavor-creation-for-automatic-flavor-matching_1">6.2  Flavor Creation for Automatic Flavor Matching</h2>
<p>Flavor creation is the process of adding one or more sets of acceptable
measurements to the Verification Service database. These measurements
correspond to specific system components, and are used as the basis of
comparison to generate trust attestations.</p>
<p>Flavors can be created manually, or can be imported from an example
host.</p>
<p>Flavors are automatically matched to hosts based on the Flavorgroup used
by the host and the Flavors, and the Flavor Match Policies of the
Flavorgroup. The ISecL Verification Service creates a default
Flavorgroups during installation called "<strong>automatic</strong>" This Flavorgroup is
configured to be used as a pool of all acceptable Flavors in a given
environment, and will automatically match the appropriate Flavor parts
to the correct host. This Flavorgroup is used by default and is expected
to be useful for the majority of deployments. If no Flavorgroup is
specified when creating a Flavor, it will be placed in the "<strong>automatic</strong>"
Flavorgroup.</p>
<p>Flavors are also divided into Flavor parts, which correspond to the
<code>PLATFORM</code>, <code>OS</code>, <code>HOST_UNIQUE</code>, <code>SOFTWARE</code>, and <code>ASSET_TAG</code> measurements. These
can be created and maintained separately (so that users can manage
acceptable OS and BIOS versions, rather than entire host
configurations). By default, if not specified, the Verification Service
will import Flavors as separate Flavor parts, as appropriate for the
host type.</p>
<p>By using individual Flavor parts, individual versions of OS or PLATFORM
measurements can be managed and automatically mapped. Whenever a host
changes states (Untrusted, Connected, etc.) the Verification Service
will attempt to match appropriate Flavors to that host. If a Flavor is
removed or added, all appropriate hosts will be updated to use the new
Flavor, or to no longer use the deleted Flavor. Hosts that are currently
using a BIOS where that BIOS versions’ PLATFORM Flavor was deleted will
now appear Untrusted, for example. This can be used to easily flag as
Untrusted hosts that are using software that has been End-Of-Lifed, or
perhaps an OS kernel with a known security vulnerability.</p>
<p><strong><em>Note:</em></strong> <em>See the Flavor Management section for additional details on how
flavors can be managed, and how the Flavor matching engine works.
The sample workflow provided here is intended to be an introduction
only.</em></p>
<h3 id="621-importing-a-flavor-from-a-sample-host_1">6.2.1  Importing a Flavor from a Sample Host</h3>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span> 
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PLATFORM&quot;</span><span class="p">,</span> <span class="s2">&quot;OS&quot;</span><span class="p">,</span> <span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">],</span>
    <span class="nt">&quot;flavorgroup_names&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Requires the permission <code>flavors:create</code></p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>The <code>HOST_UNIQUE</code> Flavor parts, used by Red Hat Enterprise Linux and
VMWare ESXi host types, MUST be created for each registered host of
that type, and should in general be imported from that host. This
means that importing the <code>HOST_UNIQUE</code> flavor should always be done
for each host registered (except for Windows hosts, which do not
have <code>HOST_UNIQUE</code> measurements)</em></p>
</blockquote>
<p>To import ONLY the <code>HOST_UNIQUE</code> Flavor part from a host:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span> 
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">],</span>
    <span class="kc">fla</span><span class="err">vorgroup_</span><span class="kc">na</span><span class="err">mes&quot;: []</span>
<span class="err">}</span>
</code></pre></div></p>
<p>Requires the permission <code>flavors:create</code></p>
<h3 id="622-creating-a-flavor-manually_1">6.2.2  Creating a Flavor Manually</h3>
<p>Flavors can be directly created (rather than importing from a sample
host) if the required information is known. If no Flavorgroup is
specified, the Flavor will be placed in the <code>automatic</code> group. Note that
the <code>label</code> is a required field and must be unique.</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavor_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;PLATFORM&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation_SE5C610.86B.01.01.1008.031920151331_TPM2.0&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;hardware&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;processor_info&quot;</span><span class="p">:</span> <span class="s2">&quot;…&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;processor_flags&quot;</span><span class="p">:</span> <span class="s2">&quot;…&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;tpm&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                            <span class="nt">&quot;pcr_banks&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s2">&quot;SHA1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;SHA256&quot;</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;txt&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="err">...</span>
                        <span class="p">}</span>
</code></pre></div></p>
<p>Requires the permission <code>flavors:create</code></p>
<h2 id="63-creating-the-default-software-flavor-linux-only_1">6.3  Creating the Default SOFTWARE Flavor (Linux Only)</h2>
<p>As part of the new Application Integrity feature added in Intel® SecL-DC
version 1.5, a new default SOFTWARE Flavor part is provided so that the
Linux Trust Agent itself can be measured and included in the attestation
process. The default SOFTWARE Flavor includes a manifest for the static
files and folders in the Trust Agent. The manifest is automatically
deployed to each Linux Trust Agent during the provisioning step.</p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>The Linux Trust Agent </em><em>must</em><em> be rebooted after the
Provisioning step is completed (typically Provisioning happens during
installation, based on whether all of the required variables are set
in the <code>trustagent.env</code> file). Rebooting allows the default <code>SOFTWARE</code>
Flavor manifest to be measured and extended to the TPM PCRs. If the
reboot is not performed, the system will require a <code>SOFTWARE</code> Flavor,
but the measurements will not exist, and the system will appear
Untrusted. If an un-rebooted host is used to create the <code>SOFTWARE</code>
Flavor, the Flavor will be created based on measurements that do not
exist, and will fail.</em></p>
</blockquote>
<p>The <code>SOFTWARE</code> Flavor part should be created separately from the other
Flavor parts. Only one default <code>SOFTWARE</code> Flavor needs to be created for
each version of the Linux Trust Agent. If the <code>SOFTWARE</code> Flavor for the
same Trust Agent version is imported multiple times, subsequent imports
will fail as the Flavor already exists.</p>
<p>To import the <code>SOFTWARE</code> Flavor part from a host:</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span> 
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SOFTWARE&quot;</span><span class="p">],</span>
    <span class="kc">fla</span><span class="err">vorgroup_</span><span class="kc">na</span><span class="err">mes&quot;: []</span>
<span class="err">}</span>
</code></pre></div></p>
<p>Requires the permission <code>flavors:create</code></p>
<h2 id="64-creating-and-provisioning-asset-tags_1">6.4  Creating and Provisioning Asset Tags</h2>
<p>Asset Tags represent a set of key/value pairs that can be associated
with a host in hardware. This enables usages around restricting
workflows to specific hosts based on tags, which could include location
information, compliance tags, etc.</p>
<p>ISecL creates Asset Tags by creating a certificate containing the list
of key/value pairs to be tagged to the host, with the host’s hardware
UUID as the certificate subject. A hash of this certificate is then
written to an NVRAM index in the host’s TPM. This value is included in
TPM quotes, and can be attested using an Asset Tag flavor that matches
up the expected value and the actual key/value pairs.</p>
<h3 id="641-creating-asset-tag-certificates_1">6.4.1  Creating Asset Tag Certificates</h3>
<p>Asset Tag certificates can be created with a single REST API call, with
any number of key/value pairs. Note that one certificate must be created
for each host to be tagged, even if they will all be tagged with
identical key/value pairs.</p>
<p><div class="highlight"><pre><span></span><code>POST https://verification.service.com:8443/hvs/v2/tag-certificates
Authorization: Bearer &lt;token&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;hardware_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;hardware UUID of host to be tagged&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;selection_content&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;key&gt;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;value&gt;&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;key&gt;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;value&gt;&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;key&gt;&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;value&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="642-deploying-asset-tags_1">6.4.2  Deploying Asset Tags</h3>
<h4 id="6421-windows-and-red-hat-enterprise-linux">6.4.2.1  Windows and Red Hat Enterprise Linux</h4>
<p>Asset Tags can be provisioned to a Windows or RHEL host via a REST API
request on the Verification Service that will in turn make a request to
the Trust Agent on the host to be tagged.</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/rpc/deploy-tag-certificate</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;certificate_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;certificate ID&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="6422-vmware_1">6.4.2.2  VMWare</h4>
<p>Since VMWare ESXi hosts do not use a Trust Agent, the process for
writing Asset Tags to a VMWare host is different from RHEL or Windows. A
new interface has been added to ESXi via a new <code>esxcli</code> command starting
in vSphere 6.5 Update 2 that allows the Asset Tag information to be
written to the TPM via a command-line command. The older process is also
described below.</p>
<p>The high-level workflow for using Asset Tags with VMWare ESXi is:</p>
<ol>
<li>Create the Asset Tag Certificate for the host.</li>
<li>Calculate the Certificate Hash value.</li>
<li>Provision the Certificate Hash value to the host TPM and reboot</li>
<li>Create the Asset Tag Flavor.</li>
</ol>
<blockquote>
<p><strong><em>Note</em></strong>: <em>Asset Tag is currently not supported for VMWare hosts
using TPM 2.0.</em></p>
</blockquote>
<h5 id="calculate-the-certificate-hash-value">Calculate the Certificate Hash Value</h5>
<p>Only the hash value of the Asset Tag Certificate can be provisioned to
the TPM, due to the low size of the NVRAM.</p>
<ol>
<li>
<p>Retrieve the Asset Tag Certificate. The Asset Tag Certificate can be
    retrieved either from the response when the Asset Tag certificate is
    created, or by using a GET API request to retrieve the certificate:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET https://verification.service.com:8443/hvs/v2/tag-certificates?subjectEqualTo=&lt;HardwareUUID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
</li>
<li>
<p>Copy only the <code>certificate</code> value (this will be the certificate in
    encoded format) and write the data to a file on a Linux system.
    Remove any line breaks and save the file. Assuming the filename used
    is <code>tag-cert</code> use the following to generate the correct hash:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>    cat tag-cert <span class="p">|</span> base64 --decode <span class="p">|</span> openssl dgst -sha1 <span class="p">|</span> awk -F<span class="s2">&quot; &quot;</span> <span class="s1">&#39;{print $2}&#39;</span>
</code></pre></div>
<p>This hash value will be what is actually written to the TPM NVRAM.</p>
<h5 id="provision-the-certificate-hash-to-the-host-tpm">Provision the Certificate Hash to the Host TPM</h5>
<p>Due to a new feature added in vSphere 6.5 Update 2, the process for
provisioning Asset Tags on VMWare ESXi hosts has been significantly
improved. Both the old and new process for provisioning Asset Tags is
documented below. Intel recommends using vSphere 6.5 Update 2 or later
due to the significant difference in the process.</p>
<h6 id="vsphere-65-update-2-or-later_1">vSphere 6.5 Update 2 or Later</h6>
<p>Starting in ESXi 6.5u2, you can now use SSH to write Asset Tags directly
with no need for TPM clears, reboots, PXE, or BIOS access. SSH to the
ESXi host using root credentials. Then use the command:</p>
<ol>
<li>Use the following command
<div class="highlight"><pre><span></span><code>    esxcli hardware tpm tag <span class="nb">set</span> -d &lt;hash&gt;
</code></pre></div></li>
</ol>
<p>You can use the following command to verify that the tag was written:</p>
<div class="highlight"><pre><span></span><code>    esxcli hardware tpm tag get
</code></pre></div>
<ol>
<li>Reboot the host. After rebooting, the TPM PCR 22 will have the
    measured value of the hash.</li>
</ol>
<h6 id="vsphere-65-update-1-or-older_1">vSphere 6.5 Update 1 or Older</h6>
<p>There is no direct interface from VMWare vCenter or ESXi previous to
vSphere 6.5 Update 2 that will write the Tag information to the host
TPM.</p>
<p>Writing Asset Tag information to a TPM requires TPM ownership; VMWare
ESXi takes TPM ownership with a secret password at boot time. This means
that the process for writing Asset Tags to a VMWare host requires:</p>
<ol>
<li>
<p>Clear TPM ownership.</p>
<ul>
<li>This can be done via the system BIOS, or using One Touch Activation
  through the IPMI interface (if enabled by the server OEM).</li>
</ul>
</li>
<li>
<p>Reactivate TPM/TXT.</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Booting to an OS that has the ability to issue TPM commands</p>
</li>
<li>
<p>Typically the provisioning OS used is Ubuntu or RHEL, booted
     temporarily using PXE.</p>
</li>
<li>
<p>Writing the Tag information</p>
</li>
<li>
<p>The TPM index 0x40000010 must be defined, and the hash of the Asset
     Tag certificate must be written to that index.</p>
</li>
<li>
<p>Clear TPM ownership.</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Reactivate TPM/TXT</p>
</li>
<li>
<p>This can be done via the system BIOS, or using One Touch Activation
     through the IPMI interface (if enabled by the server OEM).</p>
</li>
<li>
<p>Boot back to VMWare ESXi.</p>
</li>
</ol>
<p>When the system is rebooted to ESXi, the Trusted Boot process will
extend the value to PCR22, and this value can be used during
attestation.</p>
<h5 id="creating-the-asset-tag-flavor-vmware-esxi-only">Creating the Asset Tag Flavor (VMWare ESXi Only)</h5>
<p>While for RHEL and Windows hosts the Asset Tag Flavor is automatically
created during the Tag Provisioning step, for VMWare ESXi hosts the
Flavor must be created by importing it from the host after the Tag has
been provisioned.</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>   
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;VMWare vCenter connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ASSET_TAG&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Once the Asset Tag Flavor is imported, the host can be attested
including Asset Tags as normal.</p>
<h2 id="65-retrieving-current-attestation-reports_1">6.5  Retrieving Current Attestation Reports</h2>
<div class="highlight"><pre><span></span><code><span class="err">GET https://verification.service.com:8443/hvs/v2/reports?latestPerHost=true</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h2 id="66-retrieving-current-host-state-information_1">6.6  Retrieving Current Host State Information</h2>
<div class="highlight"><pre><span></span><code><span class="err">GET https://verification.service.com:8443/hvs/v2/host-status?latestPerHost=true</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h2 id="67-upgrading-hosts-in-the-datacenter-to-a-new-bios-or-os-version_1">6.7  Upgrading Hosts in the Datacenter to a New BIOS or OS Version</h2>
<p>Software and firmware updates are a common occurrence in the datacenter.
Automatic Flavor matching makes this process relatively simple:</p>
<ol>
<li>
<p>Create a new Flavor for the new version. This may be manually
    created or imported directly from a sample host that has already
    received the upgrade. Be sure to create new Flavors for each TPM
    version represented in your datacenter.</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span> 
    <span class="nt">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;connection string&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;partial_flavor_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PLATFORM&quot;</span><span class="p">,</span> <span class="s2">&quot;OS&quot;</span><span class="p">,</span> <span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">],</span>
    <span class="kc">fla</span><span class="err">vorgroup_</span><span class="kc">na</span><span class="err">mes&quot;: []</span>
<span class="err">}</span>
</code></pre></div></p>
</li>
<li>
<p>Update the hosts to the new software or firmware version as normal.
    On the next attestation attempt, the Verification Service will
    automatically match the updated hosts to the new Flavor.</p>
</li>
<li>
<p>(Optional) If desired, delete the Flavor for the older version after
    the update is completed. This will cause any hosts that are still
    using the old version to attest as Untrusted. Which can easily flag
    hosts that missed the upgrade for remediation.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="err">    DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;flavorId&gt;</span>
<span class="err">    Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>​    </p>
<h2 id="68-removing-hosts-from-the-verification-service_1">6.8  Removing Hosts From the Verification Service</h2>
<p>Hosts can be deleted at any time. Reports for that host will remain in
the Verification Service database for audit purposes.</p>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://verification.service.com:8443/hvs/v2/hosts/&lt;hostId&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>The <code>hostId</code> can be retrieved either at the time the host is created, or
by searching hosts using the host’s hostname.</p>
<h2 id="69-removing-flavors_1">6.9  Removing Flavors</h2>
<p>Flavors can be deleted; this will cause any hosts that match the deleted
Flavor to evaluate as Untrusted. This can be done if, for example, an
old BIOS version needs to be retired and should no longer exist in the
datacenter. By deleting the PLATFORM Flavor, hosts with the old BIOS
version will attest as Untrusted, flagging them for easy remediation.</p>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;flavorId&gt;</span>
</code></pre></div>
<h2 id="610-invalidating-asset-tags_1">6.10 Invalidating Asset Tags</h2>
<p>Asset Tags can be deleted in two ways.</p>
<p>Deleting the <code>ASSET_TAG</code> Flavor part will retain the Asset Tag
certificate in the database, but will cause the host using this Tag to
no longer use the Asset Tag for attestation (the Tag result will be
disregarded and no tags will be exposed in the attestation Reports).</p>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://verification.service.com:8443/hvs/v2/flavors/&lt;assetTagflavorId&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>Deleting the actual Asset Tag certificate will remove the certificate
from the database, but will not actually affect attestation results (the
authority for attestation results is the Flavor).</p>
<div class="highlight"><pre><span></span><code><span class="err">DELETE https://verification.service.com:8443/hvs/v2/tag-certificates/&lt;assetTagCertificateId&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<h2 id="611-remediating-an-untrusted-attestation_1">6.11  Remediating an Untrusted attestation</h2>
<p>Hosts can become Untrusted for a wide variety of causes. The first clue
to finding the root cause for an Untrusted attestation is the
attestation Report itself – the Report will show Trust results for the
<code>PLATFORM</code>, <code>OS</code>, <code>HOST_UNIQUE</code>, and <code>ASSET_TAG</code> Flavor parts individually,
along with the <code>OVERALL</code> trust. If the Report shows that the PLATFORM
Flavor part trust is “false” for example, it means that the PLATFORM
measurements did not match any Flavors in the host’s Flavorgroup.</p>
<p>Untrusted attestation Reports will contain <strong>faults</strong> that describe the
specific attestation rules that were not satisfied. This often shows
enough information to describe the cause of the Untrusted status. A
fault like <strong>RequiredButNotDefined</strong> means that a Flavor part is required
by the Flavorgroup policy, but no Flavors for that Flavor part exist in
the Flavorgroup (for example, generally Flavorgroups should always
require a PLATFORM Flavor part; if no PLATFORM Flavors are in the
Flavorgroup, hosts in the Flavorgroup will attest with this fault).</p>
<p>Other faults include:</p>
<p><strong>"PcrMatchesConstant"</strong> - describes a rule that evaluates whether a TPM
PCR has a specific value</p>
<p><strong>"PcrEventLogIntegrity"</strong> - the module event log is replayed during
attestation to verify that the resulting measurement matches the actual
value in the module PCR. If the replay does not match, it indicates the
event log cannot itself be trusted.</p>
<p><strong>"AikCertificateTrusted"</strong> – This rule evaluates whether the TPM quote
was signed by the TPM associated with this host. As part of host
registration, the public half of the Attestation Identity Keypair is
captured, and this public key is used to verify the signature on TPM
quotes from that host.</p>
<p>See the Appendix for a full list of the rules evaluated during
Attestation.</p>
<p>The Flavor matching engine will use the most-similar Flavor for the
attestation Report in the case of an Untrusted result.</p>
<p>The fault will explain in a general sense what rule the host attestation
violated. To remediate, the rule will need to be satisfied. This could
mean creating a new Flavor to match the actual observed values, or it
could mean that the host has been tampered with and should have its BIOS
flashed or OS reloaded.</p>
<h2 id="612-attestation-reporting_1">6.12  Attestation Reporting</h2>
<p>Attestation results are delivered in the form of Host Reports. A Report
can delivered in several different formats, which can change the type of
data returned.</p>
<p>The preferred format for Host Reports is a SAML attestation. A
SAML-formatted report includes a chain or signatures that provides
auditability for the Report. The SAML attestation will include the base
trust status of the host, as well as the overall trust for each
individual Flavor used in the attestation. The Report will also contain
host information, such as TPM version, Operating System name and
version, BIOS version, etc. The SAML Report will not, however, contain
individual measurements and comparisons of values. This format of the
Report is ideal for securely communicating the trust status of a host
and for audit history.</p>
<p>Attestation Reports can also be retrieved in <code>json</code> or <code>xml</code> format. These
formats will not include the signature chain provided in the SAML
format, but will contain the actual measurement values and expected
Flavor values used for comparison. These reports are typically used for
remediation, because they will show specifically why a given Host
attested as Untrusted.</p>
<p>The format for a Report is determined by the <code>Accept</code> header in the
request.</p>
<p>Attestations are automatically generated in the Verification Service by
a repeating scheduled background process. This process looks for
Attestation Reports that are close to expiration, and triggers a new
Attestation Report. By default, Attestation Reports are valid for 90
minutes, and the background refresh process will trigger a new
attestation when a Report is found to be within 3 minutes of expiration.</p>
<p>A user can either retrieve the most recent currently valid Attestation
Report for a given host, or may trigger a new Attestation Report to be
generated. Typically, it is best to retrieve an existing Report for
performance reasons. Generating a new Attestation Report requires the
generation of a new TPM quote from the TPM of the host being attested;
TPM performance differs greatly between vendors, and a quote can take
anywhere between 2-7 seconds to generate.</p>
<h3 id="6121-sample-call-generating-a-new-attestation-report_1">6.12.1  Sample Call – Generating a New Attestation Report</h3>
<div class="highlight"><pre><span></span><code><span class="err">POST https://verification.service.com:8443/hvs/v2/reports</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;host_name&quot;</span><span class="p">:</span><span class="s2">&quot;host-1&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Requires the permission <code>reports:create</code></p>
<h3 id="6122-sample-call-retrieving-an-existing-attestation-report_1">6.12.2  Sample Call – Retrieving an Existing Attestation Report</h3>
<div class="highlight"><pre><span></span><code><span class="err">GET https://verification.service.com:8443/hvs/v2/reports?hostName=HostName.server.com</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>Below are the supported criteria options in order of precedence. If no
host filter criteria is specified, then results are returned for all
active hosts.</p>
<ul>
<li>
<p><code>id</code> - unique UUID of the report entry in the database</p>
</li>
<li>
<p><code>hostId</code> - unique UUID of the host entry in the database</p>
</li>
<li>
<p><code>hostName</code> - name of the host</p>
</li>
<li>
<p><code>hostHardwareId</code> - hardware UUID of the host</p>
</li>
<li>
<p><code>hostStatus</code> - current state of the host, which supports the following
    options:</p>
<ul>
<li>CONNECTED - host is in connected state</li>
<li>QUEUE - host is in queue to be processed</li>
<li>CONNECTION_FAILURE - connection failure</li>
<li>UNAUTHORIZED - unauthorized</li>
<li>AIK_NOT_PROVISIONED - AIK certificate is not provisioned</li>
<li>EC_NOT_PRESENT - endorsement certificate is not present</li>
<li>MEASURED_LAUNCH_FAILURE - TXT measured launch failure</li>
<li>TPM_OWNERSHIP_FAILURE - TPM ownership failureTPM_NOT_PRESENT - TPM is not present</li>
<li>UNSUPPORTED_TPM - unsupported TPM version</li>
<li>UNKNOWN - unknown host state</li>
</ul>
</li>
</ul>
<p>Requires the permissions <code>reports:search</code></p>
<p>Other search criteria may also be used. By default, the most recent
currently valid attestation is returned. However, different query
parameters can be used to retrieve all attestations for a specific host
over the last 30 days, for example.</p>
<h2 id="613-integration_1">6.13  Integration</h2>
<p>Intel® SecL can be integrated with scheduler services (or potentially
other services) to provide additional security controls. For example, by
integrating Intel® SecL with the OpenStack scheduler service, the
OpenStack placement service can incorporate the Intel® SecL security
attributes into VM scheduling.</p>
<h3 id="6131-the-integration-hub_1">6.13.1  The Integration Hub</h3>
<p>The Integration Hub acts as the integration point between the Verification Service and a third party service. The primary purpose of the Hub is to collect and maintain up-to-date attestation information, and to “push” that information to the external service. The secondary purpose is to allow for multitenancy, the Verification Service does not allow for permissions to be applied for specific hosts, so a user with the “attestation” role can access all attestations for all hosts. By using separate Integration Hub instances for each Cloud environment (or "tenant"), the Hub will push attestations only for the associated hosts to a given tenant’s integration endpoints.</p>
<p>For example, Tenant A is using hosts 1-10 for an OpenStack environment. Tenant B is using hosts 11-15 for a Docker environment. Two Hub instances must be configured, one managing tenant A's OpenStack cluster and a second instance managing Tenant B's Docker environment.  Each integration Hub will automatically retrieve the list of hosts used by its configured orchestration endpoint, retrieve the attestation reports only for those hosts, and push the attestation attribute information to each configured endpoint. Neither tenant will have access to the Verification Service, and will not be able to see attestation or other host details regarding infrastructure used by other tenants.</p>
<p>Different integration endpoints can be added to the Integration Hub through a plugin architecture. By default, the Integration Hub includes plugins for OpenStack and Kubernetes (Kubernetes deployments require the additional installation of two Intel® SecL-DC Custom Resource Definitions on the Kube Control Plane).</p>
<p><img src="images\integration1.png" alt="image-20200621122250278" style="zoom:150%;" /></p>
<h3 id="6132-integration-with-openstack_1">6.13.2  Integration with OpenStack</h3>
<p>Starting in the Rocky release, OpenStack can now use “Traits” to provide qualitative data about Nova Compute hosts, and to establish Trait requirements for VM instances. The updated scheduler will place VMs
requiring a given Trait on Nova Compute nodes that meet the Trait requirements.</p>
<p>Intel SecL-DC uses the Integration Hub to continually push platform integrity and Asset Tag information to the OpenStack Traits resources.  This means the OpenStack scheduler natively supports workload scheduling incorporating Intel SecL-DC security attributes, including attestation report Trust status and Asset Tags. The OpenStack Placement Service will automatically attempt to place images with Trait requirements on compute nodes that have those Traits.</p>
<blockquote>
<p><strong><em>NOTE</em></strong>:  <em>This control only applies to instances launched using the
OpenStack scheduler, and the Traits functions will not affect
manually-launched instances where a specific Compute Node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing OpenStack interfaces and does not modify OpenStack code.  The
datacenter owner or OpenStack administrator is responsible for the
security of the OpenStack workload scheduling process in general, and
Intel recommends following published OpenStack security best
practices.</em></p>
</blockquote>
<h4 id="61321-prerequisites_1">6.13.2.1  Prerequisites</h4>
<ul>
<li>
<p>Verification Service must be installed and running.</p>
</li>
<li>
<p>OpenStack* Rocky (or later) Nova, Glance, Horizon, and Keystone services must
    be installed and running</p>
</li>
<li>
<p>The Integration Hub must be installed and running.</p>
</li>
</ul>
<h4 id="61322-setting-image-traits_1">6.13.2.2  Setting Image Traits</h4>
<p>Image Traits define the policy for which Traits are required for that
Image to be launched on a Nova Compute node. By setting these Traits to
“required,” the OpenStack scheduler will require these same Traits to be
present on a Nova Compute node in order to launch instances of the
image.</p>
<p>To set the Image Traits for Intel SecL-DC, a specific naming convention
is used. This naming convention will match the Traits that the
Integration Hub will automatically push to OpenStack. Two types of
Traits are currently supported – one Trait is used to require that the
Compute Node be Trusted in the Attestation Report, and the other Trait
is used to require specific Asset Tag key/value pairs.</p>
<p>To require a <code>Trusted</code> Attestation Report:</p>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_TRUSTED=required
</code></pre></div>
<p>The naming convention for Asset Tags is more flexible, and any number of
these Traits can be used simultaneously.</p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>All of the Traits must be present on the Compute Node for the
scheduler to allow instances to land, so be sure not to set mutually
exclusive Asset Tag values.</em>
</p>
</blockquote>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_AT_TAG_&lt;key&gt;__&lt;value&gt;=required`
</code></pre></div>
<p>For example, to define a Trait that will require an Asset Tag where
<code>State = CA</code> use the following:</p>
<div class="highlight"><pre><span></span><code>CUSTOM_ISECL_AT_TAG__STATE_CA= required
</code></pre></div>
<p>These Traits can be set using CLI commands for OpenStack Glance:</p>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">set</span> --property trait:CUSTOM_ISECL_AT_STATE__CA<span class="o">=</span>required &lt;image_name&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">set</span> --property trait:CUSTOM_ISECL_TRUSTED<span class="o">=</span>required &lt;image_name&gt;
</code></pre></div>
<p>To remove a Trait so that it is no longer required for an Image:</p>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">unset</span> --property trait:CUSTOM_ISECL_AT_STATE__CA &lt;image_name&gt;
</code></pre></div>
<div class="highlight"><pre><span></span><code>openstack image <span class="nb">unset</span> --property trait:CUSTOM_ISECL_TRUSTED &lt;image_name&gt;
</code></pre></div>
<h4 id="61323-configuring-the-integration-hub-for-use-with-openstack_1">6.13.2.3  Configuring the Integration Hub for Use with OpenStack</h4>
<p>The Integration Hub must be configured with the API URLs and credentials for the OpenStack instance it will integrate with.  This can be done during installation using the "OPENSTACK..." variables shown in the <code>ihub.env</code> answer file  sample (see the Installing the Integration Hub section). </p>
<h4 id="61327-scheduling-instances_1">6.13.2.7  Scheduling Instances</h4>
<p>Once Trait requirements are set for Images and the Integration Hub is
configured to push attributes to OpenStack, instances can be launched in
OpenStack as normal. As long as the OpenStack Nova scheduler is used to
schedule the workloads, only compliant Compute Nodes will be scheduled
to run instances of controlled Images.</p>
<blockquote>
<p><strong><em>NOTE</em></strong>: <em>This control only applies to instances launched using the
OpenStack scheduler, and the Traits functions will not affect
manually-launched instances where a specific Compute Node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing OpenStack interfaces and does not modify OpenStack code.  The
datacenter owner or OpenStack administrator is responsible for the
security of the OpenStack workload scheduling process in general, and
Intel recommends following published OpenStack security best
practices.</em></p>
</blockquote>
<h3 id="6133-integration-with-kubernetes_1">6.13.3  Integration with Kubernetes</h3>
<p>Through the use of Custom Resource Definitions for the Kubernetes
Control Plane, Intel® Security Libraries can make Kubernetes aware of Intel®
SecL security attributes and make them available for pod orchestration.
In this way, a security-sensitive pod can be launched only on <code>Trusted</code>
physical worker nodes, or on physical worker nodes that match specified
Asset Tag values.</p>
<blockquote>
<p><strong><em>NOTE</em></strong>: <em>This control only applies to pods launched using the
Kubernetes scheduler, and these scheduling controls will not affect
manually-launched instances where a specific worker node is defined
(since this does not use the scheduler at all). Intel SecL-DC uses
existing Kubernetes interfaces and does not modify Kubernetes code,
using only the standard Custom Resource Definition mechanism to add
this functionality to the Kubernetes Control Plane.  The datacenter owner or
Kubernetes administrator is responsible for the security of the
Kubernetes workload scheduling process in general, and Intel
recommends following published Kubernetes security best practices.</em></p>
</blockquote>
<h4 id="61331-prerequisites_1">6.13.3.1  Prerequisites</h4>
<ul>
<li>
<p>Verification Service must be installed and running.</p>
</li>
<li>
<p>Kubernetes Control Plane Node must be installed and running</p>
</li>
<li>
<p>The supported Kubernetes versions are from <code>1.14.8</code>-<code>1.17.3</code> and the
    integration is validated with <code>1.14.8</code> and <code>1.17.3</code></p>
</li>
<li>
<p>Kubernetes Worker Nodes must be configured as physical hosts and
    attached to the Control Plane Node</p>
</li>
</ul>
<h4 id="61332-installing-the-intel-secl-custom-resource-definitions_1">6.13.3.2  Installing the Intel® SecL Custom Resource Definitions</h4>
<p>Intel® SecL uses Custom Resource Definitions to add the ability to base
orchestration decisions on Intel® SecL security attributes to
Kubernetes. These CRDs allow Kubernetes administrators to configure pods
to require specific security attributes so that the Kubernetes Control Plane
Node will schedule those pods only on Worker Nodes that match the
specified attributes.</p>
<p>Two CRDs are required for integration with Intel® SecL – an extension
for the Control Plane nodes, and a scheduler extension. A single installer will
deploy both of these CRDs. The extensions are deployed as a Kubernetes
deployment in the <code>isecl</code> namespace.</p>
<p>To deploy the Kubernetes integration CRDs for Intel® SecL:</p>
<ol>
<li>
<p>Copy the <code>isecl-k8s-extensions</code> installer to the Kubernetes Control Plane
    and execute the installer</p>
<div class="highlight"><pre><span></span><code>./isecl-k8s-extensions-v3.3.1.bin
</code></pre></div>
</li>
<li>
<p>Add a mount path to the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file for the Intel
    SecL scheduler extension:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extendedsched</span>
  <span class="nt">readOnly</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</li>
<li>
<p>Add a volume path to the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file for the Intel
    SecL scheduler extension:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/</span>
    <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extendedsched</span>
</code></pre></div>
</li>
<li>
<p>Add <code>policy-config-file</code> path in the
    <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> file under <code>command</code> section:</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kube-scheduler</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--policy-config-file=/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/scheduler-policy.json</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--bind-address=127.0.0.1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--kubeconfig=/etc/kubernetes/scheduler.conf</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--leader-elect=true</span>
</code></pre></div>
</li>
<li>
<p>Wait for the isecl-controller and isecl-scheduler pods to be into
    running state</p>
<p><code>shell
kubectl get pods -n isecl</code></p>
</li>
<li>
<p>Create role bindings on the Kubernetes Control Plane:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl create clusterrolebinding isecl-clusterrole --clusterrole=system:node --user=system:serviceaccount:default:default

kubectl create clusterrolebinding isecl-crd-clusterrole --clusterrole=isecl-controller --user=system:serviceaccount:default:default
</code></pre></div>
<ol>
<li>Copy the Integration Hub public key to the Kubernetes Control Plane:</li>
</ol>
<div class="highlight"><pre><span></span><code>scp -r /etc/ihub/ihub_public_key.pem k8s.maseter.server:/opt/isecl-k8s-extensions/isecl-k8s-scheduler/config/
</code></pre></div>
<ol>
<li>Run the command <code>systemctl restart kubelet</code> to restart all the control
   plane container services, including the base scheduler.</li>
</ol>
<p>The scheduler yaml is present under
<code>/opt/isecl-k8s-extensions/yamls/isecl-scheduler.yaml</code></p>
<ol>
<li>If the Controller and/or Scheduler deployments are deleted, the
   following steps need to be performed:</li>
</ol>
<p>a. Edit <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> and
remove/comment the following content and restart kubelet</p>
<p><div class="highlight"><pre><span></span><code>--policy-config-file<span class="o">=</span>/opt/isecl-k8s-extensions/isecl-k8sscheduler/config/scheduler-policy.json
systemctl restart kubelet
</code></pre></div>
b. Redeploy scheduler and controller</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-controller.yaml
kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-scheduler.yaml
</code></pre></div>
<p>c. Edit <code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> and
add/uncomment the following content and restart kubelet</p>
<p><div class="highlight"><pre><span></span><code>--policy-config-file<span class="o">=</span>/opt/isecl-k8s-extensions/isecl-k8sscheduler/config/scheduler-policy.json
systemctl restart kubelet
</code></pre></div>
d. Logs will be appended to older logs in
/var/log/isecl-k8s-extensions</p>
<ol>
<li>Whenever the CRD's are deleted and restarted for updates, the CRD's
    using the yaml files present under <code>/opt/isecl-k8s-extensions/yamls/</code>.
    Kubernetes Version 1.14-1.15 uses <code>crd-1.14.yaml</code> and 1.16-1.17 uses
    <code>crd-1.17.yaml</code></li>
</ol>
<div class="highlight"><pre><span></span><code>kubectl delete hostattributes.crd.isecl.intel.com
kubectl apply -f /opt/isecl-k8s-extensions/yamls/crd-&lt;version&gt;.yaml
</code></pre></div>
<ol>
<li>(Optional) Verify that the Intel ® SecL Custom Resource Definitions
    have been started:</li>
</ol>
<p>To verify the Intel SecL CRDs have been deployed:</p>
<div class="highlight"><pre><span></span><code>kubectl get pods -n isecl
</code></pre></div>
<h4 id="61336-configuring-pods-to-require-intel-secl-attributes_1">6.13.3.6  Configuring Pods to Require Intel® SecL Attributes</h4>
<ol>
<li>
<p>(Optional) Verify that the worker nodes have had their Intel® SecL
    security attributes populated:</p>
<div class="highlight"><pre><span></span><code>kubectl get nodes --show-labels
</code></pre></div>
<p>The output should show the Trust status and any Asset Tags applied to
all of the registered Worker Nodes.</p>
</li>
<li>
<p>Add the following to any Pod creation files:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">affinity</span><span class="p">:</span>
    <span class="nt">nodeAffinity</span><span class="p">:</span>
      <span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
        <span class="nt">nodeSelectorTerms</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">matchExpressions</span><span class="p">:</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.trusted</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="s">&quot;true&quot;</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_Country</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">US</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_Customer</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Coke</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Pepsi</span>
              <span class="p p-Indicator">-</span> <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">isecl.TAG_State</span>
                <span class="nt">operator</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">In</span>
                <span class="nt">values</span><span class="p">:</span>
                  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
</code></pre></div>
</li>
</ol>
<p>The <code>isecl.trusted</code> key defines the requirement for a Trusted host. Only
one of these keys should be used. The <code>isecl.TAG_</code> keys indicate Asset
Tags; if the workload should only launch on hosts with the <code>COUNTRY=US</code> Asset Tag, the pod should be launched with the matchExpression key
<code>isecl.TAG_COUNTRY</code> with the value <code>US</code>.</p>
<p>All of the matchExpression definitions must be true for a given worker
node to launch the pod – in the example above, the host must be
attested as Trusted with Asset Tags <code>Country=US</code> ,<code>Customer=Customer1</code> and <code>State=CA</code>. If the worker node has
additional Asset Tags beyond the ones required, the pod will still be
able to be launched on that node. However, if one of the specified
Tags is missing or has a different value, that worker node will not be
used for that pod.</p>
<h4 id="61337-tainting-untrusted-worker-nodes_1">6.13.3.7  Tainting Untrusted Worker Nodes</h4>
<p>Optionally, the Intel® SecL Kubernetes CRDs can be configured to flag
worker nodes as <code>tainted</code> to prevent any pods from launching on them.
This restriction is applied regardless of whether the pod has a specific
trust policy – if a worker node is flagged as <code>tainted</code> no pods will be
launched on that worker.</p>
<p>This setting is disabled by default. To enable this setting:</p>
<ol>
<li>
<p>Edit the <code>isecl-controller.yaml</code> file under
    <code>/opt/isecl-k8s-extensions/yamls/isecl-controller.yaml</code> and set
    <code>TAINT_UNTRUSTED_NODES=true</code></p>
</li>
<li>
<p>Run</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f /opt/isecl-k8s-extensions/yamls/isecl-controller.yaml
</code></pre></div>
</li>
</ol>
<p>Worker nodes that attest as untrusted will be <code>tainted</code> with the
NoExecute flag and unable to launch pods.</p>
<p>If a worker was previously considered tainted and the untrusted state is
resolved, the Intel® SecL CRDs will remove the tainted flag and the
worker will be able to launch pods again.</p>
<div style="page-break-after: always"></div>
<h1 id="7-workload-confidentiality_1">7  Workload Confidentiality</h1>
<p>Workload Confidentiality builds upon Platform Attestation to protect
data in virtual machine and container images. At its core, this feature
is about allowing an image owner to set policies that define the
conditions under which their image will be allowed to run; if the policy
conditions are met, the decryption key will be provided, and if the
conditions are not met, the image will remain encrypted and
inaccessible. This provides a level of enforcement beyond integration
with orchestrators, and protects sensitive data when the image is at
rest.</p>
<p>Workload Encryption relies on Platform Attestation to define the
security attributes of hosts. When a protected image is launched, the
Workload Agent on the host launching the VM or container image will
detect the attempt (using either Libvirt hooks for VMs, or as a function
of the Docker Secure Overlay Driver in the case of containers) and use
the Image ID to find the Image Flavor on the Workload Service. The
Workload Service will retrieve the current trust report for the host
launching the image, and use that report to make a key retrieval request
to the key transfer URL retrieved from the image flavor. The key
transfer URL refers to the URL to the image owner’s Key Broker Service,
along with the ID of the key needed.</p>
<p>In a typical production deployment, a Cloud Service Provider would
enable Intel® SecL-DC security controls by installing the Intel® SecL-DC
applications (with the exception of the Key Broker and Workload Policy
Manager), and configuring each workload host to be Trusted (as per the
Platform Integrity Attestation use case).</p>
<p>The owner of the workload image(s) to be protected (for example, the end
customer of the CSP) must install a Key Broker Service (which must be
available for network communication from the Workload Service hosted on
the CSP), the Workload Policy Manager, and their own Authentication and
Authorization Service and Certificate Management Service (these will
manage authentication and certificates for the KBS and WPM).</p>
<p>Any number of image owner customers with their own unique
KBS/WPM/AAS/CMS deployments may protect images that can be run by a
single CSP deployment.</p>
<p>The image owner will use the WPM to encrypt any image(s) to be
protected; the WPM will automatically create a new image encryption key
using the KBS, and will output the encrypted image and an Image Flavor.
The image owner can then upload the encrypted image to the CSP’s image
storage service, and then upload the Image Flavor to the CSP-hosted WLS.</p>
<p><img src="images\image-encryption.png" alt="image-20200622081105459" style="zoom:150%;" /></p>
<p>When a compute host at the CSP attempts to launch a protected image, the
WLA on the host will detect the launch request, and will issue a key
transfer request to the WLS. The WLS will use the image ID to retrieve
the Image Flavor, which contains the key retrieval URL for that image.
This URL is hosted on the KBS of the image owner (which is why the KBS
must be available to network requests from the WLS). The WLS will access
the HVS to retrieve the current Platform Integrity Attestation report
for the host, and will use this report to make a key transfer request to
the KBS at the key transfer URL.</p>
<p>The KBS will receive the request, verify that the Platform Integrity
Attestation report is signed using a known SAML signing key (verifying
that the report comes from a known and trusted HVS), and will then
verify that the report shows that the host is trusted.</p>
<p>If these requirements are met, the KBS will use the host’s Binding Key
(the public half of an asymmetric keypair generated by the host’s TPM
and included in the attestation report) as a Key Encryption Key to seal
the Image Encryption Key to the TPM of the host that was attested.</p>
<p>When the host receives the response to the key request, it will unseal
the Image Encryption Key using its TPM. Because the Key Encryption Key
is unique to this host’s TPM, only the actual host that was attested
will be able to gain access to the image.</p>
<p>With the Image Encryption Key, the host’s WLA will create the
appropriate encrypted volume(s) for the image and begin the launch as
normal.</p>
<p>The WLA does not retain the key on disk; if/when the host is rebooted or
the WLA is restarted, restarting the workloads based on protected images
will trigger new key requests based on new Platform Integrity
Attestation reports. In this way, if a host is compromised in a method
detectable by the Platform Integrity feature, protected images will be
unable to launch on this server.</p>
<p><img src="images\workload-decryption" alt="image-20200622081137301" style="zoom:150%;" /></p>
<h2 id="71-virtual-machine-confidentiality_1">7.1  Virtual Machine Confidentiality</h2>
<h3 id="711-prerequisites_1">7.1.1  Prerequisites</h3>
<p>To enable Virtual Machine Confidentiality, the following Intel® SecL-DC
components must be installed and available:</p>
<ul>
<li>
<p>Authentication and Authorization Service</p>
</li>
<li>
<p>Certificate Management Service</p>
</li>
<li>
<p>Key Broker Service</p>
</li>
<li>
<p>Host Verification Service</p>
</li>
<li>
<p>Workload Service</p>
</li>
<li>
<p>Trust Agent + Workload Agent (on each virtualization host)</p>
</li>
<li>
<p>Workload Policy Manager</p>
</li>
</ul>
<p>See the Installation subsection on Recommended Service Layout for
recommendations on how/where to install each service.</p>
<p>It is strongly recommended to use a VM orchestration solution (for
example, OpenStack) with the Intel® SecL-DC Integration Hub to
schedule encrypted workloads on compute hosts that have already been
pre-checked for their Platform Integrity status. See the Platform
Integrity Attestation subsection on Integration with OpenStack for an
example.</p>
<p>You will need at least one QCOW2-format virtual machine image (for
quick testing purposes, a very small minimal premade image like CirrOS
is recommended; a good place to look for testing images is the
OpenStack Image Guide found here:
<a href="https://docs.openstack.org/image-guide/obtain-images.html">https://docs.openstack.org/image-guide/obtain-images.html</a>).</p>
<p>One or more hypervisor compute nodes running QEMU/KVM is required.
Each of these nodes must have the Intel® SecL-DC Trust Agent and
Workload Agent installed, and they must be registered with the
Verification Service. Each of these servers should show as <code>trusted</code> see the Platform Integrity Attestation section for details. You should
have Flavors that match the system configuration for these hosts, and
attestation reports should show all Flavor parts as <code>trusted=true</code>
Hosts that are not trusted (including servers where there is no trust
status, like hosts with no Trust Agent) will fail to launch any
encrypted workloads.</p>
<h3 id="712-workflow_1">7.1.2  Workflow</h3>
<h4 id="7121-encrypting-images_1">7.1.2.1  Encrypting Images</h4>
<div class="highlight"><pre><span></span><code>wpm create-image-flavor -l &lt;user-friendly unique label&gt; -i &lt;path to image file&gt; -e &lt;output path and filename <span class="k">for</span> encrypted image&gt; -o &lt;output path <span class="k">for</span> JSON image flavor&gt;
</code></pre></div>
<p>After generating the encrypted image with the WPM, the encrypted image
can be uploaded to the Image Storage service of choice (for example,
OpenStack Glance). Note that the ID of the image in this Image Storage
service must be retained and used for the next steps.</p>
<h4 id="7122-uploading-the-image-flavor_1">7.1.2.2  Uploading the Image Flavor</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>

<span class="err">{&lt;Image Flavor content from WPM output&gt;}</span>
</code></pre></div>
<p>Use the above API request to upload the Image Flavor to the WLS. The
Image Flavor will tell other Intel® SecL-DC components the Key Transfer
URL for this image.</p>
<h4 id="7123-creating-the-image-flavor-to-image-id-association_1">7.1.2.3  Creating the Image Flavor to Image ID Association</h4>
<p>The WLS needs to know the ID of the image as it exists in the image
storage service used by the CSP (for example, OpenStack Glance). Use the
below API request to create an association between the Image Flavor
created in the previous step and the image ID.</p>
<div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/images</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>

<span class="err">{</span>
<span class="err">    &quot;id&quot;: &quot;&lt;image ID on image storage&gt;&quot;,</span>
<span class="err">    &quot;flavor_ids&quot;: [&quot;&lt;Image Flavor ID&gt;&quot;]</span>
<span class="err">}</span>
</code></pre></div>
<h4 id="7124-launching-encrypted-vms_1">7.1.2.4  Launching Encrypted VMs</h4>
<p>Instances of the protected images can now be launched as normal.
Encrypted images will only be accessible on hosts with a Platform
Integrity Attestation report showing the host is trusted.</p>
<p>If the VM is launched on a host that is not trusted, the launch will
fail, as the decryption key will not be provided.</p>
<h2 id="72-docker-container-confidentiality">7.2  Docker Container Confidentiality</h2>
<h3 id="721-docker-container-integrity">7.2.1  Docker Container Integrity</h3>
<p>Intel® recommends using Docker Notary to verify the integrity of Docker
container images at launch.</p>
<p><a href="https://docs.docker.com/notary/getting_started/">https://docs.docker.com/notary/getting_started/</a></p>
<h3 id="722-prerequisites">7.2.2  Prerequisites</h3>
<p>To enable Docker Container Confidentiality, the following Intel® SecL-DC
components must be installed and available:</p>
<ul>
<li>
<p>Authentication and Authorization Service</p>
</li>
<li>
<p>Certificate Management Service</p>
</li>
<li>
<p>Key Broker Service</p>
</li>
<li>
<p>Host Verification Service</p>
</li>
<li>
<p>Workload Service</p>
</li>
<li>
<p>Trust Agent + Workload Agent (on each Docker host)</p>
</li>
<li>
<p>Workload Policy Manager</p>
</li>
</ul>
<p>See the Installation subsection on Recommended Service Layout for
recommendations on how/where to install each service.</p>
<p>It is strongly recommended to use a container orchestration solution
(for example, Kubernetes) with the Intel® SecL-DC Integration Hub to
schedule encrypted Docker containers on compute hosts that have
already been pre-checked for their Platform Integrity status. See the
Platform Integrity Attestation subsection on Integration with
Kubernetes for an example.</p>
<p>You will need at least one Docker container image. For quick testing
purposes, Intel recommends one or more of the following:</p>
<p><a href="https://github.com/jessfraz/dockerfiles/">https://github.com/jessfraz/dockerfiles/</a><br />
Image names:</p>
<ol>
<li>
<p>Openvpn</p>
</li>
<li>
<p>k8scan</p>
</li>
<li>
<p>postfix</p>
</li>
</ol>
<p>One or more Docker container worker nodes running Docker 19.03 is
required. Each of these nodes must have the Intel® SecL-DC Trust Agent
and Workload Agent installed, and they must be registered with the
Verification Service. Each of these servers should show as “trusted;”
see the Platform Integrity Attestation section for details. You should
have Flavors that match the system configuration for these hosts, and
attestation reports should show all Flavor parts as “trusted=true.”
Hosts that are not trusted (including servers where there is no trust
status, like hosts with no Trust Agent) will fail to launch any
encrypted workloads.</p>
<blockquote>
<p><strong><em>Important Note:</em></strong> <em>Docker version 19.03.13 is specifically required,
and other versions are not supported. Installation of the Workload
Agent for Docker Container Confidentiality will </em><em>replace</em><em> the
existing Docker binaries (the client and daemon, in /usr/bin/dockerd
and /usr/bin/docker) with a recompiled Docker engine that includes the
Secure Overlay Driver. This is what allows the launch of encrypted
containers to be intercepted and decrypted. The Docker runtime must
not be upgraded or downgraded to any other version; doing so will
cause encrypted Docker Containers to fail to launch.</em></p>
</blockquote>
<p>In the future, the Container Encryption feature will be modified to
use OCI-standard container encryption without the need for
recompilation or file replacement.</p>
<h3 id="723-workflow">7.2.3  Workflow</h3>
<h4 id="7231-encrypting-docker-container-images">7.2.3.1  Encrypting Docker Container Images</h4>
<p>The first step is encryption of a Docker Container image. The WPM is a
command line utility that will perform the actual image encryption and
allow the resulting encrypted image to be uploaded to a Docker Registry.</p>
<p>The commands needed are slightly different depending on whether Notary
is being used to validate container integrity.</p>
<p>If Notary is not being used:</p>
<div class="highlight"><pre><span></span><code>wpm create-container-image-flavor -i &lt;container image name&gt; -t &lt;tag-name&gt; -e -f &lt;Dockerfile Path&gt; -d &lt;dirPath&gt; -o &lt;output path <span class="k">for</span> JSON image flavor&gt;
</code></pre></div>
<p>If Notary is being used:</p>
<div class="highlight"><pre><span></span><code>wpm create-container-image-flavor -i &lt;imageName&gt; -t &lt;TagName&gt; -e
-s -n https://&lt;notaryIP&gt;:&lt;notaryPort&gt;/ -f &lt;Dockerfile Path&gt; -d &lt;dirPath&gt;
</code></pre></div>
<p>Also, if Notary is being used, set the following environment variable
before uploading the image to the Registry:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">DOCKER_CONTENT_TRUST</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>After generating the encrypted image with the WPM, the encrypted image
can be uploaded to a local Docker Registry.</p>
<h4 id="7232-uploading-the-image-flavor">7.2.3.2  Uploading the Image Flavor</h4>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/flavors</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="o">{</span>&lt;Image Flavor content from WPM output&gt;<span class="o">}</span>
</code></pre></div></p>
<p>Use the above API request to upload the Image Flavor to the WLS. The
Image Flavor will tell other Intel® SecL-DC components the Key Transfer
URL for this image.</p>
<h4 id="7233-creating-the-image-flavor-to-image-id-association">7.2.3.3  Creating the Image Flavor to Image ID Association</h4>
<p>For Docker images stored in a Docker Registry, the ID is typically an
MD5 hash. This format must be converted for use with the Workload
Service. To get the non-truncated ID of the image, use the Docker
command:</p>
<div class="highlight"><pre><span></span><code>docker images --no-trunc
</code></pre></div>
<p>Next, convert this to a UUID that can be used by Intel® SecL:</p>
<div class="highlight"><pre><span></span><code>wpm get-container-image-id &lt;image-full-md5id&gt;
</code></pre></div>
<p>The output will be a UUID, which will be considered the ID of the image
for the WLS.</p>
<p>Use the below API request to create an association between the Image
Flavor created in the previous step and the image ID.</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Workload Service IP or Hostname&gt;:5000/wls/images</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;image ID on image storage&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavor_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;Image Flavor ID&gt;&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></p>
<h4 id="7234-launching-encrypted-docker-containers">7.2.3.4  Launching Encrypted Docker Containers</h4>
<p>Containers of the protected images can now be launched as normal using
Kubernetes pods and deployments. Encrypted images will only be
accessible on hosts with a Platform Integrity Attestation report showing
the host is trusted.</p>
<p>If the Docker Container is launched on a host that is not trusted, the
launch will fail, as the decryption key will not be provided.</p>
<div style="page-break-after: always"></div>
<h1 id="8-trusted-virtual-kubernetes-worker-nodes_1">8  Trusted Virtual Kubernetes Worker Nodes</h1>
<p>While the existing Platform Integrity Attestation functions support
bare-metal Kubernetes Worker Nodes, using Virtual Machines to host the
Worker Nodes is a common deployment architecture. This feature aims to
help extend the Chain of Trust to protect the integrity of Virtual
Machines, including virtual Kubernetes Worker Nodes. This feature
requires the foundational Platform integrity Attestation feature as a
prerequisite for the bare-metal servers hosting the virtual Worker
Nodes.</p>
<p><strong><em>Note</em></strong>: <em>This feature requires a degree of separation between the VM
and Kubernetes infrastructure. All physical, bare-metal servers should
be virtualization hosts, and all Kubernetes Worker Nodes should be
Virtual Machines running on those physical virtualization hosts.
Kubernetes clusters should not use a mixture of both virtual and
bare-metal Workers. The physical virtualization clusters should not
include a mixture of hosts protected by Intel® SecL Platform integrity
Attestation and hosts that are not protected. VM trust reports can
only be generated for VM instances launched on hosts with Intel® SecL
services enabled.</em></p>
<p><strong>Also important to note is that this feature alone will not prevent
any VMs from launching</strong>. VMs will still be launched on Untrusted
platforms unless additional steps are taken (for example, using
OpenStack orchestration integration with Intel® SecL, or using the
Workload Confidentiality feature to encrypt the Kubernetes Worker Node
VM image). This feature generates VM attestation reports that can be
used to audit compliance and extend the Chain of Trust, and relies on
other datacenter policies and/or Intel® SecL features to enforce
compliance.</p>
<p>When libvirt initiates a VM Start, the Intel® SecL-DC Workload Agent
will create a report for the VM that associates the VM’s trust status
with the trust status of the host launching the VM. This VM report will
be retrievable via the Workload Service, and contains the hardware UUID
of the physical server hosting the VM. This UUID can be correlated to
the Trust Report of that server at the time of VM launch, creating an
audit trail validating that the VM launched on a trusted platform. A new
report is created for every VM Start, which includes actions like VM
migrations, so that each time a VM is launched or moved a new report is
generated ensuring an accurate trust status.</p>
<p>By using Platform Integrity and Data Sovereignty-based orchestration (or
Workload Confidentiality with encrypted worker VMs) for the Virtual
Machines to ensure that the virtual Kubernetes Worker nodes only launch
on trusted hardware, these VM trust reports provide an auditing
capability to extend the Chain of Trust to the virtual Worker Nodes.</p>
<p>Optionally, the Kubernetes Worker Node VM images can be encrypted and
protected as per the Workload Confidentiality feature of Intel® SecL.
This adds a layer of enforcement – rather than simply reporting whether
the VM started on a Trusted platform (and is therefore Trusted),
Workload Confidentiality ensures that the Worker Node VM image can only
be decrypted on compliant platforms.</p>
<p>In both cases (with VM image encryption and without), the VM Trust
Reports are accessed through the Workload Service:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET https://&lt;Workload Service IP or Hostname&gt;:5000/wls/reports?instance_id=&lt;instance ID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>This query will return the latest VM trust report for the provided
Instance ID (the Instance ID is the VM’s ID as it is identified by
Libvirt; in OpenStack this would correspond directly to the OpenStack
Instance ID).</p>
<p>As a best practice, Intel® recommends using an orchestration layer (such
as OpenStack) integrated with Intel® SecL to launch VMs only on Trusted
platforms. See the previous section, “Integration” under the “Platform
Integrity Attestation” feature for details.</p>
<p>As an additional layer of protection, the Kubernetes Worker Node VM
images can be encrypted using the Workload Confidentiality feature. This
adds cryptographic enforcement to the workload orchestration and ensures
instances of the Worker Node images will only be launched on Trusted
platforms.</p>
<h2 id="81-prerequisites_1">8.1  Prerequisites</h2>
<ul>
<li>
<p>All physical, bare-metal servers should be virtualization hosts.
    Virtualization hosts must be Linux platforms using Libvirt.</p>
</li>
<li>
<p>All Kubernetes Worker Nodes should be Virtual Machines running on
    those physical virtualization hosts.</p>
</li>
<li>
<p>Kubernetes clusters must not use a mixture of both virtual and
    bare-metal Workers.</p>
</li>
<li>
<p>The physical virtualization clusters must not include a mixture of
    hosts protected by Intel® SecL Platform integrity Attestation and
    hosts that are not protected. VM trust reports can only be generated
    for VM instances launched on hosts with Intel® SecL services
    enabled.</p>
</li>
<li>
<p>The Intel® SecL Platform integrity Attestation feature must be used
    to protect all physical virtualization hosts. These platforms must
    all be registered with the Verification Service, must have the Trust
    Agent installed and running, and must be Trusted. See the Platform
    integrity Attestation section for details.</p>
</li>
<li>
<p>In addition to the services required by Platform Integrity
    Attestation, the Workload Agent must be installed on each physical
    virtualization host, and the Workload Service must be installed on
    the management plane.</p>
</li>
<li>
<p>(Optional; recommended) Virtual Machines should be orchestrated
    using an Intel® SecL-supported orchestrator, such as OpenStack. This
    will help launch the VMs only on compliant platforms.</p>
</li>
<li>
<p>(Optional) Virtual Machine Images may be encrypted using the
    Workload Confidentiality feature. This adds a layer of cryptographic
    enforcement to the orchestration of virtual worker VMs, ensuring
    that the VMs can only be launched on compliant platforms.</p>
</li>
</ul>
<h2 id="82-workflow_1">8.2  Workflow</h2>
<p>There are no additional steps required to enable this feature; if the
Workload Agent is running on the physical virtualization host, VM trust
reports will automatically be generated at every VM Start. Intel®
strongly recommends using an orchestration integration for the VM
management layer (for example, the provided Integration Hub integration
with OpenStack) to help ensure that the worker node VMs only launch on
Trusted physical hosts. If no orchestration is used, the platform
service provider should ensure that all physical hosts are always in a
Trusted state and take action to ensure Untrusted platforms cannot
launch VMs.</p>
<p>The primary benefit of the Trusted Virtual Kubernetes Worker Node
feature is auditability of the Chain of Trust. By retrieving the VM
Trust Report from the Workload Service for a given Worker Node instance,
auditors can verify that the VM launched on a Trusted platform. The VM
trust report also includes the hardware UUID of the physical host. This
UUID, along with the time that the VM instance was launched, can be used
to pull the correlating physical host trust report from the Verification
Service to provide proof of compliance.</p>
<p>To retrieve a VM trust report from the Workload Service:</p>
<div class="highlight"><pre><span></span><code><span class="err">GET https://&lt;Workload Service IP or Hostname&gt;:5000/wls/reports?instance_id=&lt;instance ID&gt;</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<p>This will return the latest report for the specified instance ID.</p>
<h2 id="83-sample-vm-trust-report_1">8.3  Sample VM Trust Report</h2>
<p>A sample VM Trust Report from the Workload Service is below. The report
is generated by the Workload Agent and signed using the host’s TPM, then
stored in the Workload Service. The report contains some key attributes:</p>
<p><strong>instance_id</strong>: This is the ID of the instance. In OpenStack, this
would correlate directly to the Instance ID for the VM.</p>
<p><strong>image_id</strong>: This is the ID for the source image used to launch the
instance. In OpenStack, this correlates directly to the Image ID for the
VM.</p>
<p><strong>host_hardware_uuid</strong>: The hardware UUID of the physical host that
started the VM. This attribute identifies which host performed the VM
start and attested the VM. This UUID can be used to query the
Verification Service to retrieve attestations of the host. By
correlating the VM Trust Report with the Host Trust Report, we can
verify that this instance was started on a Trusted platform.</p>
<p><strong>image_encrypted</strong>: True or False based on whether the source image
was protected using the Workload Confidentiality feature.</p>
<p><strong>trusted</strong>: True or False, based on whether the VM instance was started
on a Trusted platform. Because the report is generated at every <code>vm
start</code> through Libvirt, a new report will be generated whenever the VM
is turned on or migrated, reflecting the state of the VM and its host at
every opportunity for the state to change.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Response</span> <span class="na">xmlns=</span><span class="s">&quot;http://wls.server.com/wls/reports&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;instance_manifest&gt;</span>
        <span class="nt">&lt;instance_info&gt;</span>
            <span class="nt">&lt;instance_id&gt;</span>bd06385a-5530-4644-a510-e384b8c3323a<span class="nt">&lt;/instance_id&gt;</span>
            <span class="nt">&lt;host_hardware_uuid&gt;</span>00964993-89c1-e711-906e-00163566263e<span class="nt">&lt;/host_hardware_uuid&gt;</span>
            <span class="nt">&lt;image_id&gt;</span>773e22da-f687-47ca-89e7-5df655c60b7b<span class="nt">&lt;/image_id&gt;</span>
        <span class="nt">&lt;/instance_info&gt;</span>
        <span class="nt">&lt;image_encrypted&gt;</span>true<span class="nt">&lt;/image_encrypted&gt;</span>
    <span class="nt">&lt;/instance_manifest&gt;</span>
    <span class="nt">&lt;policy_name&gt;</span>Intel VM Policy<span class="nt">&lt;/policy_name&gt;</span>
    <span class="nt">&lt;results&gt;</span>
        <span class="nt">&lt;e&gt;</span>
            <span class="nt">&lt;rule&gt;</span>
                <span class="nt">&lt;rule_name&gt;</span>EncryptionMatches<span class="nt">&lt;/rule_name&gt;</span>
                <span class="nt">&lt;markers&gt;</span>
                    <span class="nt">&lt;e&gt;</span>IMAGE<span class="nt">&lt;/e&gt;</span>
                <span class="nt">&lt;/markers&gt;</span>
                <span class="nt">&lt;expected&gt;</span>
                    <span class="nt">&lt;name&gt;</span>encryption_required<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/expected&gt;</span>
            <span class="nt">&lt;/rule&gt;</span>
            <span class="nt">&lt;flavor_id&gt;</span>3a3e1ccf-2618-4a0d-8426-fb7acb1ebabc<span class="nt">&lt;/flavor_id&gt;</span>
            <span class="nt">&lt;trusted&gt;</span>true<span class="nt">&lt;/trusted&gt;</span>
        <span class="nt">&lt;/e&gt;</span>
    <span class="nt">&lt;/results&gt;</span>
    <span class="nt">&lt;trusted&gt;</span>true<span class="nt">&lt;/trusted&gt;</span>
    <span class="nt">&lt;data&gt;</span>eyJpbnN0YW5jZV9tYW5pZmVzdC…data&gt;
        <span class="nt">&lt;hash_alg&gt;</span>SHA-256<span class="nt">&lt;/hash_alg&gt;</span>
        <span class="nt">&lt;cert&gt;</span>-----BEGIN CERTIFICATE-----
…
-----END CERTIFICATE-----<span class="nt">&lt;/cert&gt;</span>
        <span class="nt">&lt;signature&gt;</span>…<span class="nt">&lt;/signature&gt;</span>
    <span class="nt">&lt;/Response&gt;</span>
</code></pre></div>
<div style="page-break-after: always"></div>
<h1 id="9-flavor-management_1">9  Flavor Management</h1>
<h2 id="91-flavor-format-definitions_1">9.1  Flavor Format Definitions</h2>
<p>A Flavor is a standardized set of expectations that determines what
platform measurements will be considered “trusted.” Flavors are
constructed in a specific format, containing a metadata section
describing the Flavor, and then various other sections depending on the
Flavor type or Flavor part.</p>
<h3 id="911-meta_1">9.1.1  Meta</h3>
<p>The first part of a Flavor is the <code>meta</code> section:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;meta&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;PLATFORM&quot;</span><span class="p">,</span>
        <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
        <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This section defines the Flavor part and any versioning information.</p>
<blockquote>
<p><strong><em>NOTE</em></strong>:  <em>Even when the BIOS or OS version remains the same, the actual
measurements in the measured boot process will be different between
TPM 1.2 and TPM 2.0, and so the TPM version is captured here as
well. The attributes in the Meta section are used by the Flavor
matching engine when matching Flavors to Hosts.  Note that TPM 1.2 is supported only for VMware ESXi hosts.</em></p>
</blockquote>
<h3 id="912-hardware_1">9.1.2  Hardware</h3>
<p>The <code>hardware</code> section is unique to PLATFORM flavor parts:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;hardware&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;processor_info&quot;</span><span class="p">:</span> <span class="s2">&quot;54 06 05 00 FF FB EB BF&quot;</span><span class="p">,</span>
    <span class="nt">&quot;processor_flags&quot;</span><span class="p">:</span> <span class="s2">&quot;fpu vme de …&quot;</span><span class="p">,</span>
    <span class="nt">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;tpm&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;pcr_banks&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;SHA1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;SHA256&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;txt&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This part of the Flavor defines expected hardware attributes of the
host, and contains processor and TPM-related attributes.</p>
<h3 id="913-pcrs">9.1.3 PCRs</h3>
<p>The last section of a Flavor is the “PCRs” section, which contains the
actual expected measurements for any PCRs. This section will contain PCR
measurements for each applicable algorithm supported by the TPM (SHA1
only for TPM 1.2, SHA256 and SHA1 sections for TPM 2.0).</p>
<p>Some PCRs simply have a value and nothing else. Other PCRs, however,
contain different <code>event</code> measurements. This indicates that separate
individual platform or OS components are independently measured and
extended to the same PCR. PCRs with event measurements will contain an
<code>Event</code> array that lists, in the correct order, all of the events in the
measurement event log that are extended to this PCR. When the
Verification Service attests a host against a given Flavor, each
measurement event is compared to the Flavor value, and all of the events
are replayed to confirm that a replay of all of the measurement
extensions do in fact result in the hash seen in the PCR value. In this
way, the Verification Service can ensure that the measurement event log
contents are secure, and the individual measurements can be attested so
that the cause for an Untrusted attestation can easily be seen.</p>
<p>The full PCRs section is not shown here due to length; see the sample
Flavor sections for a full sample.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="err">...</span>
</code></pre></div>
<h3 id="914-sample-platform-flavor_1">9.1.4  Sample PLATFORM Flavor</h3>
<p>The <code>PLATFORM</code> Flavor part encompasses measurements that are unique to a
specific platform, including the server OEM, BIOS version, etc. A
PLATFORM Flavor can be <code>shared</code> across all hosts of the same model that
have the same BIOS version.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavor_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot; PLATFORM&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;hardware&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;processor_info&quot;</span><span class="p">:</span> <span class="s2">&quot;54 06 05 00 FF FB EB BF&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;processor_flags&quot;</span><span class="p">:</span> <span class="s2">&quot;fpu vme de …&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;feature&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;tpm&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                            <span class="nt">&quot;pcr_banks&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s2">&quot;SHA1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;SHA256&quot;</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;txt&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;enabled&quot;</span><span class="p">:</span> <span class="kc">true</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d2ed125942726641a7260c4f92beb67d531a0def&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ffb1806465d2de1b7531fd5a2a6effaad7c5a047&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3d42560dcf165a5557b3156a21583f2c6dbef10e&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;274f929dbab8b98a7031bbcd9ea5613c2a28e5e6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ca96de412b4e8c062e570d3013d2fccb4b20250a&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d123e2f2b30f1effa8d9522f667af0dac4f48cfb&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f3742133e1a0deb48177a74ed225418e5cf73fd1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_0&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;db83f0e8a1773c21164c17986037cdf8afc1bbdc1b815772c6da1befb1a7f8a3&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;50bd58407a1893056eacff493245cfe785f045b2c0e1cc3e6e9eb5812d8d91bd&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9301981c093654d5aa3430ba05c880a52eb22b9e18248f5f93e1fe1dab1cb947&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2785d1ed65f6b5d4b555dc24ce5e068a44ce8740fe77e01e15a10b1ff66cca90&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</code></pre></div>
<h3 id="915-sample-os-flavor_1">9.1.5  Sample OS Flavor</h3>
<p>An OS Flavor encompasses all of the measurements unique to a given OS.
This includes the OS kernel and other measurements.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavor_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;OS&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;os_name&quot;</span><span class="p">:</span> <span class="s2">&quot;RedHatEnterpriseServer&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;os_version&quot;</span><span class="p">:</span> <span class="s2">&quot;7.3&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;vmm_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;vmm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;1ec12004b371e3afd43d04155abde7476a3794fa&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2fb7d57dcc5455af9ac08d82bdf315dbcc59a044&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ffb1806465d2de1b7531fd5a2a6effaad7c5a047&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;5ba93c9db0cff93f52b521d7420e43f6eda2784f&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3c585604e87f855973731fea83e21fab9392d2fc&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;3d42560dcf165a5557b3156a21583f2c6dbef10e&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;274f929dbab8b98a7031bbcd9ea5613c2a28e5e6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;ca96de412b4e8c062e570d3013d2fccb4b20250a&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;d123e2f2b30f1effa8d9522f667af0dac4f48cfb&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f3742133e1a0deb48177a74ed225418e5cf73fd1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;50bd58407a1893056eacff493245cfe785f045b2c0e1cc3e6e9eb5812d8d91bd&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9301981c093654d5aa3430ba05c880a52eb22b9e18248f5f93e1fe1dab1cb947&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;HASH_START&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2785d1ed65f6b5d4b555dc24ce5e068a44ce8740fe77e01e15a10b1ff66cca90&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;BIOSAC_REG_DATA&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU_SCRTM_STAT&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_DETAILS_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;6e340b9cffb37a989ca544e6bb780a2c78901d3fb33738768511a30617afa01d&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;STM_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;67abdd721024f0ff4e0b3f4c2fc13bc5bad42d0b7851d456d88d203d15aaa450&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;OSSINITDATA_CAP_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;26e1d98742f79c950dc637f8c067b0b72a1b0e8ff75db4e609c7e17321acf3f4&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;MLE_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;0f6e0c7a5944963d7081ea494ddff1e9afa689e148e39f684db06578869ea38b&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;NV_INFO_HASH&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;27808f64e6383982cd3bcc10cfcb3457c0b65f465f779d89b668839eaf263a67&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;tb_policy&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;c89ad1d1e9adaa7ecfee2abce763b92472685f7d1b9f3799bf49974b66ed9638&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;vmlinuz&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;81b88e268e697ccf1790d41b9de748a8f395acfb47aa67c9845479d4e8456f77&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span><span class="p">:</span> <span class="s2">&quot;automatic&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="916-sample-host_unique-flavor_1">9.1.6  Sample HOST_UNIQUE Flavor</h3>
<p>Host-Unique flavors define measurements for a specific host. This can be
either a single large flavor that incorporates all of the host
measurements into a single flavor document used only to attest a single
host, or can be a small subset of measurements that are specific to a
single host. For example, some VMWare module measurements will change
from one host to the next, while most others will be shared assuming the
same ESXi build is used. The full Flavor requirement for such a host
would include Host-Unique flavors to cover the measurements that are
unique to only this one host, and would still use a generic PLATFORM and
OS flavor for the other measurements that would be identical for other
similarly configured hosts.</p>
<p><strong><em>Note</em></strong>:<em>The HOST_UNIQUE Flavors are unique to a specific host, and should
always be imported directly from the specific host. Windows hosts do
not require a HOST_UNIQUE flavor part.</em></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavors&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;4d387cbd-f72b-4742-b4e5-c5b0ffed59e0&quot;</span><span class="p">,</span>
                <span class="nt">&quot;vendor&quot;</span><span class="p">:</span> <span class="s2">&quot;INTEL&quot;</span><span class="p">,</span>
                <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;HOST_UNIQUE&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;Purley11&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;bios_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Intel Corporation&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;bios_version&quot;</span><span class="p">:</span> <span class="s2">&quot;SE5C620.86B.00.01.0004.071220170215&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;os_name&quot;</span><span class="p">:</span> <span class="s2">&quot;RedHatEnterpriseServer&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;os_version&quot;</span><span class="p">:</span> <span class="s2">&quot;7.4&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;tpm_version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;hardware_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;00448C61-46F2-E711-906E-001560A04062&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;pcrs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;SHA256&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;f9ef8c53ddfc8096d36eda5506436c52b4bfa2bd451a89aaa102f03181722176&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;09f468dfc1d98a1fee86eb7297a56b0e097d57be66db4eae539061332da2e723&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;pcr_18&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;c1f7bfdae5f270d9f13aa9620b8977951d6b759f1131fe9f9289317f3a56efa1&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha256&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;df3f619804a92fdb4057192dc43dd748ea778adc52bc498ce80524c014b81119&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;SHA1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;pcr_17&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;48695f747a3d494710bd14d20cb0a93c78a485cc&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;b1f8db372e396bb128280821b7e0ac54a5ec2791&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;initrd&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="nt">&quot;pcr_18&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;983ec7db975ed31e2c85ef8e375c038d6d307efb&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;digest_type&quot;</span><span class="p">:</span> <span class="s2">&quot;com.intel.mtwilson.lib.common.model.MeasurementSha1&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;9069ca78e7450a285173431b3e52c5c25299e473&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                <span class="nt">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="nt">&quot;ComponentName&quot;</span><span class="p">:</span> <span class="s2">&quot;LCP_CONTROL_HASH&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;EventName&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenSource.EventName&quot;</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="917-sample-asset_tag-flavor_1">9.1.7  Sample ASSET_TAG Flavor</h3>
<p>Asset Tag flavor parts are unique to Asset Tag attestation. These
flavors verify that the Asset Tag data in the host’s TPM correctly
matches the most recently created, currently valid Asset Tag certificate
that has been deployed to that host.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;b3e0c056-5b6c-4b6b-95c4-de5f1473cac0&quot;</span><span class="p">,</span>
        <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot;ASSET_TAG&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hardware_uuid&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Hardware UUID of the server to be tagged&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;external&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;asset_tag&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;tag_certificate&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;encoded&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Tag certificate in base64 encoded format&gt;&quot;</span><span class="p">,</span>
                <span class="nt">&quot;issuer&quot;</span><span class="p">:</span> <span class="s2">&quot;CN=assetTagService&quot;</span><span class="p">,</span>
                <span class="nt">&quot;serial_number&quot;</span><span class="p">:</span> <span class="mi">1519153541461</span><span class="p">,</span>
                <span class="nt">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Hardware UUID of the server to be tagged&gt;&quot;</span><span class="p">,</span>
                <span class="nt">&quot;not_before&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-02-20T11:05:41-0800&quot;</span><span class="p">,</span>
                <span class="nt">&quot;not_after&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-02-20T11:05:41-0800&quot;</span><span class="p">,</span>
                <span class="nt">&quot;fingerprint_sha384&quot;</span><span class="p">:</span> <span class="s2">&quot;46001d8472e56de423aac7c55f061404d27d50e497dfc21a861ef1965d7ac1e44887aee918fb5805385a3cbdf820899d&quot;</span><span class="p">,</span>
                <span class="nt">&quot;attribute&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;attr_type&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2.5.4.789.2&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;attribute_values&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nt">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{}</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="92-flavor-matching_1">9.2  Flavor Matching</h2>
<p>Flavors are matched to host by objects called <code>Flavor Groups</code> A Flavor
Group represents a set of rules to satisfy for a set of flavors to be
matched to a host for attestation. For example, a Flavor Group can
require that a <code>PLATFORM</code> Flavor and an <code>OS</code> Flavor be used for attestation.
Without this level of association, a host that matches measurements for
only a <code>PLATFORM</code> flavor, for example, can be attested as Trusted, even
though the OS Flavor would attest the host as Untrusted.</p>
<p>Flavor matching can be automatic (the default), or can explicitly
specify a host to which the Flavor Group must apply.</p>
<p>Automatic flavor matching allows for more ease in datacenter lifecycle
management with updates and patches that may cause the appropriate
flavors to change over time. Automatic flavor matching will trigger a
new matching action when a new flavor is added, when an existing flavor
is deleted, or when a host is initially attested as Untrusted. The
system will automatically attempt to find a new set of flavors that
match the Flavor Group rules that will attest the host as Trusted. For
example, if a host in your datacenter has recently had a BIOS update,
the next attestation will cause the host to appear Untrusted (because
the <code>PLATFORM</code> measurements will now differ). Using automatic flavor
matching, the Verification Service will automatically search for a new
<code>PLATFORM</code> flavor that matches the actual BIOS version and measurement
seen on the host. If a new BIOS version is successfully found, the
Verification Service will use the new version for attestation, and the
host will appear Trusted. If no matching <code>PLATFORM</code> flavor is found, the
host will appear Untrusted. When automatic flavor matching is used,
think of the various flavors in the Verification Service as a collection
of valid configurations, and an attested host matching any combination
of those configurations (within the confines of the Flavor Group
requirements for which flavor types must be present) will be attested as
Trusted.</p>
<p>Host-based flavor matching explicitly maps a specific host to a flavor.
Host-based attestation requires that a host saves its entire
configuration in a composite flavor document in the system, and then
later validates against this flavor to detect any changes. In this case,
if a host received a BIOS upgrade, the host will attest as Untrusted,
and no attempt will be made to re-match a new flavor. An administrator
will need to explicitly specify a new flavor to be used for that host.</p>
<h3 id="921-when-does-flavor-matching-happen_1">9.2.1  When Does Flavor Matching Happen?</h3>
<p>Generally speaking, a new Flavor match operation is triggered whenever a
host is registered, whenever a host is attested and would be untrusted,
and whenever a Flavor is added to or removed from a Flavor group.</p>
<p>When a new host is registered, the Verification Service will retrieve
the Host Report and derive the platform information needed for Flavor
matching (BIOS version, server OEM, OS type and version, TPM version,
etc.). The Verification Service then searches through the Flavors in the
same Flavor group that the host is in, and finds any Flavors that match
the platform information.</p>
<p>If a Flavor is deleted, the Verification Service finds any hosts that
are currently associated with that Flavor, and attempts to match them to
alternative Flavors.</p>
<p>If a Flavor is added, the Verification Service looks for any hosts in
the same Flavor group that are not currently matched to a Flavor of the
appropriate Flavor part, and checks to see whether those hosts should be
mapped to the new Flavor.</p>
<p>If a new Report is generated for a host and would not result in a
Trusted attestation, the Verification Service will first repeat the
Flavor matching process to be sure that no matching Flavors exist in the
host’s Flavor group that would result in a Trusted attestation. If the
Service still finds no matching Flavors, the host will appear as
Untrusted.</p>
<h3 id="922-flavor-matching-performance_1">9.2.2  Flavor Matching Performance</h3>
<p>Flavor matching causes affected hosts to be moved into the <code>QUEUE</code> state
while the host and Flavor are evaluated to determine whether the host
and Flavor should be linked. Hosts can remain in the QUEUE state for
varying amounts of time based on the extent of the Flavor match
required. This means that the trust status of a host will not be
actually updated to reflect a new Flavor until after the process
finishes, which may take a few seconds or minutes depending on the
number of registered hosts, Flavors in the same Flavorgroup, etc.</p>
<p>If a new host is registered, only that host will be added to the queue,
and other hosts will be unaffected. The Verification Service will look
for only the <code>HOST_UNIQUE</code> flavor part applicable to that specific host,
and then will look at all PLATFORM and OS Flavors in the same
Flavorgroup has the host, using the Flavor metadata and host info to
narrow the results. The Service will match the new host to the most
similar Flavors, and then move the host to the <code>CONNECTED</code> state and
generate a new trust report.</p>
<p>When a new PLATFORM or OS Flavor is created, the Service will instead
add all hosts in the same Flavorgroup as the new Flavors to the queue.
Each host in the queue will then be re-evaluated against every <code>PLATFORM</code> and <code>OS</code> Flavor in the Flavorgroup to determine the closest match.</p>
<p>This means that adding a new Flavor can cause more hosts to each spend
more time in the QUEUE state, as compared to adding a new host. For this
reason, as a best practice for initial population of Flavors and hosts
for a new deployment, it is suggested that Flavors be created before
registering hosts. This is not a concern after the initial population of
Flavors and hosts.</p>
<h3 id="923-flavor-groups_1">9.2.3  Flavor Groups</h3>
<p>Flavor Groups represent a collection of one or more Flavors that are
possible matches for a collection of one or more hosts. Flavor Groups
link to both Flavors and hosts – a host in Flavor Group "ABC" will only
be matched to Flavors in Flavor Group "ABC"</p>
<h3 id="924-default-flavor-group_1">9.2.4  Default Flavor Group</h3>
<p>By default the Verification Service includes a Flavor Group named
<code>automatic</code> and another named <code>unique</code> During host registration, the
<code>automatic</code> Flavor Group is used as a default selection if no other
Flavor Group is specified.</p>
<h4 id="9241-automatic_1">9.2.4.1  automatic</h4>
<p>The automatic Flavor Group is used as the default Flavor Group for all
hosts and all Flavor parts. If no other Flavor Groups are specified when
creating Flavors or Hosts, all Hosts and Flavors will be added to this
group. This is useful for datacenters that want to manage a single set
of acceptable configurations for all hosts.</p>
<h4 id="9242-unique_1">9.2.4.2  unique</h4>
<p>The unique Flavor Group is used to contain <code>HOST_UNIQUE</code> Flavors. This
Flavorgroup is used by the backend software and should not be managed
manually.</p>
<h3 id="925-flavor-match-policies_1">9.2.5  Flavor Match Policies</h3>
<p>Flavor Match Policies are used to define how the Flavor Match engine
will match Flavors to hosts for attestation for a given Flavor Group.
Each Flavor part can have defined Flavor Match Policies within a given
Flavor Group.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;OS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;HOST_UNIQUE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;SOFTWARE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The sample Policy above would require that a <code>PLATFORM</code> Flavor part be
matched, but any <code>PLATFORM</code> Flavor part in the Flavor Group may be
matched. The <code>OS</code> Flavor Part will only be required if there is an <code>OS</code> Flavor part in the Flavor Group; if there are no <code>OS</code> Flavor parts in the
Group, the match will not be required. If more than one <code>OS</code> Flavor part
exists in the Group, all of those <code>OS</code> parts will be required to match for
a host to be Trusted.</p>
<h4 id="9251-default-flavor-match-policy_1">9.2.5.1  Default Flavor Match Policy</h4>
<p>The <code>automatic</code> Flavor Group, and any Flavor Group created without
explicitly defining a Flavor Match Policy, will be created using the
following Flavor Match Policy. This is the default behavior for Flavor
Matching:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;OS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;HOST_UNIQUE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;SOFTWARE&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;all_of&quot;</span><span class="p">,</span>
        <span class="s2">&quot;required_if_defined&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="9252-any_of_1">9.2.5.2  ANY_OF</h4>
<p>The <code>ANY_OF</code> Policy allows any Flavor of the specified Flavor part to be
matched. If the Flavor Group contains OS Flavor 1 and OS Flavor 2, a
host will be Trusted if it matches either OS Flavor 1 or OS Flavor 2.</p>
<h4 id="9253-all_of_1">9.2.5.3  ALL_OF</h4>
<p>The <code>ALL_OF</code> Policy requires all Flavors of the specified Flavor Part in
the Flavor Group to be matched. For example, if Flavor Group X contains
PLATFORM Flavor Part 1 and <code>PLATFORM</code> Flavor Part 2, a host in Flavor
Group X will need to match both <code>PLATFORM</code> Flavor 1 and <code>PLATFORM</code> Flavor 2
to attest as Trusted. If the host matches only one of the Flavors, or
neither of them, the host will be attested as Untrusted.</p>
<h4 id="9254-latest_1">9.2.5.4  LATEST</h4>
<p>The <code>LATEST</code> Policy requires that the most recently created Flavor of the
specified Flavor part be used when matching to a host. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required_if_defined&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ASSET_TAG</code> Flavor parts by default use the above Policy. This means that
if Asset Tag Flavors are in the Flavor Group, the most recently created
Asset Tag Flavor will be used. If no Asset Tag Flavors are present in
the Flavor Group, then this Flavor part will be ignored.</p>
<h4 id="9255-required_1">9.2.5.5  REQUIRED</h4>
<p>The <code>REQUIRED</code> Policy requires a Flavor of the specified part to be
matched. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;PLATFORM&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;any_of&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>This policy means that a <code>PLATFORM</code> Flavor part must be used; if the
Flavor Group contains no <code>PLATFORM</code> Flavor parts, hosts in this Flavor
Group will always count as Untrusted.</p>
<h4 id="9256-required_if_defined_1">9.2.5.6  REQUIRED_IF_DEFINED</h4>
<p>The <code>REQUIRED_IF_DEFINED</code> Policy requires that a Flavor part be used if
a Flavor of that part exists. If no Flavor part of this type exists in
the Flavor Group, the Flavor part will not be required.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ASSET_TAG&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;latest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;required_if_defined&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ASSET_TAG</code> Flavor parts by default use the above Policy. This means that
if Asset Tag Flavors are in the Flavor Group, the most recently created
Asset Tag Flavor will be used. If no Asset Tag Flavors are present in
the Flavor Group, then this Flavor part will be ignored.</p>
<h3 id="926-flavor-match-event-triggers_1">9.2.6  Flavor Match Event Triggers</h3>
<p>Several events will cause the background queue service to attempt to
re-match Flavors and hosts:</p>
<ol>
<li>
<p>Host registration</p>
<p>This event is the first time a host will be attempted to be matched to
appropriate Flavors in the same Flavor Group, and affects only the host
that was added (other hosts will not be re-matched to Flavors when you
add a new host).</p>
</li>
<li>
<p>Flavor creation</p>
<p>When a new Flavor is added to a Flavor Group, the queue system will
repeat the Flavor match operation for all hosts in the same Flavor Group
as the new Flavor.</p>
</li>
<li>
<p>Flavor deletion</p>
<p>When a Flavor is deleted, the queue system will repeat the Flavor match
operation for all hosts in the same Flavor Group as the deleted Flavor.</p>
</li>
<li>
<p>Creation of a new Attestation Report</p>
<p>When a new Attestation Report is generated, if the host would attest as
Untrusted with the currently-matched Flavors, the host being attested
will be re-matched as part of the Report generation process. This
ensures that Reports are always generated using the best possible Flavor
matches available in the database.</p>
</li>
</ol>
<h3 id="927-sample-flavorgroup-api-calls_1">9.2.7  Sample Flavorgroup API Calls</h3>
<h4 id="9271-create-a-new-flavorgroup_1">9.2.7.1  Create a New Flavorgroup</h4>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/flavorgroups</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span><span class="p">:</span> <span class="s2">&quot;firstTest&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavor_match_policy_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavor_match_policies&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot; PLATFORM&quot;</span><span class="p">,</span>
                <span class="nt">&quot;match_policy&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;match_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ANY_OF&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="s2">&quot;REQUIRED&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Response:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;a0950923-596b-41f7-b9ad-09f525929ba1&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavorgroup_name&quot;</span><span class="p">:</span> <span class="s2">&quot;firstTest&quot;</span><span class="p">,</span>
    <span class="nt">&quot;flavor_match_policy_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;flavor_match_policies&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="nt">&quot;flavor_part&quot;</span><span class="p">:</span> <span class="s2">&quot; PLATFORM&quot;</span><span class="p">,</span>
                <span class="nt">&quot;match_policy&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;match_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ANY_OF&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;required&quot;</span><span class="p">:</span> <span class="s2">&quot;REQUIRED&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="93-software-flavor-management_1">9.3  SOFTWARE Flavor Management</h2>
<h3 id="931-what-is-a-software-flavor_1">9.3.1  What is a SOFTWARE Flavor?</h3>
<p>A <code>SOFTWARE</code> Flavor part defines the measurements expected for a specific
application, or a specific set of files and folders on the physical
host. <code>SOFTWARE</code> Flavors can be used to attest the boot-time integrity of
any static files or folders on a physical server.</p>
<p>A single server can have multiple SOFTWARE Flavors associated. Intel®
SecL-DC provides a <code>default</code> SOFTWARE Flavor that is deployed to each
Trust Agent server during the provisioning step. This default Flavor
includes the static files and folders of the Trust Agent itself, so that
the Trust Agent is measured during the server boot process, and its
integrity is included in the attestation of the other server
measurements.</p>
<p>Using <code>SOFTWARE</code> Flavors consists of two parts – creating the actual
<code>SOFTWARE</code> Flavor, and deploying the <code>SOFTWARE</code> Flavor manifest to the host.</p>
<h3 id="932-creating-a-software-flavor-part_1">9.3.2  Creating a SOFTWARE Flavor part</h3>
<p>Creating a new <code>SOFTWARE</code> Flavor requires creating a manifest of the files
and folders that need to be measured.</p>
<p>There are three different types of entries for the manifest:
<code>Directories</code>, <code>Symlinks</code>and <code>Files</code>.</p>
<h4 id="9321-directories_1">9.3.2.1  Directories</h4>
<p>A Directory defines measurement rules for measuring a directory.
Effectively this involves listing the contents of the directory and
hashing the results; in this way, a Directory measurement can verify
that no files have been added or removed from the directory specified,
but will not measure the integrity of individual files (ie, files can
change within the directory, but cannot be renamed, added, or removed).</p>
<p>Directory entries can use regular expressions to define explicit Include
and Exclude filters. For example, <code>Exclude=\*.log</code> would exclude all
files ending with .log from the measurement, meaning files with the .log
extension can be added or removed from the directory.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Dir</span> <span class="na">Type=</span><span class="s">&quot;dir&quot;</span> <span class="na">Include=</span><span class="s">&quot;.*&quot;</span> <span class="na">Exclude=</span><span class="s">&quot;&quot;</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/hypertext/WEB-INF&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h4 id="9322-symlinks_1">9.3.2.2  Symlinks</h4>
<p>A Symlink entry defines a symbolic link that will be measured. The
actual symbolic link is hashed, not the file or folder the symlink
points to. In this way, the measurement will detect the symbolic link
being modified to point to a different location, but the actual file or
folder pointed to can have its contents change.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Symlink</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/bin/tpm_nvinfo&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h4 id="9323-files_1">9.3.2.3  Files</h4>
<p>Individual files can be explicitly specified for measurement as well.
Each file listed will be hashed and extended separately. This means that
if any file explicitly listed this way changes its contents or is
deleted or moved, the measurement will change, and the host will become
Untrusted.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;File</span> <span class="na">Path=</span><span class="s">&quot;/opt/trustagent/bin/module_analysis_da.sh&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<h3 id="933-sample-software-flavor-creation-call_1">9.3.3  Sample SOFTWARE Flavor Creation Call</h3>
<p>Creating a new <code>SOFTWARE</code> Flavor requires specifying a sample host where
the application, files or folders that will be measured are currently
present. The measurements specified in the manifest will be captures
when this call is executed, and the Verification Service will
communicate with the Trust Agent and create a <code>SOFTWARE</code> Flavor based on
the file measurements.</p>
<p>The Connection String must point to the sample Trust Agent host. The
Label defines the name of the new Flavor (ideally this should be the
name of the application being measured for easier management).</p>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/flavor-from-app-manifest</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">ManifestRequest</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;lib:wml:manifests-req:1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">connectionString</span><span class="p">&gt;</span>intel:https://trustagent.server.com:1443;u=trustagentUsername;p=trustagentPassword<span class="p">&lt;/</span><span class="nt">connectionString</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Manifest</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">&quot;lib:wml:manifests:1.0&quot;</span> <span class="na">DigestAlg</span><span class="o">=</span><span class="s">&quot;SHA384&quot;</span> <span class="na">Label</span><span class="o">=</span><span class="s">&quot;Tomcat&quot;</span> <span class="na">Uuid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>+
        <span class="p">&lt;</span><span class="nt">Dir</span> <span class="na">Type</span><span class="o">=</span><span class="s">&quot;dir&quot;</span> <span class="na">Include</span><span class="o">=</span><span class="s">&quot;.*&quot;</span> <span class="na">Exclude</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">Path</span><span class="o">=</span><span class="s">&quot;/opt/trustagent/hypertext/WEB-INF&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">Symlink</span> <span class="na">Path</span><span class="o">=</span><span class="s">&quot;/opt/trustagent/bin/tpm_nvinfo&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">File</span> <span class="na">Path</span><span class="o">=</span><span class="s">&quot;/opt/trustagent/bin/module_analysis_da.sh&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Manifest</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ManifestRequest</span><span class="p">&gt;</span>
</code></pre></div></p>
<h3 id="934-deploying-a-software-flavor-manifest-to-a-host_1">9.3.4  Deploying a SOFTWARE Flavor Manifest to a Host</h3>
<p>Once the SOFTWARE Flavor has been created, it can be deployed to any
number of Trust Agent servers. This requires the Flavor ID (returned
from Flavor creation) and the Host ID (returned from host registration).
The Verification Service will send a request to the appropriate Trust
Agent and create the manifest.</p>
<blockquote>
<p><strong><em>Note</em></strong>: <em>After the SOFTWARE Flavor manifest is deployed to a host,
the host </em><em>must</em><em> be rebooted. This will allow the measurements
specified in the Flavor to be taken and extended to the TPM. Until the
host is rebooted, the host will now appear Untrusted, as it now
requires measurements from a SOFTWARE Flavor that have not yet been
extended to the TPM</em></p>
</blockquote>
<p><div class="highlight"><pre><span></span><code><span class="err">POST https://&lt;Verification Service IP or Hostname&gt;:8443/hvs/v2/rpc/deploy-software-manifest</span>
<span class="err">Authorization: Bearer &lt;token&gt;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">{</span>  
   <span class="nt">&quot;flavor_id&quot;</span><span class="p">:</span><span class="s2">&quot;a6544ff4-6dc7-4c74-82be-578592e7e3ba&quot;</span><span class="p">,</span>  
   <span class="nt">&quot;host_id&quot;</span><span class="p">:</span><span class="s2">&quot;a6544ff4-6dc7-4c74-82be-578592e7e3ba&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="935-software-flavor-matching_1">9.3.5  SOFTWARE Flavor Matching</h3>
<p>The default Flavor Match Policy for SOFTWARE Flavor parts is
<code>ALL_OF</code>,<code>REQUIRED_IF_DEFINED</code>. This means that all Software Flavors
defined in a Flavorgroup must match to all hosts in that Flavorgroup. If
no SOFTWARE Flavors are in the Flavorgroup, then hosts can still be
considered Trusted.</p>
<p>Because the default uses the <code>ALL_OF</code> Policy, it’s recommended to use
Flavorgroups dedicated to specific software loadouts. For example, if a
number of hosts will act as virtualization hosts and will have <code>SOFTWARE</code>
Flavors for the hypervisor and VM management applications, those hosts
should be placed in their own Flavorgroup as they will all run similar
or identical application loadouts. If another group of servers in the
datacenter will act as container hosts, these hosts might need <code>SOFTWARE</code> Flavors that include attestation of container runtimes and management
applications, and will have a very different application loadout from
the VM-based hosts. These should be placed in their own Flavorgroup, so
that the VM hosts are attested using the hypervisor-related <code>SOFTWARE</code> Flavors, and the container hosts are attested using the
container-related <code>SOFTWARE</code> Flavors.</p>
<p>As with other Flavor parts, hosts will be matched to Flavors in the same
Flavorgroup that the host is added to, and will not be matched to
Flavors in different Flavorgroups. Flavor matching will happen on the
same events as for other Flavor parts.</p>
<h3 id="936-kernel-upgrades_1">9.3.6  Kernel Upgrades</h3>
<p>Because the Application Integrity functionality involves adding a
measurement agent (<code>tbootXM</code>) to <code>initrd</code>, an additional process must be
followed when updating the OS kernel to ensure the new initrd also
contains the measurement agent. This is not required if Application
Integrity will not be used.</p>
<ol>
<li>
<p>Update grub to have the boot menu-entry created for the new kernel
    version in grub.cfg </p>
<p><div class="highlight"><pre><span></span><code>grub2-mkconfig -o <span class="se">\&lt;</span>path to grub file<span class="se">\&gt;</span>
</code></pre></div>
2. Reboot the host and boot into new kernel menu-entry.
3. Generate a new initrd with tbootXM.  (<code>/opt/tbootxm/bin/generate\_initrd.sh</code>)
4. Copy the generated initrd to the boot directory. (<code>cp /var/tbootxm/\&lt;generated initrd file name\&gt; /boot/</code>)
5. Update the <code>TCB protection</code> menu-entry with the new kernel version.</p>
</li>
<li>
<p>Source <code>rustagent.env</code>, or</p>
<div class="highlight"><pre><span></span><code><span class="err">expor</span><span class="kc">t</span> <span class="err">GRUB_FILE=/boo</span><span class="kc">t</span><span class="err">/e</span><span class="kc">f</span><span class="err">i/EFI/redha</span><span class="kc">t</span><span class="err">/grub.c</span><span class="kc">f</span><span class="err">g</span>
</code></pre></div>
</li>
<li>
<p>Run the configure_host script:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /opt/tbootxm/bin  
./configure_host.sh
</code></pre></div>
</li>
<li>
<p>Update the default boot menu-entry to have new kernel version. (edit
   <code>/etc/default/grub</code>)</p>
</li>
<li>
<p>Update the grub to reflect the updates. (<code>grub2-mkconfig -o \&lt;path to
   grub file\&gt;</code>)</p>
</li>
<li>
<p>Reboot the host and boot into TCB protection menu-entry.</p>
</li>
</ol>
<p>After updating the system with the new <code>initrd</code>, the Software Flavor
should attest as Trusted. Note that changing <code>grub</code> and <code>initrd</code> does result
in a new <code>OS</code> Flavor measurements, so an updated <code>OS</code> Flavor should be
imported after updating the kernel and regenerating <code>initrd</code>.</p>
<div style="page-break-after: always"></div>
<h1 id="10-scalability-and-sizing_1">10  Scalability and Sizing</h1>
<h2 id="101-configuration-maximums_1">10.1  Configuration Maximums</h2>
<h3 id="1011-registered-hosts_1">10.1.1  Registered Hosts</h3>
<p>The Intel® SecL Verification Service can support a maximum of 2000
registered hosts with a single Verification Service instance with
default settings.</p>
<h3 id="1012-hdd-space_1">10.1.2  HDD Space</h3>
<p>The HDD space recommendations below represent expected log and database
growth using default settings. Altering the database or log rotation
settings, or the SAML expiration setting, may change the amount of disk
space required. For default settings, 100 GB of disk space is
recommended.</p>
<h2 id="102-database-rotation-settings_1">10.2  Database Rotation Settings</h2>
<p>The Intel® SecL Verification Service database will automatically rotate
the audit log table after one million records, and will retain up to ten
total rotations. These settings are user-configurable if a longer
retention period is needed.</p>
<p><strong>mtwilson.audit.log.num.rotations</strong> - defines the maximum number of
rotations before the oldest rotation is deleted to make space for a new
rotation.</p>
<p><strong>mtwilson.audit.log.max.row.count</strong> – defines the maximum number of
rows in the audit log table before a rotation will occur.</p>
<h2 id="103-log-rotation_1">10.3  Log Rotation</h2>
<p>The Intel® SecL services (the Verification Service, Trust Agent, and
Integration Hub) use Logrotate to rotate logs automatically during a
daily cron job.</p>
<p>By default, logs are rotated once per month or when they exceed 1 GB in
size, whichever comes first, and 12 total rotations will be retained.</p>
<div style="page-break-after: always"></div>
<h1 id="11-intel-security-libraries-configuration-settings_1">11  Intel Security Libraries Configuration Settings</h1>
<h2 id="111-verification-service_1">11.1  Verification Service</h2>
<h3 id="1111-installation-answer-file-options_1">11.1.1  Installation Answer File Options</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials - mandatory</span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">HVS_SERVICE_USERNAME</span><span class="o">=</span>HVS_service
<span class="nv">HVS_SERVICE_PASSWORD</span><span class="o">=</span>password

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification - mandatory</span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>digest

<span class="c1"># Installation admin bearer token for CSR approval request to CMS - mandatory</span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

<span class="c1"># Skip setup - optional</span>
<span class="nv">HVS_NOSETUP</span><span class="o">=</span><span class="nb">false</span> <span class="c1">#default=false</span>

<span class="c1"># Logging options - optional</span>
<span class="nv">HVS_LOGLEVEL</span><span class="o">=</span>info              <span class="c1"># options: critical|error|warning|info|debug|trace, default=&#39;info&#39;</span>
<span class="nv">HVS_LOG_MAX_LENGTH</span><span class="o">=</span><span class="m">300</span>         <span class="c1"># default=300</span>
<span class="nv">HVS_ENABLE_CONSOLE_LOG</span><span class="o">=</span><span class="nb">false</span>   <span class="c1"># default=false</span>

<span class="c1"># HRRS configuration - optional</span>
<span class="nv">HRRS_REFRESH_PERIOD</span><span class="o">=</span>2m0s       <span class="c1"># default=2m0s</span>
<span class="nv">HRRS_REFRESH_LOOK_AHEAD</span><span class="o">=</span>5m0s   <span class="c1"># default=5m0s</span>

<span class="c1"># FVS configuration - optional</span>
<span class="nv">FVS_NUMBER_OF_VERIFIERS</span><span class="o">=</span><span class="m">20</span>                    <span class="c1"># default=20</span>
<span class="nv">FVS_NUMBER_OF_DATA_FETCHERS</span><span class="o">=</span><span class="m">20</span>                <span class="c1"># default=20</span>
<span class="nv">FVS_SKIP_FLAVOR_SIGNATURE_VERIFICATION</span><span class="o">=</span><span class="nb">false</span>  <span class="c1"># default=false</span>

<span class="c1"># In case of trusted flavor storage, flavor signature verification can be skipped</span>
<span class="c1"># using following flag - optional</span>
<span class="nv">SKIP_FLAVOR_SIGNATURE_VERIFICATION</span><span class="o">=</span><span class="nb">false</span> <span class="c1"># default=false</span>

<span class="c1"># TLS certificate configuration - optional</span>
<span class="nv">TLS_COMMON_NAME</span><span class="o">=</span><span class="s2">&quot;HVS TLS Certificate&quot;</span>      <span class="c1"># default=&quot;HVS TLS Certificate&quot;</span>
<span class="nv">TLS_SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,localhost           <span class="c1"># default=127.0.0.1,localhost</span>

<span class="c1"># Server configuration - optional</span>
<span class="nv">HVS_PORT</span><span class="o">=</span><span class="m">8443</span>                        <span class="c1"># default=8443</span>
<span class="nv">HVS_SERVER_READ_TIMEOUT</span><span class="o">=</span>30s          <span class="c1"># default=30s</span>
<span class="nv">HVS_SERVER_READ_HEADER_TIMEOUT</span><span class="o">=</span>10s   <span class="c1"># default=10s</span>
<span class="nv">HVS_SERVER_WRITE_TIMEOUT</span><span class="o">=</span>10s         <span class="c1"># default=10s</span>
<span class="nv">HVS_SERVER_IDLE_TIMEOUT</span><span class="o">=</span>10s          <span class="c1"># default=10s</span>
<span class="nv">HVS_SERVER_MAX_HEADER_BYTES</span><span class="o">=</span><span class="m">1048576</span>  <span class="c1"># default=1048576</span>

<span class="c1"># Database - mandatory</span>
<span class="nv">HVS_DB_USERNAME</span><span class="o">=</span>runner
<span class="nv">HVS_DB_PASSWORD</span><span class="o">=</span><span class="nb">test</span>
<span class="nv">HVS_DB_SSLCERTSRC</span><span class="o">=</span>/tmp/dbcert.pem          <span class="c1"># This doesn&#39;t need to be specified if HVS_DB_SSLCERT is given</span>

<span class="c1"># Database - optional</span>
<span class="nv">HVS_DB_HOSTNAME</span><span class="o">=</span>localhost                  <span class="c1"># default=localhost</span>
<span class="nv">HVS_DB_NAME</span><span class="o">=</span>hvs-pg-db                      <span class="c1"># default=hvs-pg-db</span>
<span class="nv">HVS_DB_PORT</span><span class="o">=</span><span class="m">5432</span>                           <span class="c1"># default=5432</span>
<span class="nv">HVS_DB_SSLMODE</span><span class="o">=</span>verify-full                 <span class="c1"># default=verify-full ;other options are like allow, prefer, require, verify-ca</span>
<span class="nv">HVS_DB_SSLCERT</span><span class="o">=</span>/etc/hvs/hvsdbcert.pem      <span class="c1"># default=/etc/hvs/hvsdbcert.pem</span>

<span class="c1"># Webservice configuration - Optional</span>
<span class="nv">HVS_PORT</span><span class="o">=</span><span class="m">8443</span>
<span class="nv">HVS_SERVER_READ_TIMEOUT</span><span class="o">=</span>30s
<span class="nv">HVS_SERVER_READ_HEADER_TIMEOUT</span><span class="o">=</span>10s
<span class="nv">HVS_SERVER_WRITE_TIMEOUT</span><span class="o">=</span>10s
<span class="nv">HVS_SERVER_IDLE_TIMEOUT</span><span class="o">=</span>10s
<span class="nv">HVS_SERVER_MAX_HEADER_BYTES</span><span class="o">=</span><span class="m">1048576</span>

<span class="c1"># Logging - Optional</span>
<span class="nv">HVS_LOG_MAX_LENGTH</span><span class="o">=</span><span class="m">300</span>
<span class="nv">HVS_ENABLE_CONSOLE_LOG</span><span class="o">=</span><span class="nb">false</span>

<span class="c1"># Flavor Signing Configuration - Optional</span>
<span class="nv">FLAVOR_SIGNING_KEY_FILE</span><span class="o">=</span>/etc/hvs/trusted-keys/flavor-signing.key
<span class="nv">FLAVOR_SIGNING_CERT_FILE</span><span class="o">=</span>/etc/hvs/certs/trustedca/flavor-signing.pem
<span class="nv">FLAVOR_SIGNING_COMMON_NAME</span><span class="o">=</span>HVS Flavor Signing Certificate

<span class="c1"># SAML Configuration - Optional</span>
<span class="nv">SAML_KEY_FILE</span><span class="o">=</span>/etc/hvs/trusted-keys/saml.key
<span class="nv">SAML_CERT_FILE</span><span class="o">=</span>/etc/hvs/certs/trustedca/saml-cert.pem
<span class="nv">SAML_COMMON_NAME</span><span class="o">=</span>HVS SAML Certificate

<span class="c1"># Endorsement CA Configuration - Optional</span>
<span class="nv">ENDORSEMENT_CA_KEY_FILE</span><span class="o">=</span>/etc/hvs/trusted-keys/endorsement-ca.key
<span class="nv">ENDORSEMENT_CA_CERT_FILE</span><span class="o">=</span>/etc/hvs/certs/trustedca/EndorsementCA.pem
<span class="nv">ENDORSEMENT_CA_COMMON_NAME</span><span class="o">=</span>HVS Endorsement Certificate
<span class="nv">ENDORSEMENT_CA_ISSUER</span><span class="o">=</span>intel-secl
<span class="nv">ENDORSEMENT_CA_VALIDITY_YEARS</span><span class="o">=</span><span class="m">5</span>

<span class="c1"># Privacy CA Configuration - Optional</span>
<span class="nv">PRIVACY_CA_KEY_FILE</span><span class="o">=</span>/etc/hvs/trusted-keys/privacy-ca.key
<span class="nv">PRIVACY_CA_CERT_FILE</span><span class="o">=</span>/etc/hvs/certs/trustedca/privacy-ca-cert.pem
<span class="nv">PRIVACY_CA_COMMON_NAME</span><span class="o">=</span>HVS Privacy Certificate
<span class="nv">PRIVACY_CA_ISSUER</span><span class="o">=</span>intel-secl
<span class="nv">PRIVACY_CA_VALIDITY_YEARS</span><span class="o">=</span><span class="m">5</span>

<span class="c1"># Asset Tag Configuration - Optional</span>
<span class="nv">TAG_CA_KEY_FILE</span><span class="o">=</span>/etc/hvs/trusted-keys/tag-ca.key
<span class="nv">TAG_CA_CERT_FILE</span><span class="o">=</span>/etc/hvs/certs/trustedca/tag-ca-cert.pem
<span class="nv">TAG_CA_COMMON_NAME</span><span class="o">=</span>HVS Tag Certificate
<span class="nv">TAG_CA_ISSUER</span><span class="o">=</span>intel-secl
<span class="nv">TAG_CA_VALIDITY_YEARS</span><span class="o">=</span><span class="m">5</span>
</code></pre></div>
<h3 id="1112-configuration-options_1">11.1.2  Configuration Options</h3>
<p>The Verification Service configuration is stored in the
file <code>/etc/hvs/config.yml</code>:</p>
<div class="highlight"><pre><span></span><code>tls:
  cert-file: /etc/hvs/tls-cert.pem
  key-file: /etc/hvs/tls.key
  common-name: Mt Wilson TLS Certificate
  san-list: <span class="m">127</span>.0.0.1,localhost
saml:
  common:
    cert-file: /etc/hvs/certs/trustedca/saml-cert.pem
    key-file: /etc/hvs/trusted-keys/saml.key
    common-name: mtwilson-saml
  issuer: AttestationService
  validity-days: <span class="m">1</span>
flavor-signing:
  cert-file: /etc/hvs/certs/trustedca/flavor-signing.pem
  key-file: /etc/hvs/trusted-keys/flavor-signing.key
  common-name: VS Flavor Signing Certificate
privacy-ca:
  cert-file: /etc/hvs/certs/trustedca/privacy-ca/privacy-ca-cert.pem
  key-file: /etc/hvs/trusted-keys/privacy-ca.key
  common-name: HVS Privacy Certificate
  issuer: intel-secl
  validity-years: <span class="m">5</span>
endorsement-ca:
  cert-file: /etc/hvs/certs/endorsement/EndorsementCA.pem
  key-file: /etc/hvs/trusted-keys/endorsement-ca.key
  common-name: HVS Endorsement Certificate
  issuer: intel-secl
  validity-years: <span class="m">5</span>
tag-ca:
  cert-file: /etc/hvs/certs/trustedca/tag-ca-cert.pem
  key-file: /etc/hvs/trusted-keys/tag-ca.key
  common-name: HVS Tag Certificate
  issuer: intel-secl
  validity-years: <span class="m">5</span>
aik-certificate-validity-years: <span class="m">5</span>
server:
  port: <span class="m">8898</span>
  read-timeout: 30s
  read-header-timeout: 10s
  write-timeout: 30s
  idle-timeout: 10s
  max-header-bytes: <span class="m">1048576</span>
log:
  max-length: <span class="m">30000</span>
  enable-stdout: <span class="nb">true</span>
  level: TRACE
db:
  vendor: postgres
  host: localhost
  port: <span class="s2">&quot;5432&quot;</span>
  name: hvs_db
  username: root
  password: password
  ssl-mode: allow
  ssl-cert: /etc/hvs/hvsdbsslcert.pem
  conn-retry-attempts: <span class="m">5</span>
  conn-retry-time: <span class="m">1</span>
hrrs:
  refresh-period: 2m0s
  refresh-look-ahead: 5m0s
fvs:
  number-of-verifiers: <span class="m">20</span>
  number-of-data-fetchers: <span class="m">20</span>
  skip-flavor-signature-verification: <span class="nb">true</span>                    
</code></pre></div>
<h3 id="1113-command-line-options_1">11.1.3  Command-Line Options</h3>
<p>The Verification Service supports several command-line commands that can
be executed only as the Root user:</p>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">hvs <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands:</strong></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>help|-h|--help</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs help|-h|--help</span> <br/>
​                  Show help message</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs start</span><br/>
​                  Start hvs</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs stop</span><br/>
​                  Stop hvs</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs status</span><br/>
​                  Show the status of hvs</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs uninstall [--purge]</span><br/>
​                  Uninstall hvs<br/>
​                  <span style="font-family:Courier">--purge</span> all configuration and data files will be removed if this flag is set </p>
<p>​         <span style="font-family:Courier; color:blue"><strong>version|-v|--version</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs version|-v|--version</span><br/>
​                  Show the version of current hvs build</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>config-db-rotation</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs config-db-rotation</span><br/>
​                  Configure database table rotaition for audit log table, reference db_rotation.sql<br/> 
​                in documents</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>erase-data</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs erase-data</span><br/>
​                  Reset all tables in database and create default flavor groups<br/></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">hvs setup <span style="font-family:Courier; color:green">\&lt;<strong>task</strong>></span> [--help] [--force] [-f \&lt;answer-file>]</span><br/>
​                  Run setup task</p>
<p>​                  <span style="font-family:Courier">--help</span>                                       show help message for setup task<br/>
​                  <span style="font-family:Courier">--force</span>                                     existing configuration will be overwritten if this flag is set<br/>
​                  <span style="font-family:Courier">-f|--file \<answer-file></span>     the answer file with required arguments</p>
<p>​              <strong>Available tasks for setup:</strong></p>
<p>​              <span style="font-family:Courier; color:green">all</span><br/>
​                     Runs all setup tasks<br/></p>
<p>​               <span style="font-family:Courier; color:green">server</span><br/>
​                     Setup http server on given port<br/> 
​                     - Required environment variables: <code>SERVER_PORT</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">database</span><br/>
​                     Setup hvs database<br/> 
​                   - Required environment variables: <code>DB_USERNAME</code>, <code>DB_PASSWORD</code>,<code>DB_CONN_RETRY_ATTEMPTS</code>,<br/>
​                       <code>DB_VENDOR</code>, <code>DB_HOST</code>, <code>DB_PORT</code>,
​<code>DB_NAME</code>,<code>DB_SSL_MODE</code>,<code>DB_SSL_CERT</code>,<br/>
​                       <code>DB_SSL_CERT_SOURCE</code>, <code>DB_CONN_RETRY_ATTEMPTS</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">create-default-flavorgroup</span><br/>
​                     Create default flavor groups in database<br/>
​                   - Required environment variables: <code>DB_VENDOR</code>, <code>DB_HOST</code>,<code>DB_SSL_CERT</code>,<br/>
​                       <code>DB_CONN_RETRY_ATTEMPTS</code>, <code>DB_CONN_RETRY_TIME</code>, <code>DB_PORT</code>, <code>DB_NAME</code>,<code>DB_USERNAME</code>,<br/>
​                       <code>DB_PASSWORD</code>,<code>DB_SSL_MODE</code>, <code>DB_SSL_CERT_SOURCE</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">create-dek</span><br/>
​                     Create data encryption key for HVS</p>
<p>​              <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                     Download CMS root CA certificate<br/> 
​                     - Required environment variables: <code>CMS_BASE_URL</code>, <code>CMS_TLS_CERT_SHA384</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">download-cert-tls</span><br/>
​                     Download CA certificate from CMS for tls<br/>
​                     - Required environment variables: <code>BEARER_TOKEN</code>, <code>CMS_BASE_URL</code><br/>
​                     - Optional environmental variables: <code>TLS_CERT_FILE</code>,<code>TLS_KEY_FILE</code>, <code>TLS_COMMON_NAME</code>, <br/>
​                       <code>TLS_SAN_LIST</code>,<code>TLS_ISSUER</code>, <code>TLS_VALIDITY_DAYS</code>, <br/></p>
<p>​              <span style="font-family:Courier; color:green">download-cert-saml</span><br/>
​                     Download CA certificate from CMS for saml<br/>
​                     - Required environment variables: <code>CMS_BASE_URL</code>,<code>BEARER_TOKEN</code><br/>
​                     - Optional environmental variables: <code>SAML_VALIDITY_DAYS</code>, <code>SAML_CERT_FILE</code>, <code>SAML_KEY_FILE</code>,<br/>
​                       <code>SAML_COMMON_NAME</code>, <code>SAML_SAN_LIST</code>, <code>SAML_ISSUER</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">download-cert-flavor-signing</span><br/>
​                     Download CA certificate from CMS for flavor signing<br/>
​                     - Required environment variables: <code>CMS_BASE_URL</code>,<code>BEARER_TOKEN</code><br/>
​                     - Optional environmental variables: <code>FLAVOR_SIGNING_CERT_FILE</code>, <code>FLAVOR_SIGNING_KEY_FILE</code>,<br/>
​                        <code>FLAVOR_SIGNING_COMMON_NAME</code>,
​<code>FLAVOR_SIGNING_SAN_LIST</code>, <code>FLAVOR_SIGNING_ISSUER</code>,<br/>
​                        <code>FLAVOR_SIGNING_VALIDITY_DAYS</code><br/></p>
<p>​              <span style="font-family:Courier; color:green">create-endorsement-ca</span><br/>
​                     Generate self-signed endorsement certificate</p>
<p>​              <span style="font-family:Courier; color:green">create-privacy-ca</span><br/>
​                     Generate self-signed privacy certificate</p>
<p>​              <span style="font-family:Courier; color:green">create-tag-ca</span><br/>
​                     Generate self-signed tag certificate</p>
<p>​            <strong>Environment variables used by Hvs setup:</strong><br/>
​            <em>* Indicates the environment variable is optional.</em><br/></p>
<p>​             <code>DB_VENDOR</code><br/>
​                      -  Vendor of database, or use <code>HVS_DB_VENDOR</code> alternatively<br/></p>
<p>​             <code>DB_PASSWORD</code><br/>
​                      -  Database password, or use <code>HVS_DB_PASSWORD</code> alternatively<br/></p>
<p>​             <code>DB_SSL_CERT</code><br/>
​                      - Database SSL certificate, or use <code>HVS_DB_SSLCERT</code> alternatively<br/></p>
<p>​             <code>DB_SSL_CERT_SOURCE</code><br/>
​                      - Database SSL certificate to be copied from, or use <code>HVS_DB_SSLCERTSRC</code> alternatively<br/></p>
<p>​             <code>DB_CONN_RETRY_TIME</code><br/>
​                      -  Database connection retry time<br/></p>
<p>​             <code>DB_HOST</code><br/>
​                      -  Database host name, or use <code>HVS_DB_HOSTNAME</code> alternatively<br/></p>
<p>​             <code>DB_PORT</code><br/>
​                      - Database port, or use <code>HVS_DB_PORT</code> alternatively<br/></p>
<p>​             <code>DB_NAME</code><br/>
​                      - Database name, or use <code>HVS_DB_NAME</code> alternatively<br/></p>
<p>​             <code>DB_USERNAME</code><br/>
​                      -  Database username, or use <code>HVS_DB_USERNAME</code> alternatively<br/></p>
<p>​             <code>DB_SSL_MODE</code><br/>
​                      -  Database SSL mode, or use <code>HVS_DB_SSL_MODE</code> alternatively<br/></p>
<p>​             <code>DB_CONN_RETRY_ATTEMPTS</code><br/>
​                      - Database connection retry attempts<br/></p>
<p>​             <code>BEARER_TOKEN</code><br/>
​                      - Bearer token for accessing CMS api<br/></p>
<p>​             <code>CMS_BASE_URL</code><br/>
​                      - CMS base URL in the format <code>https://{{cms}}:{{cms_port}}/cms/v1/</code><br/></p>
<p>​             <code>SERVER_PORT</code><br/>
​                      - The port on which to listen, or use <code>HVS_PORT</code> alternatively<br/></p>
<p>​             <code>HVS_SERVICE_USERNAME</code><br/>
​                      -  The service username for HVS configured in AAS<br/></p>
<p>​             <code>HVS_SERVICE_PASSWORD</code><br/>
​                      -  The service password for HVS configured in AAS<br/></p>
<p>​             <code>CMS_TLS_CERT_SHA384</code><br/>
​                      - SHA384 hash value of CMS TLS certificate<br/></p>
<p>​             <code>TLS_ISSUER</code>*<br/>
​                      - The issuer of signed certificate<br/></p>
<p>​             <code>TLS_VALIDITY_DAYS</code>*<br/>
​                      -  The validity time in days of signed certificate<br/></p>
<p>​             <code>TLS_CERT_FILE</code>*<br/>
​                      -  The file to which certificate is created<br/></p>
<p>​             <code>TLS_KEY_FILE</code>*<br/>
​                      - The file to which private key is created<br/></p>
<p>​             <code>TLS_COMMON_NAME</code>*<br/>
​                      - The common name of signed certificate<br/></p>
<p>​             <code>TLS_SAN_LIST</code>*<br/>
​                      -  Comma separated list of hostnames to add to Certificate, including IP addresses and dns<br/>
​                         names<br/></p>
<p>​             <code>SAML_VALIDITY_DAYS</code>*<br/>
​                      - The validity time in days of signed certificate<br/></p>
<p>​             <code>SAML_CERT_FILE</code>*<br/>
​                      - The file to which certificate is created<br/></p>
<p>​             <code>SAML_KEY_FILE</code>*<br/>
​                      - The file to which private key is created<br/></p>
<p>​             <code>SAML_COMMON_NAME</code>*<br/>
​                      -  The common name of signed certificate<br/></p>
<p>​             <code>SAML_SAN_LIST</code>*<br/>
​                      -  Comma separated list of hostnames to add to Certificate, including IP addresses and dns<br/> 
​                        names<br/></p>
<p>​             <code>SAML_ISSUER</code>*<br/>
​                      - The issuer of signed certificate<br/></p>
<p>​             <code>FLAVOR_SIGNING_CERT_FILE</code>*<br/>
​                      - The file to which certificate is created<br/></p>
<p>​             <code>FLAVOR_SIGNING_KEY_FILE</code>*<br/>
​                      -  The file to which private key is created<br/></p>
<p>​             <code>FLAVOR_SIGNING_COMMON_NAME</code>*<br/>
​                      -  The common name of signed certificate<br/></p>
<p>​             <code>FLAVOR_SIGNING_SAN_LIST</code>*<br/>
​                      - Comma separated list of hostnames to add to Certificate, including IP addresses and dns <br/>
​                        names<br/></p>
<p>​             <code>FLAVOR_SIGNING_ISSUER</code>*<br/>
​                      - The issuer of signed certificate<br/></p>
<p>​             <code>FLAVOR_SIGNING_VALIDITY_DAYS</code>*<br/>
​                      -  The validity time in days of signed certificate<br/></p>
<h3 id="1114-directory-layout_1">11.1.4  Directory Layout</h3>
<p>The Host Verification Service installs by default to  the
following folders:</p>
<p>This directory contains the config.yml configuration file, the database connection ssl cerificate, and the webservice TLS certificate.</p>
<p><code>/etc/hvs/</code>                          - This directory contains the config.yml configuration file, the database     connection ssl cerificate, and the webservice TLS certificate.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>certs/</code>                            - This directory contains endorsement, trustedca, trustedjwt cerificates.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>endorsement/</code>              - Contains EndorsementCA and EndorsementCA-external certificates<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>trustedca/</code>                  - Contains flavor-signing, saml-cert, tag-ca-cert certificates<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>privacy-ca/</code>              - Contains privary ca certificate<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>root/</code>                           - Contains root certificate<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>trustedjwt/</code>               - Contains EndorsementCA and EndorsementCA-external certificates <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>trusted-keys/</code>             - Contains all the necessary keys needed for hvs. Like endorsement-ca.key, flavor-signing.key, privacy-ca.key, saml.key and tag-ca.key<br/></p>
<p><code>/opt/hvs/</code>                          - Contains hvs service file<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>bin/</code>                                                 - Contains the hvs executable.<br/> 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>privacyca-aik-requests/</code>        - Contains the hvs executable.<br/></p>
<h2 id="112-trust-agent_1">11.2  Trust Agent</h2>
<h3 id="1121-installation-answer-file-options_1">11.2.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAS_API_URL</td>
<td>AAS_API_URL=https://{host}:{port}/aas/v1</td>
<td>API URL for Authentication Authorization Service (AAS).</td>
</tr>
<tr>
<td>AUTOMATIC_PULL_MANIFEST</td>
<td>AUTOMATIC_PULL_MANIFEST=Y</td>
<td>Instructs the installer to automatically pull application-manifests from HVS similar to tagent setup get-configured-manifest</td>
</tr>
<tr>
<td>AUTOMATIC_REGISTRATION</td>
<td>AUTOMATIC_REGISTRATION=Y</td>
<td>Instructs the installer to automatically register the host with HVS similar to running tagent setup create-host and tagent setup create-host-unique-flavor.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsjdkMTdiNmUz...</td>
<td>JWT from AAS that contains "install" permissions needed to access ISecL services during provisioning and registration</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td>CMS_BASE_URL=https://{host}:{port}/cms/v1</td>
<td>API URL for Certificate Management Service (CMS).</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td>CMS_TLS_CERT_SHA384=bd8ebf5091289958b5765da4...</td>
<td>SHA384 Hash sum for verifying the CMS TLS certificate.</td>
</tr>
<tr>
<td>MTWILSON_API_URL</td>
<td>MTWILSON_API_URL=https://{host}:{port}/hvs/v2</td>
<td>The url used during setup to request information from HVS.</td>
</tr>
<tr>
<td>PROVISION_ATTESTATION</td>
<td>PROVISION_ATTESTATION=Y</td>
<td>When present, enables/disables whether tagent setup is called during installation. If trustagent.env is not present, the value defaults to no ('N').</td>
</tr>
<tr>
<td>SAN_LIST</td>
<td>SAN_LIST=10.123.100.1,201.102.10.22,mya.example.com</td>
<td>CSV list that sets the value for SAN list in the TA TLS certificate. Defaults to 127.0.0.1.</td>
</tr>
<tr>
<td>TA_TLS_CERT_CN</td>
<td>TA_TLS_CERT_CN=Acme Trust Agent 007</td>
<td>Sets the value for Common Name in the TA TLS certificate. Defaults to CN=trustagent.</td>
</tr>
<tr>
<td>TPM_OWNER_SECRET</td>
<td>TPM_OWNER_SECRET=625d6...</td>
<td>20 byte hex value to be used as the secret key when taking ownership of the TPM. <em>Note: If this field is not specified, GTA will generate a random secret key.</em></td>
</tr>
<tr>
<td>TPM_QUOTE_IPV4</td>
<td>TPM_QUOTE_IPV4=no</td>
<td>When enabled (=y), uses the local system's ip address as a salt when processing a quote nonce. This field must align with the configuration of HVS.</td>
</tr>
<tr>
<td>TA_SERVER_READ_TIMEOUT</td>
<td>TA_SERVER_READ_TIMEOUT=30</td>
<td>Sets tagent server ReadTimeout. Defaults to 30 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_READ_HEADER_TIMEOUT</td>
<td>TA_SERVER_READ_HEADER_TIMEOUT=10</td>
<td>Sets tagent server ReadHeaderTimeout. Defaults to 30 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_WRITE_TIMEOUT</td>
<td>TA_SERVER_WRITE_TIMEOUT=10</td>
<td>Sets tagent server WriteTimeout. Defaults to 10 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_IDLE_TIMEOUT</td>
<td>TA_SERVER_IDLE_TIMEOUT=10</td>
<td>Sets tagent server IdleTimeout. Defaults to 10 seconds.</td>
</tr>
<tr>
<td>TA_SERVER_MAX_HEADER_BYTES</td>
<td>TA_SERVER_MAX_HEADER_BYTES=1048576</td>
<td>Sets tagent server MaxHeaderBytes. Defaults to 1MB(1048576)</td>
</tr>
<tr>
<td>TA_ENABLE_CONSOLE_LOG</td>
<td>TA_ENABLE_CONSOLE_LOG=true</td>
<td>When set true, tagent logs are redirected to stdout. Defaults to false</td>
</tr>
<tr>
<td>TRUSTAGENT_LOG_LEVEL</td>
<td>TRUSTAGENT_LOG_LEVEL=debug</td>
<td>The logging level to be saved in config.yml during installation ("trace", "debug", "info").</td>
</tr>
<tr>
<td>TRUSTAGENT_PORT</td>
<td>TRUSTAGENT_PORT=10433</td>
<td>The port on which the trust-agent service will listen.</td>
</tr>
</tbody>
</table>
<h3 id="1122-configuration-options_1">11.2.2  Configuration Options</h3>
<p>The Trust Agent configuration settings are managed in
<code>/opt/trustagent/configuration/config.yml</code></p>
<table>
<thead>
<tr>
<th><strong>Setting</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>tpmquoteipv4: true</td>
<td>When enabled, the Trust Agent will perform an additional hash of the nonce using the bytes from the Trust Agent server IP when returning TPM quotes. This should always be set to True.</td>
</tr>
<tr>
<td>logging:</td>
<td></td>
</tr>
<tr>
<td>loglevel: info</td>
<td>Defines the Trust Agent logging level</td>
</tr>
<tr>
<td>logenablestdout: false</td>
<td>If set to True, the Trust Agent will log to stdout. By default this is False and the logs are sent to /var/log/trustagent/trustagent.log</td>
</tr>
<tr>
<td>logentrymaxlength: 300</td>
<td>Defines the maximum length of a single log entry</td>
</tr>
<tr>
<td>webservice:</td>
<td></td>
</tr>
<tr>
<td>port: 1443</td>
<td>Defines the port on which the Trust Agent API server will listen</td>
</tr>
<tr>
<td>readtimeout: 30s</td>
<td></td>
</tr>
<tr>
<td>readheadertimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>writetimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>idletimeout: 10s</td>
<td></td>
</tr>
<tr>
<td>maxheaderbytes: 1048576</td>
<td></td>
</tr>
<tr>
<td>hvs:</td>
<td></td>
</tr>
<tr>
<td>url: <a href="https://0.0.0.0:8443/hvs/v2">https://0.0.0.0:8443/hvs/v2</a></td>
<td>Defines the baseurl for the Verification Service</td>
</tr>
<tr>
<td>tpm:</td>
<td></td>
</tr>
<tr>
<td>ownersecretkey: 625d6d8...1be0b4e957</td>
<td>Defines the TPM ownership secret. This is randomly generated unless manually specified during installation in the trustagent.env file. Note that changing this value may require clearing the TPM ownership in the server BIOS.</td>
</tr>
<tr>
<td>aiksecretkey: 59acd1367...edcbede60c</td>
<td>Defines the AIK secret. Randomly generated. If this is changed, a new AIK will need to be provisioned.</td>
</tr>
<tr>
<td>aas:</td>
<td></td>
</tr>
<tr>
<td>baseurl: <a href="https://0.0.0.0:8444/aas/">https://0.0.0.0:8444/aas/</a></td>
<td>Defines the base URL for the AAS</td>
</tr>
<tr>
<td>cms:</td>
<td></td>
</tr>
<tr>
<td>baseurl: <a href="https://0.0.0.0:8445/cms/v1">https://0.0.0.0:8445/cms/v1</a></td>
<td>Defines the base URL for the CMS</td>
</tr>
<tr>
<td>tlscertdigest: 330086b3...ae477c8502</td>
<td>Defines the SHA383 hash of the CMS TLS certificate</td>
</tr>
<tr>
<td>tls:</td>
<td></td>
</tr>
<tr>
<td>certsan: 10.1.2.3,server.domain.com,localhost</td>
<td>Comma-separated list of hostnames and IP addresses for the Trust Agent. Used in the Agent TLS certificate.</td>
</tr>
<tr>
<td>certcn: Trust Agent TLS Certificate</td>
<td>Common Name for the Trust Agent TLS certificate</td>
</tr>
</tbody>
</table>
<h3 id="1123-command-line-options_1">11.2.3  Command-Line Options</h3>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">tagent <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands</strong><br/>
         <span style="font-family:Courier; color:blue"><strong>help|-h|-help</strong></span><br/>
                   <span style="font-family:Courier; color:brown">tagent help|-h|-help</span><br/>
                   Show the help message.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">tagent setup <span style="font-family:Courier; color:green"><strong>[task]</strong> </span></span><br/>
​                  Run setup task. </p>
<p>​            <strong>Available Tasks for 'setup':</strong><br/>
​            <span style="font-family:Courier; color:green">[all] [/path/to/trustagent.env]</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup [all] [/path/to/trustagent.env]</span><br/>
​                   - Runs all setup tasks to provision the trust agent.<br/>
​                   - If path to trustagent.env not provided, settings are sourced from the environment.<br/>
​                   - Required environment variables: <code>AAS_API_URL</code>, <code>CMS_BASE_URL</code>,<br/> 
​                    <code>CMS_TLS_CERT_SHA384</code>,  <code>BEARER_TOKEN</code>, <code>MTWILSON_API_URL</code><br/>
​                   - Optional environment variables: <code>TA_ENABLE_CONSOLE_LOG</code>,<br/>
​                      <code>TA_SERVER_IDLE_TIMEOUT</code>, <code>TA_SERVER_MAX_HEADER_BYTES</code>,<br/>
​                      <code>TA_SERVER_READ_HEADER_TIMEOUT</code>, <code>TA_SERVER_WRITE_TIMEOUT</code>, <code>SAN_LIST</code>,<br/> 
​                    <code>TA_TLS_CERT_CN</code>, <code>TPM_OWNER_SECRET</code>, <code>TPM_QUOTE_IPV4</code>, <code>TRUSTAGENT_LOG_LEVEL</code>, <br/>
​                      <code>TRUSTAGENT_PORT</code>, <code>TA_SERVER_READ_TIMEOUT</code></p>
<p>​            <span style="font-family:Courier; color:green">download-ca-cert</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup download-ca-cert</span><br/>
​                   - Fetches the latest CMS Root CA Certificates, overwriting existing files.<br/>
​                   - Required environment variables:  <code>CMS_BASE_URL</code>, <code>CMS_TLS_CERT_SHA384</code></p>
<p>​            <span style="font-family:Courier; color:green">download-cert</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup download-cert</span><br/>
​                   - Fetches a signed TLS Certificate from CMS, overwriting existing files.<br/>
​                   - Required environment variables: <code>CMS_BASE_URL</code>, <code>BEARER_TOKEN</code>,<br/>
​                   - Optional environment variables: <code>SAN_LIST</code>, <code>TA_TLS_CERT_CN</code></p>
<p>​            <span style="font-family:Courier; color:green">update-certificates</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup update-certificates</span><br/>
​                   - Runs 'download-ca-cert' and 'download-cert'<br/>
​                   - Required environment variables: <code>CMS_BASE_URL</code>, <code>CMS_TLS_CERT_SHA384</code>,<br/>
​                     <code>BEARER_TOKEN</code><br/>
​                   - Optional environment variables: <code>SAN_LIST</code>, <code>TA_TLS_CERT_CN</code></p>
<p>​            <span style="font-family:Courier; color:green">provision-attestation</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup provision-attestation</span><br/>
​                   - Runs setup tasks associated with HVS/TPM provisioning.<br/>
​                   - Required environment variables: <code>BEARER_TOKEN</code>, <code>MTWILSON_API_URL</code><br/>
​                   - Optional environment variables: <code>TPM_OWNER_SECRET</code>, <code>TPM_QUOTE_IPV4</code></p>
<p>​            <span style="font-family:Courier; color:green">create-host</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup create-host</span><br/>
​                   - Registers the trust agent with the verification service.<br/>
​                   - Required environment variables: <code>BEARER_TOKEN</code>, <code>MTWILSON_API_URL</code><br/>
​                   - Optional environment variables: <code>TPM_OWNER_SECRET</code>, <code>TPM_QUOTE_IPV4</code></p>
<p>​            <span style="font-family:Courier; color:green">create-host-unique-flavor</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup create-host-unique-flavor</span><br/>
​                   - Populates the verification service with the host unique flavor<br/>
​                   - Required environment variables: <code>BEARER_TOKEN</code>, <code>MTWILSON_API_URL</code></p>
<p>​            <span style="font-family:Courier; color:green">get-configured-manifest</span><br/>
​                   <span style="font-family:Courier; color:brown">tagent setup get-configured-manifest</span><br/>
​                   - Uses environment variables to pull application-integrity manifests from the <br/>
​                     verification service.<br/>
​                   - Required Environment variables: <code>BEARER_TOKEN</code>, <code>MTWILSON_API_URL</code>,<br/>
​                     <code>FLAVOR_UUIDS</code> or <code>FLAVOR_LABELS</code></p>
<p>​            <strong>Environment variables used by tagent setup:</strong><br/>
​            <em>* Indicates the environment variable is optional.</em><br/></p>
<p>​             <code>AAS_API_URL</code><br/>
​                      - AAS API URL<br/>
​                      - Ex. <span style="font-family:Courier">AAS_API_URL=https://{host}:{port}/aas/v1</span></p>
<p>​             <code>CMS_BASE_URL</code><br/>
​                      - CMS API URL<br/>
​                      - Ex. <span style="font-family:Courier">CMS_BASE_URL=https://{host}:{port}/cms/v1</span></p>
<p>​             <code>CMS_TLS_CERT_SHA384</code><br/>
​                      - to ensure that TA is communicating with the right CMS instance<br/>
​                      - Ex. <span style="font-family:Courier">CMS_TLS_CERT_SHA384=bd8ebf5091289958b5765da4...</span></p>
<p>​             <code>BEARER_TOKEN</code><br/>
​                      - for authenticating with CMS and VS<br/>
​                      - Ex. <span style="font-family:Courier">BEARER_TOKEN=eyJhbGciOiJSUzM4NCIsjdkMTdiNmUz...</span></p>
<p>​             <code>MTWILSON_API_URL</code><br/>
​                      - VS API URL<br/>
​                      - Ex. <span style="font-family:Courier">MTWILSON_API_URL=https://{host}:{port}/hvs/v2</span></p>
<p>​             <code>TA_ENABLE_CONSOLE_LOG</code>*<br/>
​                      - When set to 'true', trust agent logs are redirected to stdout. Defaults to false.<br/>
​                      - Ex. <span style="font-family:Courier">TA_ENABLE_CONSOLE_LOG=true</span></p>
<p>​             <code>TA_SERVER_IDLE_TIMEOUT</code>*<br/>
​                      - Sets the trust agent service's idle timeout. Defaults to 10 seconds.<br/>
​                      - Ex. <span style="font-family:Courier">TA_SERVER_IDLE_TIMEOUT=10</span></p>
<p>​             <code>TA_SERVER_MAX_HEADER_BYTES</code>*<br/>
​                      - Sets trust agent service's maximum header bytes. Defaults to 1MB.<br/>
​                      - Ex. <span style="font-family:Courier">TA_SERVER_MAX_HEADER_BYTES=1048576</span></p>
<p>​             <code>TA_SERVER_READ_TIMEOUT</code>*<br/>
​                      - Sets trust agent service's read timeout. Defaults to 30 seconds.<br/>
​                      - Ex. <span style="font-family:Courier">TA_SERVER_READ_TIMEOUT=30</span></p>
<p>​             <code>TA_SERVER_READ_HEADER_TIMEOUT</code>*<br/>
​                      - Sets trust agent service's read header timeout. Defaults to 30 seconds.<br/>
​                      - Ex. <span style="font-family:Courier">TA_SERVER_READ_HEADER_TIMEOUT=10</span></p>
<p>​             <code>TA_SERVER_WRITE_TIMEOUT</code>*<br/>
​                      - Sets trust agent service's write timeout. Defaults to 10 seconds.<br/>
​                      - Ex. <span style="font-family:Courier">TA_SERVER_WRITE_TIMEOUT=10</span></p>
<p>​             <code>SAN_LIST</code>*<br/>
​                      - CSV list that sets the value for SAN list in the TA TLS certificate.<br/>
​                        Defaults to "127.0.0.1,localhost".<br/>
​                      - Ex. <span style="font-family:Courier">SAN_LIST=10.123.100.1,201.102.10.22,my.example.com</span></p>
<p>​             <code>TA_TLS_CERT_CN</code>*<br/>
​                      - Sets the value for Common Name in the TA TLS certificate.<br/>
​                        Defaults to "Trust Agent TLS Certificate".<br/>
​                      - Ex. <span style="font-family:Courier">TA_TLS_CERT_CN=Acme Trust Agent 007</span></p>
<p>​             <code>TPM_OWNER_SECRET</code>*<br/>
​                      - When provided, setup uses the 40 character hex string for the TPM owner <br/>
​                        password. The TPM owner secret is generated when not provided.<br/>
​                      - Ex. <span style="font-family:Courier">TPM_OWNER_SECRET=625d6d8a18f98bf764760fa392b8c01be0b4e959</span></p>
<p>​             <code>TPM_QUOTE_IPV4</code>*<br/>
​                      - When 'Y', used the local system's ip address a salt when processing TPM quotes.<br/> 
​                        Defaults to 'N'.<br/>
​                      - Ex. <span style="font-family:Courier">TPM_QUOTE_IPV4=Y</span></p>
<p>​             <code>TRUSTAGENT_LOG_LEVEL</code>*<br/>
​                      - Sets the verbosity level of logging (trace|debug|info|error). Defaults to 'info'.<br/>
​                      - Ex. <span style="font-family:Courier">TRUSTAGENT_LOG_LEVEL=debug</span></p>
<p>​             <code>TRUSTAGENT_PORT</code>*<br/>
​                      - The port on which the trust agent service will listen.<br/>
​                      - Ex. <span style="font-family:Courier">TRUSTAGENT_PORT=10433</span></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent uninstall</span><br/>
​                   Uninstall trust agent.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>version</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent version</span><br/>
​                   Print build version info.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent start</span><br/>
​                   Start the trust agent service.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent stop</span><br/>
​                   Stop the trust agent service.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent status</span><br/>
​                   Get the status of the trust agent service.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>fetch-ekcert-with-issuer</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">tagent fetch-ekcert-with-issuer</span><br/>
​                   Print Tpm Endorsement Certificate in Base64 encoded string along with issue.</p>
<h3 id="1124-directory-layout_1">11.2.4  Directory Layout</h3>
<h4 id="windows">Windows</h4>
<h4 id="linux">Linux</h4>
<p>The Linux Trust Agent installs by default to <code>/opt/trustagent</code>, with the
following subfolders:</p>
<h5 id="bin">Bin</h5>
<p>Contains executables and scripts.</p>
<h5 id="configuration">Configuration</h5>
<p>Contains the <code>config.yml</code> configuration file, as well as certificates and
keystores. This includes the AIK public key blob after provitioning.</p>
<h5 id="var">Var</h5>
<p>Contains information gathered from the platform and SOFTWARE Flavor
manifests. All files with the name <code>manifest_*.xml</code> will be parsed to
define measurements during boot. Generally these should be automatically
provisioned from the Verification Service when creating/deploying
<code>SOFTWARE</code> Flavors.</p>
<h2 id="113-integration-hub_1">11.3  Integration Hub</h2>
<h3 id="1131-installation-answer-file_1">11.3.1  Installation Answer File</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Authentication URL and service account credentials</span>
<span class="nv">AAS_API_URL</span><span class="o">=</span>https://isecl-aas:8444/aas
<span class="nv">IHUB_SERVICE_USERNAME</span><span class="o">=</span>&lt;Integration Hub Service User username&gt;
<span class="nv">IHUB_SERVICE_PASSWORD</span><span class="o">=</span>&lt;Integration Hub Service User password&gt;

<span class="c1"># CMS URL and CMS webserivce TLS hash for server verification</span>
<span class="nv">CMS_BASE_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">CMS_TLS_CERT_SHA384</span><span class="o">=</span>&lt;TLS hash&gt;

<span class="c1"># TLS Configuration</span>
<span class="nv">TLS_SAN_LIST</span><span class="o">=</span><span class="m">127</span>.0.0.1,192.168.1.1,hub.server.com <span class="c1">#comma-separated list of IP addresses and hostnames for the Hub to be used in the Subject Alternative Names list in the TLS Certificate</span>

<span class="c1"># Verification Service URL</span>
<span class="nv">ATTESTATION_SERVICE_URL</span><span class="o">=</span>https://isecl-hvs:8443/hvs/v2
<span class="nv">ATTESTATION_TYPE</span><span class="o">=</span>HVS

<span class="c1">#Integration tenant type.  Currently supported values are &quot;KUBENETES&quot; or &quot;OPENSTACK&quot;</span>
<span class="nv">TENANT</span><span class="o">=</span>&lt;KUBERNETES or OPENSTACK&gt;

<span class="c1"># OpenStack Integration Credentials - required for OpenStack integration only</span>
<span class="nv">OPENSTACK_AUTH_URL</span><span class="o">=</span>&lt;OpenStack Keystone URL<span class="p">;</span> typically http://openstack-ip:5000/&gt;
<span class="nv">OPENSTACK_PLACEMENT_URL</span><span class="o">=</span>&lt;OpenStack Nova API URL<span class="p">;</span> typically http://openstack-ip:8778/&gt;
<span class="nv">OPENSTACK_USERNAME</span><span class="o">=</span>&lt;OpenStack username&gt;
<span class="nv">OPENSTACK_PASSWORD</span><span class="o">=</span>&lt;OpenStack password&gt;

<span class="c1"># Kubernetes Integration Credentials - required for Kubernetes integration only</span>
<span class="nv">KUBERNETES_URL</span><span class="o">=</span>https://kubernetes:6443/
<span class="nv">KUBERNETES_CRD</span><span class="o">=</span>custom-isecl
<span class="nv">KUBERNETES_CERT_FILE</span><span class="o">=</span>/etc/ihub/apiserver.crt
<span class="nv">KUBERNETES_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzI1NiIsImtpZCI6Ik......

<span class="c1"># Installation admin bearer token for CSR approval request to CMS - mandatory</span>
<span class="nv">BEARER_TOKEN</span><span class="o">=</span>eyJhbGciOiJSUzM4NCIsImtpZCI6ImE…

<span class="c1"># Report Signing Certificate URL and service TLS hash for server verification</span>
<span class="c1"># Required for Platform Integrity Attestation attributes.  Not required for SGX #attributes.</span>
<span class="nv">REPORT_SIGNING_CERT_URL</span><span class="o">=</span>https://isecl-cms:8445/cms/v1
<span class="nv">REPORT_SIGNING_SERVICE_TLS_CERT_SHA384</span><span class="o">=</span>bb3a1…
</code></pre></div>
<h3 id="1132-configuration-options_1">11.3.2  Configuration Options</h3>
<div class="highlight"><pre><span></span><code>ihub-service-username: ihub_service
ihub-service-password: password
aas:
  url: https://isecl-aas:8444/aas
cms:
  url: https://isecl-cms:8445/cms/v1
report-signing:
  cert-url: https://isecl-cms:8445/cms/v1
  service-tls-cert-sha384: bb3a1…
attestation-service:
  url: https://isecl-hvs:8443/mtwilson/v2
endpoint:
  url: http://openstack:5000/v3
  username: admin
  password: password
signing-cert:
  common-name: <span class="s2">&quot;IHUB Signing Certificate&quot;</span>
  org: Intel
  org-unit: 
  country: US
  province: CA
  locality: Folsom
  email: 
log:
  level: warning
  max-length: <span class="m">300</span>
  enable-console: <span class="nb">false</span>
poll-interval-minutes: <span class="m">2</span>
expiry-time-offset-hours: <span class="m">2</span>
attestation-type: hvs
</code></pre></div>
<h3 id="1133-command-line-options_1">11.3.3  Command-Line Options</h3>
<p><strong>Syntax:</strong></p>
<p>​          <span style="font-family:Courier; color:brown">ihub <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands</strong></p>
<p>​        <span style="font-family:Courier; color:blue"><strong>-h|--help</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">ihub -h|--help</span><br/>
​                  Shows help message.</p>
<p>​          <span style="font-family:Courier; color:blue"><strong>-v|--version</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">ihub -v|--version</span><br/>
​                  Reports the version of the current ihub build.</p>
<p>​          <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">ihub setup<span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>></span> [--help] [--force] [-f \&lt;answer-file>]</span></p>
<p>​                  <span style="font-family:Courier">--help</span>
​                                            show help message for setup task<br/>
​                  <span style="font-family:Courier">--force</span>
​                                         existing configuration will be overwritten if this flag is set<br/>
​                  <span style="font-family:Courier">-f|--file \<answer-file></span>     the answer file with required arguments<br/></p>
<p>​                  <strong>Available tasks for setup:</strong><br/>
​                    <span style="font-family:Courier; color:green">all</span><br/>
​                        Runs all setup tasks</p>
<p>​                    <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                        Download CMS root CA certificate<br/>
​                        - Required env variables: <code>CMS_BASE_URL</code>, <code>CMS_TLS_CERT_SHA384</code><br/></p>
<p>​                   <span style="font-family:Courier; color:green">download-cert-tls</span><br/>
​                        Download CA certificate from CMS for tls<br/>
​                        - Required env variables: <code>CMS_BASE_URL</code>,<code>BEARER_TOKEN</code><br/>
​                        - Optional env variables: <code>TLS_CERT_FILE</code>, <code>TLS_KEY_FILE</code>, <code>TLS_COMMON_NAME</code>,<br/>
​                           <code>TLS_SAN_LIST</code>, <code>TLS_ISSUER</code>, <code>TLS_VALIDITY_DAYS</code><br/></p>
<p>​                    <span style="font-family:Courier; color:green">attestation-service-connection</span><br/>
​                        Establish Attestation service connection<br/>
​                        - Required env variables: <code>ATTESTATION_TYPE</code>, <code>ATTESTATION_URL</code><br/></p>
<p>​                    <span style="font-family:Courier; color:green">tenant-service-connection</span><br/>
​                        Establish Tenant service connection<br/>
​                        - Required env variables: TENANT<br/>
​                        - Required env variables for Kubernetes tenant: <code>KUBERNETES_URL</code>, <code>KUBERNETES_TOKEN</code>, <br/>
​                         <code>KUBERNETES_CERT_FILE</code>,<br/>
​                        - Required env variables for OpenStack tenant: <code>OPENSTACK_API_PORT</code>, <code>OPENSTACK_USERNAME</code>, <br/>
​                           <code>OPENSTACK_PASSWORD</code>,<code>OPENSTACK_IP</code>,<code>OPENSTACK_AUTH_PORT</code><br/></p>
<p>​                    <span style="font-family:Courier; color:green">create-signing-key</span><br/>
​                        Create signing key for IHUB</p>
<p>​                    <span style="font-family:Courier; color:green">download-saml-cert</span><br/> 
​                        Download SAML certificate from Attestation service<br/>
​                        - Required env variables: <code>ATTESTATION_TYPE</code>, <code>ATTESTATION_URL</code><br/></p>
<p>​                  <strong>Environment variables used by IHUB setup:</strong><br/>
​                  <em>* Indicates the environment variable is optional.</em><br/></p>
<p>​                  <code>ATTESTATION_TYPE</code><br/>
​                       - Type of Attestation Service<br/></p>
<p>​                  <code>ATTESTATION_URL</code><br/>
​                       - Base URL for the Attestation Service<br/></p>
<p>​               <code>CMS_BASE_URL</code><br/>
​                       - CMS BASE URL<br/>
​                       - Ex. <span style="font-family:Courier">CMS_BASE_URL=https://{{cms}}:{{cms_port}}/cms/v1/</span></p>
<p>​                  <code>CMS_TLS_CERT_SHA384</code><br/>
​                        - SHA384 hash value of CMS TLS certificate<br/></p>
<p>​                  <code>BEARER_TOKEN</code><br/>
​                         - for authenticating with CMS api<br/></p>
<p>​                   <code>TENANT</code><br/>
​                        - Type of Tenant Service<br/></p>
<p>​                   <code>KUBERNETES_URL</code><br/>
​                       - URL for Kubernetes deployment<br/></p>
<p>​                   <code>KUBERNETES_TOKEN</code><br/>
​                       - Token for Kubernetes deployment<br/></p>
<p>​                   <code>KUBERNETES_CERT_FILE</code><br/>
​                       - Certificate path for Kubernetes deployment<br/></p>
<p>​                   <code>OPENSTACK_API_PORT</code><br/>
​                       - API Port for OpenStack deployment<br/></p>
<p>​                   <code>OPENSTACK_USERNAME</code><br/>
​                       - UserName for OpenStack deployment<br/></p>
<p>​                   <code>OPENSTACK_PASSWORD</code><br/>
​                          - Password for OpenStack deployment<br/></p>
<p>​                   <code>OPENSTACK_IP</code><br/>
​                        - IP for OpenStack deployment<br/></p>
<p>​                   <code>OPENSTACK_AUTH_PORT</code><br/>
​                        - Authorization Port for OpenStack deployment<br/></p>
<p>​                   <code>TLS_CERT_FILE</code>*<br/>
​                           - The file to which certificate is saved<br/></p>
<p>​                    <code>TLS_KEY_FILE</code>*<br/>
​                           - The file to which private key is saved<br/></p>
<p>​                   <code>TLS_COMMON_NAME</code>*<br/>
​                           - The common name of signed certificate<br/></p>
<p>​                   <code>TLS_SAN_LIST</code>*<br/>
​                           - Comma separated list of hostnames to add to Certificate, including IP addresses and DNS<br/>
​                             names<br/></p>
<p>​                   <code>TLS_ISSUER</code>*<br/>
​                           - The issuer of signed certificate<br/></p>
<p>​                   <code>TLS_VALIDITY_DAYS</code>*<br/>
​                           - The validity time in days of signed certificate<br/></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">ihub start</span><br/>
​                    Starts the ihub.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/> 
​                  <span style="font-family:Courier; color:brown">ihub status</span><br/>
​                    Reports the status of the ihub.</p>
<p>​          <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/> 
​                  <span style="font-family:Courier; color:brown">ihub stop</span><br/>
​                    Stops the ihub.                    </p>
<p>​          <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/> 
​                  <span style="font-family:Courier; color:brown">ihub uninstall [--purge]</span><br/>
​                    Uninstalls the ihub.   <br/>
​                  <span style="font-family:Courier">--purge</span><br/>
​                   if this option is applied, all configuration and data files will be removed if the flag is set.</p>
<p>​        </p>
<h3 id="1134-directory-layout_1">11.3.4  Directory Layout</h3>
<h4 id="11341-logs">11.3.4.1  Logs</h4>
<h2 id="114-certificate-management-service_1">11.4  Certificate Management Service</h2>
<h3 id="1141-installation-answer-file-options_1">11.4.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CMS_NOSETUP</td>
<td>false</td>
<td>Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data.</td>
</tr>
<tr>
<td>CMS_PORT</td>
<td>8445</td>
<td>Defines the HTTPS port the service will use.</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;Hostname or IP address of the AAS>:8444/aas/</td>
<td>URL to connect to the AAS, used during setup for authentication.</td>
</tr>
<tr>
<td>AAS_TLS_SAN</td>
<td>\&lt;Comma-separated list of IPs/hostnames for the AAS></td>
<td>SAN list populated in special JWT token, this token is used by AAS to get TLS certificate signed from CMS. SAN list in this token and CSR generated by AAS must match.</td>
</tr>
<tr>
<td>LOG_ROTATION_PERIOD</td>
<td>hourly, daily, weekly, monthly, yearly</td>
<td>log rotation period, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_COMPRESS</td>
<td>Compress</td>
<td>Old versions of log files are compressed with gzip, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_DELAYCOMPRESS</td>
<td>delaycompress</td>
<td>Postpone compression of the previous log file to the next rotation cycle, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_COPYTRUNCATE</td>
<td>Copytruncate</td>
<td>Truncate the original log file in place after creating a copy,'create' creates new one, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_SIZE</td>
<td>1K</td>
<td>Log files are rotated when they grow bigger than size bytes, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>LOG_OLD</td>
<td>12</td>
<td>Log files are rotated count times before being removed, for more details refer- <a href="https://linux.die.net/man/8/logrotate">https://linux.die.net/man/8/logrotate</a></td>
</tr>
<tr>
<td>CMS_CA_CERT_VALIDITY</td>
<td>5</td>
<td>CMS Root Certificate Validity in years</td>
</tr>
<tr>
<td>CMS_CA_ORGANIZATION</td>
<td>INTEL</td>
<td>CMS Certificate Organization</td>
</tr>
<tr>
<td>CMS_CA_LOCALITY</td>
<td>US</td>
<td>CMS Certificate locality</td>
</tr>
<tr>
<td>CMS_CA_PROVINCE</td>
<td>CA</td>
<td>CMS Certificate province</td>
</tr>
<tr>
<td>CMS_CA_COUNTRY</td>
<td>USA</td>
<td>CMS Certificate country</td>
</tr>
<tr>
<td>CMS_TLS_SAN_LIST</td>
<td></td>
<td>Comma-separated list of IP addresses and hostnames to be added to the SAN list of CMS server</td>
</tr>
<tr>
<td>CMS_SERVER_READ_TIMEOUT</td>
<td>30s</td>
<td>MS server - ReadTimeout is the maximum duration for reading the entire request, including the body.</td>
</tr>
<tr>
<td>CMS_SERVER_READ_HEADER_TIMEOUT</td>
<td>10s</td>
<td>CMS server - ReadHeaderTimeout is the amount of time allowed to read request headers</td>
</tr>
<tr>
<td>CMS_SERVER_WRITE_TIMEOUT</td>
<td>10s</td>
<td>CMS server - WriteTimeout is the maximum duration before timing out writes of the response.</td>
</tr>
<tr>
<td>CMS_SERVER_IDLE_TIMEOUT</td>
<td>10s</td>
<td>CMS server - IdleTimeout is the maximum amount of time to wait for the next request when keep-alives are enabled.</td>
</tr>
<tr>
<td>CMS_SERVER_MAX_HEADER_BYTES</td>
<td>1048576</td>
<td>CMS server - MaxHeaderBytes controls the maximum number of bytes the server will read parsing the request header's keys and values, including the request line.</td>
</tr>
<tr>
<td>AAS_JWT_CN</td>
<td>AAS JWT Signing Certificate</td>
<td>CN of AAS JWT certificate, this gets populated in special JWT token. AAS must send JWT certificate CSR with this CN.</td>
</tr>
<tr>
<td>AAS_TLS_CN</td>
<td>AAS TLS Certificate</td>
<td>CN of AAS TLS certificate, this gets populated in special JWT token. AAS must send TLS certificate CSR with this CN.</td>
</tr>
<tr>
<td>AAS_TLS_SAN</td>
<td></td>
<td>SAN list populated in special JWT token, this token is used by AAS to get TLS certificate signed from CMS. SAN list in this token and CSR generated by AAS must match.</td>
</tr>
</tbody>
</table>
<h3 id="1142-configuration-options_1">11.4.2  Configuration Options</h3>
<p>The CMS configuration can be found in <code>/etc/cms/config.yml</code></p>
<div class="highlight"><pre><span></span><code><span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8445</span>
<span class="nt">loglevel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="nt">authserviceurl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://&lt;AAS IP or hostname&gt;:8444/aas/</span>
<span class="nt">cacertvalidity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="nt">organization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">INTEL</span>
<span class="nt">locality</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SC</span>
<span class="nt">province</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CA</span>
<span class="nt">country</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">US</span>
<span class="nt">keyalgorithm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rsa</span>
<span class="nt">keyalgorithmlength</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3072</span>
<span class="nt">rootcacertdigest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;sha384&gt;</span>
<span class="nt">tlscertdigest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;sha384&gt;</span>
<span class="nt">tokendurationmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="nt">aasjwtcn</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">aastlscn</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">aastlssan</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
<span class="nt">authdefender</span><span class="p">:</span>
  <span class="nt">maxattempts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">intervalmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">lockoutdurationmins</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</code></pre></div>
<h3 id="1143-command-line-options_1">11.4.3  Command-Line Options</h3>
<p><strong>Syntax:</strong></p>
<p>​       <span style="font-family:Courier; color:brown">cms <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands:</strong></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>-h|--help</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms -h|--help</span><br/>
​                  Shows help message.</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms start</span><br/>
​                  Start cms</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms stop</span><br/>
​                  Stop cms</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms status</span><br/>
​                  Show the status of cms</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms uninstall [--purge]</span><br/>
​                  Uninstall cms<br/>
​                  <span style="font-family:Courier">--purge</span>  option needs to be applied to remove configuration and data files</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>-v|--version</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms -v|--version</span><br/>
​                  Show the version of cms</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>tlscertsha384</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms tlscertsha384</span><br/>
​                  Show the SHA384 digest of the certificate used for TLS</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">cms setup <span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>></span> [--arguments=<argument_value>] [--force]</span><br/>
​                  Runs a specific setup task.</p>
<p>​             <strong>Available Tasks for setup:</strong><br/>
​            <span style="font-family:Courier; color:green">all</span><br/>
​                   Runs all setup tasks<br/>
​                   - Required env variables: get required env variables from all the setup tasks<br/>
​                   - Optional env variables: get optional env variables from all the setup tasks</p>
<p>​            <span style="font-family:Courier; color:green">root_ca</span><br/>
​                   Create its own self signed Root CA keypair in /etc/cms/root-ca for quality of life<br/>
​                   - Option [--force] overwrites any existing files, and always generate new<br/>
​                      Root CA keypair<br/>
​                   - Optional env variables specific to setup task are:<br/>
​                        - <code>CMS_CA_CERT_VALIDITY=&lt;cert life span in years&gt;</code> - Certificate Management<br/>
​                           Service Root Certificate Validitys<br/>
  ​                      - <code>CMS_CA_ORGANIZATION=&lt;cert org&gt;</code> - Certificate Management Service Root <br/>
​                           Certificate Organization<br/>
​                        - <code>CMS_CA_LOCALITY=&lt;cert locality&gt;</code> - Certificate Management Service Root <br/>
​                           Certificate Locality<br/>
​                        - <code>CMS_CA_PROVINCE=&lt;cert province&gt;</code> - Certificate Management Service Root <br/>
​                           Certificate Province<br/>
​                        - <code>CMS_CA_COUNTRY=&lt;cert country&gt;</code> - Certificate Management Service Root<br/>
​                           Certificate Country</p>
<p>​            <span style="font-family:Courier; color:green">intermediate_ca</span><br/>
​                   Creates a root_ca signed intermediate CA keypair(signing, tls-server and tls-client) <br/>
​                   in /etc/cms/intermediate-ca/ for quality of life<br/>
​                   - Option [--force] overwrites any existing files, and always generate new root_ca signed <br/>
​                      Intermediate CA keypair<br/>
​                   - Available argument specific to setup task is:<br/>
​                         <em>type</em> - available options are: TLS, TLS-Client, Signing</p>
<p>​            <span style="font-family:Courier; color:green">tls</span><br/>
​                   Create an intermediate_ca signed TLS keypair in /etc/cms for quality of life<br/>
​                   - Option [--force] overwrites any existing files, and always generate root_ca signed <br/>
​                     TLS keypair<br/>
​                   - Available argument and optional env variable specific to setup task is:<br/>
​                         <em>host_names</em> - alternatively, set environment variable <code>SAN_LIST</code></p>
<p>​            <span style="font-family:Courier; color:green">server</span><br/>
​                   Setup http server on given port<br/>
​                   - Available arguments and optional env variables specific to task are:<br/>
​                         <em>port</em> - alternatively, set environment variable <code>CMS_PORT</code><br/>
​                         <em>aas-url</em> - alternatively, set environment variable <code>AAS_API_URL</code><br/>
​                   - Optional env variables specific to setup task are: <br/>
​                        - <code>CMS_SERVER_READ_TIMEOUT =&lt;read timeout in seconds&gt;</code> - Certificate <br/> 
​                        Management Service Read Timeout<br/>
​                        - <code>CMS_SERVER_READ_HEADER_TIMEOUT =&lt;read header timeout in seconds&gt;</code> - <br/>
​                          Certificate Management Service Read Header Timeout<br/>
​                        - <code>CMS_SERVER_WRITE_TIMEOUT =&lt;write timeout in seconds&gt;</code> - Certificate  <br/>
​                           Management Service Write Timeout<br/>
​                        - <code>CMS_SERVER_IDLE_TIMEOUT =&lt;idle timeout in seconds&gt;</code> - Certificate <br/>
​                           Management Service Idle Timeout<br/>
​                        - <code>CMS_SERVER_MAX_HEADER_BYTES =&lt;max header bytes&gt;</code> - Certificate Management <br/>
​                           Service Max Header Bytes<br/>
​                        - <code>LOG_ENTRY_MAXLENGTH =&lt;log max length&gt;</code> - Maximum length of each entry in a <br/>
​                           log<br/>
​                        - <code>CMS_ENABLE_CONSOLE_LOG =&lt;bool&gt;</code> - Certificate Management Service Enable <br/>
​                           standard output</p>
<p>​            <span style="font-family:Courier; color:green">cms_auth_token</span><br/>
​                   Create its own self signed JWT keypair in /etc/cms/jwt for quality of life<br/>
​                   - Option [--force] overwrites any existing files, and always generate new JWT keypair <br/>
​                     and token<br/>
​                   - Optional env variables specific to setup task are: <br/>
​                        - <code>AAS_JWT_CN=&lt;jwt common-name&gt;</code> - Authentication and Authorization JWT <br/>
​                           Common Name<br/>
​                        - <code>AAS_TLS_CN=&lt;tls common-name&gt;</code> - Authentication and Authorization TLS <br/>
​                           Common Name <br/>
​                        - <code>AAS_TLS_SAN=&lt;tls SAN&gt;</code> - Authentication and Authorization TLS SAN list</p>
<h3 id="1144-directory-layout_1">11.4.4  Directory Layout</h3>
<p>The Certificate Management Service installs by default to <code>/opt/cms</code> with
the following folders.</p>
<h4 id="11441-bin_1">11.4.4.1  Bin</h4>
<p>This folder contains executable scripts.</p>
<h4 id="11442-cacerts_1">11.4.4.2 Cacerts</h4>
<p>This folder contains the CMS root CA certificate.</p>
<h2 id="115-authentication-and-authorization-service_1">11.5  Authentication and Authorization Service</h2>
<h3 id="1151-installation-answer-file-options_1">11.5.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CMS_BASE_URL</td>
<td>https://&lt;cms IP or hostname>/cms/v1/</td>
<td>Required; Provides the URL for the CMS.</td>
</tr>
<tr>
<td>AAS_NOSETUP</td>
<td>false</td>
<td>Optional. Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data.</td>
</tr>
<tr>
<td>AAS_DB_HOSTNAME</td>
<td>localhost</td>
<td>Required. Hostname or IP address of the AAS database</td>
</tr>
<tr>
<td>AAS_DB_PORT</td>
<td>5432</td>
<td>Required. Database port number</td>
</tr>
<tr>
<td>AAS_DB_NAME</td>
<td>pgdb</td>
<td>Required. Database name</td>
</tr>
<tr>
<td>AAS_DB_USERNAME</td>
<td>dbuser</td>
<td>Required. Database username</td>
</tr>
<tr>
<td>AAS_DB_PASSWORD</td>
<td>dbpassword</td>
<td>Required. Database password</td>
</tr>
<tr>
<td>AAS_DB_SSLMODE</td>
<td>verify-ca</td>
<td>Defines the SSL mode for the connection to the database. If not specified, the database connection will not use certificate verification. If specified, certificate verification will be required for database connections.</td>
</tr>
<tr>
<td>AAS_DB_SSLCERTSRC</td>
<td>/usr/local/pgsql/data/server.crt</td>
<td>Optional, required if the<code>“AAS_DB_SSLMODE</code> is set to <code>verify-ca</code> Defines the location of the database SSL certificate.</td>
</tr>
<tr>
<td>AAS_DB_SSLCERT</td>
<td>\&lt;path_to_cert_file_on_system></td>
<td>Optional. The <code>AAS_DB_SSLCERTSRC</code> variable defines the source location of the database SSL certificate; this variable determines the local location. If the former option is used without specifying this option, the service will copy the SSL certificate to the default configuration directory.</td>
</tr>
<tr>
<td>AAS_ADMIN_USERNAME</td>
<td>admin@aas</td>
<td>Required. Defines a new AAS administrative user. This user will be able to create new users, new roles, and new role-user mappings. This user will have the <code>AAS:Administrator</code> role.</td>
</tr>
<tr>
<td>AAS_ADMIN_PASSWORD</td>
<td>aasAdminPass</td>
<td>Required. Password for the new AAS admin user.</td>
</tr>
<tr>
<td>AAS_JWT_CERT_SUBJECT</td>
<td>"AAS JWT Signing Certificate"</td>
<td>Optional. Defines the subject of the JWT signing certificate.</td>
</tr>
<tr>
<td>AAS_JWT_TOKEN_DURATION_MINS</td>
<td>5</td>
<td>Optional. Defines the amount of time in minutes that an issued token will be valid.</td>
</tr>
<tr>
<td>SAN_LIST</td>
<td>127.0.0.1,localhost,10.x.x.x</td>
<td>Comma-separated list of IP addresses and hostnames that will be valid connection points for the service. Requests sent to the service using an IP or hostname not in this list will be denied, even if it resolves to this service.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>Required. Token from the CMS generated during CMS setup that allows the AAS to perform initial setup tasks.</td>
</tr>
<tr>
<td>LOG_LEVEL</td>
<td>Critical, error, warning, info, debug, trace</td>
<td>Optional. Defaults to INFO. Changes the log level used.</td>
</tr>
</tbody>
</table>
<h3 id="1152-configuration-options_1">11.5.2  Configuration Options</h3>
<h3 id="1153-command-line-options_1">11.5.3  Command-Line Options</h3>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">authservice <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands</strong><br/>
​         <span style="font-family:Courier; color:blue"><strong>-h|--help</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice -h|--help</span><br/>
​                   Show this help message</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice setup <span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>> </span></span><br/>
​                   Run setup task</p>
<p>​            <strong>Available Tasks for setup:</strong><br/>
​            <span style="font-family:Courier; color:green">all</span><br/>
​                   Runs all setup tasks<br/>
​                   - Required env variables: get required env variables from all the setup tasks<br/>
​                   - Optional env variables: get optional env variables from all the setup tasks</p>
<p>​            <span style="font-family:Courier; color:green">database</span><br/>
​                   Setup authservice database<br/>
​                     - Required environment variables if <code>AAS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance<br/>
​                     - Available arguments and Required Env variables specific to setup task are:<br/>
​                           - db-host alternatively, set environment variable <code>AAS_DB_HOSTNAME</code><br/>
​                           - db-port alternatively, set environment variable <code>AAS_DB_PORT</code><br/>
​                           - db-user alternatively, set environment variable <code>AAS_DB_USERNAME</code><br/>
​                           - db-pass alternatively, set environment variable <code>AAS_DB_PASSWORD</code><br/>
​                           - db-name alternatively, set environment variable <code>AAS_DB_NAME</code><br/>
​                     - Available arguments and Optional env variables specific to setup task are:<br/>
​                           - db-sslmode \&lt;disable|allow|prefer|require|verify-ca|verify-full><br/>
​                            alternatively, set environment variable <code>AAS_DB_SSLMODE</code><br/>
​                          - db-sslcert path to where the certificate file of database. Only applicable<br/>
​                            for db-sslmode=\&lt;verify-ca|verify-full. If left empty, the cert will be <br/>
​                            copied to /etc/authservice/tdcertdb.pem alternatively, <br/>
​                            set environment variable <code>AAS_DB_SSLCERT</code><br/>
​                          - db-sslcertsrc \&lt;path to where the database ssl/tls certificate file><br/>
​                            mandatory if db-sslcert does not already exist<br/>
​                            alternatively, set environment variable <code>AAS_DB_SSLCERTSRC</code></p>
<p>​            <span style="font-family:Courier; color:green">admin</span><br/>
​                   Setup task to register authservice user with default admin roles to database<br/>
​                     - Required environment variables if <code>AAS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance<br/>
​                     - Available arguments and Required Env variables specific to setup task are:<br/>
​      ​                   - <em>user</em> - alternatively set environment variable <code>AAS_ADMIN_USERNAME</code><br/>
​      ​                   - <em>pass</em> - alternatively set environment variable <code>AAS_ADMIN_PASSWORD</code></p>
<p>​      ​      <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                   Download CMS root CA certificate<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance</p>
<p>​            <span style="font-family:Courier; color:green">download_cert TLS</span><br/>
​                   Generates Key pair and CSR, gets it signed from CMS<br/>
​                     - Option [--force] overwrites any existing files, and always downloads newly signed <br/>
​                        TLS cert<br/>
​                     - Required environment variables if <code>AAS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with CMS<br/>
​                         - <code>SAN_LIST=&lt;san&gt;</code> - list of hosts which needs access to service<br/>
​                     - Optional env variables specific to setup task are:<br/>
​                         - <code>KEY_PATH=&lt;key_path&gt;</code> - Path of file where TLS key needs to be stored<br/>
​                         - <code>CERT_PATH=&lt;cert_path&gt;</code> - Path of file/directory where TLS certificate needs <br/>
​                            to be stored</p>
<p>​            <span style="font-family:Courier; color:green">jwt</span><br/>
  ​                 Create jwt signing key and jwt certificate signed by CMS<br/>
​                   - Option [--force] overwrites any existing files, and always downloads newly signed <br/>
​                      JWT cert<br/>
​                     - Required environment variables if <code>AAS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance<br/>
​                     - Available arguments and Required Env variables specific to setup task are:<br/>
​      ​                   - <em>cms-url</em> - alternatively set environment variable <code>CMS_BASE_URL</code><br/>
​      ​                   - <em>token</em> - alternatively set environment variable <code>BEARER_TOKEN</code><br/>
​                     - Available arguments and Optional env variables specific to setup task are:<br/>
​      ​                   - <em>subj</em> - alternatively set environment variable <code>AAS_JWT_CERT_CN</code> <br/>
​      ​                   - <em>keyid</em> - alternatively set environment variable <code>AAS_JWT_INCLUDE_KEYID</code> <br/>
​      ​                   - <em>valid-mins</em> - alternatively set environment variable <br/>
​                            <code>AAS_JWT_TOKEN_DURATION_MINS</code> </p>
<p>​            <span style="font-family:Courier; color:green">server</span><br/>
​                   Setup http server on given port<br/>
​                     - Required environment variables if <code>AAS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that AAS is <br/>
​                            talking to the right CMS instance<br/>
​                     - Available arguments and Optional env variables specific to setup task are:<br/>
​      ​                   - port - alternatively set environment variable <code>AAS_PORT</code> <br/>
​      ​                   - <code>AAS_SERVER_READ_TIMEOUT=&lt;read timeout in seconds&gt;</code> <br/>
​      ​                   - <code>AAS_SERVER_READ_HEADER_TIMEOUT=&lt;read header timeout in seconds&gt;</code> <br/>
​      ​                   - <code>AAS_SERVER_WRITE_TIMEOUT=&lt;write timeout in seconds&gt;</code> <br/>
​      ​                   - <code>AAS_SERVER_IDLE_TIMEOUT=&lt;idle timeout in seconds&gt;</code> <br/>
​      ​                   - <code>AAS_SERVER_MAX_HEADER_BYTES=&lt;max header bytes&gt;</code> <br/>
​      ​                   - <code>AAS_LOG_MAX_LENGTH=&lt;log max length&gt;</code> <br/>
​      ​                   - <code>AAS_ENABLE_CONSOLE_LOG=&lt;bool&gt;</code> </p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice start</span><br/>
​                   Start authservice</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice status</span><br/>
​                   Show the status of authservice</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice stop</span><br/>
​                   Stop authservice</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>tlscertsha384</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice tlscertsha384</span><br/>
​                   Show the SHA384 digest of the certificate used for TLS</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice uninstall</span><br/>
​                   Uninstall authservice<br/>
​                   --purge option needs to be applied to remove configuration and data files</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>-v|--version</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">authservice -v|--version</span><br/>
​                   Shows the version of authservice.</p>
<h3 id="1154-directory-layout_1">11.5.4  Directory Layout</h3>
<p>The Verification Service installs by default to <code>/opt/authservice</code> with
the following folders.</p>
<h4 id="11541-bin_1">11.5.4.1 Bin</h4>
<p>Contains executable scripts and binaries.</p>
<h4 id="11542-dbscripts_1">11.5.4.2  dbscripts</h4>
<p>Contains database scripts.</p>
<h2 id="116-workload-service_1">11.6  Workload Service</h2>
<h3 id="1161-installation-answer-file-options_1">11.6.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>WLS_LOGLEVEL</td>
<td>INFO</td>
<td>(Optional) Alternatives include WARN and DEBUG. Sets the log level for the service.</td>
</tr>
<tr>
<td>WLS_NOSETUP</td>
<td>false</td>
<td>(Optional) Determines whether “setup” will be executed after installation. Typically this is set to “false” to install and perform setup in one action. The “true” option is intended for building the service as a container, where the installation would be part of the image build, and setup would be performed when the container starts for the first time to generate any persistent data. Defaults to “false” if unset.</td>
</tr>
<tr>
<td>WLS_PORT</td>
<td>5000</td>
<td>(Optional) Defines the HTTPS port used by the service Defaults to 5000 if unset.</td>
</tr>
<tr>
<td>WLS_DB_HOSTNAME</td>
<td>localhost</td>
<td>(Required) Database hostname</td>
</tr>
<tr>
<td>WLS_DB</td>
<td>wlsdb</td>
<td>(Required) Database name</td>
</tr>
<tr>
<td>WLS_DB_PORT</td>
<td>5432</td>
<td>(Required) Database port number</td>
</tr>
<tr>
<td>WLS_DB_USERNAME</td>
<td>wlsdbuser</td>
<td>(Required) Database username</td>
</tr>
<tr>
<td>WLS_DB_PASSWORD</td>
<td>wlsdbuserpass</td>
<td>(Required) Database password</td>
</tr>
<tr>
<td>HVS_URL</td>
<td>https://\&lt;HVS IP address or hostname>:8443/hvs/v2/</td>
<td>(Required) Base URL for the HVS</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;AAS IP address or hostname>:8444/aas</td>
<td>Base URL for the AAS</td>
</tr>
<tr>
<td>WLS_CERT_SAN_LIST</td>
<td>127.0.0.1,localhost,10.x.x.x</td>
<td>Comma-separated list of IP addresses and hostnames that will be valid connection points for the service. Requests sent to the service using an IP or hostname not in this list will be denied, even if it resolves to this service.</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td></td>
<td>Base URL for the CMS</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>(Required) Token from the CMS generated during CMS setup that allows the AAS to perform initial setup tasks.</td>
</tr>
<tr>
<td>WLS_TLS_CERT_CN</td>
<td>'WLS TLS Certificate</td>
<td>(Optional) Set the Common name for TLS cert to be downloaded from CMS. Default is 'WLS TLS Certificate'.</td>
</tr>
<tr>
<td>WLS_CERT_ORG</td>
<td>'INTEL'</td>
<td>(Optional) Set the Organization in Subject of CSR. Default is 'INTEL'.</td>
</tr>
<tr>
<td>WLS_CERT_COUNTRY</td>
<td>'US'</td>
<td>(Optional) Set the Country in Subject of CSR. Default is 'US'.</td>
</tr>
<tr>
<td>WLS_CERT_PROVINCE</td>
<td>'SF'</td>
<td>(Optional) Set the Province in Subject of CSR. Default is 'SF'.</td>
</tr>
<tr>
<td>WLS_CERT_LOCALITY</td>
<td>'SC'</td>
<td>(Optional) Set the Locality in Subject of CSR. Default is 'SC'.</td>
</tr>
<tr>
<td>KEY_CACHE_SECONDS</td>
<td>300</td>
<td>(Optional) Set the time till which the key will be cached. Default is '300 seconds'.</td>
</tr>
<tr>
<td>WLS_LOGLEVEL</td>
<td>Info, debug, error, warn</td>
<td>(Optional) Set the log level.</td>
</tr>
<tr>
<td>KEY_PATH</td>
<td></td>
<td>(Optional) Redefines the path to the keystore folder</td>
</tr>
<tr>
<td>CERT_PATH</td>
<td></td>
<td>(Optional) Redefines the path to the certificates folder</td>
</tr>
</tbody>
</table>
<h3 id="1162-configuration-options_1">11.6.2  Configuration Options</h3>
<p>The Workload Service configuration can be found in
<code>/etc/workload-service/config.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5000</span>
<span class="nt">cmstlscertdigest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;sha384&gt;</span>
<span class="nt">postgres</span><span class="p">:</span>
  <span class="nt">dbname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wlsdb</span>
  <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;database username&gt;</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;database password&gt;</span>
  <span class="nt">hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;database IP or hostname&gt;</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
  <span class="nt">sslmode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">hvs_api_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://&lt;HVS IP or hostname&gt;:8443/hvs/v2/</span>
<span class="nt">cms_base_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://&lt;CMS IP or hostname&gt;:8445:/cms/v1/</span>
<span class="nt">aas_api_url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://&lt;AAS IP or hostname&gt;:8444/aas/</span>
<span class="nt">subject</span><span class="p">:</span>
  <span class="nt">tlscertcommonname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">WLS TLS Certificate</span>
  <span class="nt">organization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">INTEL</span>
  <span class="nt">country</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">US</span>
  <span class="nt">province</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SF</span>
  <span class="nt">locality</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SC</span>
<span class="nt">wls</span><span class="p">:</span>
  <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username of service account used by WLS to access other services&gt;&gt;</span>
  <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
<span class="nt">loglevel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
<span class="nt">key_cache_seconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
</code></pre></div>
<h3 id="1163-command-line-options_1">11.6.3  Command-Line Options</h3>
<p>The Workload Service supports several command-line commands that can be
executed only as the Root user:</p>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">workload-service <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [argument]</span></p>
<p><strong>Available Commands:</strong></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>Help</strong></span><br/>
​              <span style="font-family:Courier; color:brown">-help|--help</span>                       Show this help message<br/>
​              <span style="font-family:Courier; color:brown">-v|--version</span>                       Print version/build information<br/>
​              <span style="font-family:Courier; color:brown">start</span>                                       Start workload-service<br/>
​              <span style="font-family:Courier; color:brown">stop</span>                                       Stop workload-service<br/>
​              <span style="font-family:Courier; color:brown">status</span>                                    Determine if workload-service is running<br/>
​              <span style="font-family:Courier; color:brown">uninstall [--purge]</span>      Uninstall workload-service. --purge option needs to be <br/>
​                                                                applied to remove configuration and data files<br/>
​              <span style="font-family:Courier; color:brown">setup</span>                                      Run workload-service setup tasks</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">workload-service start</span><br/>
​                   Start workload-service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">workload-service stop</span><br/>
​                   Stop workload-service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">workload-service status</span><br/>
​                   Determine if workload-service is running</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">workload-service uninstall</span><br/>
​                   Uninstall workload-service<br/>
​                   <span style="font-family:Courier; color:brown">[--purge]</span> option needs to be applied to remove configuration and data files</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                   Setup workload-service for use<br/>
​                   <span style="font-family:Courier; color:brown">workload-service setup <span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>></span> [--force]</span></p>
<p>​              <strong><em>Available tasks for setup:</em></strong><br/>
​              <span style="font-family:Courier; color:green">all</span><br/>
​                     Runs all setup tasks<br/>
​                     - Required env variables: get required env variables from all the setup tasks<br/>
​                     - Optional env variables: get optional env variables from all the setup tasks</p>
<p>​              <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                     Download CMS root CA certificate<br/>
​                     - Fetches the latest CMS Root CA Certificates, overwriting existing files.<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password<br/>
​                     - Required environment variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is <br/>
​                            talking to the right CMS instance</p>
<p>​              <span style="font-family:Courier; color:green">download_cert TLS</span><br/>
​                     Generates Key pair and CSR, gets it signed from CMS<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is <br/>
​                            talking to the right CMS instance<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with CMS<br/>
​                         - <code>SAN_LIST=&lt;CSV List&gt;</code> - List of FQDNs to be added to the SAN field in TLS cert<br/> 
​                            to override <br/>
​                     - Optional env variables specific to setup task are:<br/>
​                         - <code>KEY_PATH=&lt;key_path&gt;</code> - Path of file where TLS key needs to be stored<br/>
​                         - <code>CERT_PATH=&lt;cert_path&gt;</code> - Path of file/directory where TLS certificate needs <br/>
​                            to be stored<br/>
​                         - <code>WLS_TLS_CERT_CN=&lt;COMMON NAME&gt;</code> to override default specified in config</p>
<p>​              <span style="font-family:Courier; color:green">database</span><br/>
​                     Setup workload-service database<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is <br/>
​                            talking to the right CMS instance<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>WLS_DB_HOSTNAME=&lt;db host name&gt;</code> - database host name<br/>
​                         - <code>WLS_DB_PORT=&lt;db port&gt;</code> - database port number<br/>
​                         - <code>WLS_DB=&lt;db name&gt;</code> - database schema name<br/>
​                         - <code>WLS_DB_USERNAME=&lt;db user name&gt;</code> - database user name<br/>
​                         - <code>WLS_DB_PASSWORD=&lt;db password&gt;</code> - database password<br/>
​                     - Optional env variables specific to setup task are:<br/>
​                         - <code>WLS_DB_SSLMODE=&lt;db sslmode&gt;</code> - database SSL Connection Mode <br/>
​                            \<disable|allow|prefer|require|verify-ca|verify-full><br/>
​                         - <code>WLS_DB_SSLCERT=&lt;ssl certificate path&gt;</code> - database SSL Certificate <br/>
​                            target path. <br/>
​                            Only applicable for WLS_DB_SSLMODE=<verify-ca|verify-full>. If left empty, <br/>
​                            the cert will be copied to /etc/workload-service/wlsdbsslcert.pem<br/>
​                         - <code>WLS_DB_SSLCERTSRC=&lt;ssl certificate source path&gt;</code> - database SSL Certificate<br/>
​                            source path. Mandatory if <code>WLS_DB_SSLCERT</code> does not already exist</p>
<p>​              <span style="font-family:Courier; color:green">server</span><br/>
​                     Setup http server on given port<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root<br/> 
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is <br/>
​                            talking to the right CMS instance<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>WLS_PORT=&lt;port&gt;</code> - database port number<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password</p>
<p>​              <span style="font-family:Courier; color:green">hvsconnection</span><br/>
​                     Setup task for setting up the connection to the Host Verification Service (HVS)<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is<br/> 
​                          talking to the right CMS instance<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL</p>
<p>​              <span style="font-family:Courier; color:green">download_saml_ca_cert</span><br/>
​                     Setup to download SAML CA certificates from HVS<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WLS_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WLS is <br/>
​                            talking to the right CMS instance<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>WLS_SERVICE_USERNAME=&lt;service username&gt;</code> - WLS service username<br/>
​                         - <code>WLS_SERVICE_PASSWORD=&lt;service password&gt;</code> - WLS service password<br/>
​                     - Required env variables specific to setup task are:<br/>
​                         - <code>HVS_URL=&lt;url&gt;</code> - HVS API Endpoint URL<br/>
​                         - <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with HVS</p>
<h3 id="1164-directory-layout_1">11.6.4 Directory Layout</h3>
<p>The Workload Service installs by default to /opt/wls with the following
folders.</p>
<h2 id="117-key-broker-service_1">11.7  Key Broker Service</h2>
<h3 id="1171-installation-answer-file-options_1">11.7.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Default Value</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>USERNAME</td>
<td></td>
<td>KBS admin username</td>
</tr>
<tr>
<td>PASSWORD</td>
<td></td>
<td>KBS admin password</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td></td>
<td>Required for generating TLS certificate</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td></td>
<td>SHA384 digest of CMS TLS certificate</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td></td>
<td>AAS baseurl</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td></td>
<td>JWT token for installation user</td>
</tr>
<tr>
<td>KMS_HOME</td>
<td>/opt/kms</td>
<td>Application home directory</td>
</tr>
<tr>
<td>KBS_SERVICE_USERNAME</td>
<td>kms</td>
<td>Non-root user to run KMS</td>
</tr>
<tr>
<td>JETTY_PORT</td>
<td>80</td>
<td>The server will listen for HTTP connections on this port</td>
</tr>
<tr>
<td>JETTY_SECURE_PORT</td>
<td>443</td>
<td>The server will listen for HTTPS connections on this port</td>
</tr>
<tr>
<td>KMS_LOG_LEVEL</td>
<td>INFO</td>
<td>Sets the root log level in logback.xml</td>
</tr>
<tr>
<td>KMS_NOSETUP</td>
<td>false</td>
<td>Skips setup during installation if set to true</td>
</tr>
<tr>
<td>ENDPOINT_URL</td>
<td><a href="http://localhost">http://localhost</a></td>
<td>Endpoint to be used in key transfer url</td>
</tr>
<tr>
<td>KEY_MANAGER_PROVIDER</td>
<td>DirectoryKeyManager</td>
<td>Key manager to be used for key management</td>
</tr>
<tr>
<td>KBS_SERVICE_PASSWORD</td>
<td></td>
<td>This password protects the configuration file and the password vault. It must be set before installing and before starting the KBS</td>
</tr>
<tr>
<td>KMS_TLS_CERT_IP</td>
<td></td>
<td>IP addresses to be included in SAN list</td>
</tr>
<tr>
<td>KMS_TLS_CERT_DNS</td>
<td></td>
<td>DNS addresses to be included in SAN list</td>
</tr>
<tr>
<td>BARBICAN_PROJECT_ID</td>
<td></td>
<td>OpenStack Barbican project id</td>
</tr>
<tr>
<td>BARBICAN_ENDPOINT_URL</td>
<td></td>
<td>OpenStack Barbican endpoint url</td>
</tr>
<tr>
<td>BARBICAN_KEYSTONE_PUBLIC_ENDPOINT</td>
<td></td>
<td>OpenStack Keystone endpoint url</td>
</tr>
<tr>
<td>BARBICAN_TENANTNAME</td>
<td></td>
<td>OpenStack Barbican tenant name</td>
</tr>
<tr>
<td>BARBICAN_USERNAME</td>
<td></td>
<td>OpenStack Barbican admin username</td>
</tr>
<tr>
<td>BARBICAN_PASSWORD</td>
<td></td>
<td>OpenStack Barbican admin password</td>
</tr>
</tbody>
</table>
<h3 id="1172-configuration-options_1">11.7.2  Configuration Options</h3>
<h3 id="1173-command-line-options_1">11.7.3 Command-Line Options</h3>
<p>The Key Broker Service supports several command-line commands that can be executed 
only as the Root user:</p>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">kms <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span></span></p>
<p>​       <strong>Available Commands</strong></p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms start</span><br/>
​                   Starts the service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms stop</span><br/>
​                    Stops the service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms status</span><br/>
​                   Reports the status of service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>restart</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms restart</span><br/>
​                   Restarts the status of service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms uninstall</span><br/>
​                   Removes the service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>version</strong></span><br/>
​                   <span style="font-family:Courier; color:brown">kms version</span><br/>
​                   Displays the version of the service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                    <span style="font-family:Courier; color:brown">kms setup [--force|--noexec] [task1 task2...]</span></p>
<p>​                   <strong>Available setup tasks:</strong><br/>
​                       <span style="font-family:Courier; color:brown">kms setup password-vault</span><br/>
​                           <span style="font-family:Courier; color:brown">kms setup jetty-tls-keystore</span><br/>
​                       <span style="font-family:Courier; color:brown">kms setup shiro-ssl-port</span><br/>
​                       <span style="font-family:Courier; color:brown">kms setup notary-key</span><br/>
​                       <span style="font-family:Courier; color:brown">kms setup envelope-key</span><br/>
​                       <span style="font-family:Courier; color:brown">kms setup storage-key</span><br/>
​                       <span style="font-family:Courier; color:brown">kms setup saml-certificates</span><br/>
​                           <span style="font-family:Courier; color:brown">kms setup tpm-identity-certificates</span></p>
<h3 id="1174-directory-layout_1">11.7.4  Directory Layout</h3>
<p>The Verification Service installs by default to /opt/kms with the
following folders.</p>
<h4 id="11741-bin">11.7.4.1  Bin</h4>
<p>Contains scripts and executable binaries</p>
<h4 id="11742-configuration">11.7.4.2  Configuration</h4>
<p>Contains configuration files</p>
<h4 id="11743-env">11.7.4.3  Env</h4>
<p>Contains environment details</p>
<h4 id="11744-features">11.7.4.4  Features</h4>
<h4 id="11745-java">11.7.4.5  Java</h4>
<p>Contains Java artifacts</p>
<h4 id="11746-logs">11.7.4.6  Logs</h4>
<p>Contains logs. Primary log file is <code>kms.log</code></p>
<h4 id="11747-repository">11.7.4.7  Repository</h4>
<p>Contains the <code>keys</code> subdirectory, which is used for storing image
encryption keys.</p>
<h4 id="11748-script">11.7.4.8  Script</h4>
<p>Contains additional scripts</p>
<h2 id="118-workload-agent_1">11.8  Workload Agent</h2>
<h3 id="1181-installation-answer-file-options_1">11.8.1  Installation Answer File Options</h3>
<h3 id="1182-configuration-options_1">11.8.2  Configuration Options</h3>
<h3 id="1183-command-line-options_1">11.8.3  Command-Line Options</h3>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">wlagent <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span></span></p>
<p><strong>Available Commands:</strong><br/>
​         <span style="font-family:Courier; color:blue"><strong>help|-help|--help</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent help|-help|--help</span><br/>
​                  Show help message</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent setup <span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>> </span></span><br/>
​                  Run setup task</p>
<p>​            <strong>Available Tasks for setup</strong><br/>
​            <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                   Download CMS root CA certificate<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Environment variable <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                     - Environment variable <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to <br/>
​                        ensure that WLS is talking to the right CMS in</p>
<p>​            <span style="font-family:Courier; color:green">SigningKey</span><br/>
​                   Generate a TPM signing key<br/>
​                     - Option [--force] overwrites any existing files, and always creates a new Signing key</p>
<p>​            <span style="font-family:Courier; color:green">BindingKey</span><br/>
​                   Generate a TPM binding key<br/>
​                     - Option [--force] overwrites any existing files, and always creates a new Binding key</p>
<p>​            <span style="font-family:Courier; color:green">RegisterSigningKey</span><br/>
​                   Register a signing key with the host verification service<br/>
​                     - Option [--force] Always registers the Signing key with Verification service<br/>
​                     - Environment variable <code>MTWILSON_API_URL=&lt;url&gt;</code> for registering the key with <br/>
​                        Verification service<br/>
​                     - Environment variable <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with <br/>
​                        Verification service</p>
<p>​            <span style="font-family:Courier; color:green">RegisterBindingKey</span><br/>
​                   Register a binding key with the host verification service<br/>
​                     - Option [--force] Always registers the Binding key with Verification service<br/>
​                     - Environment variable <code>MTWILSON_API_URL=&lt;url&gt;</code> for registering the key with <br/>
​                        Verification service<br/>
​                     - Environment variable <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with <br/>
​                        Verification service<br/>
​                     - Environment variable <code>TRUSTAGENT_USERNAME=&lt;TA user&gt;</code> for changing binding <br/>
​                        key file ownership to TA application user</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>start</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent start</span><br/>
​                  Start wlagent</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>stop</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent stop</span><br/>
​                  Stop wlagent</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>status</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent status</span><br/>
​                  Reports the status of wlagent service</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent uninstall [--purge]</span><br/>
​                  Uninstall wlagent<br/>
​                  <span style="font-family:Courier; color:brown">[--purge]</span> Uninstalls workload agent and deletes the existing configuration directory</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>-v|--version</strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent -v|--version</span><br/>
​                  Print version/build information</p>
<p>​         <span style="font-family:Courier; color:blue"><strong>fetch-key-url \<keyUrl></strong></span><br/>
​                  <span style="font-family:Courier; color:brown">wlagent fetch-key-url \<keyUrl></span><br/>
​                  Fetch a key from the keyUrl</p>
<h3 id="1184-directory-layout_1">11.8.4  Directory Layout</h3>
<p>The Workload Agent installs by default to /opt/workload-agent with the
following folders.</p>
<h4 id="11841-bin_1">11.8.4.1  Bin</h4>
<p>Contains scripts and executable binaries.</p>
<h2 id="119-workload-policy-manager_1">11.9  Workload Policy Manager</h2>
<h3 id="1191-installation-answer-file-options_1">11.9.1  Installation Answer File Options</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>KMS_API_URL</td>
<td>https://\&lt;IP address or hostname of the KBS>:9443/v1/</td>
<td>Required. Defines the baseurl for the Key Broker Service. The WPM uses this URL to request new encryption keys when encrypting images.</td>
</tr>
<tr>
<td>KMS_TLS_SHA384</td>
<td></td>
<td>Required. SHA384 hash of the Key Broker TLS certificate</td>
</tr>
<tr>
<td>CMS_TLS_CERT_SHA384</td>
<td></td>
<td>Required. SHA384 hash of the CMS TLS certificate</td>
</tr>
<tr>
<td>CMS_BASE_URL</td>
<td>https://\&lt;IP address or hostname for CMS>:8445/cms/v1/</td>
<td>Required. Defines the base URL for the CMS owned by the image owner. Note that this CMS may be different from the CMS used for other components.</td>
</tr>
<tr>
<td>AAS_API_URL</td>
<td>https://\&lt;IP address or hostname for AAS>:8444/aas</td>
<td>Required. Defines the baseurl for the AAS owned by the image owner. Note that this AAS may be different from the AAS used for other components.</td>
</tr>
<tr>
<td>BEARER_TOKEN</td>
<td>\&lt;token></td>
<td>Required; token from CMS with permissions used for installation.</td>
</tr>
<tr>
<td>WPM_WITH_CONTAINER_SECURITY</td>
<td>“yes” or “no”</td>
<td>Optional, defaults to “no.” Defines whether the WPM will support Docker Container encryption. If this is set to Yes, the appropriate prerequisites for Docker Container encryption will be installed. If this is set to “no,” the WPM will not be able to encrypt Docker Container images, and will only be usable to encrypt Virtual Machine images.</td>
</tr>
<tr>
<td>WPM_LOG_LEVEL</td>
<td>INFO (default), DEBUG</td>
<td>Optional; defines the log level for the WPM. Defaults to INFO.</td>
</tr>
<tr>
<td>WPM_PASSWORD</td>
<td></td>
<td>Defines the credentials for the WPM to use to access the KBS</td>
</tr>
<tr>
<td>WPM_USERNAME</td>
<td></td>
<td>Defines the credentials for the WPM to use to access the KBS</td>
</tr>
</tbody>
</table>
<h3 id="1192-configuration-options_1">11.9.2  Configuration Options</h3>
<h3 id="1193-command-line-options_1">11.9.3  Command-Line Options</h3>
<p>The Workload Policy Manager supports several command-line commands that can be 
executed only as the Root user:</p>
<p><strong>Syntax:</strong></p>
<p>​        <span style="font-family:Courier; color:brown">wpm <span style="font-family:Courier; color:blue"><strong>\&lt;command></strong></span> [arguments]</span></p>
<p><strong>Available Commands</strong></p>
<p>​     <span style="font-family:Courier; color:blue"><strong>-h|--help</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm -h|--help</span><br/>
​         Displays help text</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>-v|--version</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm -v|--version</span><br/>
​         Print version/build information</p>
<p>​    <span style="font-family:Courier; color:blue"><strong>create-image-flavor</strong></span><br/>
​         Create VM image flavors and encrypt the image</p>
<p>​         <span style="font-family:Courier; color:brown">wpm create-image-flavor [-l label] [-i in] [-o out] [-e encout] [-k key]</span><br/>
​         <span style="font-family:Courier">-l, --label</span>               image flavor label<br/>
​         <span style="font-family:Courier">-i, --in</span>                      input image file path<br/>
​         <span style="font-family:Courier">-o, --out</span>                    (optional) output image flavor file path<br/>
​                                                  if not specified, will print to the console<br/>
​         <span style="font-family:Courier">-e, --encout</span>             (optional) output encrypted image file path<br/>
​                                                  if not specified, encryption is skipped<br/>
​         <span style="font-family:Courier">-k, --key</span>                    (optional) existing key ID<br/>
​                                                  if not specified, a new key is generated</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>create-container-image-flavor</strong></span><br/>
​         Create container image flavors and encrypt the container image<br/>
​         <span style="font-family:Courier; color:brown">wpm create-container-image-flavor [-i img-name] [-t tag] [-f dockerFile] [-d build-dir] [-k keyId] [-e] [-s] [-n notaryServer] [-o out-file]</span><br/>
​         <span style="font-family:Courier">-i, --img-name</span>                            container image name<br/>
​         <span style="font-family:Courier">-t, --tag</span>                                        (optional)container image tag name<br/>
​         <span style="font-family:Courier">-f, --docker-file</span>                     (optional) container file path to build the container image<br/>
​         <span style="font-family:Courier">-d, --build-dir</span>                          (optional) build directory to build the container image<br/>
​         <span style="font-family:Courier">-k, --key-id </span>                               (optional) existing key ID if not specified, a new key is <br/>
​                                                                      generated<br/>
​         <span style="font-family:Courier">-e, --encryption-required</span>    (optional) boolean parameter specifies if container <br/>
​                                                                       image needs to be encrypted<br/>
​         <span style="font-family:Courier">-s, --integrity-enforced</span>      (optional) boolean parameter specifies if container <br/>
​                                                                       image should be signed<br/>
​         <span style="font-family:Courier">-n, --notary-server</span>                  (optional) specify notary server url<br/>
​         <span style="font-family:Courier">-o, --out-file</span>                              (optional) specify output file path<br/></p>
<p>​     <span style="font-family:Courier; color:blue"><strong>get-container-image-id</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm get-container-image-id [\<sha256 digest of image>]</span><br/>
​         Fetch the container image ID given the sha256 digest of the image</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>unwrap-key</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm unwrap-key [-i |--in] \<wrapped key file path></span><br/>
​         Unwraps the image encryption key fetched from KMS</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>fetch-key</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm fetch-key</span><br/>
​         Fetch key from KMS</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>create-software-flavor</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm create-software-flavor</span><br/>
​         Not currently supported; intended for future functionality.</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>uninstall</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm uninstall</span><br/>
​         Uninstall wpm. <br/>
​         --purge option needs to be applied to remove configuration and data files</p>
<p>​     <span style="font-family:Courier; color:blue"><strong>setup</strong></span><br/>
​         <span style="font-family:Courier; color:brown">wpm setup <span style="font-family:Courier; color:green"> \&lt;<strong>task</strong>></span> [--force]</span><br/>
​         Run workload-policy-manager setup tasks</p>
<p>​         <strong>Available tasks for setup:</strong><br/>
​              <span style="font-family:Courier; color:green">all</span><br/>
​                   Runs all setup tasks<br/>
​                   - Required env variables: get required env variables from all the setup tasks<br/>
​                   - Optional env variables: get optional env variables from all the setup tasks</p>
<p>​              <span style="font-family:Courier; color:green">download_ca_cert</span><br/>
​                     Download CMS root CA certificate<br/>
​                     - Option [--force] overwrites any existing files, and always downloads new root <br/>
​                        CA cert<br/>
​                     - Required environment variables if <code>WPM_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>KMS_API_URL=&lt;url&gt;</code> - KMS API url<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>WPM_SERVICE_USERNAME=&lt;service username&gt;</code> - WPM service username<br/>
​                         - <code>WPM_SERVICE_PASSWORD=&lt;service password&gt;</code> - WPM service password<br/>
​                     - Required environment variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WPM is <br/>
​                            talking to the right CMS instance</p>
<p>​              <span style="font-family:Courier; color:green">download_cert flavor-signing</span><br/>
​                     Generates Key pair and CSR, gets it signed from CMS<br/>
​                     - Option [--force] overwrites any existing files, and always downloads newly signed <br/>
​                        WPM Flavor Signing cert<br/>
​                     - Required environment variables if <code>WPM_NOSETUP=true</code> or variables not set <br/>
​                        in <code>config.yml</code>: <br/>
​                         - <code>CMS_TLS_CERT_SHA384=&lt;CMS TLS cert sha384 hash&gt;</code> to ensure that WPM is <br/>
​                            talking to the right CMS instance<br/>
​                         - <code>KMS_API_URL=&lt;url&gt;</code> - KMS API url<br/>
​                         - <code>AAS_API_URL=&lt;url&gt;</code> - AAS API url<br/>
​                         - <code>WPM_SERVICE_USERNAME=&lt;service username&gt;</code> - WPM service username<br/>
​                         - <code>WPM_SERVICE_PASSWORD=&lt;service password&gt;</code> - WPM service password<br/>
​                     - Required environment variables specific to setup task are:<br/>
​                         - <code>CMS_BASE_URL=&lt;url&gt;</code> for CMS API url<br/>
​                         - <code>BEARER_TOKEN=&lt;token&gt;</code> for authenticating with CMS<br/>
​                     - Optional env variables specific to setup task are:<br/>
​                         - <code>KEY_PATH=&lt;key_path&gt;</code> - Path of file where Flavor-Signing key needs to be stored<br/>
​                         - <code>CERT_PATH=&lt;cert_path&gt;</code> - Path of file/directory where Flavor-Signing certificate<br/> 
​                          needs to be stored<br/>
​                         - <code>WPM_FLAVOR_SIGN_CERT_CN=&lt;COMMON NAME&gt;</code> to override default specified in config</p>
<p>​              <span style="font-family:Courier; color:green">createenvelopekey</span><br/>
​                     Creates the key pair required to securely transfer key from KMS<br/>
​                     - Option [--force] overwrites existing envelope key pairs</p>
<div style="page-break-after: always"></div>
<h1 id="12-certificate-and-key-management_1">12  Certificate and Key Management</h1>
<h2 id="121-authentication-and-authorization-service">12.1  Authentication and Authorization Service</h2>
<p>The AAS uses a JWT signing certificate to generate JWT tokens.  By default this certificate is issued by the CMS signing CA.  Generally, this should not be changed.</p>
<p>The JWT signing certificate and its private key can be found here:</p>
<div class="highlight"><pre><span></span><code>/etc/authservice/certs/tokensign/jwtsigncert.pem
/etc/authservice/certs/tokensign/jwt.key
</code></pre></div>
<h2 id="122-host-verification-service">12.2  Host Verification Service</h2>
<h3 id="1221-saml">12.2.1  SAML</h3>
<p>The SAML Certificate is used to sign SAML attestation reports, and is itself signed by the intermediate signing CA from the CMS. This certificate is unique to the Verification Service.</p>
<p><div class="highlight"><pre><span></span><code>/etc/hvs/certs/trustedca/saml-crt.pem
/etc/hvs/trusted-keys/saml.key
</code></pre></div>
Note that, if this certificate is replaced, all existing attestations in the HVS will immediately appear as invalid/untrusted due to a SAML signature mismatch.  </p>
<p>If the Integration Hub is being used, the new SAML certificate will need to be imported to the Hub.</p>
<p>If the Key Broker Service is being used, the new SAML certificate will need to be imported to the KBS.</p>
<p>To replace this certificate with a new SAML certificate using the CMS self-signed certificate chain, use the following command:</p>
<div class="highlight"><pre><span></span><code>hvs setup download-cert-saml
</code></pre></div>
<h3 id="1222-asset-tag">12.2.2  Asset Tag</h3>
<p>The Asset tag Certificate is used to sign all Asset Tag Certificates. This certificate is unique to the Verification Service.</p>
<div class="highlight"><pre><span></span><code>/etc/hvs/certs/trustedca/tag-ca-cert.pem
/etc/hvs/trusted-keys/tag-ca.key
</code></pre></div>
<p>If the Asset tag signing certificate is replaced, all existing Asset Tags will be considered invalid, and will need to be recreated. It is recommended to delete any existing Asset Tag certificates and Flavors, and then recreate and deploy new Tags.</p>
<h3 id="1223-privacy-ca">12.2.3  Privacy CA</h3>
<p>The Privacy CA certificate is used as part of the certificate chain for creating the Attestation Identity Key (AIK) during Trust Agent provisioning. The Privacy CA must be a self-signed certificate. This certificate is unique to the Verification Service.</p>
<p>The Privacy CA certificate is used by Trust Agent nodes during Trust Agent provisioning; if the Privacy CA certificate is changed, all Trust Agent nodes will need to be re-provisioned.</p>
<div class="highlight"><pre><span></span><code>/etc/hvs/certs/trustedca/privacy-ca/privacy-ca-cert.pem
/etc/hvs/trusted-keys/privacy-ca.key
</code></pre></div>
<p>If the Privacy CA certificate is replaced, all Trust Agent hosts will need to be re-provisioned with a new AIK:</p>
<div class="highlight"><pre><span></span><code>tagent setup provision-attestation
</code></pre></div>
<p>Any Trust Agent hosts not reprovisioned will result in untrusted attestations, as the validation of the AIK used to sign the hosts' TPM quotes will no longer match the endorsement chain of the HVS.</p>
<h3 id="1224-endorsement-ca">12.2.4  Endorsement CA</h3>
<p>The Endorsement CA is a self-signed certificate used during Trust Agent provisioning.  </p>
<div class="highlight"><pre><span></span><code>/etc/hvs/certs/endorsement/EndorsementCA.pem`
/etc/hvs/trusted-keys/endorsement-ca.key
/etc/hvs/certs/endorsement/EndorsementCA-external.pem`
</code></pre></div>
<p>If the Endorsement CA certificate is replaced, all Trust Agent hosts will need to be re-provisioned with a new Endorsement Certificate:</p>
<div class="highlight"><pre><span></span><code>tagent setup provision-attestation
</code></pre></div>
<p>Any Trust Agent hosts not reprovisioned will result in untrusted attestations, as the validation of the AIK used to sign the hosts' TPM quotes will no longer match the endorsement chain of the HVS.</p>
<h2 id="123-regenerating-tls-certificates">12.3  Regenerating TLS Certificates</h2>
<p>TLS certificates for each service are issued by the Certificate Management Service during installation. If the CMS root certificate is changed, or to regenerate the TLS certificate for a given service, use the following commands (note: environment variables will need to be set; typically these are the same variables set in the service installation .env file):</p>
<ol>
<li>
<p><servicename> download_ca_cert`</p>
</li>
<li>
<p>Set up required environment variables.  These are some of the same variables that would be used in the .env installation file to install the service.  Note that a new/valid bearer token will be needed; this can be generated using the populate-users.sh script with the AAS, or by using the installation admin user credentials to get a token from the AAS API.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>CMS_BASE_URL=&lt;CMS API URL&gt;`
BEARER_TOKEN=&lt;token&gt;
</code></pre></div>
<ol>
<li>Use setup to re-download a new TLS certificate.</li>
</ol>
<div class="highlight"><pre><span></span><code>&lt;servicename&gt; download-cert-tls --force
</code></pre></div>
<p>This generates a new key pair and CSR, gets it signed by the CMS.</p>
<h2 id="124-replacing-self-signed-certificates">12.4 Replacing Self-Signed Certificates</h2>
<p>The CMS offers automatic generation of certificates based on a self-signed root CA. Certificates using this root CA may need to be replaced with certificates signed by a recognized CA. This effectively involves replacing the certificates deployed during installation with new certificates that use a hierarchy outside of the CMS.</p>
<p>To replace any non-TLS certificate, simply replace the existing certificate file with the new certificate and its private key.  Each certificate must include any intermediate certificate chain, excluding the root.  The root CA certificate must also be replaced so that the new hierarchy is used for validation.  </p>
<h3 id="tls-certificates">TLS Certificates</h3>
<p>To replace the TLS certificates in ISecL services, generate new TLS certificates for each service.  Each TLS certificate requires that a list of resolvable DNS hostnames and/or IP addresses be included as Subject Alternative Names in the new certificate.</p>
<p>Copy the new TLS certificates to the appropriate directories, overwriting the existing TLS certificates deployed by the CMS during installation:</p>
<div class="highlight"><pre><span></span><code>/etc/&lt;servicename&gt;/tls-cert.pem
/etc/&lt;servicename&gt;/tls.key
</code></pre></div>
<p>Copy the new root CA to each service, overwriting the CMS-created root CA:</p>
<div class="highlight"><pre><span></span><code>/etc/&lt;servicename&gt;/certs/trustedca/root/
</code></pre></div>
<p>Restart each service so that the changes take effect.</p>
<div style="page-break-after: always"></div>
<h1 id="13-uninstallation_1">13  Uninstallation</h1>
<p>This section describes steps used for uninstalling Intel SecL-DC
services.</p>
<ol>
<li>This section does not apply for containerized deployments. To
    uninstall a containerized deployment, simply shut down the container
    and delete the persistence volumes.</li>
</ol>
<h2 id="131-host-verification-service_1">13.1 Host Verification Service</h2>
<p>To uninstall the Verification Service, run the following command:</p>
<div class="highlight"><pre><span></span><code> hvs uninstall
</code></pre></div>
<p>The hvs uninstall command will not delete any database content. To
completely uninstall and delete all database content and user data, run
the following:</p>
<div class="highlight"><pre><span></span><code> hvs erase-data
</code></pre></div>
<div class="highlight"><pre><span></span><code> hvs uninstall
</code></pre></div>
<blockquote>
<p><strong><em>Note:</em></strong> <em>The uninstall command must be issued last, because the uninstall process removes the scripts that execute the other commands, along with all database connectivity info.</em></p>
</blockquote>
<h2 id="132-trust-agent_1">13.2  Trust Agent</h2>
<p>To uninstall the Trust Agent, run the following command:</p>
<div class="highlight"><pre><span></span><code> tagent uninstall
</code></pre></div>
<p>Backs up the configuration directory and removes all Trust Agent files,
except for configuration files which are saved and restored.</p>
<p>Removes following directories:</p>
<ol>
<li>
<p><code>/usr/local/bin/tagent</code></p>
</li>
<li>
<p><code>TRUSTAGENT_HOME</code> : `/opt/trustagent</p>
</li>
<li>
<p><code>/opt/tbootxm</code></p>
</li>
<li>
<p><code>/var/log/trustagent/measurement.*</code></p>
</li>
</ol>
<blockquote>
<p><strong><em>Note:</em></strong> <em>TPM ownership can be preserved by retaining the TPM owner secret. If
the Operating System will also be cleared, Linux systems will also
require the <code>/usr/local/var/lib/tpm/system.data</code> file to be preserved.
This file must be preserved from after ownership is taken, and then
replaced after the OS reload before the Trust Agent attempts to
reassert ownership.</em></p>
</blockquote>
<p>If the ownership secret and/or<code>system.data</code> file are not preserved,
reinstallation will require clearing TPM ownership.</p>
<h2 id="133-integration-hub_1">13.3  Integration Hub</h2>
<p>To uninstall the Integration Hub, run the following command:</p>
<div class="highlight"><pre><span></span><code>ihub uninstall
</code></pre></div>
<p>Removes the following directories:</p>
<ol>
<li>
<p><code>/usr/local/bin/ihub</code></p>
</li>
<li>
<p><code>/usr/bin/ihub</code></p>
</li>
<li>
<p><code>/opt/ihub</code></p>
</li>
<li>
<p><code>/etc/logrotate.d/ihub</code></p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>ihub uninstall --purge
</code></pre></div>
<p>Removes the following directories (in addition to directories removed
without the –purge option):</p>
<ol>
<li>Drops the database</li>
<li>Drops the user</li>
<li>Removes integration hub tenant configuration path</li>
</ol>
<div style="page-break-after: always"></div>
<h2 id="134-kubernetes-crds">13.4 Kubernetes CRDs</h2>
<p>Uninstalling the Intel® SecL Custom Resource Definitions </p>
<p>To unisntall the Intel® SecL CRDs, run the following commands on the Kubernetes Control Plane where the CRDs were installed:</p>
<div class="highlight"><pre><span></span><code>kubectl delete deploy -n isecl --all

rm -rf /opt/isecl-k8s-extensions

rm -rf /var/log/isecl-k8s-extensions
</code></pre></div>
<h1 id="14-appendix">14  Appendix</h1>
<h2 id="141-pcr-definitions_1">14.1  PCR Definitions</h2>
<h3 id="1411-microsoft-windows-server-2016-datacenter">14.1.1  Microsoft Windows Server 2016 Datacenter</h3>
<h4 id="14111-tpm-20_1">14.1.1.1  TPM 2.0</h4>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td>BIOS ROM and Flash Image</td>
<td>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as the PLATFORM Flavor</td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 12</td>
<td>Data events and highly volatile events</td>
<td>This PCR measures some of the modules which has boot counters in it. It changes on every boot and resume (Microsoft Windows ONLY; do not use for attestation as the values change on reboot)</td>
<td><ul>
<li><p>Microsoft Windows Server</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 13</td>
<td>Boot Module Details</td>
<td>This PCR remains static except major changes such as kernel module update, different device driver for different OEM servers, etc. (Microsoft Windows ONLY)</td>
<td><ul>
<li><p>Microsoft Windows Server</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 14</td>
<td>Boot Authorities</td>
<td>Used to record the Public keys of authorities that sign OS components. Expected not to change often. (Microsoft Windows ONLY)</td>
<td><ul>
<li><p>Microsoft Windows Server</p></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="1412-red-had-enterprise-linux">14.1.2  Red Had Enterprise Linux</h3>
<h4 id="14121-tpm-20">14.1.2.1  TPM 2.0</h4>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td><p>BIOS ROM and Flash Image</p>
<p>Initial Boot Block (Intel® BootGuard only)</p></td>
<td><p>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as the PLATFORM Flavor.</p>
<p>(Intel® BootGuard only): Extends measurements based on the Intel® BootGuard profile configuration and production vs non-production ACM flags; ACM signature; BootGuard key manifest hash; Boot Policy Manifest Signature</p></td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 7</td>
<td>Intel® BootGuard configuration and profiles</td>
<td>Describes the success of the IBB measurement event.</td>
<td><ul>
<li><p>All (Intel® BootGuard only)</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 17</td>
<td>ACM</td>
<td>BIOS AC registration information<br />
Digest of Processor S-CRTM<br />
Digest of Policycontrol<br />
Digest of all matching elements used by the policy<br />
Digest of STM<br />
Digest of Capability field of OsSinitData<br />
Digest of MLE<br />
For TA hosts, this PCR includes measurements of the OS, InitRD, and UUID. This changes with every install due to InitRD and UUID change.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>Digest of public key modulus used to verify SINIT signature<br />
Digest of Processor S-CRTM<br />
Digest of Capability field of OSSinitData table<br />
Digest of PolicyControl field of used policy<br />
Digest of LCP</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td><p>For ESXi and Trust Agent hosts, this PCR contains individual measurements of all of the non-Kernel modules.</p>
<p>For Linux hosts, this PCR is a measurement of the OS, InitRD, and UUID.</p></td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
</tbody>
</table>

<h3 id="1413-vmware-esxi">14.1.3  VMWare ESXi</h3>
<h4 id="14131-tpm-12">14.1.3.1  TPM 1.2</h4>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td>BIOS ROM and Flash Image</td>
<td>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as the PLATFORM Flavor.</td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 17</td>
<td>ACM</td>
<td>This PCR measures the SINIT ACM, and is hardware platform-specific. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>This PCR measures the tboot and hypervisor version. In ESXi hosts, only the tboot version is measured.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td><p>For ESXi and Trust Agent hosts, this PCR contains individual measurements of all of the non-Kernel modules.</p>
<p>For Citrix Xen hosts, this PCR is a measurement of the OS, InitRD, and UUID.</p></td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 20</td>
<td><p>For ESXi only.</p>
<p>VM Kernel and VMK Boot</p></td>
<td>This PCR is used only by ESXi hosts and is blank for all other host types.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 22</td>
<td>Asset Tag</td>
<td>This PCR contains the measurement of the SHA1 of the Asset Tag Certificate provisioned to the TPM, if any.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li></li>
</ul></td>
</tr>
</tbody>
</table>

<h4 id="14132-tpm-20">14.1.3.2  TPM 2.0</h4>
<p>VMWare supports TPM 2.0 with Intel TXT starting in vSphere 6.7 Update 1.
Earlier versions will support TPM 1.2 only.</p>
<table>
<thead>
<tr class="header">
<th>PCR</th>
<th>Measurement Parameters</th>
<th>Description</th>
<th>Operating System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PCR 0</td>
<td>BIOS ROM and Flash Image</td>
<td>This PCR is based solely on the BIOS version, and remains identical across all hosts using the same BIOS. This PCR is used as part of the PLATFORM flavor.</td>
<td><ul>
<li><p>All</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 17</td>
<td>ACM</td>
<td>This PCR measures the SINIT ACM, and is hardware platform-specific. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 18</td>
<td>MLE [Tboot +VMM]</td>
<td>This PCR measures the tboot and hypervisor version. In ESXi hosts, only the tboot version is measured. This PCR is part of the PLATFORM Flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 19</td>
<td><blockquote>
<p>OS Specific.</p>
</blockquote>
<ul>
<li><p>ESX and Trust Agent — non Kernel modules</p></li>
<li><p>Citrix Xen — OS</p></li>
<li><p>+ Init RD + UUID</p></li>
</ul></td>
<td>For ESXi this PCR contains individual measurements of all of the non-Kernel modules – this includes all of the VIBs installed on the ESXi host. This is part of the OS flavor. Note that two ESXi hosts with the same version of ESXi installed may require different OS flavors if different VIBs are installed.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li><p>Red Hat Enterprise Linux</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>PCR 20</td>
<td><p>For ESXi only.</p>
<p>VM Kernel and VMK Boot</p></td>
<td>This PCR is used only by ESXi hosts for some host-specific measurements, and is part of the host-unique flavor.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
</ul></td>
</tr>
<tr class="even">
<td>PCR 22</td>
<td>Asset Tag</td>
<td>Asset Tag is not currently supported for TPM 2.0 with ESXi.</td>
<td><ul>
<li><p>VMware ESXi</p></li>
<li></li>
</ul></td>
</tr>
</tbody>
</table>

<h2 id="a1-attestation-rules_1">A.1  Attestation Rules</h2>
<table>
<thead>
<tr class="header">
<th>Platform</th>
<th>TPM</th>
<th>Flavor Type</th>
<th>Rules to be verified</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>RHEL</td>
<td>2.0</td>
<td>HARDWARE</td>
<td><p>PcrMatchesConstant rule for PCR 0</p>
<p>PcrEventLogIncludes rule for PCR 17 (LCP_DETAILS_HASH, BIOSAC_REG_DATA, OSSINITDATA_CAP_HASH, STM_HASH, MLE_HASH, NV_INFO_HASH, tb_policy, CPU_SCRTM_STAT, HASH_START, LCP_CONTROL_HASH)</p>
<p>PcrEventLogIntegrity rule for PCR 17</p></td>
<td><p>Evaluation of PcrEventLogIncludes would not include initrd and vmlinuz modules. They would be handled in host_specific flavor.</p>
<p>Evaluation of PcrEventLogIntegrity rule would also include OS modules (initrd &amp; vmlinuz)</p></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td>PcrEventLogIntegrity rule for PCR 17</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>HOST_SPECIFIC</td>
<td>PcrEventLogIncludes rule for PCR 17 (initrd &amp; vmlinuz)</td>
<td></td>
</tr>
<tr class="odd">
<td>VMware ESXi</td>
<td>1.2</td>
<td>PLATFORM</td>
<td><p>PcrMatchesConstant rule for PCR 0</p>
<p>PcrMatchesConstant rule for PCR 17</p></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 18</p>
<p>PcrMatchesConstant rule for PCR 20</p>
<p>PcrEventLogEqualsExcluding rule for PCR 19 (excludes dynamic modules based on component name)</p>
<p>PcrEventLogIntegrity rule for PCR 19</p></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>PcrMatchesConstant rule for PCR 22</td>
<td></td>
</tr>
<tr class="even">
<td>VMware ESXi</td>
<td>2.0</td>
<td></td>
<td>NOT SUPPORTED</td>
<td></td>
</tr>
<tr class="odd">
<td>Windows</td>
<td>1.2</td>
<td>PLATFORM</td>
<td>PcrMatchesConstant rule for PCR 0</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 13</p>
<p>PcrMatchesConstant rule for PCR 14</p></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td></td>
</tr>
<tr class="even">
<td>Windows</td>
<td>2.0</td>
<td>PLATFORM</td>
<td>PcrMatchesConstant rule for PCR 0</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td>OS</td>
<td><p>PcrMatchesConstant rule for PCR 13</p>
<p>PcrMatchesConstant rule for PCR 14</p></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>ASSET_TAG</td>
<td>AssetTagMatches rule</td>
<td>AssetTagMatches rule needs to be updated to verify the key-value pairs after verifying the tag certificate.</td>
</tr>
</tbody>
</table>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote></blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../quick-start-guide/secure_key_caching/appendix/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Appendix
              </div>
            </div>
          </a>
        
        
          <a href="../Product%20Guide%20-%20Intel%C2%AE%20Security%20Libraries%20-%20Secure%20Key%20Caching/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Intel® Security Libraries - Datacenter SGX Attestation Infrastructure and Secure Key Caching
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>